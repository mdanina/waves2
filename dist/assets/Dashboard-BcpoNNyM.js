import{j as e,r as y}from"./vendor-radix-htwXsPHy.js";import{p as ls,a as wt}from"./friendly-and-clean-face-of-an-adult-person--gender (1)-mshj5uDX.js";import{c as ds,a as us}from"./friendly-and-clean-face-of-a-white-boy-7-yo--soft- (1)-BoJK1GJM.js";import{j as Ae,E as Ut,u as Bt,v as ne,C as ke,i as Qe,G as _t,U as Pe,J as fs,K as ms,N as Be,O as Ve,Q as qe,r as de,B as z,D as ve,R as hs,T as ct,V as Me,W as Ie,X as He,Y as Ge,Z as De,_ as Vt,L as xs,$ as qt,a0 as Ht,g as je,a1 as gs,o as ps,a2 as js,a3 as vs,p as bs,m as Se,a4 as ys,a as we,a5 as Ns,a6 as Ze,a7 as Ct,z as St,a8 as kt,a9 as At,x as ws,y as _s,w as Cs,aa as Et}from"./index-Dv2C02zj.js";import{isEligibleForCheckup as Ue,CHECKUP_MIN_AGE as Dt,CHECKUP_MAX_AGE as Ss,calculateAge as ks,deleteProfile as As}from"./profileStorage-CNyPVPjQ.js";import{u as Es}from"./useProfiles-ClG2Y7EV.js";import{u as Lt,a as Tt}from"./useAssessments-QHkX3uH7.js";import{b as Ds,a as Ls}from"./useAppointments-u0fKxR2v.js";import{f as Pt}from"./moscowTime-Bf471xDt.js";import{A as Xe,h as Je,a as et,b as tt,c as st,d as nt,e as rt,f as it,g as at}from"./alert-dialog-BJd2NNw3.js";import{S as Ts}from"./separator-CH7uCMjL.js";import{B as lt}from"./briefcase-KtA4t_fu.js";import{P as Ps}from"./play-CetBQGhi.js";import{G as Ms,B as Is}from"./graduation-cap-DtkN-T_E.js";import{S as Fs}from"./star-N_dgvkCe.js";import{g as zs,b as Os,a as Rs,r as $s}from"./calendar-feed-jqkEm5ax.js";import{C as Us}from"./copy-DUsxLmGa.js";import{T as Gt}from"./trash-2-C4DY-mZ7.js";import{A as Bs}from"./arrow-right-DuiPKs_q.js";import{u as Vs}from"./vendor-query-BNGVDYIL.js";import{u as qs}from"./vendor-react-CI8wve7f.js";import{E as ot}from"./eye-Qk7D3Dvv.js";import{P as Mt}from"./plus-CrCC_Tdd.js";import{P as Hs}from"./pencil-CiJyETcy.js";import"./vendor-charts-DjioKZbK.js";import"./assessmentStorage-C8gjZ2L4.js";import"./appointmentStorage-BM6-WgPI.js";const Gs="/assets/friendly-and-clean-vector-style-illustration-of-a--eflqllss.png",Ks="/assets/minimalistic-and-friendly-vector-style-illustratio%20(1)-o6xpfYcR.png",Ws={coral:"bg-gradient-to-br from-[#ffd4c4] via-[#ffb299] to-[#ff8a65]",blue:"bg-gradient-to-br from-[#E8F5FE] via-[#D4EDFC] to-[#C0E5FA]",pink:"bg-gradient-to-br from-[#FFE8F0] via-[#FFD6E8] to-[#FFC4E0]",lavender:"bg-[#F0E8F8]"};function It({children:t,className:s,gradient:r,hover:a=!1,...c}){return e.jsx("div",{...c,className:Ae("rounded-[20px] p-6 shadow-[0_4px_20px_rgba(0,0,0,0.06)]",r?Ws[r]:"bg-white",a&&"transition-all duration-300 hover:shadow-[0_6px_30px_rgba(0,0,0,0.1)] hover:scale-[1.02]",s),children:t})}const Ys={child_psychology:"Детская психология",family_therapy:"Семейная терапия",cbt:"КПТ",trauma:"Работа с травмой",anxiety:"Тревожные расстройства",depression:"Депрессия",adhd:"СДВГ",autism:"Аутизм",eating_disorders:"Расстройства питания",parenting:"Родительство",psychologist:"Психолог",psychiatrist:"Психиатр",psychotherapist:"Психотерапевт",clinical_psychologist:"Клинический психолог",child_psychologist:"Детский психолог",family_therapist:"Семейный терапевт",neuropsychologist:"Нейропсихолог",logopedist:"Логопед",defectologist:"Дефектолог",art_therapist:"Арт-терапевт",cbt_specialist:"Специалист по КПТ",coordinator:"Координатор"},Qs={higher:"Высшее образование",additional:"Дополнительное образование",certification:"Сертификация",course:"Курс"};function Zs({specialistId:t,showChangeButton:s=!0,onSpecialistChange:r}){const{toast:a}=Ut(),{user:c}=Bt(),[i,o]=y.useState(null),[u,d]=y.useState([]),[l,j]=y.useState(!0),[g,p]=y.useState(!1),[N,h]=y.useState(!1),[x,b]=y.useState(""),[m,f]=y.useState(!1),[C,T]=y.useState(!1);y.useEffect(()=>{O()},[t,c]);const O=async()=>{if(c)try{j(!0);let v=null;if(t){const{data:D,error:$}=await ne.from("specialists").select("*").eq("id",t).single();if($)throw $;v=D}else{const{data:D,error:$}=await ne.from("client_assignments").select("specialist_id").eq("client_user_id",c.id).eq("status","active").single();if($){if($.code==="PGRST116"){o(null),j(!1);return}throw $}const{data:G,error:K}=await ne.from("specialists").select("*").eq("id",D.specialist_id).single();if(K)throw K;v=G}if(o(v),v){const{data:D}=await ne.from("specialist_education").select("*").eq("specialist_id",v.id).order("year_end",{ascending:!1,nullsFirst:!1});d(D||[]);const{data:$}=await ne.from("specialist_change_requests").select("id").eq("client_user_id",c.id).eq("status","pending").single();T(!!$)}}catch(v){console.error("Error loading specialist data:",v),a({title:"Ошибка",description:"Не удалось загрузить данные специалиста",variant:"destructive"})}finally{j(!1)}},I=v=>{const D=v.match(/(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);if(D)return`https://www.youtube.com/embed/${D[1]}`;const $=v.match(/vimeo\.com\/(?:video\/)?(\d+)/);return $?`https://player.vimeo.com/video/${$[1]}`:null},k=async()=>{if(!(!c||!i))try{f(!0);const{error:v}=await ne.from("specialist_change_requests").insert({client_user_id:c.id,current_specialist_id:i.id,reason:x||null,status:"pending"});if(v)throw v;a({title:"Запрос отправлен",description:"Координатор рассмотрит ваш запрос на смену специалиста"}),h(!1),b(""),T(!0),r==null||r()}catch(v){console.error("Error submitting change request:",v),a({title:"Ошибка",description:"Не удалось отправить запрос",variant:"destructive"})}finally{f(!1)}},E=v=>v.split(" ").map($=>$[0]).join("").toUpperCase().slice(0,2),S=(v,D)=>v&&D?`${v} - ${D}`:D?`${D}`:v?`с ${v}`:null;if(l)return e.jsx(ke,{children:e.jsx(Qe,{className:"flex items-center justify-center py-12",children:e.jsx(_t,{className:"h-8 w-8 animate-spin text-muted-foreground"})})});if(!i)return e.jsx(ke,{children:e.jsxs(Qe,{className:"py-8 text-center",children:[e.jsx(Pe,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Вам пока не назначен специалист. После установочной встречи координатор подберёт для вас подходящего специалиста."})]})});const R=i.video_intro_url?I(i.video_intro_url):null;return e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(fs,{children:e.jsxs(ms,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5"}),"Ваш специалист"]})}),e.jsxs(Qe,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(Be,{className:"h-20 w-20",children:[e.jsx(Ve,{src:i.avatar_url||void 0}),e.jsx(qe,{className:"text-xl",children:E(i.display_name)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold",children:i.display_name}),i.experience_years&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(lt,{className:"h-4 w-4"}),"Опыт работы: ",i.experience_years," лет"]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx(de,{variant:i.is_available?"default":"secondary",children:i.is_available?"Доступен":"Не в сети"})})]})]}),i.specialization_codes.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Специализации:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.specialization_codes.map(v=>e.jsx(de,{variant:"outline",children:Ys[v]||v},v))})]}),i.bio&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"О специалисте:"}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:i.bio})]}),i.video_intro_url&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Видеовизитка:"}),e.jsxs(z,{variant:"outline",onClick:()=>p(!0),className:"w-full sm:w-auto",children:[e.jsx(Ps,{className:"mr-2 h-4 w-4"}),"Смотреть видео"]})]}),u.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium mb-3 flex items-center gap-2",children:[e.jsx(Ms,{className:"h-4 w-4"}),"Образование:"]}),e.jsx("div",{className:"space-y-3",children:u.map(v=>e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Is,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:v.institution})]}),v.specialty&&e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:v.specialty}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground pl-6",children:[S(v.year_start,v.year_end)&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"h-3 w-3"}),S(v.year_start,v.year_end)]}),e.jsx("span",{className:"px-2 py-0.5 bg-muted rounded",children:Qs[v.education_type]||v.education_type})]})]},v.id))})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(Ts,{}),C?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground p-3 bg-muted/50 rounded-lg",children:[e.jsx(hs,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Ваш запрос на смену специалиста рассматривается"})]}):e.jsxs(z,{variant:"outline",onClick:()=>h(!0),className:"w-full",children:[e.jsx(ct,{className:"mr-2 h-4 w-4"}),"Запросить смену специалиста"]})]})]})]}),e.jsx(Me,{open:g,onOpenChange:p,children:e.jsxs(Ie,{className:"max-w-3xl w-[90vw] p-0",children:[e.jsx(He,{className:"px-6 pt-6",children:e.jsxs(Ge,{children:["Видеовизитка ",i.display_name]})}),e.jsx("div",{className:"px-6 pb-6",children:R?e.jsx("div",{className:"relative w-full",style:{paddingBottom:"56.25%"},children:e.jsx("iframe",{className:"absolute top-0 left-0 w-full h-full rounded-lg",src:R,title:"Видеовизитка специалиста",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(De,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground",children:["Видео доступно по"," ",e.jsx("a",{href:i.video_intro_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"ссылке"})]})]})})]})}),e.jsx(Me,{open:N,onOpenChange:h,children:e.jsxs(Ie,{children:[e.jsxs(He,{children:[e.jsx(Ge,{children:"Запросить смену специалиста"}),e.jsx(Vt,{children:"Если вы чувствуете, что текущий специалист вам не подходит, вы можете запросить смену. Координатор подберет вам другого специалиста."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(xs,{htmlFor:"change-reason",children:"Причина смены (необязательно)"}),e.jsx(qt,{id:"change-reason",value:x,onChange:v=>b(v.target.value),placeholder:"Опишите, почему вы хотите сменить специалиста...",rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Это поможет координатору лучше подобрать нового специалиста"})]})}),e.jsxs(Ht,{children:[e.jsx(z,{variant:"outline",onClick:()=>h(!1),disabled:m,children:"Отмена"}),e.jsx(z,{onClick:k,disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"mr-2 h-4 w-4 animate-spin"}),"Отправка..."]}):"Отправить запрос"})]})]})})]})}async function Ft(){const{data:{user:t}}=await ne.auth.getUser();if(!t)return null;const{data:s,error:r}=await ne.rpc("get_pending_ratings_for_user",{p_user_id:t.id});return r?(console.error("Error fetching pending rating:",r),null):!s||s.length===0?null:s[0]}async function Xs(t){const{data:{user:s}}=await ne.auth.getUser();if(!s)return{success:!1,error:"Пользователь не авторизован"};const{error:r}=await ne.from("specialist_ratings").insert({appointment_id:t.appointment_id,client_user_id:s.id,specialist_id:t.specialist_id,rating:t.rating,review_text:t.review_text||null});return r?(console.error("Error submitting rating:",r),{success:!1,error:r.message}):{success:!0}}async function Js(t){const{error:s}=await ne.from("appointments").update({rating_skipped:!0}).eq("id",t);return s?(console.error("Error skipping rating:",s),{success:!1,error:s.message}):{success:!0}}async function en(t){if(!t||t.length===0)return"";const{data:s,error:r}=await ne.from("specializations").select("name").in("code",t);return r?(console.error("Error fetching specialization names:",r),""):(s==null?void 0:s.map(a=>a.name).join(", "))||""}function tn(t){return new Date(t).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Moscow"})}function sn({pendingRating:t,open:s,onClose:r,onSubmitted:a}){const[c,i]=y.useState(0),[o,u]=y.useState(0),[d,l]=y.useState(""),[j,g]=y.useState(!1),[p,N]=y.useState("");y.useEffect(()=>{i(0),u(0),l(""),N("")},[t==null?void 0:t.appointment_id]),y.useEffect(()=>{var f;((f=t==null?void 0:t.specialization_codes)==null?void 0:f.length)>0&&en(t.specialization_codes).then(N)},[t==null?void 0:t.specialization_codes]);const h=async()=>{if(c===0){je.error("Пожалуйста, выберите оценку");return}g(!0);const f=await Xs({appointment_id:t.appointment_id,specialist_id:t.specialist_id,rating:c,review_text:d.trim()||void 0});g(!1),f.success?(je.success("Спасибо за вашу оценку!"),a()):je.error(f.error||"Не удалось отправить оценку")},x=async()=>{g(!0);const f=await Js(t.appointment_id);g(!1),f.success?r():je.error(f.error||"Не удалось пропустить оценку")},b=f=>f.split(" ").map(C=>C[0]).join("").slice(0,2).toUpperCase(),m=o||c;return e.jsx(Me,{open:s,onOpenChange:f=>!f&&r(),children:e.jsxs(Ie,{className:"sm:max-w-md",children:[e.jsx(He,{children:e.jsx(Ge,{className:"text-center text-xl",children:"Как прошла консультация?"})}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs(Be,{className:"h-14 w-14",children:[e.jsx(Ve,{src:t.specialist_avatar||void 0}),e.jsx(qe,{className:"bg-primary/10 text-primary text-lg",children:b(t.specialist_name)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"font-semibold text-foreground truncate",children:t.specialist_name})]}),p&&e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:p}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ve,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:tn(t.scheduled_at)})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 py-4",children:[e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(f=>e.jsx("button",{type:"button",onClick:()=>i(f),onMouseEnter:()=>u(f),onMouseLeave:()=>u(0),className:"p-1 transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded","aria-label":`Оценка ${f} из 5`,children:e.jsx(Fs,{className:`h-10 w-10 transition-colors ${f<=m?"fill-yellow-400 text-yellow-400":"fill-none text-muted-foreground/50"}`})},f))}),m>0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[m===1&&"Очень плохо",m===2&&"Плохо",m===3&&"Нормально",m===4&&"Хорошо",m===5&&"Отлично"]})]}),e.jsxs("div",{children:[e.jsx(qt,{placeholder:"Поделитесь впечатлениями (необязательно)...",value:d,onChange:f=>l(f.target.value),rows:3,maxLength:1e3,className:"resize-none"}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right mt-1",children:[d.length,"/1000"]})]}),e.jsxs(Ht,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(z,{variant:"ghost",onClick:x,disabled:j,className:"w-full sm:w-auto",children:"Пропустить"}),e.jsx(z,{onClick:h,disabled:j||c===0,className:"w-full sm:w-auto",children:j?"Отправка...":"Отправить"})]})]})})}function nn({trigger:t}){const[s,r]=y.useState(!1),[a,c]=y.useState(!1),[i,o]=y.useState(null),[u,d]=y.useState(!1),{toast:l}=Ut();y.useEffect(()=>{s&&j()},[s]);const j=async()=>{c(!0);try{const x=await zs();o(x?Os(x):null)}catch(x){console.error("Ошибка загрузки токена:",x)}finally{c(!1)}},g=async()=>{c(!0);try{const x=await Rs();o(x.feedUrl),l({title:"Ссылка создана",description:"Скопируйте ссылку и добавьте в свой календарь"})}catch(x){l({title:"Ошибка",description:x instanceof Error?x.message:"Не удалось создать ссылку",variant:"destructive"})}finally{c(!1)}},p=async()=>{c(!0);try{await $s(),o(null),l({title:"Ссылка отозвана",description:"Старая ссылка больше не работает"})}catch(x){l({title:"Ошибка",description:x instanceof Error?x.message:"Не удалось отозвать ссылку",variant:"destructive"})}finally{c(!1)}},N=async()=>{if(i)try{await navigator.clipboard.writeText(i),d(!0),l({title:"Скопировано",description:"Ссылка скопирована в буфер обмена"}),setTimeout(()=>d(!1),2e3)}catch{l({title:"Ошибка",description:"Не удалось скопировать ссылку",variant:"destructive"})}},h=e.jsxs(z,{variant:"outline",size:"sm",className:"text-xs sm:text-sm",children:[e.jsx(ve,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Добавить в календарь"})]});return e.jsxs(Me,{open:s,onOpenChange:r,children:[e.jsx(gs,{asChild:!0,children:t||h}),e.jsxs(Ie,{className:"sm:max-w-md",children:[e.jsxs(He,{children:[e.jsxs(Ge,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-primary"}),"Добавьте сессии себе в календарь"]}),e.jsx(Vt,{children:"Создайте ссылку и добавьте её в календарь."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Google Календарь"}),e.jsx("p",{className:"text-muted-foreground",children:"Меню «Другие календари» — «Добавить по URL»"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Apple Календарь"}),e.jsx("p",{className:"text-muted-foreground",children:"Меню «Файл» — «Подписка на новый календарь...»"})]})]}),i?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ps,{value:i,readOnly:!0,className:"font-mono text-xs"}),e.jsx(z,{variant:"outline",size:"icon",onClick:N,disabled:a,children:u?e.jsx(js,{className:"h-4 w-4 text-green-500"}):e.jsx(Us,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"outline",size:"sm",onClick:g,disabled:a,className:"flex-1",children:[e.jsx(ct,{className:`h-4 w-4 mr-2 ${a?"animate-spin":""}`}),"Обновить ссылку"]}),e.jsx(z,{variant:"outline",size:"sm",onClick:p,disabled:a,className:"text-destructive hover:text-destructive",children:e.jsx(Gt,{className:"h-4 w-4"})})]})]}):e.jsxs(z,{onClick:g,disabled:a,className:"w-full bg-primary hover:bg-primary/90",children:[a?e.jsx(ct,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Создать ссылку"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Календарь будет автоматически обновляться при изменении ваших сессий. Не передавайте эту ссылку третьим лицам."})]})]})]})}function rn(t){return Object.prototype.toString.call(t)==="[object Object]"}function zt(t){return rn(t)||Array.isArray(t)}function an(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function ft(t,s){const r=Object.keys(t),a=Object.keys(s);if(r.length!==a.length)return!1;const c=JSON.stringify(Object.keys(t.breakpoints||{})),i=JSON.stringify(Object.keys(s.breakpoints||{}));return c!==i?!1:r.every(o=>{const u=t[o],d=s[o];return typeof u=="function"?`${u}`==`${d}`:!zt(u)||!zt(d)?u===d:ft(u,d)})}function Ot(t){return t.concat().sort((s,r)=>s.name>r.name?1:-1).map(s=>s.options)}function on(t,s){if(t.length!==s.length)return!1;const r=Ot(t),a=Ot(s);return r.every((c,i)=>{const o=a[i];return ft(c,o)})}function mt(t){return typeof t=="number"}function dt(t){return typeof t=="string"}function We(t){return typeof t=="boolean"}function Rt(t){return Object.prototype.toString.call(t)==="[object Object]"}function q(t){return Math.abs(t)}function ht(t){return Math.sign(t)}function Te(t,s){return q(t-s)}function cn(t,s){if(t===0||s===0||q(t)<=q(s))return 0;const r=Te(q(t),q(s));return q(r/t)}function ln(t){return Math.round(t*100)/100}function Fe(t){return ze(t).map(Number)}function ue(t){return t[Re(t)]}function Re(t){return Math.max(0,t.length-1)}function xt(t,s){return s===Re(t)}function $t(t,s=0){return Array.from(Array(t),(r,a)=>s+a)}function ze(t){return Object.keys(t)}function Kt(t,s){return[t,s].reduce((r,a)=>(ze(a).forEach(c=>{const i=r[c],o=a[c],u=Rt(i)&&Rt(o);r[c]=u?Kt(i,o):o}),r),{})}function ut(t,s){return typeof s.MouseEvent<"u"&&t instanceof s.MouseEvent}function dn(t,s){const r={start:a,center:c,end:i};function a(){return 0}function c(d){return i(d)/2}function i(d){return s-d}function o(d,l){return dt(t)?r[t](d):t(s,d,l)}return{measure:o}}function Oe(){let t=[];function s(c,i,o,u={passive:!0}){let d;if("addEventListener"in c)c.addEventListener(i,o,u),d=()=>c.removeEventListener(i,o,u);else{const l=c;l.addListener(o),d=()=>l.removeListener(o)}return t.push(d),a}function r(){t=t.filter(c=>c())}const a={add:s,clear:r};return a}function un(t,s,r,a){const c=Oe(),i=1e3/60;let o=null,u=0,d=0;function l(){c.add(t,"visibilitychange",()=>{t.hidden&&h()})}function j(){N(),c.clear()}function g(b){if(!d)return;o||(o=b,r(),r());const m=b-o;for(o=b,u+=m;u>=i;)r(),u-=i;const f=u/i;a(f),d&&(d=s.requestAnimationFrame(g))}function p(){d||(d=s.requestAnimationFrame(g))}function N(){s.cancelAnimationFrame(d),o=null,u=0,d=0}function h(){o=null,u=0}return{init:l,destroy:j,start:p,stop:N,update:r,render:a}}function fn(t,s){const r=s==="rtl",a=t==="y",c=a?"y":"x",i=a?"x":"y",o=!a&&r?-1:1,u=j(),d=g();function l(h){const{height:x,width:b}=h;return a?x:b}function j(){return a?"top":r?"right":"left"}function g(){return a?"bottom":r?"left":"right"}function p(h){return h*o}return{scroll:c,cross:i,startEdge:u,endEdge:d,measureSize:l,direction:p}}function _e(t=0,s=0){const r=q(t-s);function a(l){return l<t}function c(l){return l>s}function i(l){return a(l)||c(l)}function o(l){return i(l)?a(l)?t:s:l}function u(l){return r?l-r*Math.ceil((l-s)/r):l}return{length:r,max:s,min:t,constrain:o,reachedAny:i,reachedMax:c,reachedMin:a,removeOffset:u}}function Wt(t,s,r){const{constrain:a}=_e(0,t),c=t+1;let i=o(s);function o(p){return r?q((c+p)%c):a(p)}function u(){return i}function d(p){return i=o(p),g}function l(p){return j().set(u()+p)}function j(){return Wt(t,u(),r)}const g={get:u,set:d,add:l,clone:j};return g}function mn(t,s,r,a,c,i,o,u,d,l,j,g,p,N,h,x,b,m,f){const{cross:C,direction:T}=t,O=["INPUT","SELECT","TEXTAREA"],I={passive:!1},k=Oe(),E=Oe(),S=_e(50,225).constrain(N.measure(20)),R={mouse:300,touch:400},v={mouse:500,touch:600},D=h?43:25;let $=!1,G=0,K=0,ae=!1,fe=!1,te=!1,oe=!1;function re(_){if(!f)return;function F(W){(We(f)||f(_,W))&&ye(W)}const V=s;k.add(V,"dragstart",W=>W.preventDefault(),I).add(V,"touchmove",()=>{},I).add(V,"touchend",()=>{}).add(V,"touchstart",F).add(V,"mousedown",F).add(V,"touchcancel",Y).add(V,"contextmenu",Y).add(V,"click",he,!0)}function ee(){k.clear(),E.clear()}function be(){const _=oe?r:s;E.add(_,"touchmove",J,I).add(_,"touchend",Y).add(_,"mousemove",J,I).add(_,"mouseup",Y)}function me(_){const F=_.nodeName||"";return O.includes(F)}function ce(){return(h?v:R)[oe?"mouse":"touch"]}function U(_,F){const V=g.add(ht(_)*-1),W=j.byDistance(_,!h).distance;return h||q(_)<S?W:b&&F?W*.5:j.byIndex(V.get(),0).distance}function ye(_){const F=ut(_,a);oe=F,te=h&&F&&!_.buttons&&$,$=Te(c.get(),o.get())>=2,!(F&&_.button!==0)&&(me(_.target)||(ae=!0,i.pointerDown(_),l.useFriction(0).useDuration(0),c.set(o),be(),G=i.readPoint(_),K=i.readPoint(_,C),p.emit("pointerDown")))}function J(_){if(!ut(_,a)&&_.touches.length>=2)return Y(_);const V=i.readPoint(_),W=i.readPoint(_,C),ie=Te(V,G),Q=Te(W,K);if(!fe&&!oe&&(!_.cancelable||(fe=ie>Q,!fe)))return Y(_);const xe=i.pointerMove(_);ie>x&&(te=!0),l.useFriction(.3).useDuration(.75),u.start(),c.add(T(xe)),_.preventDefault()}function Y(_){const V=j.byDistance(0,!1).index!==g.get(),W=i.pointerUp(_)*ce(),ie=U(T(W),V),Q=cn(W,ie),xe=D-10*Q,ge=m+Q/50;fe=!1,ae=!1,E.clear(),l.useDuration(xe).useFriction(ge),d.distance(ie,!h),oe=!1,p.emit("pointerUp")}function he(_){te&&(_.stopPropagation(),_.preventDefault(),te=!1)}function se(){return ae}return{init:re,destroy:ee,pointerDown:se}}function hn(t,s){let a,c;function i(g){return g.timeStamp}function o(g,p){const h=`client${(p||t.scroll)==="x"?"X":"Y"}`;return(ut(g,s)?g:g.touches[0])[h]}function u(g){return a=g,c=g,o(g)}function d(g){const p=o(g)-o(c),N=i(g)-i(a)>170;return c=g,N&&(a=g),p}function l(g){if(!a||!c)return 0;const p=o(c)-o(a),N=i(g)-i(a),h=i(g)-i(c)>170,x=p/N;return N&&!h&&q(x)>.1?x:0}return{pointerDown:u,pointerMove:d,pointerUp:l,readPoint:o}}function xn(){function t(r){const{offsetTop:a,offsetLeft:c,offsetWidth:i,offsetHeight:o}=r;return{top:a,right:c+i,bottom:a+o,left:c,width:i,height:o}}return{measure:t}}function gn(t){function s(a){return t*(a/100)}return{measure:s}}function pn(t,s,r,a,c,i,o){const u=[t].concat(a);let d,l,j=[],g=!1;function p(b){return c.measureSize(o.measure(b))}function N(b){if(!i)return;l=p(t),j=a.map(p);function m(f){for(const C of f){if(g)return;const T=C.target===t,O=a.indexOf(C.target),I=T?l:j[O],k=p(T?t:a[O]);if(q(k-I)>=.5){b.reInit(),s.emit("resize");break}}}d=new ResizeObserver(f=>{(We(i)||i(b,f))&&m(f)}),r.requestAnimationFrame(()=>{u.forEach(f=>d.observe(f))})}function h(){g=!0,d&&d.disconnect()}return{init:N,destroy:h}}function jn(t,s,r,a,c,i){let o=0,u=0,d=c,l=i,j=t.get(),g=0;function p(){const I=a.get()-t.get(),k=!d;let E=0;return k?(o=0,r.set(a),t.set(a),E=I):(r.set(t),o+=I/d,o*=l,j+=o,t.add(o),E=j-g),u=ht(E),g=j,O}function N(){const I=a.get()-s.get();return q(I)<.001}function h(){return d}function x(){return u}function b(){return o}function m(){return C(c)}function f(){return T(i)}function C(I){return d=I,O}function T(I){return l=I,O}const O={direction:x,duration:h,velocity:b,seek:p,settled:N,useBaseFriction:f,useBaseDuration:m,useFriction:T,useDuration:C};return O}function vn(t,s,r,a,c){const i=c.measure(10),o=c.measure(50),u=_e(.1,.99);let d=!1;function l(){return!(d||!t.reachedAny(r.get())||!t.reachedAny(s.get()))}function j(N){if(!l())return;const h=t.reachedMin(s.get())?"min":"max",x=q(t[h]-s.get()),b=r.get()-s.get(),m=u.constrain(x/o);r.subtract(b*m),!N&&q(b)<i&&(r.set(t.constrain(r.get())),a.useDuration(25).useBaseFriction())}function g(N){d=!N}return{shouldConstrain:l,constrain:j,toggleActive:g}}function bn(t,s,r,a,c){const i=_e(-s+t,0),o=g(),u=j(),d=p();function l(h,x){return Te(h,x)<=1}function j(){const h=o[0],x=ue(o),b=o.lastIndexOf(h),m=o.indexOf(x)+1;return _e(b,m)}function g(){return r.map((h,x)=>{const{min:b,max:m}=i,f=i.constrain(h),C=!x,T=xt(r,x);return C?m:T||l(b,f)?b:l(m,f)?m:f}).map(h=>parseFloat(h.toFixed(3)))}function p(){if(s<=t+c)return[i.max];if(a==="keepSnaps")return o;const{min:h,max:x}=u;return o.slice(h,x)}return{snapsContained:d,scrollContainLimit:u}}function yn(t,s,r){const a=s[0],c=r?a-t:ue(s);return{limit:_e(c,a)}}function Nn(t,s,r,a){const i=s.min+.1,o=s.max+.1,{reachedMin:u,reachedMax:d}=_e(i,o);function l(p){return p===1?d(r.get()):p===-1?u(r.get()):!1}function j(p){if(!l(p))return;const N=t*(p*-1);a.forEach(h=>h.add(N))}return{loop:j}}function wn(t){const{max:s,length:r}=t;function a(i){const o=i-s;return r?o/-r:0}return{get:a}}function _n(t,s,r,a,c){const{startEdge:i,endEdge:o}=t,{groupSlides:u}=c,d=g().map(s.measure),l=p(),j=N();function g(){return u(a).map(x=>ue(x)[o]-x[0][i]).map(q)}function p(){return a.map(x=>r[i]-x[i]).map(x=>-q(x))}function N(){return u(l).map(x=>x[0]).map((x,b)=>x+d[b])}return{snaps:l,snapsAligned:j}}function Cn(t,s,r,a,c,i){const{groupSlides:o}=c,{min:u,max:d}=a,l=j();function j(){const p=o(i),N=!t||s==="keepSnaps";return r.length===1?[i]:N?p:p.slice(u,d).map((h,x,b)=>{const m=!x,f=xt(b,x);if(m){const C=ue(b[0])+1;return $t(C)}if(f){const C=Re(i)-ue(b)[0]+1;return $t(C,ue(b)[0])}return h})}return{slideRegistry:l}}function Sn(t,s,r,a,c){const{reachedAny:i,removeOffset:o,constrain:u}=a;function d(h){return h.concat().sort((x,b)=>q(x)-q(b))[0]}function l(h){const x=t?o(h):u(h),b=s.map((f,C)=>({diff:j(f-x,0),index:C})).sort((f,C)=>q(f.diff)-q(C.diff)),{index:m}=b[0];return{index:m,distance:x}}function j(h,x){const b=[h,h+r,h-r];if(!t)return h;if(!x)return d(b);const m=b.filter(f=>ht(f)===x);return m.length?d(m):ue(b)-r}function g(h,x){const b=s[h]-c.get(),m=j(b,x);return{index:h,distance:m}}function p(h,x){const b=c.get()+h,{index:m,distance:f}=l(b),C=!t&&i(b);if(!x||C)return{index:m,distance:h};const T=s[m]-f,O=h+j(T,0);return{index:m,distance:O}}return{byDistance:p,byIndex:g,shortcut:j}}function kn(t,s,r,a,c,i,o){function u(g){const p=g.distance,N=g.index!==s.get();i.add(p),p&&(a.duration()?t.start():(t.update(),t.render(1),t.update())),N&&(r.set(s.get()),s.set(g.index),o.emit("select"))}function d(g,p){const N=c.byDistance(g,p);u(N)}function l(g,p){const N=s.clone().set(g),h=c.byIndex(N.get(),p);u(h)}return{distance:d,index:l}}function An(t,s,r,a,c,i,o,u){const d={passive:!0,capture:!0};let l=0;function j(N){if(!u)return;function h(x){if(new Date().getTime()-l>10)return;o.emit("slideFocusStart"),t.scrollLeft=0;const f=r.findIndex(C=>C.includes(x));mt(f)&&(c.useDuration(0),a.index(f,0),o.emit("slideFocus"))}i.add(document,"keydown",g,!1),s.forEach((x,b)=>{i.add(x,"focus",m=>{(We(u)||u(N,m))&&h(b)},d)})}function g(N){N.code==="Tab"&&(l=new Date().getTime())}return{init:j}}function Le(t){let s=t;function r(){return s}function a(d){s=o(d)}function c(d){s+=o(d)}function i(d){s-=o(d)}function o(d){return mt(d)?d:d.get()}return{get:r,set:a,add:c,subtract:i}}function Yt(t,s){const r=t.scroll==="x"?o:u,a=s.style;let c=null,i=!1;function o(p){return`translate3d(${p}px,0px,0px)`}function u(p){return`translate3d(0px,${p}px,0px)`}function d(p){if(i)return;const N=ln(t.direction(p));N!==c&&(a.transform=r(N),c=N)}function l(p){i=!p}function j(){i||(a.transform="",s.getAttribute("style")||s.removeAttribute("style"))}return{clear:j,to:d,toggleActive:l}}function En(t,s,r,a,c,i,o,u,d){const j=Fe(c),g=Fe(c).reverse(),p=m().concat(f());function N(k,E){return k.reduce((S,R)=>S-c[R],E)}function h(k,E){return k.reduce((S,R)=>N(S,E)>0?S.concat([R]):S,[])}function x(k){return i.map((E,S)=>({start:E-a[S]+.5+k,end:E+s-.5+k}))}function b(k,E,S){const R=x(E);return k.map(v=>{const D=S?0:-r,$=S?r:0,G=S?"end":"start",K=R[v][G];return{index:v,loopPoint:K,slideLocation:Le(-1),translate:Yt(t,d[v]),target:()=>u.get()>K?D:$}})}function m(){const k=o[0],E=h(g,k);return b(E,r,!1)}function f(){const k=s-o[0]-1,E=h(j,k);return b(E,-r,!0)}function C(){return p.every(({index:k})=>{const E=j.filter(S=>S!==k);return N(E,s)<=.1})}function T(){p.forEach(k=>{const{target:E,translate:S,slideLocation:R}=k,v=E();v!==R.get()&&(S.to(v),R.set(v))})}function O(){p.forEach(k=>k.translate.clear())}return{canLoop:C,clear:O,loop:T,loopPoints:p}}function Dn(t,s,r){let a,c=!1;function i(d){if(!r)return;function l(j){for(const g of j)if(g.type==="childList"){d.reInit(),s.emit("slidesChanged");break}}a=new MutationObserver(j=>{c||(We(r)||r(d,j))&&l(j)}),a.observe(t,{childList:!0})}function o(){a&&a.disconnect(),c=!0}return{init:i,destroy:o}}function Ln(t,s,r,a){const c={};let i=null,o=null,u,d=!1;function l(){u=new IntersectionObserver(h=>{d||(h.forEach(x=>{const b=s.indexOf(x.target);c[b]=x}),i=null,o=null,r.emit("slidesInView"))},{root:t.parentElement,threshold:a}),s.forEach(h=>u.observe(h))}function j(){u&&u.disconnect(),d=!0}function g(h){return ze(c).reduce((x,b)=>{const m=parseInt(b),{isIntersecting:f}=c[m];return(h&&f||!h&&!f)&&x.push(m),x},[])}function p(h=!0){if(h&&i)return i;if(!h&&o)return o;const x=g(h);return h&&(i=x),h||(o=x),x}return{init:l,destroy:j,get:p}}function Tn(t,s,r,a,c,i){const{measureSize:o,startEdge:u,endEdge:d}=t,l=r[0]&&c,j=h(),g=x(),p=r.map(o),N=b();function h(){if(!l)return 0;const f=r[0];return q(s[u]-f[u])}function x(){if(!l)return 0;const f=i.getComputedStyle(ue(a));return parseFloat(f.getPropertyValue(`margin-${d}`))}function b(){return r.map((f,C,T)=>{const O=!C,I=xt(T,C);return O?p[C]+j:I?p[C]+g:T[C+1][u]-f[u]}).map(q)}return{slideSizes:p,slideSizesWithGaps:N,startGap:j,endGap:g}}function Pn(t,s,r,a,c,i,o,u,d){const{startEdge:l,endEdge:j,direction:g}=t,p=mt(r);function N(m,f){return Fe(m).filter(C=>C%f===0).map(C=>m.slice(C,C+f))}function h(m){return m.length?Fe(m).reduce((f,C,T)=>{const O=ue(f)||0,I=O===0,k=C===Re(m),E=c[l]-i[O][l],S=c[l]-i[C][j],R=!a&&I?g(o):0,v=!a&&k?g(u):0,D=q(S-v-(E+R));return T&&D>s+d&&f.push(C),k&&f.push(m.length),f},[]).map((f,C,T)=>{const O=Math.max(T[C-1]||0);return m.slice(O,f)}):[]}function x(m){return p?N(m,r):h(m)}return{groupSlides:x}}function Mn(t,s,r,a,c,i,o){const{align:u,axis:d,direction:l,startIndex:j,loop:g,duration:p,dragFree:N,dragThreshold:h,inViewThreshold:x,slidesToScroll:b,skipSnaps:m,containScroll:f,watchResize:C,watchSlides:T,watchDrag:O,watchFocus:I}=i,k=2,E=xn(),S=E.measure(s),R=r.map(E.measure),v=fn(d,l),D=v.measureSize(S),$=gn(D),G=dn(u,D),K=!g&&!!f,ae=g||!!f,{slideSizes:fe,slideSizesWithGaps:te,startGap:oe,endGap:re}=Tn(v,S,R,r,ae,c),ee=Pn(v,D,b,g,S,R,oe,re,k),{snaps:be,snapsAligned:me}=_n(v,G,S,R,ee),ce=-ue(be)+ue(te),{snapsContained:U,scrollContainLimit:ye}=bn(D,ce,me,f,k),J=K?U:me,{limit:Y}=yn(ce,J,g),he=Wt(Re(J),j,g),se=he.clone(),B=Fe(r),_=({dragHandler:le,scrollBody:Ce,scrollBounds:$e,options:{loop:H}})=>{H||$e.constrain(le.pointerDown()),Ce.seek()},F=({scrollBody:le,translate:Ce,location:$e,offsetLocation:H,previousLocation:pe,scrollLooper:ss,slideLooper:ns,dragHandler:rs,animation:is,eventHandler:pt,scrollBounds:as,options:{loop:jt}},vt)=>{const bt=le.settled(),os=!as.shouldConstrain(),yt=jt?bt:bt&&os,Nt=yt&&!rs.pointerDown();Nt&&is.stop();const cs=$e.get()*vt+pe.get()*(1-vt);H.set(cs),jt&&(ss.loop(le.direction()),ns.loop()),Ce.to(H.get()),Nt&&pt.emit("settle"),yt||pt.emit("scroll")},V=un(a,c,()=>_(X),le=>F(X,le)),W=.68,ie=J[he.get()],Q=Le(ie),xe=Le(ie),ge=Le(ie),P=Le(ie),Z=jn(Q,ge,xe,P,p,W),Ee=Sn(g,J,ce,Y,P),Ne=kn(V,he,se,Z,Ee,P,o),n=wn(Y),w=Oe(),A=Ln(s,r,o,x),{slideRegistry:L}=Cn(K,f,J,ye,ee,B),M=An(t,r,L,Ne,Z,w,o,I),X={ownerDocument:a,ownerWindow:c,eventHandler:o,containerRect:S,slideRects:R,animation:V,axis:v,dragHandler:mn(v,t,a,c,P,hn(v,c),Q,V,Ne,Z,Ee,he,o,$,N,h,m,W,O),eventStore:w,percentOfView:$,index:he,indexPrevious:se,limit:Y,location:Q,offsetLocation:ge,previousLocation:xe,options:i,resizeHandler:pn(s,o,c,r,v,C,E),scrollBody:Z,scrollBounds:vn(Y,ge,P,Z,$),scrollLooper:Nn(ce,Y,ge,[Q,ge,xe,P]),scrollProgress:n,scrollSnapList:J.map(n.get),scrollSnaps:J,scrollTarget:Ee,scrollTo:Ne,slideLooper:En(v,D,ce,fe,te,be,J,ge,r),slideFocus:M,slidesHandler:Dn(s,o,T),slidesInView:A,slideIndexes:B,slideRegistry:L,slidesToScroll:ee,target:P,translate:Yt(v,s)};return X}function In(){let t={},s;function r(l){s=l}function a(l){return t[l]||[]}function c(l){return a(l).forEach(j=>j(s,l)),d}function i(l,j){return t[l]=a(l).concat([j]),d}function o(l,j){return t[l]=a(l).filter(g=>g!==j),d}function u(){t={}}const d={init:r,emit:c,off:o,on:i,clear:u};return d}const Fn={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function zn(t){function s(i,o){return Kt(i,o||{})}function r(i){const o=i.breakpoints||{},u=ze(o).filter(d=>t.matchMedia(d).matches).map(d=>o[d]).reduce((d,l)=>s(d,l),{});return s(i,u)}function a(i){return i.map(o=>ze(o.breakpoints||{})).reduce((o,u)=>o.concat(u),[]).map(t.matchMedia)}return{mergeOptions:s,optionsAtMedia:r,optionsMediaQueries:a}}function On(t){let s=[];function r(i,o){return s=o.filter(({options:u})=>t.optionsAtMedia(u).active!==!1),s.forEach(u=>u.init(i,t)),o.reduce((u,d)=>Object.assign(u,{[d.name]:d}),{})}function a(){s=s.filter(i=>i.destroy())}return{init:r,destroy:a}}function Ke(t,s,r){const a=t.ownerDocument,c=a.defaultView,i=zn(c),o=On(i),u=Oe(),d=In(),{mergeOptions:l,optionsAtMedia:j,optionsMediaQueries:g}=i,{on:p,off:N,emit:h}=d,x=v;let b=!1,m,f=l(Fn,Ke.globalOptions),C=l(f),T=[],O,I,k;function E(){const{container:B,slides:_}=C;I=(dt(B)?t.querySelector(B):B)||t.children[0];const V=dt(_)?I.querySelectorAll(_):_;k=[].slice.call(V||I.children)}function S(B){const _=Mn(t,I,k,a,c,B,d);if(B.loop&&!_.slideLooper.canLoop()){const F=Object.assign({},B,{loop:!1});return S(F)}return _}function R(B,_){b||(f=l(f,B),C=j(f),T=_||T,E(),m=S(C),g([f,...T.map(({options:F})=>F)]).forEach(F=>u.add(F,"change",v)),C.active&&(m.translate.to(m.location.get()),m.animation.init(),m.slidesInView.init(),m.slideFocus.init(se),m.eventHandler.init(se),m.resizeHandler.init(se),m.slidesHandler.init(se),m.options.loop&&m.slideLooper.loop(),I.offsetParent&&k.length&&m.dragHandler.init(se),O=o.init(se,T)))}function v(B,_){const F=ee();D(),R(l({startIndex:F},B),_),d.emit("reInit")}function D(){m.dragHandler.destroy(),m.eventStore.clear(),m.translate.clear(),m.slideLooper.clear(),m.resizeHandler.destroy(),m.slidesHandler.destroy(),m.slidesInView.destroy(),m.animation.destroy(),o.destroy(),u.clear()}function $(){b||(b=!0,u.clear(),D(),d.emit("destroy"),d.clear())}function G(B,_,F){!C.active||b||(m.scrollBody.useBaseFriction().useDuration(_===!0?0:C.duration),m.scrollTo.index(B,F||0))}function K(B){const _=m.index.add(1).get();G(_,B,-1)}function ae(B){const _=m.index.add(-1).get();G(_,B,1)}function fe(){return m.index.add(1).get()!==ee()}function te(){return m.index.add(-1).get()!==ee()}function oe(){return m.scrollSnapList}function re(){return m.scrollProgress.get(m.offsetLocation.get())}function ee(){return m.index.get()}function be(){return m.indexPrevious.get()}function me(){return m.slidesInView.get()}function ce(){return m.slidesInView.get(!1)}function U(){return O}function ye(){return m}function J(){return t}function Y(){return I}function he(){return k}const se={canScrollNext:fe,canScrollPrev:te,containerNode:Y,internalEngine:ye,destroy:$,off:N,on:p,emit:h,plugins:U,previousScrollSnap:be,reInit:x,rootNode:J,scrollNext:K,scrollPrev:ae,scrollProgress:re,scrollSnapList:oe,scrollTo:G,selectedScrollSnap:ee,slideNodes:he,slidesInView:me,slidesNotInView:ce};return R(s,r),setTimeout(()=>d.emit("init"),0),se}Ke.globalOptions=void 0;function gt(t={},s=[]){const r=y.useRef(t),a=y.useRef(s),[c,i]=y.useState(),[o,u]=y.useState(),d=y.useCallback(()=>{c&&c.reInit(r.current,a.current)},[c]);return y.useEffect(()=>{ft(r.current,t)||(r.current=t,d())},[t,d]),y.useEffect(()=>{on(a.current,s)||(a.current=s,d())},[s,d]),y.useEffect(()=>{if(an()&&o){Ke.globalOptions=gt.globalOptions;const l=Ke(o,r.current,a.current);return i(l),()=>l.destroy()}else i(void 0)},[o,i]),[u,c]}gt.globalOptions=void 0;const Qt=y.createContext(null);function Ye(){const t=y.useContext(Qt);if(!t)throw new Error("useCarousel must be used within a <Carousel />");return t}const Zt=y.forwardRef(({orientation:t="horizontal",opts:s,setApi:r,plugins:a,className:c,children:i,...o},u)=>{const[d,l]=gt({...s,axis:t==="horizontal"?"x":"y"},a),[j,g]=y.useState(!1),[p,N]=y.useState(!1),h=y.useCallback(f=>{f&&(g(f.canScrollPrev()),N(f.canScrollNext()))},[]),x=y.useCallback(()=>{l==null||l.scrollPrev()},[l]),b=y.useCallback(()=>{l==null||l.scrollNext()},[l]),m=y.useCallback(f=>{f.key==="ArrowLeft"?(f.preventDefault(),x()):f.key==="ArrowRight"&&(f.preventDefault(),b())},[x,b]);return y.useEffect(()=>{!l||!r||r(l)},[l,r]),y.useEffect(()=>{if(l)return h(l),l.on("reInit",h),l.on("select",h),()=>{l==null||l.off("select",h)}},[l,h]),e.jsx(Qt.Provider,{value:{carouselRef:d,api:l,opts:s,orientation:t||((s==null?void 0:s.axis)==="y"?"vertical":"horizontal"),scrollPrev:x,scrollNext:b,canScrollPrev:j,canScrollNext:p},children:e.jsx("div",{ref:u,onKeyDownCapture:m,className:Ae("relative",c),role:"region","aria-roledescription":"carousel",...o,children:i})})});Zt.displayName="Carousel";const Xt=y.forwardRef(({className:t,...s},r)=>{const{carouselRef:a,orientation:c}=Ye();return e.jsx("div",{ref:a,className:"overflow-hidden",children:e.jsx("div",{ref:r,className:Ae("flex",c==="horizontal"?"-ml-4":"-mt-4 flex-col",t),...s})})});Xt.displayName="CarouselContent";const Jt=y.forwardRef(({className:t,...s},r)=>{const{orientation:a}=Ye();return e.jsx("div",{ref:r,role:"group","aria-roledescription":"slide",className:Ae("min-w-0 shrink-0 grow-0 basis-full",a==="horizontal"?"pl-4":"pt-4",t),...s})});Jt.displayName="CarouselItem";const es=y.forwardRef(({className:t,variant:s="outline",size:r="icon",...a},c)=>{const{orientation:i,scrollPrev:o,canScrollPrev:u}=Ye();return e.jsxs(z,{ref:c,variant:s,size:r,className:Ae("absolute h-8 w-8 rounded-full",i==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!u,onClick:o,...a,children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Previous slide"})]})});es.displayName="CarouselPrevious";const ts=y.forwardRef(({className:t,variant:s="outline",size:r="icon",...a},c)=>{const{orientation:i,scrollNext:o,canScrollNext:u}=Ye();return e.jsxs(z,{ref:c,variant:s,size:r,className:Ae("absolute h-8 w-8 rounded-full",i==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!u,onClick:o,...a,children:[e.jsx(Bs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Next slide"})]})});ts.displayName="CarouselNext";function fr(){const t=qs(),{user:s}=Bt(),{setCurrentProfileId:r,setCurrentProfile:a}=bs(),c=Ds(),i=Vs(),[o,u]=y.useState(null),[d,l]=y.useState(0),[j,g]=y.useState(null),[p,N]=y.useState(null),[h,x]=y.useState(!1),[b,m]=y.useState(null),f=y.useRef(null),[C,T]=y.useState(!1),[O,I]=y.useState(!0),[k,E]=y.useState(0),{data:S,isLoading:R,error:v}=Es(),{data:D,isLoading:$,error:G}=Ls();y.useEffect(()=>{Se.log("Dashboard data state:",{profiles:(S==null?void 0:S.length)||0,profilesLoading:R,profilesError:v==null?void 0:v.message,appointments:(D==null?void 0:D.length)||0,appointmentsLoading:$,appointmentsError:G==null?void 0:G.message,user:s==null?void 0:s.id})},[S,R,v,D,$,G,s]);const K=y.useMemo(()=>!S||!Array.isArray(S)?[]:S.map(n=>n.id),[S]),{data:ae,isLoading:fe}=Lt(K,"checkup"),{data:te,isLoading:oe}=Tt(K,"checkup"),re=y.useMemo(()=>{if(!S||!Array.isArray(S))return null;const n=S.find(w=>w.type==="parent");return(n==null?void 0:n.id)||null},[S]),{data:ee,isLoading:be}=Lt(re?[re]:[],"parent"),{data:me,isLoading:ce}=Tt(re?[re]:[],"parent"),U=y.useMemo(()=>{if(!S||!Array.isArray(S))return[];const n=ae||{},w=te||{},A=ee||{},L=me||{};return S.map(M=>M.type==="parent"?{...M,checkupAssessment:A[M.id]||null,activeCheckupAssessment:L[M.id]||null}:{...M,checkupAssessment:n[M.id]||null,activeCheckupAssessment:w[M.id]||null})},[S,ae,te,ee,me]),ye=R&&!S,J=fe&&ae===void 0&&K.length>0,Y=oe&&te===void 0&&K.length>0,B=ye||J||Y||be&&ee===void 0&&re!==null||ce&&me===void 0&&re!==null;y.useEffect(()=>{async function n(){try{await ne.rpc("update_appointment_statuses")}catch(w){console.error("Error updating appointment statuses:",w)}}n()},[]),y.useEffect(()=>{async function n(){try{const w=await Et();l(w)}catch(w){console.error("Error loading unread count:",w)}}s!=null&&s.id&&n()},[s==null?void 0:s.id]),y.useEffect(()=>{if(!(s!=null&&s.id))return;const n=ys(s.id,async()=>{const w=await Et();l(w)});return()=>n()},[s==null?void 0:s.id]),y.useEffect(()=>{async function n(){const w=await Ft();w&&(N(w),x(!0))}s!=null&&s.id&&n()},[s==null?void 0:s.id]),y.useMemo(()=>{if(!S||!Array.isArray(S))return null;const n=S.find(w=>w.type==="parent");return(n==null?void 0:n.first_name)||null},[S]);const _=y.useCallback(n=>n.type==="parent"?n.gender==="male"?ls:wt:n.type==="child"?n.gender==="male"?ds:us:wt,[]),F=y.useMemo(()=>D?D.filter(n=>n.status==="scheduled"||n.status==="in_progress"||n.status==="payment_pending"):[],[D]),V=y.useCallback(n=>{if(!n)return"Для меня (родитель)";const w=S==null?void 0:S.find(A=>A.id===n);return w?`${w.first_name}${w.last_name?` ${w.last_name}`:""}`:"Профиль не найден"},[S]),W=async n=>{try{await c.mutateAsync(n),u(null)}catch{}},ie=async n=>{try{await As(n),await i.invalidateQueries({queryKey:["profiles",s==null?void 0:s.id]}),m(null),je.success("Член семьи удален")}catch(w){Se.error("Error deleting profile:",w),je.error("Ошибка при удалении члена семьи")}},Q=y.useCallback(()=>{if(!f.current)return;const{scrollLeft:n,scrollWidth:w,clientWidth:A}=f.current;T(n>0),I(n<w-A-10);const M=Math.round(n/336);E(Math.max(0,Math.min(M,U.length-1)))},[U.length]);y.useEffect(()=>{if(U.length===0)return;Q();const n=f.current;if(n)return n.addEventListener("scroll",Q),window.addEventListener("resize",Q),()=>{n.removeEventListener("scroll",Q),window.removeEventListener("resize",Q)}},[U,Q]);const xe=y.useCallback(n=>{if(!f.current)return;const w=336,A=w,L=f.current.scrollLeft;let M=n==="left"?L-A:L+A;M=Math.max(0,Math.min(M,f.current.scrollWidth-f.current.clientWidth)),f.current.scrollTo({left:M,behavior:"smooth"});const X=Math.round(M/w);E(Math.max(0,Math.min(X,U.length-1)))},[U.length]),ge=y.useCallback(n=>{if(!f.current)return;f.current.scrollTo({left:n*336,behavior:"smooth"}),E(n)},[]),P=y.useMemo(()=>{const n=U.filter(H=>H.type==="child");if(n.length===0)return{allowed:!1,reason:"no_children"};const w=n.filter(H=>Ue(H.dob).eligible);if(w.length===0)return{allowed:!1,reason:"no_eligible_children"};if(w.find(H=>{const pe=H.activeCheckupAssessment;return pe&&pe.status==="in_progress"&&!pe.completed_at}))return{allowed:!0,reason:"active_checkup_exists"};const L=w.map(H=>{const pe=H.checkupAssessment;return pe&&pe.status==="completed"&&pe.completed_at?new Date(pe.completed_at):null}).filter(H=>H!==null),M=L.length>0?new Date(Math.max(...L.map(H=>H.getTime()))):null;if(!M)return{allowed:!0,reason:"no_previous_checkup"};const X=w.map(H=>new Date(H.created_at)).filter(H=>!isNaN(H.getTime())),le=X.length>0?new Date(Math.max(...X.map(H=>H.getTime()))):null;if(le&&le>M)return{allowed:!0,reason:"new_child_added"};const Ce=Math.floor((Date.now()-M.getTime())/(1e3*60*60*24));return Ce>=30?{allowed:!0,reason:"month_passed"}:{allowed:!1,reason:"too_soon",daysRemaining:30-Ce,lastCheckupDate:M}},[U]),Z=y.useMemo(()=>U.filter(w=>w.type==="child").some(w=>{var A;return((A=w.checkupAssessment)==null?void 0:A.status)==="completed"}),[U]),Ee=y.useMemo(()=>{const n=U.filter(A=>A.type==="child");return n.length===0?!1:n.every(A=>{const L=Ue(A.dob);return!L.eligible&&L.reason==="too_young"})},[U]),Ne=y.useCallback(()=>{Se.log("Checkup card clicked");const n=U.filter(L=>L.type==="child");if(n.length===0){t("/family-members");return}const w=n.filter(L=>Ue(L.dob).eligible);if(!P.allowed){if(P.reason==="no_eligible_children"){n.filter(M=>{const X=Ue(M.dob);return!X.eligible&&X.reason==="too_young"}).length>0?je.error("Чекап предназначен для детей от 3 до 18 лет. Ваш ребёнок ещё слишком маленький для прохождения чекапа."):je.error("Чекап предназначен для детей от 3 до 18 лет.");return}if(P.reason==="too_soon"){const L=P.daysRemaining||0,M=P.lastCheckupDate?new Date(P.lastCheckupDate).toLocaleDateString("ru-RU"):"";je.error(`Чекап можно пройти только раз в месяц или после добавления нового ребенка. Последний чекап был пройден ${M}. Повторно можно будет пройти через ${L} ${L===1?"день":L<5?"дня":"дней"}.`)}return}if(P.reason==="active_checkup_exists"){const L=w.find(M=>M.activeCheckupAssessment);if(L){Se.log("Resuming checkup for child:",L.first_name),r(L.id),a(L),t(`/checkup-intro/${L.id}`);return}}const A=w[0];A&&(Se.log("Starting checkup for child:",A.first_name),r(A.id),a(A),t(`/checkup-intro/${A.id}`))},[U,t,r,a,P]);return y.useEffect(()=>{v&&(Se.error("Error loading profiles:",v),je.error("Не удалось загрузить данные. Попробуйте обновить страницу."))},[v]),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 pt-8 pb-8",children:[(v||G)&&e.jsxs("div",{className:"mb-6 rounded-lg border border-destructive bg-destructive/10 p-4",children:[e.jsxs("p",{className:"text-sm font-medium text-destructive mb-2",children:[v&&`Ошибка загрузки профилей: ${v instanceof Error?v.message:"Неизвестная ошибка"}`,G&&`Ошибка загрузки консультаций: ${G instanceof Error?G.message:"Неизвестная ошибка"}`]}),e.jsx(z,{variant:"outline",size:"sm",onClick:()=>window.location.reload(),children:"Обновить страницу"})]}),F.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsx(we,{size:"xl",children:"Ваши предстоящие консультации"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>t("/cabinet/settings?tab=notifications"),className:"text-xs sm:text-sm",children:[e.jsx(Ns,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Настроить уведомления"})]}),e.jsx(nn,{})]})]}),F.length===1?e.jsx("div",{className:"space-y-4",children:F.map(n=>{var w;return e.jsx("div",{className:`rounded-xl border border-white/30 p-4 sm:p-6 text-card-foreground shadow-soft overflow-hidden ${n.status==="payment_pending"?"border-amber-300/50":""}`,style:{background:n.status==="payment_pending"?"linear-gradient(108deg, rgba(255, 193, 7, 0.35) 0%, rgba(255, 193, 7, 0.2) 100%)":"linear-gradient(108deg, rgba(255, 255, 255, 0.45) 0%, rgba(255, 255, 255, 0.25) 100%)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n.status==="payment_pending"?e.jsxs(de,{variant:"secondary",className:"bg-honey-pale text-foreground border-honey hover:bg-honey-pale font-light",children:[e.jsx(Ze,{className:"h-3 w-3 mr-1"}),"Ожидает оплаты"]}):n.payment_id?e.jsxs(de,{variant:"secondary",className:"bg-sage-pale text-foreground border-sage hover:bg-sage-pale font-light",children:[e.jsx(Ct,{className:"h-3 w-3 mr-1"}),"Оплачено"]}):null,n.status==="in_progress"&&e.jsxs(de,{variant:"default",className:"bg-success hover:bg-success font-light",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-white animate-pulse mr-1"}),"Идет сейчас"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(ve,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Дата и время"}),e.jsx("p",{className:"font-medium truncate",children:Pt(n.scheduled_at)})]})]}),n.appointment_type&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(St,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Тип консультации"}),e.jsxs("p",{className:"font-medium truncate",children:[n.appointment_type.name," (",n.appointment_type.duration_minutes," минут)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Pe,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Для кого"}),e.jsx("p",{className:"font-medium truncate",children:V(n.profile_id)})]})]}),n.status==="payment_pending"&&n.payment_expires_at&&e.jsxs("div",{className:"p-3 bg-honey-pale border border-honey rounded-lg",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[e.jsx("strong",{children:"Срок оплаты:"})," ",new Date(n.payment_expires_at).toLocaleString("ru-RU",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Moscow"})," (МСК)"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"После истечения срока запись будет автоматически отменена"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:ml-0 w-full md:w-auto md:min-w-[200px]",children:[n.specialist&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg cursor-pointer hover:bg-muted transition-colors mb-2",onClick:()=>g(n.specialist.id),children:[e.jsxs(Be,{className:"h-10 w-10",children:[e.jsx(Ve,{src:n.specialist.avatar_url||void 0}),e.jsx(qe,{children:((w=n.specialist.display_name)==null?void 0:w.split(" ").map(A=>A[0]).join("").slice(0,2).toUpperCase())||"?"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Специалист"}),e.jsx("p",{className:"font-medium",children:n.specialist.display_name}),n.specialist.experience_years&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(lt,{className:"h-3 w-3"}),"Опыт: ",n.specialist.experience_years," лет"]})]}),e.jsx(ot,{className:"h-4 w-4 text-muted-foreground"})]}),n.status!=="payment_pending"&&n.video_room_url&&(()=>{const A=new Date(n.scheduled_at),L=new Date,M=(A.getTime()-L.getTime())/1e3/60;return n.status==="in_progress"||M<=15?e.jsxs(z,{variant:n.status==="in_progress"?"default":"outline",size:"sm",onClick:()=>window.open(n.video_room_url,"_blank"),className:n.status==="in_progress"?"bg-success hover:bg-success/90":"",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),n.status==="in_progress"?"Войти сейчас":"Войти в комнату"]}):e.jsxs(z,{variant:"outline",size:"sm",disabled:!0,className:"opacity-50",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Доступно за 15 мин"]})})(),n.status==="payment_pending"&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Ссылка на оплату отправлена на email"}),n.status!=="payment_pending"&&e.jsxs(Xe,{open:o===n.id,onOpenChange:A=>u(A?n.id:null),children:[e.jsx(Je,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-destructive hover:bg-muted/50 font-light",children:[e.jsx(kt,{className:"h-4 w-4 mr-2"}),"Отменить"]})}),e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(st,{children:"Отменить консультацию?"}),e.jsx(nt,{children:"Вы уверены, что хотите отменить консультацию? Это действие нельзя отменить."})]}),e.jsxs(rt,{children:[e.jsx(it,{children:"Нет, оставить"}),e.jsx(at,{onClick:()=>W(n.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Да, отменить"})]})]})]})]})]})},n.id)})}):e.jsxs(Zt,{opts:{align:"start",loop:!1},className:"w-full",children:[e.jsx(Xt,{className:"-ml-2 md:-ml-4",children:F.map(n=>{var w;return e.jsx(Jt,{className:"pl-2 md:pl-4 basis-full md:basis-[calc(50%-8px)] lg:basis-[calc(50%-8px)]",children:e.jsx("div",{className:`rounded-xl border border-white/30 p-4 sm:p-6 text-card-foreground shadow-soft overflow-hidden h-full ${n.status==="payment_pending"?"border-amber-300/50":""}`,style:{background:n.status==="payment_pending"?"linear-gradient(108deg, rgba(255, 193, 7, 0.35) 0%, rgba(255, 193, 7, 0.2) 100%)":"linear-gradient(108deg, rgba(255, 255, 255, 0.45) 0%, rgba(255, 255, 255, 0.25) 100%)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n.status==="payment_pending"?e.jsxs(de,{variant:"secondary",className:"bg-honey-pale text-foreground border-honey hover:bg-honey-pale font-light",children:[e.jsx(Ze,{className:"h-3 w-3 mr-1"}),"Ожидает оплаты"]}):n.payment_id?e.jsxs(de,{variant:"secondary",className:"bg-sage-pale text-foreground border-sage hover:bg-sage-pale font-light",children:[e.jsx(Ct,{className:"h-3 w-3 mr-1"}),"Оплачено"]}):null,n.status==="in_progress"&&e.jsxs(de,{variant:"default",className:"bg-success hover:bg-success font-light",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-white animate-pulse mr-1"}),"Идет сейчас"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(ve,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Дата и время"}),e.jsx("p",{className:"font-medium truncate",children:Pt(n.scheduled_at)})]})]}),n.appointment_type&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(St,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Тип консультации"}),e.jsxs("p",{className:"font-medium truncate",children:[n.appointment_type.name," (",n.appointment_type.duration_minutes," минут)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Pe,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Для кого"}),e.jsx("p",{className:"font-medium truncate",children:V(n.profile_id)})]})]}),n.status==="payment_pending"&&n.payment_expires_at&&e.jsxs("div",{className:"p-3 bg-honey-pale border border-honey rounded-lg",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[e.jsx("strong",{children:"Срок оплаты:"})," ",new Date(n.payment_expires_at).toLocaleString("ru-RU",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Moscow"})," (МСК)"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"После истечения срока запись будет автоматически отменена"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[n.specialist&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg cursor-pointer hover:bg-muted transition-colors mb-2",onClick:()=>g(n.specialist.id),children:[e.jsxs(Be,{className:"h-10 w-10",children:[e.jsx(Ve,{src:n.specialist.avatar_url||void 0}),e.jsx(qe,{children:((w=n.specialist.display_name)==null?void 0:w.split(" ").map(A=>A[0]).join("").slice(0,2).toUpperCase())||"?"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Специалист"}),e.jsx("p",{className:"font-medium",children:n.specialist.display_name}),n.specialist.experience_years&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(lt,{className:"h-3 w-3"}),"Опыт: ",n.specialist.experience_years," лет"]})]}),e.jsx(ot,{className:"h-4 w-4 text-muted-foreground"})]}),n.status!=="payment_pending"&&n.video_room_url&&(()=>{const A=new Date(n.scheduled_at),L=new Date,M=(A.getTime()-L.getTime())/1e3/60;return n.status==="in_progress"||M<=15?e.jsxs(z,{variant:n.status==="in_progress"?"default":"outline",size:"sm",onClick:()=>window.open(n.video_room_url,"_blank"),className:n.status==="in_progress"?"bg-success hover:bg-success/90":"",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),n.status==="in_progress"?"Войти сейчас":"Войти в комнату"]}):e.jsxs(z,{variant:"outline",size:"sm",disabled:!0,className:"opacity-50",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Доступно за 15 мин"]})})(),n.status==="payment_pending"&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Ссылка на оплату отправлена на email"}),n.status!=="payment_pending"&&e.jsxs(Xe,{open:o===n.id,onOpenChange:A=>u(A?n.id:null),children:[e.jsx(Je,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-destructive hover:bg-muted/50 font-light",children:[e.jsx(kt,{className:"h-4 w-4 mr-2"}),"Отменить"]})}),e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(st,{children:"Отменить консультацию?"}),e.jsx(nt,{children:"Вы уверены, что хотите отменить консультацию? Это действие нельзя отменить."})]}),e.jsxs(rt,{children:[e.jsx(it,{children:"Нет, оставить"}),e.jsx(at,{onClick:()=>W(n.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Да, отменить"})]})]})]})]})]})})},n.id)})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4",children:[e.jsx(es,{className:"static translate-y-0 h-8 w-8"}),e.jsx(ts,{className:"static translate-y-0 h-8 w-8"})]})]})]}),B?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})}):null,e.jsx("div",{className:"mb-8",children:e.jsx(we,{size:"xl",className:"mb-4",children:"С чего начать?"})}),Ee&&e.jsxs("div",{className:"mb-8 flex items-start gap-3 rounded-xl border border-amber-200 bg-amber-50 p-4 text-amber-800",children:[e.jsx(Ze,{className:"mt-0.5 h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Чекап для детей до ",Dt," лет пока недоступен"]}),e.jsxs("p",{className:"mt-1 text-amber-700",children:["Наш чекап разработан для детей от ",Dt," до ",Ss," лет. Однако вы можете получить консультацию специалиста для себя как родителя. Для этого напишите в поддержку — мы поможем записаться."]}),e.jsxs(z,{variant:"outline",size:"sm",className:"mt-3 border-amber-300 text-amber-800 hover:bg-amber-100",onClick:()=>t("/cabinet/messages"),children:[e.jsx(At,{className:"h-4 w-4 mr-2"}),"Написать в поддержку"]})]})]}),e.jsxs("div",{className:"mb-12 grid gap-6 md:grid-cols-2 md:items-stretch",children:[e.jsx("div",{className:"flex flex-col gap-4 h-full",children:e.jsxs(It,{className:`group relative overflow-hidden p-8 transition-all flex flex-col ${P.allowed?"cursor-pointer hover:scale-[1.02] active:scale-[0.98]":"cursor-not-allowed opacity-75"}`,gradient:P.allowed?"pink":void 0,hover:P.allowed,style:{height:"100%",minHeight:"340px"},onClick:n=>{if(!P.allowed){n.preventDefault(),n.stopPropagation();return}n.preventDefault(),n.stopPropagation(),Ne()},role:"button",tabIndex:P.allowed?0:-1,onKeyDown:n=>{P.allowed&&(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),Ne())},children:[e.jsx("div",{className:"absolute top-4 right-4 w-12 h-12 rounded-full bg-honey flex items-center justify-center shadow-soft pointer-events-none z-10",children:e.jsx("span",{className:"text-ink font-light text-xl",children:"1"})}),e.jsxs("div",{className:"flex flex-col items-center text-center justify-center flex-1",onClick:n=>{if(!P.allowed){n.stopPropagation();return}n.stopPropagation(),Ne()},children:[e.jsx("img",{src:Ks,alt:"Проверка психического здоровья семьи",className:`mb-6 h-40 w-auto object-contain transition-transform pointer-events-none ${P.allowed?"group-hover:scale-110":""}`}),e.jsx(we,{size:"lg",className:`mb-2 transition-colors pointer-events-none ${P.allowed?"group-hover:text-coral":"text-muted-foreground"}`,children:"Пройти чекап"}),P.allowed&&P.reason==="active_checkup_exists"&&e.jsx("p",{className:`text-lg font-medium pointer-events-none ${P.allowed?"text-muted-foreground":"text-muted-foreground/70"}`,children:"Продолжить проверку"}),!P.allowed&&P.reason==="too_soon"&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs(de,{variant:"secondary",className:"bg-muted text-muted-foreground border border-border/50 px-4 py-2 rounded-full font-light hover:bg-muted",children:[e.jsx(ve,{className:"h-3.5 w-3.5 mr-2"}),P.daysRemaining?`Повторно можно пройти через ${P.daysRemaining} ${P.daysRemaining===1?"день":P.daysRemaining<5?"дня":"дней"}`:"Чекап можно пройти только раз в месяц или после добавления нового ребенка"]})})]})]})}),e.jsx("div",{children:e.jsxs(It,{className:`group relative overflow-hidden p-8 transition-all flex flex-col ${Z?"cursor-pointer hover:scale-[1.02] active:scale-[0.98]":"cursor-not-allowed opacity-75"}`,gradient:Z?"lavender":void 0,hover:Z,style:{height:"100%",minHeight:"340px"},onClick:()=>Z&&t("/appointments"),role:Z?"button":void 0,tabIndex:Z?0:-1,onKeyDown:n=>{Z&&(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),t("/appointments"))},children:[e.jsx("div",{className:"absolute top-4 right-4 w-12 h-12 rounded-full bg-honey flex items-center justify-center shadow-soft pointer-events-none z-10",children:e.jsx("span",{className:"text-ink font-light text-xl",children:"2"})}),e.jsxs("div",{className:"flex flex-col items-center text-center justify-center flex-1",children:[e.jsx("img",{src:Gs,alt:"Waves Portal",className:`mb-6 h-40 w-auto object-contain transition-transform pointer-events-none ${Z?"group-hover:scale-110":""}`}),e.jsx(we,{size:"lg",className:`mb-2 transition-colors pointer-events-none ${Z?"text-foreground group-hover:text-coral":"text-muted-foreground"}`,children:"Получить консультацию"}),!Z&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs(de,{variant:"secondary",className:"bg-muted text-muted-foreground border border-border/50 px-4 py-2 rounded-full font-light hover:bg-muted",children:[e.jsx(ve,{className:"h-3.5 w-3.5 mr-2"}),"Для доступа к консультациям пройдите чекап"]})})]})]})})]}),e.jsxs("div",{className:"mb-12",children:[e.jsx(we,{size:"xl",className:"mb-4",children:"Есть вопросы?"}),e.jsxs(ke,{className:"border-2 bg-white p-6",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Напишите в поддержку, чтобы решить любые проблемы или записаться к специалисту напрямую без предварительной диагностики."}),e.jsxs(z,{onClick:()=>t("/cabinet/messages"),children:[e.jsx(At,{className:"h-4 w-4 mr-2"}),"Написать в поддержку"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx(we,{size:"xl",children:"Ваша семья"}),U.length>0&&e.jsxs(z,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground hover:bg-muted/50 font-light",onClick:()=>t("/add-family-member",{state:{from:"cabinet"}}),children:[e.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Добавить члена семьи"]})]}),U.length===0?e.jsxs(ke,{className:"border-2 bg-card p-8 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Пока нет членов семьи"}),e.jsxs(z,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground hover:bg-muted/50 font-light",onClick:()=>t("/add-family-member",{state:{from:"cabinet"}}),children:[e.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Добавить члена семьи"]})]}):e.jsxs("div",{className:"relative",children:[C&&e.jsx(z,{variant:"ghost",size:"icon",className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 h-10 w-10 rounded-full bg-white/90 hover:bg-white shadow-md",onClick:()=>xe("left"),"aria-label":"Предыдущая карточка",children:e.jsx(ws,{className:"h-5 w-5 text-ink"})}),O&&e.jsx(z,{variant:"ghost",size:"icon",className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 h-10 w-10 rounded-full bg-white/90 hover:bg-white shadow-md",onClick:()=>xe("right"),"aria-label":"Следующая карточка",children:e.jsx(_s,{className:"h-5 w-5 text-ink"})}),e.jsx("div",{ref:f,className:"flex gap-4 overflow-x-auto pb-4 scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch",touchAction:"pan-x"},onScroll:Q,children:U.map(n=>{var M,X;const w=n.dob?ks(n.dob):null,A=((M=n.checkupAssessment)==null?void 0:M.status)==="completed",L=(X=n.checkupAssessment)!=null&&X.completed_at?new Date(n.checkupAssessment.completed_at).toLocaleDateString("ru-RU"):null;return e.jsx(ke,{className:"min-w-[320px] flex-shrink-0 flex flex-col border-2 bg-card p-6 shadow-sm transition-all hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col items-center text-center flex-1",children:[e.jsx("img",{src:_(n),alt:`${n.first_name} ${n.last_name||""}`,className:"h-20 w-20 rounded-full object-cover mb-4"}),e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs(we,{size:"lg",children:[n.first_name," ",n.last_name||""]})}),w!==null&&e.jsxs("p",{className:"text-muted-foreground mb-2",children:[w," лет"]}),A&&e.jsxs(de,{variant:"default",className:"bg-success text-success-foreground hover:bg-success font-light mb-2",children:[e.jsx(Cs,{className:"h-3 w-3 mr-1"}),"Чекап завершен"]}),A&&L&&e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Завершен: ",L]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-auto w-full",children:[A&&e.jsxs(z,{variant:"outline",size:"sm",className:"w-full",onClick:()=>t(`/results-report?profileId=${n.id}`),children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"Посмотреть результаты"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"ghost",size:"sm",className:"flex-1 text-muted-foreground hover:text-foreground hover:bg-muted/50 font-light",onClick:()=>t(`/edit-family-member/${n.id}`,{state:{from:"cabinet"}}),children:[e.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Редактировать"]}),e.jsxs(Xe,{open:b===n.id,onOpenChange:le=>m(le?n.id:null),children:[e.jsx(Je,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"flex-1 text-muted-foreground hover:text-destructive hover:bg-muted/50 font-light",onClick:()=>m(n.id),children:[e.jsx(Gt,{className:"h-4 w-4 mr-2"}),"Удалить"]})}),e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(st,{children:"Удалить члена семьи?"}),e.jsxs(nt,{children:["Вы уверены, что хотите удалить ",n.first_name," ",n.last_name||"","? Это действие нельзя будет отменить."]})]}),e.jsxs(rt,{children:[e.jsx(it,{children:"Отмена"}),e.jsx(at,{onClick:()=>ie(n.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Удалить"})]})]})]})]})]})]})},n.id)})}),U.length>1&&e.jsx("div",{className:"flex justify-center gap-2 mt-4",children:U.map((n,w)=>e.jsx("button",{className:`h-2 w-2 rounded-full transition-colors ${w===k?"bg-honey":"bg-muted-foreground/30 hover:bg-muted-foreground/60"}`,onClick:()=>ge(w),"aria-label":`Перейти к карточке ${w+1}`},w))})]})]}),e.jsx(Me,{open:!!j,onOpenChange:n=>!n&&g(null),children:e.jsx(Ie,{className:"max-w-2xl w-[90vw] max-h-[90vh] overflow-y-auto p-0 bg-background",style:{background:"var(--bg-golden-hour)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed"},children:e.jsx("div",{className:"px-6 pb-6 pt-6",children:j&&e.jsx(Zs,{specialistId:j,showChangeButton:!0,onSpecialistChange:()=>g(null)})})})}),p&&e.jsx(sn,{pendingRating:p,open:h,onClose:()=>{x(!1),N(null)},onSubmitted:async()=>{x(!1),N(null);const n=await Ft();n&&(N(n),x(!0))}})]})}export{fr as default};
