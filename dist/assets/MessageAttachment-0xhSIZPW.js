import{h as x,B as N,Z as v,a6 as C,F as S}from"./index-Dt6uKTGi.js";import{r as i,j as t}from"./vendor-radix-CDHcN1cP.js";import{q as I}from"./supabase-messages-C9v4Eu2L.js";import{D as R}from"./download-zFy5GEJo.js";import{I as U,F}from"./image-B9uhbZ1Z.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=x("ImageOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=x("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=x("Stethoscope",[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);function A(){return()=>{try{const e=new(window.AudioContext||window.webkitAudioContext),s=e.createOscillator(),n=e.createGain();s.connect(n),n.connect(e.destination),s.frequency.value=800,s.type="sine",n.gain.setValueAtTime(.3,e.currentTime),n.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),s.start(e.currentTime),s.stop(e.currentTime+.3)}catch{}}}function z(){const[e,s]=i.useState("default"),n=i.useRef(A());i.useEffect(()=>{"Notification"in window&&s(Notification.permission)},[]);const c=i.useCallback(async()=>{if(!("Notification"in window))return console.warn("Браузер не поддерживает уведомления"),!1;try{const r=await Notification.requestPermission();return s(r),r==="granted"}catch(r){return console.error("Ошибка запроса разрешения:",r),!1}},[]),a=i.useCallback(()=>{n.current()},[]),l=i.useCallback(r=>{if(a(),document.hidden&&e==="granted"){const o=new Notification(r.title,{body:r.body,icon:r.icon||"/favicon.ico",tag:r.tag});r.onClick&&(o.onclick=()=>{var d;window.focus(),o.close(),(d=r.onClick)==null||d.call(r)}),setTimeout(()=>o.close(),5e3)}},[e,a]),u=i.useCallback((r,o,d)=>{l({title:`Новое сообщение от ${r}`,body:o.length>100?o.slice(0,100)+"...":o,tag:"new-message",onClick:d})},[l]);return{permission:e,requestPermission:c,playSound:a,showNotification:l,notifyNewMessage:u,isSupported:"Notification"in window}}function f(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}function w(e){return e.startsWith("image/")?U:e.includes("pdf")?S:F}function V({url:e,name:s,type:n,size:c,isOwn:a}){const l=n.startsWith("image/"),u=w(n),[r,o]=i.useState(!1),[d,h]=i.useState(!1),[g,p]=i.useState(e);i.useEffect(()=>{p(e),o(!1)},[e]);const b=()=>{o(!0)},k=async()=>{h(!0);try{let m=e;if(e.includes("/storage/v1/object/sign/")){const j=e.match(/\/message-attachments\/([^?]+)/);j&&(m=j[1])}else e.startsWith("http")||(m=e);const y=await I(m);y&&(p(y),o(!1))}catch(m){console.error("Failed to refresh image URL:",m)}finally{h(!1)}};return l?r?t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:`flex flex-col items-center justify-center gap-2 p-4 rounded-lg border ${a?"border-primary-foreground/30 bg-primary-foreground/10":"border-border bg-muted"}`,children:[t.jsx(M,{className:`h-8 w-8 ${a?"opacity-50":"text-muted-foreground"}`}),t.jsx("p",{className:`text-xs ${a?"opacity-70":"text-muted-foreground"}`,children:"Не удалось загрузить изображение"}),t.jsxs(N,{variant:"ghost",size:"sm",onClick:k,disabled:d,className:"h-7 text-xs",children:[d?t.jsx(v,{className:"h-3 w-3 mr-1 animate-spin"}):t.jsx(C,{className:"h-3 w-3 mr-1"}),"Обновить"]})]}),t.jsxs("p",{className:`text-xs mt-1 ${a?"opacity-70":"text-muted-foreground"}`,children:[s," (",f(c),")"]})]}):t.jsxs("div",{className:"mt-2",children:[t.jsx("a",{href:g,target:"_blank",rel:"noopener noreferrer",children:t.jsx("img",{src:g,alt:s,className:"max-w-[300px] max-h-[200px] rounded-lg object-cover cursor-pointer hover:opacity-90 transition-opacity",onError:b})}),t.jsxs("p",{className:`text-xs mt-1 ${a?"opacity-70":"text-muted-foreground"}`,children:[s," (",f(c),")"]})]}):t.jsxs("div",{className:`mt-2 flex items-center gap-2 p-2 rounded-lg ${a?"bg-primary-foreground/10":"bg-background/50"}`,children:[t.jsx(u,{className:"h-8 w-8 flex-shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium truncate",children:s}),t.jsx("p",{className:`text-xs ${a?"opacity-70":"text-muted-foreground"}`,children:f(c)})]}),t.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8 flex-shrink-0",asChild:!0,children:t.jsx("a",{href:e,download:s,target:"_blank",rel:"noopener noreferrer",children:t.jsx(R,{className:"h-4 w-4"})})})]})}function W({file:e,onRemove:s}){const n=e.type.startsWith("image/"),c=w(e.type),[a,l]=i.useState(null);return i.useEffect(()=>{if(!n)return;const u=URL.createObjectURL(e);return l(u),()=>{URL.revokeObjectURL(u)}},[e,n]),t.jsxs("div",{className:"relative inline-flex items-center gap-2 p-2 bg-muted rounded-lg max-w-[200px]",children:[n&&a?t.jsx("img",{src:a,alt:e.name,className:"w-12 h-12 rounded object-cover"}):t.jsx(c,{className:"h-8 w-8 text-muted-foreground"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-xs font-medium truncate",children:e.name}),t.jsx("p",{className:"text-xs text-muted-foreground",children:f(e.size)})]}),t.jsx("button",{onClick:s,className:"absolute -top-1 -right-1 w-5 h-5 bg-destructive text-destructive-foreground rounded-full text-xs flex items-center justify-center hover:bg-destructive/90",children:"×"})]})}export{W as A,V as M,q as P,B as S,z as u};
