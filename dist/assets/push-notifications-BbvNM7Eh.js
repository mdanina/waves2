import{w as o}from"./index-Bu4m9iDU.js";import"./vendor-radix-htwXsPHy.js";import"./vendor-charts-DjioKZbK.js";import"./vendor-query-BNGVDYIL.js";import"./vendor-react-CI8wve7f.js";function s(){return"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window}function v(){return window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0}function m(){return"Notification"in window?Notification.permission:"denied"}function a(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}function y(){if(!a())return!0;const r=navigator.userAgent.match(/OS (\d+)_(\d+)/);if(r){const e=parseInt(r[1],10),i=parseInt(r[2],10);return e>16||e===16&&i>=4}return!0}async function c(){if(!("serviceWorker"in navigator))return console.warn("Service Workers not supported"),null;try{const r=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return console.log("Service Worker registered:",r.scope),await navigator.serviceWorker.ready,r}catch(r){return console.error("Service Worker registration failed:",r),null}}async function n(){if(!("serviceWorker"in navigator))return null;try{return await navigator.serviceWorker.ready}catch{return null}}async function S(){const r=await n();if(!r)return!1;try{const e=await r.pushManager.getSubscription();return e&&(await e.unsubscribe(),await f(e.endpoint),console.log("Push subscription removed")),!0}catch(e){return console.error("Push unsubscribe failed:",e),!1}}async function u(){const r=await n();if(!r)return!1;try{return await r.pushManager.getSubscription()!==null}catch{return!1}}function p(){const r=navigator.userAgent;let e="desktop";/Mobile|Android|iPhone|iPad|iPod/i.test(r)&&(e=/iPad|tablet/i.test(r)?"tablet":"mobile");let i="other";return/Chrome/i.test(r)&&!/Edge|Edg/i.test(r)?i="chrome":/Safari/i.test(r)&&!/Chrome/i.test(r)?i="safari":/Firefox/i.test(r)?i="firefox":/Edge|Edg/i.test(r)&&(i="edge"),{userAgent:r.substring(0,500),deviceType:e,browser:i}}async function d(r){const e=r.toJSON();if(!e.keys)throw new Error("Subscription has no keys");const i=p(),{error:t}=await o.rpc("register_push_subscription",{p_endpoint:e.endpoint,p_p256dh:e.keys.p256dh,p_auth:e.keys.auth,p_user_agent:i.userAgent,p_device_type:i.deviceType,p_browser:i.browser});if(t)throw console.error("Failed to save push subscription:",t),t;console.log("Push subscription saved to backend")}async function f(r){const{error:e}=await o.rpc("unregister_push_subscription",{p_endpoint:r});e&&console.error("Failed to remove push subscription:",e)}async function P(){return s()?(console.error("VAPID public key not configured"),"no-vapid"):"unsupported"}async function k(){if(s())try{if(await c(),await u()&&Notification.permission==="granted"){const e=await n(),i=await(e==null?void 0:e.pushManager.getSubscription());i&&await d(i)}}catch(r){console.error("Push initialization error:",r)}}export{m as getNotificationPermission,n as getServiceWorkerRegistration,k as initializePushNotifications,a as isIOS,y as isIOSPushSupported,s as isPushSupported,v as isRunningAsPWA,u as isSubscribedToPush,c as registerServiceWorker,P as setupPushNotifications,S as unsubscribeFromPush};
