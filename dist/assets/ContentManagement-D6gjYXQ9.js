import{r as m,j as e}from"./vendor-radix-CDHcN1cP.js";import{u as ae,a as z,c as w}from"./vendor-query-DyYoeD25.js";import{Z as re,B as r,C as M,$ as O,a0 as V,ak as A,i as Z,L as i,x as d,a8 as T,a as ce,b as te,c as le,d as de,e as oe,f as v,R as y}from"./index-Dt6uKTGi.js";import{T as G,a as J,b as N,c as o,d as U,e as h}from"./table-B5n0484N.js";import{D as P,f as W,a as S,b as q,c as F,e as D}from"./dialog-Bj2cYqgx.js";import{S as I}from"./switch-DdimT5yl.js";import{P as X}from"./plus-C1Qd69GB.js";import{S as Y}from"./square-pen-DClxkTk9.js";import"./vendor-charts-DMFz3Lzq.js";import"./vendor-react-D0zZO7ze.js";const B={name:"",duration_minutes:60,price:0,description:null,is_active:!0},R={name:"",session_count:1,appointment_type_id:"",price:0,description:null,is_active:!0};function fe(){const[f,$]=m.useState("types"),[c,x]=m.useState(null),[t,j]=m.useState(null),[ee,_]=m.useState(!1),[se,k]=m.useState(!1),[l,p]=m.useState(B),[a,u]=m.useState(R),b=ae(),{data:g,isLoading:ne}=z({queryKey:["appointment-types"],queryFn:async()=>{const{data:s,error:n}=await y.from("appointment_types").select("*").order("created_at",{ascending:!1});if(n)throw n;return s||[]}}),{data:L,isLoading:ie}=z({queryKey:["packages"],queryFn:async()=>{const{data:s,error:n}=await y.from("packages").select("*").order("created_at",{ascending:!1});if(n)throw n;return s||[]}}),E=w({mutationFn:async({id:s,updates:n})=>{const{error:C}=await y.from("appointment_types").update(n).eq("id",s);if(C)throw C},onSuccess:()=>{b.invalidateQueries({queryKey:["appointment-types"]}),v.success("Тип консультации обновлен"),x(null)}}),K=w({mutationFn:async({id:s,updates:n})=>{const{error:C}=await y.from("packages").update(n).eq("id",s);if(C)throw C},onSuccess:()=>{b.invalidateQueries({queryKey:["packages"]}),v.success("Пакет обновлен"),j(null)}}),Q=w({mutationFn:async s=>{const{error:n}=await y.from("appointment_types").insert(s);if(n)throw n},onSuccess:()=>{b.invalidateQueries({queryKey:["appointment-types"]}),v.success("Тип консультации создан"),_(!1),p(B)},onError:s=>{v.error(`Ошибка создания: ${s.message}`)}}),H=w({mutationFn:async s=>{const{error:n}=await y.from("packages").insert(s);if(n)throw n},onSuccess:()=>{b.invalidateQueries({queryKey:["packages"]}),v.success("Пакет создан"),k(!1),u(R)},onError:s=>{v.error(`Ошибка создания: ${s.message}`)}});return ne||ie?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(re,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Управление контентом"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Управление типами консультаций и пакетами"})]}),e.jsxs("div",{className:"flex gap-2 border-b",children:[e.jsx(r,{variant:f==="types"?"default":"ghost",onClick:()=>$("types"),children:"Типы консультаций"}),e.jsx(r,{variant:f==="packages"?"default":"ghost",onClick:()=>$("packages"),children:"Пакеты"})]}),f==="types"&&e.jsxs(M,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Типы консультаций"}),e.jsx(A,{children:"Управление типами и ценами консультаций"})]}),e.jsxs(r,{onClick:()=>_(!0),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Создать тип"]})]}),e.jsx(Z,{children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs(N,{children:[e.jsx(o,{children:"Название"}),e.jsx(o,{children:"Длительность"}),e.jsx(o,{children:"Цена"}),e.jsx(o,{children:"Активен"}),e.jsx(o,{children:"Действия"})]})}),e.jsx(U,{children:g==null?void 0:g.map(s=>e.jsxs(N,{children:[e.jsx(h,{children:s.name}),e.jsxs(h,{children:[s.duration_minutes," мин"]}),e.jsxs(h,{children:[s.price," ₽"]}),e.jsx(h,{children:s.is_active?"Да":"Нет"}),e.jsx(h,{children:e.jsxs(P,{children:[e.jsx(W,{asChild:!0,children:e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>x(s),children:e.jsx(Y,{className:"h-4 w-4"})})}),c&&e.jsxs(S,{children:[e.jsx(q,{children:e.jsx(F,{children:"Редактировать тип консультации"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Название"}),e.jsx(d,{value:c.name,onChange:n=>x({...c,name:n.target.value})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Длительность (минуты)"}),e.jsx(d,{type:"number",value:c.duration_minutes,onChange:n=>x({...c,duration_minutes:parseInt(n.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Цена (₽)"}),e.jsx(d,{type:"number",value:c.price,onChange:n=>x({...c,price:parseFloat(n.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Описание"}),e.jsx(T,{value:c.description||"",onChange:n=>x({...c,description:n.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{checked:c.is_active,onCheckedChange:n=>x({...c,is_active:n})}),e.jsx(i,{children:"Активен"})]})]}),e.jsxs(D,{children:[e.jsx(r,{variant:"outline",onClick:()=>x(null),children:"Отмена"}),e.jsx(r,{onClick:()=>E.mutate({id:c.id,updates:c}),disabled:E.isPending,children:E.isPending?"Сохранение...":"Сохранить"})]})]})]})})]},s.id))})]})})]}),f==="packages"&&e.jsxs(M,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Пакеты"}),e.jsx(A,{children:"Управление пакетами сессий"})]}),e.jsxs(r,{onClick:()=>k(!0),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Создать пакет"]})]}),e.jsx(Z,{children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs(N,{children:[e.jsx(o,{children:"Название"}),e.jsx(o,{children:"Количество сессий"}),e.jsx(o,{children:"Цена"}),e.jsx(o,{children:"Активен"}),e.jsx(o,{children:"Действия"})]})}),e.jsx(U,{children:L==null?void 0:L.map(s=>e.jsxs(N,{children:[e.jsx(h,{children:s.name}),e.jsx(h,{children:s.session_count}),e.jsxs(h,{children:[s.price," ₽"]}),e.jsx(h,{children:s.is_active?"Да":"Нет"}),e.jsx(h,{children:e.jsxs(P,{children:[e.jsx(W,{asChild:!0,children:e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>j(s),children:e.jsx(Y,{className:"h-4 w-4"})})}),t&&e.jsxs(S,{children:[e.jsx(q,{children:e.jsx(F,{children:"Редактировать пакет"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Название"}),e.jsx(d,{value:t.name,onChange:n=>j({...t,name:n.target.value})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Количество сессий"}),e.jsx(d,{type:"number",value:t.session_count,onChange:n=>j({...t,session_count:parseInt(n.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Цена (₽)"}),e.jsx(d,{type:"number",value:t.price,onChange:n=>j({...t,price:parseFloat(n.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Описание"}),e.jsx(T,{value:t.description||"",onChange:n=>j({...t,description:n.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{checked:t.is_active,onCheckedChange:n=>j({...t,is_active:n})}),e.jsx(i,{children:"Активен"})]})]}),e.jsxs(D,{children:[e.jsx(r,{variant:"outline",onClick:()=>j(null),children:"Отмена"}),e.jsx(r,{onClick:()=>K.mutate({id:t.id,updates:t}),disabled:K.isPending,children:K.isPending?"Сохранение...":"Сохранить"})]})]})]})})]},s.id))})]})})]}),e.jsx(P,{open:ee,onOpenChange:_,children:e.jsxs(S,{children:[e.jsx(q,{children:e.jsx(F,{children:"Создать тип консультации"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Название"}),e.jsx(d,{value:l.name,onChange:s=>p({...l,name:s.target.value}),placeholder:"Например: Первичная консультация"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Длительность (минуты)"}),e.jsx(d,{type:"number",value:l.duration_minutes,onChange:s=>p({...l,duration_minutes:parseInt(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Цена (₽)"}),e.jsx(d,{type:"number",value:l.price,onChange:s=>p({...l,price:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Описание"}),e.jsx(T,{value:l.description||"",onChange:s=>p({...l,description:s.target.value||null}),placeholder:"Описание типа консультации..."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{checked:l.is_active,onCheckedChange:s=>p({...l,is_active:s})}),e.jsx(i,{children:"Активен"})]})]}),e.jsxs(D,{children:[e.jsx(r,{variant:"outline",onClick:()=>{_(!1),p(B)},children:"Отмена"}),e.jsx(r,{onClick:()=>Q.mutate(l),disabled:Q.isPending||!l.name,children:Q.isPending?"Создание...":"Создать"})]})]})}),e.jsx(P,{open:se,onOpenChange:k,children:e.jsxs(S,{children:[e.jsx(q,{children:e.jsx(F,{children:"Создать пакет"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Название"}),e.jsx(d,{value:a.name,onChange:s=>u({...a,name:s.target.value}),placeholder:"Например: Пакет из 5 консультаций"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Тип консультации"}),e.jsxs(ce,{value:a.appointment_type_id,onValueChange:s=>u({...a,appointment_type_id:s}),children:[e.jsx(te,{children:e.jsx(le,{placeholder:"Выберите тип консультации"})}),e.jsx(de,{children:g==null?void 0:g.filter(s=>s.is_active).map(s=>e.jsx(oe,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Количество сессий"}),e.jsx(d,{type:"number",value:a.session_count,onChange:s=>u({...a,session_count:parseInt(s.target.value)||1}),min:1})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Цена (₽)"}),e.jsx(d,{type:"number",value:a.price,onChange:s=>u({...a,price:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Описание"}),e.jsx(T,{value:a.description||"",onChange:s=>u({...a,description:s.target.value||null}),placeholder:"Описание пакета..."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{checked:a.is_active,onCheckedChange:s=>u({...a,is_active:s})}),e.jsx(i,{children:"Активен"})]})]}),e.jsxs(D,{children:[e.jsx(r,{variant:"outline",onClick:()=>{k(!1),u(R)},children:"Отмена"}),e.jsx(r,{onClick:()=>H.mutate(a),disabled:H.isPending||!a.name||!a.appointment_type_id,children:H.isPending?"Создание...":"Создать"})]})]})})]})}export{fe as default};
