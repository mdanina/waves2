import{r as i,j as e}from"./vendor-radix-J7BmBqsC.js";import{u as O}from"./vendor-query-Bb981xLV.js";import{u as Y,j as A,C as G,S as M,L as a,r as E,a as _,b as q,c as D,d as I,e as l,B as P,f as m}from"./index-CsvxaYtI.js";import{R as V,a as x}from"./radio-group-DaEomwmN.js";import{getProfile as Q,updateProfile as H}from"./profileStorage-CU3CxDLE.js";import{B as K}from"./birth-date-picker-BMedgmcE.js";import{u as T,a as $,e as J}from"./vendor-react-CI1J5nwZ.js";import"./vendor-charts-CkgrveCd.js";import"./vendor-date-CR4liJ_d.js";function ie(){var B;const r=T(),n=$(),{id:c}=J(),z=O(),{user:u}=Y(),[h,b]=i.useState(""),[p,N]=i.useState(""),[f,y]=i.useState(""),[j,S]=i.useState(""),[g,k]=i.useState(""),[C,F]=i.useState(""),[v,w]=i.useState("");i.useEffect(()=>{async function t(){var o,d,R;if(c)try{const s=await Q(c);if(s){if(s.type==="parent"){r("/profile",{state:{from:((o=n.state)==null?void 0:o.from)||"cabinet"},replace:!0});return}b(s.first_name),N(s.last_name||""),y(s.dob||""),S(s.type),k(s.gender||""),F(s.referral||""),w(s.seeking_care||"")}else m.error("Член семьи не найден"),((d=n.state)==null?void 0:d.from)==="cabinet"?r("/cabinet"):r("/family-members")}catch(s){console.error("Error loading profile:",s),m.error("Ошибка при загрузке данных"),((R=n.state)==null?void 0:R.from)==="cabinet"?r("/cabinet"):r("/family-members")}}t()},[c,r,(B=n.state)==null?void 0:B.from]);const L=async t=>{var o;if(t.preventDefault(),h&&p&&f&&j&&g&&v&&c)try{await H(c,{firstName:h,lastName:p,dateOfBirth:f,relationship:j,sex:g,referral:C,seekingCare:v}),await z.invalidateQueries({queryKey:["profiles",u==null?void 0:u.id]}),m.success("Данные члена семьи обновлены!"),((o=n.state)==null?void 0:o.from)==="cabinet"?r("/cabinet"):r("/family-members")}catch(d){console.error("Error updating profile:",d),m.error("Ошибка при обновлении данных")}};return e.jsx("div",{className:"min-h-screen",style:{backgroundImage:`url(${A})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"},children:e.jsx("div",{className:"container mx-auto max-w-2xl px-4 py-12",children:e.jsx(G,{className:"rounded-[20px] border-2 bg-white p-8 shadow-[0_4px_20px_rgba(0,0,0,0.06)]",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"text-center",children:e.jsx(M,{size:"2xl",className:"mb-4",children:"Редактировать данные члена семьи"})}),e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(a,{htmlFor:"firstName",children:["Имя ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(E,{id:"firstName",type:"text",value:h,onChange:t=>b(t.target.value),required:!0,className:"h-12 text-base"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(a,{htmlFor:"lastName",children:["Фамилия ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(E,{id:"lastName",type:"text",value:p,onChange:t=>N(t.target.value),required:!0,className:"h-12 text-base"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(a,{htmlFor:"dateOfBirth",children:["Дата рождения ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(K,{id:"dateOfBirth",value:f,onChange:y,required:!0,fromYear:new Date().getFullYear()-100,toYear:new Date().getFullYear()})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(a,{htmlFor:"relationship",children:["Кем для вас приходится? ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(_,{value:j,onValueChange:S,children:[e.jsx(q,{id:"relationship",className:"h-12 text-base",children:e.jsx(D,{placeholder:"Выберите"})}),e.jsxs(I,{children:[e.jsx(l,{value:"child",children:"Ребенок"}),e.jsx(l,{value:"partner",children:"Партнер"}),e.jsx(l,{value:"other",children:"Другое"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(a,{children:["Пол ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(V,{value:g,onValueChange:k,className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 rounded-lg border border-input px-4 py-4",children:[e.jsx(x,{value:"male",id:"male-edit"}),e.jsx(a,{htmlFor:"male-edit",className:"flex-1 cursor-pointer font-normal",children:"Мужской"})]}),e.jsxs("div",{className:"flex items-center space-x-3 rounded-lg border border-input px-4 py-4",children:[e.jsx(x,{value:"female",id:"female-edit"}),e.jsx(a,{htmlFor:"female-edit",className:"flex-1 cursor-pointer font-normal",children:"Женский"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"referral",children:"Пришел по направлению от организации?"}),e.jsxs(_,{value:C,onValueChange:F,children:[e.jsx(q,{id:"referral",className:"h-12 text-base",children:e.jsx(D,{placeholder:"Нет направления"})}),e.jsxs(I,{children:[e.jsx(l,{value:"no",children:"Нет направления"}),e.jsx(l,{value:"insurance",children:"Страховая компания"}),e.jsx(l,{value:"doctor",children:"Врач"}),e.jsx(l,{value:"school",children:"Школа"}),e.jsx(l,{value:"other",children:"Другое"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(a,{children:["Этому члену семьи нужна помощь? ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(V,{value:v,onValueChange:w,className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 rounded-lg border border-input px-4 py-4",children:[e.jsx(x,{value:"yes",id:"seeking-yes-edit"}),e.jsx(a,{htmlFor:"seeking-yes-edit",className:"flex-1 cursor-pointer font-normal",children:"Да"})]}),e.jsxs("div",{className:"flex items-center space-x-3 rounded-lg border border-input px-4 py-4",children:[e.jsx(x,{value:"no",id:"seeking-no-edit"}),e.jsx(a,{htmlFor:"seeking-no-edit",className:"flex-1 cursor-pointer font-normal",children:"Нет"})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(P,{type:"button",variant:"outline",size:"lg",onClick:()=>{var t;((t=n.state)==null?void 0:t.from)==="cabinet"?r("/cabinet"):r("/family-members")},className:"h-14 flex-1 text-base font-medium",children:"Отмена"}),e.jsx(P,{type:"submit",size:"lg",className:"h-14 flex-1 text-base font-medium",children:"Сохранить"})]})]})]})})})})}export{ie as default};
