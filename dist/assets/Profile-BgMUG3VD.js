import{j as e,r as a}from"./vendor-radix-CDHcN1cP.js";import{j as z,u as H,k as V,C as $,S as J,I as w,B as K,l as O,g as q,f as u,m as Q,n as T,o as X,p as Z}from"./index-Dt6uKTGi.js";import{S as ee}from"./StepIndicator-CN1oIlQO.js";import{R as Y}from"./Radio-Cc-G03YK.js";import{getCurrentUserData as se,upsertUserData as te,PhoneAlreadyExistsError as ae}from"./userStorage-BC6791f4.js";import{B as re}from"./birth-date-picker-Bps1FAwS.js";import{isPushSupported as ne,setupPushNotifications as oe}from"./push-notifications-C-gnuEtV.js";import{u as ie,a as le}from"./vendor-react-D0zZO7ze.js";import"./vendor-charts-DMFz3Lzq.js";import"./vendor-query-DyYoeD25.js";import"./vendor-date-CR4liJ_d.js";function A({label:o,checked:i=!1,onChange:d,disabled:c=!1,className:p}){return e.jsxs("label",{className:z("flex items-center gap-3 cursor-pointer",c&&"opacity-50 cursor-not-allowed",p),children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:m=>d==null?void 0:d(m.target.checked),disabled:c,className:"sr-only"}),e.jsx("div",{className:z("w-6 h-6 rounded-lg border-2 transition-all duration-200","flex items-center justify-center",i?"bg-gradient-to-br from-coral to-coral-light border-coral shadow-md shadow-coral/30":"bg-white border-muted"),children:i&&e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),o&&e.jsx("span",{className:"text-sm",children:o})]})}function Ne(){const o=ie(),i=le(),{user:d}=H(),[c,p]=a.useState(""),[m,k]=a.useState(""),[h,S]=a.useState(""),[x,C]=a.useState(""),[g,P]=a.useState(""),[f,E]=a.useState(""),[_,b]=a.useState(""),[U,B]=a.useState(!1),[D,F]=a.useState(!1),[I,j]=a.useState(!0),N=a.useRef(!1);a.useEffect(()=>{async function s(){var r,l;if(d)try{const n=await se();n&&(E(n.phone?O(n.phone):""),F(n.marketing_consent||!1));const t=(await q()).find(R=>R.type==="parent");t&&(p(t.first_name||""),k(t.last_name||"")),t&&(S(t.dob||""),C(t.gender||""),P(t.seeking_care||""));const L=t&&t.first_name&&t.last_name,y=n==null?void 0:n.phone;if(L&&y&&(N.current=!0,!["cabinet","family-members"].includes(((r=i.state)==null?void 0:r.from)??"")&&!((l=i.state)!=null&&l.debug))){o("/cabinet",{replace:!0});return}}catch(n){console.error("Error loading user data:",n)}finally{j(!1)}}s()},[d,i.state,o]);const M=s=>{const r=O(s.target.value);E(r),_&&b("")},W=async s=>{if(B(s),s&&ne()){const r=await oe();r==="denied"?(u.error("Вы заблокировали уведомления в браузере. Разрешите их в настройках."),B(!1)):r==="granted"&&u.success("Уведомления включены!")}},G=async s=>{var r;if(s.preventDefault(),!f){b("Введите номер телефона");return}if(!Q(f)){b("Введите корректный номер телефона");return}if(c&&m&&h&&x&&g&&f)try{j(!0);const l=T(f);await te({phone:l,marketing_consent:D});const v=(await q()).find(y=>y.type==="parent");v?(await X(v.id,{firstName:c,lastName:m,dateOfBirth:h,relationship:"parent",sex:x,seekingCare:g}),u.success("Профиль успешно обновлен!")):(await Z({firstName:c,lastName:m,dateOfBirth:h,relationship:"parent",sex:x,seekingCare:g}),u.success("Профиль успешно создан!"));const t=(r=i.state)==null?void 0:r.from;t==="cabinet"||N.current?o("/cabinet"):t==="family-members"&&N.current?o("/family-members"):o("/family-setup")}catch(l){console.error("Error saving profile:",l),l instanceof ae?u.error(l.message):u.error("Ошибка при сохранении профиля"),j(!1)}};return e.jsx("div",{className:"min-h-screen",style:{backgroundImage:`url(${V})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"},children:e.jsx("div",{className:"container mx-auto max-w-2xl px-4 py-12",children:e.jsxs($,{className:"rounded-[20px] border-2 bg-white p-8 shadow-[0_4px_20px_rgba(0,0,0,0.06)]",children:[e.jsx(ee,{currentStep:1,totalSteps:3,label:"ПРОФИЛЬ РОДИТЕЛЯ"}),e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(J,{size:"2xl",className:"mb-4",children:"Расскажите нам больше о себе"}),e.jsx("p",{className:"text-muted-foreground",children:"Данные используются для персонализации тренировок, в соответствии с нашей политикой конфиденциальности."})]}),e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsx(w,{id:"firstName",type:"text",label:"Имя *",value:c,onChange:s=>p(s.target.value),required:!0}),e.jsx(w,{id:"lastName",type:"text",label:"Фамилия *",value:m,onChange:s=>k(s.target.value),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"dateOfBirth",className:"text-sm font-medium text-foreground",children:["Дата рождения ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(re,{id:"dateOfBirth",value:h,onChange:S,required:!0,fromYear:new Date().getFullYear()-100,toYear:new Date().getFullYear()})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground",children:["Пол ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Y,{name:"sex",value:x,onChange:C,options:[{value:"male",label:"Мужской"},{value:"female",label:"Женский"}],className:"grid grid-cols-2 gap-4"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground",children:["Планируете ли вы сами использовать платформу для собственных тренировок? ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Y,{name:"seekingCare",value:g,onChange:P,options:[{value:"yes",label:"Да"},{value:"no",label:"Нет"}],className:"grid grid-cols-2 gap-4"})]}),e.jsx(w,{id:"phone",type:"tel",label:"Номер телефона *",value:f,onChange:M,placeholder:"+7 (999) 123-45-67",required:!0,error:_}),e.jsxs("div",{className:"space-y-4 rounded-lg border border-border p-4",children:[e.jsx(A,{checked:U,onChange:s=>W(s),label:e.jsx("span",{className:"text-sm leading-relaxed",children:"Разрешить отправлять уведомления об обновлениях на платформе"})}),e.jsx(A,{checked:D,onChange:s=>F(s),label:e.jsxs("span",{className:"text-sm leading-relaxed",children:["Я согласен получать ",e.jsx("strong",{children:"периодические маркетинговые"})," письма о программах, предложениях и обновлениях Waves."]})})]}),e.jsx(K,{type:"submit",size:"lg",disabled:I,className:"h-14 w-full text-base font-medium",children:I?"Сохранение...":"Продолжить"})]})]})]})})})}export{Ne as default};
