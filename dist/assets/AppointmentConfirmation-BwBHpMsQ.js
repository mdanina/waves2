import{r as j,j as e}from"./vendor-radix-CDHcN1cP.js";import{u as T,c as D}from"./vendor-react-D0zZO7ze.js";import{ac as k,ad as b,a4 as P,af as I,s as _,B as x,U as L,H as C,Z as E,C as M,T as S,_ as A}from"./index-Dt6uKTGi.js";import{h as B,f as F}from"./useAppointments-BUGKN8HV.js";import{b as H,a as z}from"./usePackages-C4yd8J9f.js";import{f as O}from"./moscowTime-Bf471xDt.js";import{D as V,a as $,b as R,c as U,d as W,e as q}from"./dialog-Bj2cYqgx.js";import{u as G}from"./usePushNotifications-Djlcy60w.js";import{S as K}from"./smartphone-Vnh406Yu.js";import"./vendor-charts-DMFz3Lzq.js";import"./vendor-query-DyYoeD25.js";import"./appointmentStorage-Dmm45BMo.js";import"./push-notifications-C-gnuEtV.js";const y="push_notification_modal_dismissed";function Y({open:t,onOpenChange:l,onSuccess:r}){const{status:n,isSupported:s,isIOSDevice:g,isPWAInstalled:N,subscribe:i,isLoading:a,error:u}=G(),[h,d]=j.useState(null),m=async()=>{d(null),await i()?(localStorage.setItem(y,"enabled"),l(!1),r==null||r()):u&&d(u)},v=()=>{localStorage.setItem(y,"dismissed"),l(!1)},c=g&&!N;return n==="subscribed"?null:e.jsx(V,{open:t,onOpenChange:l,children:e.jsxs($,{className:"sm:max-w-md",children:[e.jsxs(R,{children:[e.jsx("div",{className:"mx-auto mb-4 h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(k,{className:"h-8 w-8 text-primary"})}),e.jsx(U,{className:"text-center text-xl",children:"Включить уведомления?"}),e.jsx(W,{className:"text-center",children:"Чтобы не пропустить важные события, включите push-уведомления"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-sage-pale flex items-center justify-center",children:e.jsx(b,{className:"h-4 w-4 text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Напоминания о сессиях"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Получайте уведомления за 36 часов и за 1 час до встречи"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-lavender-pale flex items-center justify-center",children:e.jsx(P,{className:"h-4 w-4 text-secondary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Когда специалист ждёт"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Узнайте мгновенно, когда специалист уже в комнате"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-lilac-pale flex items-center justify-center",children:e.jsx(I,{className:"h-4 w-4 text-lilac"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Новые сообщения"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Не пропустите важные сообщения от специалиста"})]})]})]}),c&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-honey-pale rounded-lg border border-honey",children:[e.jsx(K,{className:"h-5 w-5 text-honey-dark flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-foreground",children:"Для iOS"}),e.jsxs("p",{className:"text-muted-foreground text-xs mt-1",children:["Сначала добавьте приложение на главный экран: нажмите",e.jsx("span",{className:"inline-block mx-1",children:e.jsxs("svg",{className:"inline h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L11 6.414V13a1 1 0 11-2 0V6.414L7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3z"}),e.jsx("path",{d:"M3 14a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"})]})}),"→ «На экран Домой»"]})]})]}),!s&&!c&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted rounded-lg",children:[e.jsx(_,{className:"h-5 w-5 text-muted-foreground flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ваш браузер не поддерживает push-уведомления. Попробуйте Chrome, Firefox или Safari."})]}),h&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-destructive/10 rounded-lg border border-destructive/30",children:[e.jsx(_,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-destructive",children:h})]})]}),e.jsxs(q,{className:"flex-col gap-2 sm:flex-col",children:[e.jsx(x,{onClick:m,disabled:a||!s||c,className:"w-full",children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:e.jsxs("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]})}),"Подключаем..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Включить уведомления"]})}),e.jsx(x,{variant:"ghost",onClick:v,disabled:a,className:"w-full text-muted-foreground",children:"Может быть позже"})]})]})})}function Z(){const t=localStorage.getItem(y);return!(t==="enabled"||t==="dismissed")}function me(){const t=T(),[l]=D(),r=l.get("appointment_id"),n=l.get("package_id");l.get("payment_id");const{data:s,isLoading:g}=B(r),N=s==null?void 0:s.appointment_type_id,{data:i}=F(N||null),{data:a,isLoading:u}=H(n),h=a==null?void 0:a.package_id,{data:d}=z(h||null),{data:m}=L(),[v,c]=j.useState(!1),p=g||u;j.useEffect(()=>{if(s&&i&&i.price===0&&Z()){const o=setTimeout(()=>{c(!0)},500);return()=>clearTimeout(o)}},[s,i]);const f=s!=null&&s.profile_id?m==null?void 0:m.find(o=>o.id===s.profile_id):null,w=f?`${f.first_name}${f.last_name?` ${f.last_name}`:""}`:s!=null&&s.profile_id?null:"Для меня (родитель)";return j.useEffect(()=>{if(!p&&!s&&!a)if(r||n){const o=setTimeout(()=>{!s&&!a&&t("/cabinet")},2e3);return()=>clearTimeout(o)}else t("/cabinet")},[s,a,p,t,r,n]),p?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(C,{}),e.jsx("div",{className:"container mx-auto px-4 py-20 flex items-center justify-center",children:e.jsx(E,{className:"h-8 w-8 animate-spin text-primary"})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(C,{}),e.jsx("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 pt-8 pb-8",children:e.jsxs(M,{className:"p-8 text-center",children:[e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsx("div",{className:"h-20 w-20 rounded-full bg-success/20 flex items-center justify-center",children:e.jsx(S,{className:"h-12 w-12 text-success"})})}),e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:s?"Консультация записана!":"Пакет успешно приобретен!"}),e.jsx("p",{className:"text-muted-foreground mb-8",children:s?"Ваша консультация успешно записана и оплачена":"Ваш пакет сессий успешно приобретен"}),s&&e.jsxs("div",{className:"mb-8 space-y-4 text-left bg-muted/50 p-6 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Дата и время"}),e.jsx("p",{className:"font-medium",children:O(s.scheduled_at)})]})]}),i&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Тип консультации"}),e.jsxs("p",{className:"font-medium",children:[i.name," (",i.duration_minutes," минут)"]})]})]}),w&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Для кого"}),e.jsx("p",{className:"font-medium",children:w})]})]})]}),a&&d&&e.jsxs("div",{className:"mb-8 space-y-4 text-left bg-muted/50 p-6 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Пакет"}),e.jsx("p",{className:"font-medium",children:d.name})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Оставшиеся сессии"}),e.jsxs("p",{className:"font-medium",children:[a.sessions_remaining," сессий"]})]})]})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(x,{variant:"outline",onClick:()=>t("/cabinet"),children:"Вернуться в кабинет"}),s&&e.jsx(x,{onClick:()=>t("/appointments"),children:"Записаться еще"}),a&&e.jsx(x,{onClick:()=>t("/packages"),children:"Посмотреть пакеты"})]})]})}),e.jsx(Y,{open:v,onOpenChange:c})]})}export{me as default};
