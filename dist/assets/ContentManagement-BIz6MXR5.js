import{r as m,j as e}from"./vendor-radix-htwXsPHy.js";import{u as ae,b as z,c as w}from"./vendor-query-BNGVDYIL.js";import{G as re,B as r,C as M,J as O,K as R,af as A,i as G,V as T,a1 as J,W as N,X as P,Y as S,L as i,o as d,$ as q,a0 as F,b as ce,c as te,d as le,e as de,f as oe,g as v,v as y}from"./index-Dv2C02zj.js";import{T as W,a as X,b as I,c as o,d as Y,e as h}from"./table-Dp3rzXzr.js";import{S as D}from"./switch-DBnBobQZ.js";import{P as U}from"./plus-CrCC_Tdd.js";import{S as Z}from"./square-pen-zPyIDgWu.js";import"./vendor-charts-DjioKZbK.js";import"./vendor-react-CI8wve7f.js";const B={name:"",duration_minutes:60,price:0,description:null,is_active:!0},V={name:"",session_count:1,appointment_type_id:"",price:0,description:null,is_active:!0};function Ce(){const[f,$]=m.useState("types"),[c,x]=m.useState(null),[t,j]=m.useState(null),[ee,_]=m.useState(!1),[se,k]=m.useState(!1),[l,p]=m.useState(B),[a,u]=m.useState(V),b=ae(),{data:g,isLoading:ne}=z({queryKey:["appointment-types"],queryFn:async()=>{const{data:s,error:n}=await y.from("appointment_types").select("*").order("created_at",{ascending:!1});if(n)throw n;return s||[]}}),{data:K,isLoading:ie}=z({queryKey:["packages"],queryFn:async()=>{const{data:s,error:n}=await y.from("packages").select("*").order("created_at",{ascending:!1});if(n)throw n;return s||[]}}),L=w({mutationFn:async({id:s,updates:n})=>{const{error:C}=await y.from("appointment_types").update(n).eq("id",s);if(C)throw C},onSuccess:()=>{b.invalidateQueries({queryKey:["appointment-types"]}),v.success("Тип консультации обновлен"),x(null)}}),E=w({mutationFn:async({id:s,updates:n})=>{const{error:C}=await y.from("packages").update(n).eq("id",s);if(C)throw C},onSuccess:()=>{b.invalidateQueries({queryKey:["packages"]}),v.success("Пакет обновлен"),j(null)}}),Q=w({mutationFn:async s=>{const{error:n}=await y.from("appointment_types").insert(s);if(n)throw n},onSuccess:()=>{b.invalidateQueries({queryKey:["appointment-types"]}),v.success("Тип консультации создан"),_(!1),p(B)},onError:s=>{v.error(`Ошибка создания: ${s.message}`)}}),H=w({mutationFn:async s=>{const{error:n}=await y.from("packages").insert(s);if(n)throw n},onSuccess:()=>{b.invalidateQueries({queryKey:["packages"]}),v.success("Пакет создан"),k(!1),u(V)},onError:s=>{v.error(`Ошибка создания: ${s.message}`)}});return ne||ie?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(re,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Управление контентом"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Управление типами консультаций и пакетами"})]}),e.jsxs("div",{className:"flex gap-2 border-b",children:[e.jsx(r,{variant:f==="types"?"default":"ghost",onClick:()=>$("types"),children:"Типы консультаций"}),e.jsx(r,{variant:f==="packages"?"default":"ghost",onClick:()=>$("packages"),children:"Пакеты"})]}),f==="types"&&e.jsxs(M,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Типы консультаций"}),e.jsx(A,{children:"Управление типами и ценами консультаций"})]}),e.jsxs(r,{onClick:()=>_(!0),children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Создать тип"]})]}),e.jsx(G,{children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(I,{children:[e.jsx(o,{children:"Название"}),e.jsx(o,{children:"Длительность"}),e.jsx(o,{children:"Цена"}),e.jsx(o,{children:"Активен"}),e.jsx(o,{children:"Действия"})]})}),e.jsx(Y,{children:g==null?void 0:g.map(s=>e.jsxs(I,{children:[e.jsx(h,{children:s.name}),e.jsxs(h,{children:[s.duration_minutes," мин"]}),e.jsxs(h,{children:[s.price," ₽"]}),e.jsx(h,{children:s.is_active?"Да":"Нет"}),e.jsx(h,{children:e.jsxs(T,{children:[e.jsx(J,{asChild:!0,children:e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>x(s),children:e.jsx(Z,{className:"h-4 w-4"})})}),c&&e.jsxs(N,{children:[e.jsx(P,{children:e.jsx(S,{children:"Редактировать тип консультации"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Название"}),e.jsx(d,{value:c.name,onChange:n=>x({...c,name:n.target.value})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Длительность (минуты)"}),e.jsx(d,{type:"number",value:c.duration_minutes,onChange:n=>x({...c,duration_minutes:parseInt(n.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Цена (₽)"}),e.jsx(d,{type:"number",value:c.price,onChange:n=>x({...c,price:parseFloat(n.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Описание"}),e.jsx(q,{value:c.description||"",onChange:n=>x({...c,description:n.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{checked:c.is_active,onCheckedChange:n=>x({...c,is_active:n})}),e.jsx(i,{children:"Активен"})]})]}),e.jsxs(F,{children:[e.jsx(r,{variant:"outline",onClick:()=>x(null),children:"Отмена"}),e.jsx(r,{onClick:()=>L.mutate({id:c.id,updates:c}),disabled:L.isPending,children:L.isPending?"Сохранение...":"Сохранить"})]})]})]})})]},s.id))})]})})]}),f==="packages"&&e.jsxs(M,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Пакеты"}),e.jsx(A,{children:"Управление пакетами сессий"})]}),e.jsxs(r,{onClick:()=>k(!0),children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Создать пакет"]})]}),e.jsx(G,{children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(I,{children:[e.jsx(o,{children:"Название"}),e.jsx(o,{children:"Количество сессий"}),e.jsx(o,{children:"Цена"}),e.jsx(o,{children:"Активен"}),e.jsx(o,{children:"Действия"})]})}),e.jsx(Y,{children:K==null?void 0:K.map(s=>e.jsxs(I,{children:[e.jsx(h,{children:s.name}),e.jsx(h,{children:s.session_count}),e.jsxs(h,{children:[s.price," ₽"]}),e.jsx(h,{children:s.is_active?"Да":"Нет"}),e.jsx(h,{children:e.jsxs(T,{children:[e.jsx(J,{asChild:!0,children:e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>j(s),children:e.jsx(Z,{className:"h-4 w-4"})})}),t&&e.jsxs(N,{children:[e.jsx(P,{children:e.jsx(S,{children:"Редактировать пакет"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Название"}),e.jsx(d,{value:t.name,onChange:n=>j({...t,name:n.target.value})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Количество сессий"}),e.jsx(d,{type:"number",value:t.session_count,onChange:n=>j({...t,session_count:parseInt(n.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Цена (₽)"}),e.jsx(d,{type:"number",value:t.price,onChange:n=>j({...t,price:parseFloat(n.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Описание"}),e.jsx(q,{value:t.description||"",onChange:n=>j({...t,description:n.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{checked:t.is_active,onCheckedChange:n=>j({...t,is_active:n})}),e.jsx(i,{children:"Активен"})]})]}),e.jsxs(F,{children:[e.jsx(r,{variant:"outline",onClick:()=>j(null),children:"Отмена"}),e.jsx(r,{onClick:()=>E.mutate({id:t.id,updates:t}),disabled:E.isPending,children:E.isPending?"Сохранение...":"Сохранить"})]})]})]})})]},s.id))})]})})]}),e.jsx(T,{open:ee,onOpenChange:_,children:e.jsxs(N,{children:[e.jsx(P,{children:e.jsx(S,{children:"Создать тип консультации"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Название"}),e.jsx(d,{value:l.name,onChange:s=>p({...l,name:s.target.value}),placeholder:"Например: Первичная консультация"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Длительность (минуты)"}),e.jsx(d,{type:"number",value:l.duration_minutes,onChange:s=>p({...l,duration_minutes:parseInt(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Цена (₽)"}),e.jsx(d,{type:"number",value:l.price,onChange:s=>p({...l,price:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Описание"}),e.jsx(q,{value:l.description||"",onChange:s=>p({...l,description:s.target.value||null}),placeholder:"Описание типа консультации..."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{checked:l.is_active,onCheckedChange:s=>p({...l,is_active:s})}),e.jsx(i,{children:"Активен"})]})]}),e.jsxs(F,{children:[e.jsx(r,{variant:"outline",onClick:()=>{_(!1),p(B)},children:"Отмена"}),e.jsx(r,{onClick:()=>Q.mutate(l),disabled:Q.isPending||!l.name,children:Q.isPending?"Создание...":"Создать"})]})]})}),e.jsx(T,{open:se,onOpenChange:k,children:e.jsxs(N,{children:[e.jsx(P,{children:e.jsx(S,{children:"Создать пакет"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Название"}),e.jsx(d,{value:a.name,onChange:s=>u({...a,name:s.target.value}),placeholder:"Например: Пакет из 5 консультаций"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Тип консультации"}),e.jsxs(ce,{value:a.appointment_type_id,onValueChange:s=>u({...a,appointment_type_id:s}),children:[e.jsx(te,{children:e.jsx(le,{placeholder:"Выберите тип консультации"})}),e.jsx(de,{children:g==null?void 0:g.filter(s=>s.is_active).map(s=>e.jsx(oe,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Количество сессий"}),e.jsx(d,{type:"number",value:a.session_count,onChange:s=>u({...a,session_count:parseInt(s.target.value)||1}),min:1})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Цена (₽)"}),e.jsx(d,{type:"number",value:a.price,onChange:s=>u({...a,price:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Описание"}),e.jsx(q,{value:a.description||"",onChange:s=>u({...a,description:s.target.value||null}),placeholder:"Описание пакета..."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{checked:a.is_active,onCheckedChange:s=>u({...a,is_active:s})}),e.jsx(i,{children:"Активен"})]})]}),e.jsxs(F,{children:[e.jsx(r,{variant:"outline",onClick:()=>{k(!1),u(V)},children:"Отмена"}),e.jsx(r,{onClick:()=>H.mutate(a),disabled:H.isPending||!a.name||!a.appointment_type_id,children:H.isPending?"Создание...":"Создать"})]})]})})]})}export{Ce as default};
