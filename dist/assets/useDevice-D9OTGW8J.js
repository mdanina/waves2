import{r as o}from"./vendor-radix-CDHcN1cP.js";import{u as _}from"./index-Dt6uKTGi.js";const c="waves_device",m="waves_device_setup";function w(){const{user:e}=_(),[t,n]=o.useState(null),[u,d]=o.useState(!0),[p,g]=o.useState(null);o.useEffect(()=>{if(!(e!=null&&e.id)){n(null),d(!1);return}try{const s=localStorage.getItem(`${c}_${e.id}`);if(s){const r=JSON.parse(s);(r.status==="delivered"||r.status==="setup_pending"||r.status==="setup_complete")&&!r.serial_number&&(r.serial_number="WF-"+Math.random().toString(36).substring(2,10).toUpperCase(),localStorage.setItem(`${c}_${e.id}`,JSON.stringify(r))),n(r)}else n(null)}catch(s){console.error("Error loading device:",s),n(null)}d(!1)},[e==null?void 0:e.id]);const i=o.useCallback(s=>{e!=null&&e.id&&(s?localStorage.setItem(`${c}_${e.id}`,JSON.stringify(s)):localStorage.removeItem(`${c}_${e.id}`),n(s))},[e==null?void 0:e.id]),S=o.useCallback(async s=>{if(!(e!=null&&e.id))throw new Error("User not authenticated");await new Promise(f=>setTimeout(f,1e3));const r={id:`device_${Date.now()}`,user_id:e.id,model:"Waves Neurofeedback v1",status:"ordered",shipping_address:s,ordered_at:new Date().toISOString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return i(r),r},[e==null?void 0:e.id,i]),a=o.useCallback(s=>{if(!t)return;const r={status:s,updated_at:new Date().toISOString()};s==="shipped"&&(r.shipped_at=new Date().toISOString(),r.tracking_number="SDEK-"+Math.random().toString(36).substring(2,10).toUpperCase(),r.carrier="sdek"),s==="delivered"&&(r.delivered_at=new Date().toISOString(),t.serial_number||(r.serial_number="WF-"+Math.random().toString(36).substring(2,10).toUpperCase())),s==="setup_complete"&&(r.setup_completed_at=new Date().toISOString(),t.serial_number||(r.serial_number="WF-"+Math.random().toString(36).substring(2,10).toUpperCase())),i({...t,...r})},[t,i]),l=o.useCallback(()=>{i(null)},[i]);return{device:t,loading:u,error:p,orderDevice:S,updateStatus:a,resetDevice:l,hasDevice:!!t,isOrdered:(t==null?void 0:t.status)==="ordered",isShipped:(t==null?void 0:t.status)==="shipped"||(t==null?void 0:t.status)==="in_transit",isDelivered:(t==null?void 0:t.status)==="delivered"||(t==null?void 0:t.status)==="setup_pending"||(t==null?void 0:t.status)==="setup_complete",isSetupComplete:(t==null?void 0:t.status)==="setup_complete"}}function C(){const{user:e}=_(),[t,n]=o.useState(new Set);o.useEffect(()=>{if(e!=null&&e.id)try{const a=localStorage.getItem(`${m}_${e.id}`);a&&n(new Set(JSON.parse(a)))}catch(a){console.error("Error loading device setup:",a)}},[e==null?void 0:e.id]),o.useEffect(()=>{if(e!=null&&e.id)try{localStorage.setItem(`${m}_${e.id}`,JSON.stringify([...t]))}catch(a){console.error("Error saving device setup:",a)}},[t,e==null?void 0:e.id]);const u=o.useCallback(a=>{n(l=>{const s=new Set(l);return s.has(a)?s.delete(a):s.add(a),s})},[]),d=o.useCallback(a=>{n(l=>new Set(l).add(a))},[]),p=o.useCallback(()=>{n(new Set)},[]),g=o.useCallback(a=>t.has(a),[t]),i={completed:t.size,total:6,percentage:Math.round(t.size/6*100)},S=t.size>=6;return{completedSteps:t,toggleStep:u,markComplete:d,reset:p,isStepComplete:g,progress:i,isAllComplete:S}}export{C as a,w as u};
