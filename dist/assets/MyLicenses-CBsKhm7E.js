import{r as N,j as e}from"./vendor-radix-htwXsPHy.js";import{g as q,S as A,C as f,a8 as G,i as w,s as T,U as O,ah as R,a4 as J,B as h,m as K,X as z,a3 as V,Y as B,Z as F,_ as M,a0 as H,Q as $,T as Q,z as ee,f as p,ad as se,u as te}from"./index-Bu4m9iDU.js";import{u as ae}from"./useProfiles-CiC7oZdw.js";import{u as re}from"./vendor-react-CI8wve7f.js";import{P as W}from"./plus-L645YxVk.js";import"./vendor-charts-DjioKZbK.js";import"./vendor-query-BNGVDYIL.js";import"./profileStorage-B9P4N8Co.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=q("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]),L=[{id:"individual",name:"Индивидуальный",description:"Для одного участника",maxSeats:1,includesDevice:!0,price:9900,period:"month",features:["Устройство нейрофидбэка","Мобильное приложение","Персональные тренировки","Отслеживание прогресса","Поддержка в чате"]},{id:"family",name:"Семейный",description:"Родитель + ребёнок",maxSeats:2,includesDevice:!0,price:14900,period:"month",features:["Устройство нейрофидбэка","Мобильное приложение","2 аккаунта участников","Персональные тренировки для каждого","Семейная статистика","Приоритетная поддержка"]}],ne={active:"Активна",expired:"Истекла",cancelled:"Отменена",pending:"Ожидает оплаты"},ce={active:"bg-success/20 text-success",expired:"bg-muted text-muted-foreground",cancelled:"bg-destructive/20 text-destructive",pending:"bg-honey/20 text-honey-dark"};function Y(n){return L.find(o=>o.id===n)}function X(n){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0,maximumFractionDigits:0}).format(n)}function de(n,o=7){const g=new Date(n.expires_at),m=new Date,x=Math.floor((g.getTime()-m.getTime())/(1e3*60*60*24));return x<=o&&x>0}function le(){const{user:n}=te(),[o,g]=N.useState([]),[m,x]=N.useState([]);return{licenses:o,seats:m,loading:!1,error:null,purchaseLicense:async d=>{await new Promise(l=>setTimeout(l,1e3));const c=Y(d);if(!c)throw new Error("Invalid plan");const a={id:`license_${Date.now()}`,user_id:(n==null?void 0:n.id)||"",plan_type:d,status:"active",starts_at:new Date().toISOString(),expires_at:new Date(Date.now()+30*24*60*60*1e3).toISOString(),auto_renew:!0,max_seats:c.maxSeats,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return g(l=>[...l,a]),a},assignSeat:async(d,c,a)=>{const l=o.find(u=>u.id===d);if(!l)throw new Error("License not found");if(m.filter(u=>u.license_id===d).length>=l.max_seats)throw new Error("No available seats");const b={id:`seat_${Date.now()}`,license_id:d,profile_id:c,profile:a,assigned_at:new Date().toISOString()};return x(u=>[...u,b]),b},removeSeat:async d=>{x(c=>c.filter(a=>a.id!==d))},hasLicense:o.length>0}}function pe(){const n=re(),{data:o}=ae(),{licenses:g,seats:m,purchaseLicense:x,assignSeat:C,removeSeat:P,hasLicense:S}=le(),[j,_]=N.useState(!1),[d,c]=N.useState(!1),[a,l]=N.useState(null),y=async s=>{_(!0);try{await x(s),p.success("Лицензия успешно приобретена!"),c(!1),l(null)}catch{p.error("Ошибка при покупке лицензии")}finally{_(!1)}},b=s=>m.filter(r=>r.license_id===s),u=s=>{const r=m.filter(i=>i.license_id===s).map(i=>i.profile_id);return(o||[]).filter(i=>!r.includes(i.id))};return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(A,{size:"2xl",className:"mb-2",children:"Мои лицензии"}),e.jsx("p",{className:"text-muted-foreground",children:"Управление подписками и участниками"})]}),!S&&e.jsx("div",{className:"space-y-6",children:e.jsxs(f,{className:"glass-elegant border-2 p-6 sm:p-8",children:[e.jsxs("div",{className:"text-center max-w-md mx-auto mb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-honey/10 flex items-center justify-center mx-auto mb-6",children:e.jsx(G,{className:"h-10 w-10 text-honey"})}),e.jsx(A,{size:"xl",className:"mb-3",children:"У вас нет активных лицензий"}),e.jsx("p",{className:"text-muted-foreground",children:"Выберите подходящий план, чтобы начать использовать Waves"})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:L.map(s=>e.jsxs(f,{className:w("relative p-6 border-2 transition-all cursor-pointer hover:shadow-lg",a===s.id?"border-coral bg-coral/5":"border-border/50 hover:border-coral/50"),onClick:()=>l(s.id),children:[s.id==="family"&&e.jsxs(T,{className:"absolute -top-2 -right-2 bg-honey text-ink",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"Популярный"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.id==="individual"?e.jsx(O,{className:"h-8 w-8 text-coral"}):e.jsx(R,{className:"h-8 w-8 text-coral"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-3xl font-bold",children:X(s.price)}),e.jsx("span",{className:"text-muted-foreground",children:" / месяц"})]}),e.jsx("ul",{className:"space-y-2 mb-6",children:s.features.map((r,i)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(J,{className:"h-4 w-4 text-success flex-shrink-0"}),e.jsx("span",{children:r})]},i))}),e.jsx(h,{className:w("w-full",a===s.id?"bg-gradient-to-r from-coral to-coral-light":""),variant:a===s.id?"default":"outline",onClick:r=>{r.stopPropagation(),y(s.id)},disabled:j,children:j&&a===s.id?"Оформление...":"Выбрать план"})]},s.id))})]})}),S&&e.jsxs("div",{className:"space-y-6",children:[g.map(s=>{const r=Y(s.plan_type),i=b(s.id),k=u(s.id),v=s.max_seats-i.length,Z=de(s);return e.jsxs(f,{className:"glass-elegant border-2 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-coral/20 to-coral/10 flex items-center justify-center",children:s.plan_type==="individual"?e.jsx(O,{className:"h-6 w-6 text-coral"}):e.jsx(R,{className:"h-6 w-6 text-coral"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:(r==null?void 0:r.name)||"Лицензия"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r==null?void 0:r.description})]})]}),e.jsx(T,{className:w(ce[s.status]),children:ne[s.status]})]}),Z&&e.jsxs("div",{className:"mb-6 flex items-center gap-2 p-3 bg-honey/10 border border-honey/30 rounded-lg",children:[e.jsx(K,{className:"h-4 w-4 text-honey"}),e.jsxs("span",{className:"text-sm",children:["Лицензия истекает"," ",new Date(s.expires_at).toLocaleDateString("ru-RU")]}),e.jsx(h,{variant:"link",size:"sm",className:"ml-auto h-auto p-0",children:"Продлить"})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3 mb-6",children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Действует до"}),e.jsx("p",{className:"font-medium",children:new Date(s.expires_at).toLocaleDateString("ru-RU")})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Участники"}),e.jsxs("p",{className:"font-medium",children:[i.length," из ",s.max_seats]})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Устройство"}),e.jsx("p",{className:"font-medium",children:s.device_id?"Подключено":"Не привязано"})]})]}),e.jsxs("div",{className:"border-t border-border/50 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium",children:"Участники"}),v>0&&k.length>0&&e.jsxs(z,{children:[e.jsx(V,{asChild:!0,children:e.jsxs(h,{variant:"outline",size:"sm",children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"Добавить"]})}),e.jsxs(B,{children:[e.jsxs(F,{children:[e.jsx(M,{children:"Добавить участника"}),e.jsx(H,{children:"Выберите профиль для добавления в лицензию"})]}),e.jsx("div",{className:"space-y-2 mt-4",children:k.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-muted/50 transition-colors",onClick:async()=>{try{await C(s.id,t.id,{id:t.id,first_name:t.first_name,last_name:t.last_name||void 0,type:t.type}),p.success(`${t.first_name} добавлен в лицензию`)}catch{p.error("Ошибка при добавлении участника")}},children:[e.jsx($,{className:"h-10 w-10",children:e.jsx(Q,{children:t.first_name[0]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium",children:[t.first_name," ",t.last_name||""]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.type==="parent"?"Родитель":"Ребёнок"})]}),e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})]},t.id))})]})]})]}),i.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Нет добавленных участников"}):e.jsx("div",{className:"space-y-2",children:i.map(t=>{var D,E,I,U;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/30 rounded-lg",children:[e.jsx($,{className:"h-10 w-10",children:e.jsx(Q,{children:((E=(D=t.profile)==null?void 0:D.first_name)==null?void 0:E[0])||"?"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium",children:[(I=t.profile)==null?void 0:I.first_name," ",((U=t.profile)==null?void 0:U.last_name)||""]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Добавлен ",new Date(t.assigned_at).toLocaleDateString("ru-RU")]})]}),e.jsx(h,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-destructive",onClick:()=>{P(t.id),p.success("Участник удалён")},children:"Удалить"})]},t.id)})}),v>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-3",children:["Доступно ещё ",v," ",v===1?"место":"места"]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-border/50",children:e.jsxs(h,{variant:"outline",className:"w-full sm:w-auto",onClick:()=>n("/cabinet/device"),children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),s.device_id?"Управление устройством":"Привязать устройство"]})})]},s.id)}),e.jsxs(f,{className:"border-2 border-dashed border-muted-foreground/30 p-6 text-center cursor-pointer hover:border-coral/50 transition-colors",onClick:()=>c(!0),children:[e.jsx(W,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Приобрести ещё одну лицензию"})]})]}),e.jsx(z,{open:d,onOpenChange:c,children:e.jsxs(B,{className:"max-w-2xl",children:[e.jsxs(F,{children:[e.jsx(M,{children:"Выбор лицензии"}),e.jsx(H,{children:"Выберите план, который подходит вам"})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 mt-4",children:L.map(s=>e.jsxs(f,{className:w("relative p-4 border-2 cursor-pointer transition-all",a===s.id?"border-coral bg-coral/5":"border-border/50 hover:border-coral/50"),onClick:()=>l(s.id),children:[e.jsx("h4",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.description}),e.jsxs("p",{className:"text-xl font-bold",children:[X(s.price),e.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:" / мес"})]})]},s.id))}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx(h,{variant:"outline",onClick:()=>c(!1),children:"Отмена"}),e.jsx(h,{onClick:()=>a&&y(a),disabled:!a||j,className:"bg-gradient-to-r from-coral to-coral-light",children:j?"Оформление...":"Оформить"})]})]})})]})}export{pe as default};
