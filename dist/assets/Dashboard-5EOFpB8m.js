import{r as j,j as e}from"./vendor-radix-J7BmBqsC.js";import{p as fs,a as _t}from"./friendly-and-clean-face-of-an-adult-person--gender (1)-mshj5uDX.js";import{c as ms,a as hs}from"./friendly-and-clean-face-of-a-white-boy-7-yo--soft- (1)-BoJK1GJM.js";import{N as Ut,u as mt,x as K,C as we,h as Ke,O as Ct,Q as Le,R as xs,T as gs,V as Ve,W as qe,X as He,t as ge,B as O,Y as Ne,Z as ps,_ as ct,E as Se,G as Ee,J as Ie,$ as Pe,a0 as Ae,a1 as Vt,L as vs,a2 as qt,a3 as Ht,f as pe,a4 as js,r as ys,a5 as bs,q as ue,i as ve,S as Ce,a6 as lt,v as ws,w as Ns,y as Yt,D as Gt,a7 as ks,s as _s,a8 as Cs,o as St,m as Et,a9 as At,z as Ss,U as Qe}from"./index-CsvxaYtI.js";import{isEligibleForCheckup as Ue,calculateAge as Es,deleteProfile as As}from"./profileStorage-CU3CxDLE.js";import{u as Ts}from"./useProfiles-Bh4H3Y1m.js";import{u as Tt,a as Dt}from"./useAssessments-v2X3fjfe.js";import{b as Ds,a as Ls}from"./useAppointments-CyaU3UD4.js";import{f as Lt}from"./moscowTime-Bf471xDt.js";import{A as Ze,h as Xe,a as et,b as tt,c as st,d as nt,e as rt,f as it,g as at}from"./alert-dialog-COnYxGom.js";import{S as Is}from"./separator-B5qA960N.js";import{B as dt}from"./briefcase-sH88EsxI.js";import{P as Ps}from"./play-BCyXg3Ja.js";import{G as Ms,B as Os}from"./graduation-cap-C_VsmSiJ.js";import{S as zs}from"./star-DQWG-27u.js";import{g as Fs,b as $s,a as Rs,r as Bs}from"./calendar-feed-CbZCm7zL.js";import{C as Us}from"./copy-BIipb-ws.js";import{T as Vs}from"./trash-2-BiEfhxdN.js";import{u as Wt}from"./vendor-react-CI1J5nwZ.js";import{E as qs}from"./external-link-Cy2wAi2R.js";import{A as Hs}from"./arrow-right-DEcTS4qg.js";import{s as Ys,g as It}from"./supabase-messages-DKMqSP5V.js";import{u as Gs}from"./vendor-query-Bb981xLV.js";import{E as ot}from"./eye-PA3INOij.js";import{P as Pt}from"./plus-CNlpg7MV.js";import"./vendor-charts-CkgrveCd.js";import"./assessmentStorage-kMcQQ0-2.js";import"./appointmentStorage-D1wbbDxY.js";const Ws={child_psychology:"Детская психология",family_therapy:"Семейная терапия",cbt:"КПТ",trauma:"Работа с травмой",anxiety:"Тревожные расстройства",depression:"Депрессия",adhd:"СДВГ",autism:"Аутизм",eating_disorders:"Расстройства питания",parenting:"Родительство",psychologist:"Психолог",psychiatrist:"Психиатр",psychotherapist:"Психотерапевт",clinical_psychologist:"Клинический психолог",child_psychologist:"Детский психолог",family_therapist:"Семейный терапевт",neuropsychologist:"Нейропсихолог",logopedist:"Логопед",defectologist:"Дефектолог",art_therapist:"Арт-терапевт",cbt_specialist:"Специалист по КПТ",coordinator:"Координатор"},Js={higher:"Высшее образование",additional:"Дополнительное образование",certification:"Сертификация",course:"Курс"};function Ks({specialistId:t,showChangeButton:s=!0,onSpecialistChange:a}){const{toast:o}=Ut(),{user:c}=mt(),[n,i]=j.useState(null),[m,u]=j.useState([]),[l,b]=j.useState(!0),[p,v]=j.useState(!1),[N,x]=j.useState(!1),[g,h]=j.useState(""),[d,f]=j.useState(!1),[y,S]=j.useState(!1);j.useEffect(()=>{E()},[t,c]);const E=async()=>{if(c)try{b(!0);let w=null;if(t){const{data:I,error:$}=await K.from("specialists").select("*").eq("id",t).single();if($)throw $;w=I}else{const{data:I,error:$}=await K.from("client_assignments").select("specialist_id").eq("client_user_id",c.id).eq("status","active").single();if($){if($.code==="PGRST116"){i(null),b(!1);return}throw $}const{data:H,error:Y}=await K.from("specialists").select("*").eq("id",I.specialist_id).single();if(Y)throw Y;w=H}if(i(w),w){const{data:I}=await K.from("specialist_education").select("*").eq("specialist_id",w.id).order("year_end",{ascending:!1,nullsFirst:!1});u(I||[]);const{data:$}=await K.from("specialist_change_requests").select("id").eq("client_user_id",c.id).eq("status","pending").single();S(!!$)}}catch(w){console.error("Error loading specialist data:",w),o({title:"Ошибка",description:"Не удалось загрузить данные специалиста",variant:"destructive"})}finally{b(!1)}},L=w=>{const I=w.match(/(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);if(I)return`https://www.youtube.com/embed/${I[1]}`;const $=w.match(/vimeo\.com\/(?:video\/)?(\d+)/);return $?`https://player.vimeo.com/video/${$[1]}`:null},A=async()=>{if(!(!c||!n))try{f(!0);const{error:w}=await K.from("specialist_change_requests").insert({client_user_id:c.id,current_specialist_id:n.id,reason:g||null,status:"pending"});if(w)throw w;o({title:"Запрос отправлен",description:"Координатор рассмотрит ваш запрос на смену специалиста"}),x(!1),h(""),S(!0),a==null||a()}catch(w){console.error("Error submitting change request:",w),o({title:"Ошибка",description:"Не удалось отправить запрос",variant:"destructive"})}finally{f(!1)}},T=w=>w.split(" ").map($=>$[0]).join("").toUpperCase().slice(0,2),k=(w,I)=>w&&I?`${w} - ${I}`:I?`${I}`:w?`с ${w}`:null;if(l)return e.jsx(we,{children:e.jsx(Ke,{className:"flex items-center justify-center py-12",children:e.jsx(Ct,{className:"h-8 w-8 animate-spin text-muted-foreground"})})});if(!n)return e.jsx(we,{children:e.jsxs(Ke,{className:"py-8 text-center",children:[e.jsx(Le,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Вам пока не назначен специалист. После установочной встречи координатор подберёт для вас подходящего специалиста."})]})});const F=n.video_intro_url?L(n.video_intro_url):null;return e.jsxs(e.Fragment,{children:[e.jsxs(we,{children:[e.jsx(xs,{children:e.jsxs(gs,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5"}),"Ваш специалист"]})}),e.jsxs(Ke,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(Ve,{className:"h-20 w-20",children:[e.jsx(qe,{src:n.avatar_url||void 0}),e.jsx(He,{className:"text-xl",children:T(n.display_name)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold",children:n.display_name}),n.experience_years&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(dt,{className:"h-4 w-4"}),"Опыт работы: ",n.experience_years," лет"]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx(ge,{variant:n.is_available?"default":"secondary",children:n.is_available?"Доступен":"Не в сети"})})]})]}),n.specialization_codes.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Специализации:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.specialization_codes.map(w=>e.jsx(ge,{variant:"outline",children:Ws[w]||w},w))})]}),n.bio&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"О специалисте:"}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:n.bio})]}),n.video_intro_url&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Видеовизитка:"}),e.jsxs(O,{variant:"outline",onClick:()=>v(!0),className:"w-full sm:w-auto",children:[e.jsx(Ps,{className:"mr-2 h-4 w-4"}),"Смотреть видео"]})]}),m.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium mb-3 flex items-center gap-2",children:[e.jsx(Ms,{className:"h-4 w-4"}),"Образование:"]}),e.jsx("div",{className:"space-y-3",children:m.map(w=>e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Os,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:w.institution})]}),w.specialty&&e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:w.specialty}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground pl-6",children:[k(w.year_start,w.year_end)&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"h-3 w-3"}),k(w.year_start,w.year_end)]}),e.jsx("span",{className:"px-2 py-0.5 bg-muted rounded",children:Js[w.education_type]||w.education_type})]})]},w.id))})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(Is,{}),y?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground p-3 bg-muted/50 rounded-lg",children:[e.jsx(ps,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Ваш запрос на смену специалиста рассматривается"})]}):e.jsxs(O,{variant:"outline",onClick:()=>x(!0),className:"w-full",children:[e.jsx(ct,{className:"mr-2 h-4 w-4"}),"Запросить смену специалиста"]})]})]})]}),e.jsx(Se,{open:p,onOpenChange:v,children:e.jsxs(Ee,{className:"max-w-3xl w-[90vw] p-0",children:[e.jsx(Ie,{className:"px-6 pt-6",children:e.jsxs(Pe,{children:["Видеовизитка ",n.display_name]})}),e.jsx("div",{className:"px-6 pb-6",children:F?e.jsx("div",{className:"relative w-full",style:{paddingBottom:"56.25%"},children:e.jsx("iframe",{className:"absolute top-0 left-0 w-full h-full rounded-lg",src:F,title:"Видеовизитка специалиста",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ae,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground",children:["Видео доступно по"," ",e.jsx("a",{href:n.video_intro_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"ссылке"})]})]})})]})}),e.jsx(Se,{open:N,onOpenChange:x,children:e.jsxs(Ee,{children:[e.jsxs(Ie,{children:[e.jsx(Pe,{children:"Запросить смену специалиста"}),e.jsx(Vt,{children:"Если вы чувствуете, что текущий специалист вам не подходит, вы можете запросить смену. Координатор подберет вам другого специалиста."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(vs,{htmlFor:"change-reason",children:"Причина смены (необязательно)"}),e.jsx(qt,{id:"change-reason",value:g,onChange:w=>h(w.target.value),placeholder:"Опишите, почему вы хотите сменить специалиста...",rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Это поможет координатору лучше подобрать нового специалиста"})]})}),e.jsxs(Ht,{children:[e.jsx(O,{variant:"outline",onClick:()=>x(!1),disabled:d,children:"Отмена"}),e.jsx(O,{onClick:A,disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"mr-2 h-4 w-4 animate-spin"}),"Отправка..."]}):"Отправить запрос"})]})]})})]})}async function Mt(){const{data:{user:t}}=await K.auth.getUser();if(!t)return null;const{data:s,error:a}=await K.rpc("get_pending_ratings_for_user",{p_user_id:t.id});return a?(console.error("Error fetching pending rating:",a),null):!s||s.length===0?null:s[0]}async function Qs(t){const{data:{user:s}}=await K.auth.getUser();if(!s)return{success:!1,error:"Пользователь не авторизован"};const{error:a}=await K.from("specialist_ratings").insert({appointment_id:t.appointment_id,client_user_id:s.id,specialist_id:t.specialist_id,rating:t.rating,review_text:t.review_text||null});return a?(console.error("Error submitting rating:",a),{success:!1,error:a.message}):{success:!0}}async function Zs(t){const{error:s}=await K.from("appointments").update({rating_skipped:!0}).eq("id",t);return s?(console.error("Error skipping rating:",s),{success:!1,error:s.message}):{success:!0}}async function Xs(t){if(!t||t.length===0)return"";const{data:s,error:a}=await K.from("specializations").select("name").in("code",t);return a?(console.error("Error fetching specialization names:",a),""):(s==null?void 0:s.map(o=>o.name).join(", "))||""}function en(t){return new Date(t).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Moscow"})}function tn({pendingRating:t,open:s,onClose:a,onSubmitted:o}){const[c,n]=j.useState(0),[i,m]=j.useState(0),[u,l]=j.useState(""),[b,p]=j.useState(!1),[v,N]=j.useState("");j.useEffect(()=>{n(0),m(0),l(""),N("")},[t==null?void 0:t.appointment_id]),j.useEffect(()=>{var f;((f=t==null?void 0:t.specialization_codes)==null?void 0:f.length)>0&&Xs(t.specialization_codes).then(N)},[t==null?void 0:t.specialization_codes]);const x=async()=>{if(c===0){pe.error("Пожалуйста, выберите оценку");return}p(!0);const f=await Qs({appointment_id:t.appointment_id,specialist_id:t.specialist_id,rating:c,review_text:u.trim()||void 0});p(!1),f.success?(pe.success("Спасибо за вашу оценку!"),o()):pe.error(f.error||"Не удалось отправить оценку")},g=async()=>{p(!0);const f=await Zs(t.appointment_id);p(!1),f.success?a():pe.error(f.error||"Не удалось пропустить оценку")},h=f=>f.split(" ").map(y=>y[0]).join("").slice(0,2).toUpperCase(),d=i||c;return e.jsx(Se,{open:s,onOpenChange:f=>!f&&a(),children:e.jsxs(Ee,{className:"sm:max-w-md",children:[e.jsx(Ie,{children:e.jsx(Pe,{className:"text-center text-xl",children:"Как прошла консультация?"})}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs(Ve,{className:"h-14 w-14",children:[e.jsx(qe,{src:t.specialist_avatar||void 0}),e.jsx(He,{className:"bg-primary/10 text-primary text-lg",children:h(t.specialist_name)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"font-semibold text-foreground truncate",children:t.specialist_name})]}),v&&e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:v}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Ne,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:en(t.scheduled_at)})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 py-4",children:[e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(f=>e.jsx("button",{type:"button",onClick:()=>n(f),onMouseEnter:()=>m(f),onMouseLeave:()=>m(0),className:"p-1 transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded","aria-label":`Оценка ${f} из 5`,children:e.jsx(zs,{className:`h-10 w-10 transition-colors ${f<=d?"fill-yellow-400 text-yellow-400":"fill-none text-muted-foreground/50"}`})},f))}),d>0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d===1&&"Очень плохо",d===2&&"Плохо",d===3&&"Нормально",d===4&&"Хорошо",d===5&&"Отлично"]})]}),e.jsxs("div",{children:[e.jsx(qt,{placeholder:"Поделитесь впечатлениями (необязательно)...",value:u,onChange:f=>l(f.target.value),rows:3,maxLength:1e3,className:"resize-none"}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right mt-1",children:[u.length,"/1000"]})]}),e.jsxs(Ht,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(O,{variant:"ghost",onClick:g,disabled:b,className:"w-full sm:w-auto",children:"Пропустить"}),e.jsx(O,{onClick:x,disabled:b||c===0,className:"w-full sm:w-auto",children:b?"Отправка...":"Отправить"})]})]})})}function sn({trigger:t}){const[s,a]=j.useState(!1),[o,c]=j.useState(!1),[n,i]=j.useState(null),[m,u]=j.useState(!1),{toast:l}=Ut();j.useEffect(()=>{s&&b()},[s]);const b=async()=>{c(!0);try{const g=await Fs();i(g?$s(g):null)}catch(g){console.error("Ошибка загрузки токена:",g)}finally{c(!1)}},p=async()=>{c(!0);try{const g=await Rs();i(g.feedUrl),l({title:"Ссылка создана",description:"Скопируйте ссылку и добавьте в свой календарь"})}catch(g){l({title:"Ошибка",description:g instanceof Error?g.message:"Не удалось создать ссылку",variant:"destructive"})}finally{c(!1)}},v=async()=>{c(!0);try{await Bs(),i(null),l({title:"Ссылка отозвана",description:"Старая ссылка больше не работает"})}catch(g){l({title:"Ошибка",description:g instanceof Error?g.message:"Не удалось отозвать ссылку",variant:"destructive"})}finally{c(!1)}},N=async()=>{if(n)try{await navigator.clipboard.writeText(n),u(!0),l({title:"Скопировано",description:"Ссылка скопирована в буфер обмена"}),setTimeout(()=>u(!1),2e3)}catch{l({title:"Ошибка",description:"Не удалось скопировать ссылку",variant:"destructive"})}},x=e.jsxs(O,{variant:"outline",size:"sm",className:"text-xs sm:text-sm",children:[e.jsx(Ne,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Добавить в календарь"})]});return e.jsxs(Se,{open:s,onOpenChange:a,children:[e.jsx(js,{asChild:!0,children:t||x}),e.jsxs(Ee,{className:"sm:max-w-md",children:[e.jsxs(Ie,{children:[e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-primary"}),"Добавьте сессии себе в календарь"]}),e.jsx(Vt,{children:"Создайте ссылку и добавьте её в календарь."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Google Календарь"}),e.jsx("p",{className:"text-muted-foreground",children:"Меню «Другие календари» — «Добавить по URL»"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Apple Календарь"}),e.jsx("p",{className:"text-muted-foreground",children:"Меню «Файл» — «Подписка на новый календарь...»"})]})]}),n?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ys,{value:n,readOnly:!0,className:"font-mono text-xs"}),e.jsx(O,{variant:"outline",size:"icon",onClick:N,disabled:o,children:m?e.jsx(bs,{className:"h-4 w-4 text-green-500"}):e.jsx(Us,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{variant:"outline",size:"sm",onClick:p,disabled:o,className:"flex-1",children:[e.jsx(ct,{className:`h-4 w-4 mr-2 ${o?"animate-spin":""}`}),"Обновить ссылку"]}),e.jsx(O,{variant:"outline",size:"sm",onClick:v,disabled:o,className:"text-destructive hover:text-destructive",children:e.jsx(Vs,{className:"h-4 w-4"})})]})]}):e.jsxs(O,{onClick:p,disabled:o,className:"w-full bg-primary hover:bg-primary/90",children:[o?e.jsx(ct,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Создать ссылку"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Календарь будет автоматически обновляться при изменении ваших сессий. Не передавайте эту ссылку третьим лицам."})]})]})]})}const _e="waves_onboarding_checklist",nn=[{id:"pay_licenses",title:"Оплатить лицензию",description:"Приобретите лицензию для начала работы",autoCheck:!0,link:"/cabinet/licenses",linkText:"Открыть"},{id:"order_device",title:"Заказать доставку устройства",description:"Оформите заказ на устройство нейрофидбэка",autoCheck:!0,link:"/cabinet/device",linkText:"Открыть"},{id:"fill_profiles",title:"Заполнить профили участников",description:"Добавьте информацию о себе и членах семьи",autoCheck:!0,link:"/family-members",linkText:"Открыть"},{id:"learn_neurofeedback",title:"Познакомиться с методом нейрофидбэка",description:"Узнайте, как работает технология",link:"https://waves.ai/neurofeedback",linkText:"Открыть"},{id:"download_app",title:"Скачать мобильное приложение",description:"Установите приложение Waves на телефон",link:"https://waves.ai/app",linkText:"Скачать"},{id:"test_device",title:"Подключить и протестировать устройство",description:"Убедитесь, что устройство работает корректно"},{id:"complete_tutorial",title:"Пройти инструктаж в мобильном приложении",description:"Завершите обучение в приложении"}];function Ot(){try{const t=localStorage.getItem("waves_licenses");return(t?JSON.parse(t):[]).length>0}catch{return!1}}function zt(t){if(!t)return!1;try{return localStorage.getItem(`waves_device_${t}`)!==null}catch{return!1}}function rn(t={}){const{user:s}=mt(),{profilesCount:a=0}=t,[o,c]=j.useState({hasLicense:t.hasLicense??Ot(),hasDevice:t.hasDevice??zt(s==null?void 0:s.id)});j.useEffect(()=>{const h=()=>{c({hasLicense:t.hasLicense??Ot(),hasDevice:t.hasDevice??zt(s==null?void 0:s.id)})};h();const d=y=>{var S,E;((S=y.key)!=null&&S.includes("waves_licenses")||(E=y.key)!=null&&E.includes("waves_device"))&&h()};window.addEventListener("storage",d);const f=setInterval(h,2e3);return()=>{window.removeEventListener("storage",d),clearInterval(f)}},[s==null?void 0:s.id,t.hasLicense,t.hasDevice]);const[n,i]=j.useState(()=>{if(typeof window>"u")return{items:{}};try{const h=localStorage.getItem(`${_e}_${(s==null?void 0:s.id)||"guest"}`);if(h)return JSON.parse(h)}catch(h){console.error("Error loading checklist state:",h)}return{items:{}}});j.useEffect(()=>{if(!(s!=null&&s.id))return;(async()=>{try{const{data:d,error:f}=await K.from("users").select("onboarding_checklist").eq("id",s.id).single();if(f&&f.code!=="PGRST116"){ue.error("Error loading checklist from DB:",f);const y=localStorage.getItem(`${_e}_${s.id}`);y&&i(JSON.parse(y));return}if(d!=null&&d.onboarding_checklist)i(d.onboarding_checklist),localStorage.setItem(`${_e}_${s.id}`,JSON.stringify(d.onboarding_checklist));else{const y=localStorage.getItem(`${_e}_${s.id}`);if(y){const S=JSON.parse(y);i(S),await K.from("users").update({onboarding_checklist:S}).eq("id",s.id)}else i({items:{}})}}catch(d){ue.error("Error loading checklist state:",d);const f=localStorage.getItem(`${_e}_${s.id}`);f&&i(JSON.parse(f))}})()},[s==null?void 0:s.id]),j.useEffect(()=>{if(!(s!=null&&s.id))return;const d=setTimeout(async()=>{try{localStorage.setItem(`${_e}_${s.id}`,JSON.stringify(n));const{error:f}=await K.from("users").update({onboarding_checklist:n}).eq("id",s.id);f&&ue.error("Error saving checklist to DB:",f)}catch(f){ue.error("Error saving checklist state:",f)}},500);return()=>clearTimeout(d)},[n,s==null?void 0:s.id]);const m=j.useMemo(()=>nn.map(h=>{let d=n.items[h.id]||!1;return h.id==="pay_licenses"&&h.autoCheck&&(d=o.hasLicense),h.id==="order_device"&&h.autoCheck&&(d=o.hasDevice),h.id==="fill_profiles"&&h.autoCheck&&(d=a>=1),{...h,completed:d}}),[n.items,a,o]),u=j.useMemo(()=>{const h=m.filter(y=>y.completed).length,d=m.length,f=Math.round(h/d*100);return{completed:h,total:d,percentage:f}},[m]),l=u.completed===u.total,b=!!n.dismissedAt,p=j.useCallback((h,d=!0)=>{i(f=>({...f,items:{...f.items,[h]:d}}))},[]),v=j.useCallback(h=>{i(d=>({...d,items:{...d.items,[h]:!d.items[h]}}))},[]),N=j.useCallback(()=>{i(h=>({...h,dismissedAt:new Date().toISOString()}))},[]),x=j.useCallback(()=>{i(h=>({...h,dismissedAt:void 0}))},[]),g=j.useCallback(()=>{i({items:{}})},[]);return{items:m,progress:u,isCompleted:l,isDismissed:b,markCompleted:p,toggleItem:v,dismiss:N,restore:x,reset:g}}function an({profilesCount:t=0,className:s}){const a=Wt(),{items:o,progress:c,isCompleted:n,isDismissed:i,toggleItem:m,dismiss:u,restore:l,markCompleted:b}=rn({profilesCount:t}),[p,v]=j.useState(!0),[N,x]=j.useState(!1),[g,h]=j.useState(!1);if(j.useEffect(()=>{i&&!n&&l()},[i,n,l]),j.useEffect(()=>{n&&!i&&h(!0)},[n,i]),i)return null;const d=o.findIndex(y=>!y.completed),f=d!==-1?o[d]:null;return e.jsx("div",{className:ve("transition-all duration-500",N&&"opacity-0 scale-95 -translate-y-4",s),children:e.jsxs(we,{className:"bg-white overflow-hidden border-0",children:[e.jsxs("div",{className:"p-4 sm:p-6 cursor-pointer",onClick:()=>v(!p),children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Ce,{size:"xl",className:"truncate",children:g?"Отлично! Все готово":"С чего начать?"}),g&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:"Вы выполнили все шаги для начала работы"})]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-coral to-coral-light transition-all duration-500",style:{width:`${c.percentage}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[c.percentage,"%"]})]}),n&&e.jsx(O,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-foreground",onClick:y=>{y.stopPropagation(),u()},children:e.jsx(lt,{className:"h-4 w-4"})}),e.jsx(O,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-foreground",onClick:y=>{y.stopPropagation(),v(!p)},children:p?e.jsx(ws,{className:"h-4 w-4"}):e.jsx(Ns,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"sm:hidden mt-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-coral to-coral-light transition-all duration-500",style:{width:`${c.percentage}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[c.percentage,"%"]})]})})]}),e.jsx("div",{className:ve("overflow-hidden transition-all duration-300",p?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"),children:e.jsx("div",{className:"px-4 sm:px-6 pb-4 sm:pb-6 space-y-2",children:o.map((y,S)=>e.jsx(on,{item:y,index:S,isCurrent:(f==null?void 0:f.id)===y.id,onToggle:()=>!y.autoCheck&&m(y.id),onNavigate:E=>a(E),onMarkCompleted:E=>b(E,!0)},y.id))})})]})})}function on({item:t,index:s,isCurrent:a,onToggle:o,onNavigate:c,onMarkCompleted:n}){var N;const i=!t.autoCheck,m=(N=t.link)==null?void 0:N.startsWith("/"),[u,l]=j.useState(!1),b=j.useRef(null),p=t.id==="learn_neurofeedback",v=p?"https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1&origin="+encodeURIComponent(window.location.origin):null;return j.useEffect(()=>{if(!u||!p)return;let x=null,g=null;const h={value:!1},d=()=>window.YT&&window.YT.Player?Promise.resolve():new Promise(y=>{var T;if(document.querySelector('script[src="https://www.youtube.com/iframe_api"]')){const k=setInterval(()=>{window.YT&&window.YT.Player&&(clearInterval(k),y())},100);return}const E=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{E&&E(),y()};const L=document.createElement("script");L.src="https://www.youtube.com/iframe_api",L.async=!0;const A=document.getElementsByTagName("script")[0];(T=A.parentNode)==null||T.insertBefore(L,A)});return(async()=>{try{await d(),g=setInterval(()=>{if(b.current&&window.YT&&window.YT.Player){clearInterval(g);try{x=new window.YT.Player(b.current,{events:{onStateChange:y=>{if(y.data===0&&!h.value)try{const S=x.getCurrentTime(),E=x.getDuration();E>0&&S>=E-1&&(h.value=!0,n(t.id),setTimeout(()=>{l(!1)},1e3))}catch{h.value=!0,n(t.id),setTimeout(()=>{l(!1)},1e3)}},onReady:()=>{},onError:y=>{console.error("YouTube player error:",y)}}})}catch(y){console.error("Error initializing YouTube player:",y)}}},100)}catch(y){console.error("Error loading YouTube API:",y)}})(),()=>{if(g&&clearInterval(g),x&&typeof x.destroy=="function")try{x.destroy()}catch(y){console.error("Error destroying YouTube player:",y)}}},[u,p,t.id,n]),e.jsxs("div",{className:ve("flex items-start gap-3 p-3 rounded-xl transition-all duration-200",a&&!t.completed&&"bg-white/50",t.completed&&"opacity-60",(i||t.completed)&&"cursor-pointer hover:bg-white/50"),onClick:i?o:t.completed?()=>o():void 0,children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:t.completed?e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center shadow-sm",style:{background:"linear-gradient(108deg, rgba(34, 197, 94, 0.25) 0%, rgba(34, 197, 94, 0.14) 100%)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(34, 197, 94, 0.3)"},children:e.jsx(Yt,{className:"h-4 w-4 text-green-600"})}):e.jsx("div",{className:ve("w-6 h-6 rounded-full border flex items-center justify-center transition-colors",a&&"border-coral"),style:{background:a?"linear-gradient(108deg, rgba(255, 138, 91, 0.25) 0%, rgba(255, 138, 91, 0.14) 100%)":"linear-gradient(108deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.14) 100%)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:a?"1px solid rgba(255, 138, 91, 0.3)":"1px solid rgba(0, 0, 0, 0.1)"},children:e.jsx("span",{className:"text-xs font-medium text-foreground",children:s+1})})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:ve("transition-all",t.completed&&"line-through text-muted-foreground"),children:t.title})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[t.autoCheck&&!t.completed&&e.jsx(ge,{variant:"secondary",className:"text-xs font-light",children:"Автоматически"}),t.link&&!t.completed&&e.jsxs(e.Fragment,{children:[e.jsxs(O,{variant:"ghost",size:"sm",className:"h-7 px-2 text-coral hover:text-coral hover:bg-coral/10",onClick:x=>{x.stopPropagation(),p?l(!0):m?c(t.link):window.open(t.link,"_blank","noopener,noreferrer")},children:[e.jsx("span",{className:"text-xs mr-1",children:t.linkText||"Открыть"}),m?e.jsx(Gt,{className:"h-3 w-3"}):e.jsx(qs,{className:"h-3 w-3"})]}),p&&e.jsx(Se,{open:u,onOpenChange:l,children:e.jsxs(Ee,{className:"max-w-4xl w-[90vw] p-0",children:[e.jsx(Ie,{className:"px-6 pt-6",children:e.jsx(Pe,{children:t.title})}),e.jsx("div",{className:"px-6 pb-6",children:v&&e.jsx("div",{className:"relative w-full",style:{paddingBottom:"56.25%"},children:e.jsx("iframe",{ref:b,className:"absolute top-0 left-0 w-full h-full rounded-lg",src:v,title:t.title,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})})]})})]})]})]})})]})}function cn(t){return Object.prototype.toString.call(t)==="[object Object]"}function Ft(t){return cn(t)||Array.isArray(t)}function ln(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function ht(t,s){const a=Object.keys(t),o=Object.keys(s);if(a.length!==o.length)return!1;const c=JSON.stringify(Object.keys(t.breakpoints||{})),n=JSON.stringify(Object.keys(s.breakpoints||{}));return c!==n?!1:a.every(i=>{const m=t[i],u=s[i];return typeof m=="function"?`${m}`==`${u}`:!Ft(m)||!Ft(u)?m===u:ht(m,u)})}function $t(t){return t.concat().sort((s,a)=>s.name>a.name?1:-1).map(s=>s.options)}function dn(t,s){if(t.length!==s.length)return!1;const a=$t(t),o=$t(s);return a.every((c,n)=>{const i=o[n];return ht(c,i)})}function xt(t){return typeof t=="number"}function ut(t){return typeof t=="string"}function Ge(t){return typeof t=="boolean"}function Rt(t){return Object.prototype.toString.call(t)==="[object Object]"}function q(t){return Math.abs(t)}function gt(t){return Math.sign(t)}function De(t,s){return q(t-s)}function un(t,s){if(t===0||s===0||q(t)<=q(s))return 0;const a=De(q(t),q(s));return q(a/t)}function fn(t){return Math.round(t*100)/100}function Me(t){return Oe(t).map(Number)}function fe(t){return t[Fe(t)]}function Fe(t){return Math.max(0,t.length-1)}function pt(t,s){return s===Fe(t)}function Bt(t,s=0){return Array.from(Array(t),(a,o)=>s+o)}function Oe(t){return Object.keys(t)}function Jt(t,s){return[t,s].reduce((a,o)=>(Oe(o).forEach(c=>{const n=a[c],i=o[c],m=Rt(n)&&Rt(i);a[c]=m?Jt(n,i):i}),a),{})}function ft(t,s){return typeof s.MouseEvent<"u"&&t instanceof s.MouseEvent}function mn(t,s){const a={start:o,center:c,end:n};function o(){return 0}function c(u){return n(u)/2}function n(u){return s-u}function i(u,l){return ut(t)?a[t](u):t(s,u,l)}return{measure:i}}function ze(){let t=[];function s(c,n,i,m={passive:!0}){let u;if("addEventListener"in c)c.addEventListener(n,i,m),u=()=>c.removeEventListener(n,i,m);else{const l=c;l.addListener(i),u=()=>l.removeListener(i)}return t.push(u),o}function a(){t=t.filter(c=>c())}const o={add:s,clear:a};return o}function hn(t,s,a,o){const c=ze(),n=1e3/60;let i=null,m=0,u=0;function l(){c.add(t,"visibilitychange",()=>{t.hidden&&x()})}function b(){N(),c.clear()}function p(h){if(!u)return;i||(i=h,a(),a());const d=h-i;for(i=h,m+=d;m>=n;)a(),m-=n;const f=m/n;o(f),u&&(u=s.requestAnimationFrame(p))}function v(){u||(u=s.requestAnimationFrame(p))}function N(){s.cancelAnimationFrame(u),i=null,m=0,u=0}function x(){i=null,m=0}return{init:l,destroy:b,start:v,stop:N,update:a,render:o}}function xn(t,s){const a=s==="rtl",o=t==="y",c=o?"y":"x",n=o?"x":"y",i=!o&&a?-1:1,m=b(),u=p();function l(x){const{height:g,width:h}=x;return o?g:h}function b(){return o?"top":a?"right":"left"}function p(){return o?"bottom":a?"left":"right"}function v(x){return x*i}return{scroll:c,cross:n,startEdge:m,endEdge:u,measureSize:l,direction:v}}function ke(t=0,s=0){const a=q(t-s);function o(l){return l<t}function c(l){return l>s}function n(l){return o(l)||c(l)}function i(l){return n(l)?o(l)?t:s:l}function m(l){return a?l-a*Math.ceil((l-s)/a):l}return{length:a,max:s,min:t,constrain:i,reachedAny:n,reachedMax:c,reachedMin:o,removeOffset:m}}function Kt(t,s,a){const{constrain:o}=ke(0,t),c=t+1;let n=i(s);function i(v){return a?q((c+v)%c):o(v)}function m(){return n}function u(v){return n=i(v),p}function l(v){return b().set(m()+v)}function b(){return Kt(t,m(),a)}const p={get:m,set:u,add:l,clone:b};return p}function gn(t,s,a,o,c,n,i,m,u,l,b,p,v,N,x,g,h,d,f){const{cross:y,direction:S}=t,E=["INPUT","SELECT","TEXTAREA"],L={passive:!1},A=ze(),T=ze(),k=ke(50,225).constrain(N.measure(20)),F={mouse:300,touch:400},w={mouse:500,touch:600},I=x?43:25;let $=!1,H=0,Y=0,ae=!1,me=!1,te=!1,oe=!1;function re(_){if(!f)return;function z(G){(Ge(f)||f(_,G))&&ye(G)}const B=s;A.add(B,"dragstart",G=>G.preventDefault(),L).add(B,"touchmove",()=>{},L).add(B,"touchend",()=>{}).add(B,"touchstart",z).add(B,"mousedown",z).add(B,"touchcancel",W).add(B,"contextmenu",W).add(B,"click",xe,!0)}function X(){A.clear(),T.clear()}function je(){const _=oe?a:s;T.add(_,"touchmove",Q,L).add(_,"touchend",W).add(_,"mousemove",Q,L).add(_,"mouseup",W)}function he(_){const z=_.nodeName||"";return E.includes(z)}function ce(){return(x?w:F)[oe?"mouse":"touch"]}function U(_,z){const B=p.add(gt(_)*-1),G=b.byDistance(_,!x).distance;return x||q(_)<k?G:h&&z?G*.5:b.byIndex(B.get(),0).distance}function ye(_){const z=ft(_,o);oe=z,te=x&&z&&!_.buttons&&$,$=De(c.get(),i.get())>=2,!(z&&_.button!==0)&&(he(_.target)||(ae=!0,n.pointerDown(_),l.useFriction(0).useDuration(0),c.set(i),je(),H=n.readPoint(_),Y=n.readPoint(_,y),v.emit("pointerDown")))}function Q(_){if(!ft(_,o)&&_.touches.length>=2)return W(_);const B=n.readPoint(_),G=n.readPoint(_,y),ne=De(B,H),le=De(G,Y);if(!me&&!oe&&(!_.cancelable||(me=ne>le,!me)))return W(_);const Z=n.pointerMove(_);ne>g&&(te=!0),l.useFriction(.3).useDuration(.75),m.start(),c.add(S(Z)),_.preventDefault()}function W(_){const B=b.byDistance(0,!1).index!==p.get(),G=n.pointerUp(_)*ce(),ne=U(S(G),B),le=un(G,ne),Z=I-10*le,de=d+le/50;me=!1,ae=!1,T.clear(),l.useDuration(Z).useFriction(de),u.distance(ne,!x),oe=!1,v.emit("pointerUp")}function xe(_){te&&(_.stopPropagation(),_.preventDefault(),te=!1)}function se(){return ae}return{init:re,destroy:X,pointerDown:se}}function pn(t,s){let o,c;function n(p){return p.timeStamp}function i(p,v){const x=`client${(v||t.scroll)==="x"?"X":"Y"}`;return(ft(p,s)?p:p.touches[0])[x]}function m(p){return o=p,c=p,i(p)}function u(p){const v=i(p)-i(c),N=n(p)-n(o)>170;return c=p,N&&(o=p),v}function l(p){if(!o||!c)return 0;const v=i(c)-i(o),N=n(p)-n(o),x=n(p)-n(c)>170,g=v/N;return N&&!x&&q(g)>.1?g:0}return{pointerDown:m,pointerMove:u,pointerUp:l,readPoint:i}}function vn(){function t(a){const{offsetTop:o,offsetLeft:c,offsetWidth:n,offsetHeight:i}=a;return{top:o,right:c+n,bottom:o+i,left:c,width:n,height:i}}return{measure:t}}function jn(t){function s(o){return t*(o/100)}return{measure:s}}function yn(t,s,a,o,c,n,i){const m=[t].concat(o);let u,l,b=[],p=!1;function v(h){return c.measureSize(i.measure(h))}function N(h){if(!n)return;l=v(t),b=o.map(v);function d(f){for(const y of f){if(p)return;const S=y.target===t,E=o.indexOf(y.target),L=S?l:b[E],A=v(S?t:o[E]);if(q(A-L)>=.5){h.reInit(),s.emit("resize");break}}}u=new ResizeObserver(f=>{(Ge(n)||n(h,f))&&d(f)}),a.requestAnimationFrame(()=>{m.forEach(f=>u.observe(f))})}function x(){p=!0,u&&u.disconnect()}return{init:N,destroy:x}}function bn(t,s,a,o,c,n){let i=0,m=0,u=c,l=n,b=t.get(),p=0;function v(){const L=o.get()-t.get(),A=!u;let T=0;return A?(i=0,a.set(o),t.set(o),T=L):(a.set(t),i+=L/u,i*=l,b+=i,t.add(i),T=b-p),m=gt(T),p=b,E}function N(){const L=o.get()-s.get();return q(L)<.001}function x(){return u}function g(){return m}function h(){return i}function d(){return y(c)}function f(){return S(n)}function y(L){return u=L,E}function S(L){return l=L,E}const E={direction:g,duration:x,velocity:h,seek:v,settled:N,useBaseFriction:f,useBaseDuration:d,useFriction:S,useDuration:y};return E}function wn(t,s,a,o,c){const n=c.measure(10),i=c.measure(50),m=ke(.1,.99);let u=!1;function l(){return!(u||!t.reachedAny(a.get())||!t.reachedAny(s.get()))}function b(N){if(!l())return;const x=t.reachedMin(s.get())?"min":"max",g=q(t[x]-s.get()),h=a.get()-s.get(),d=m.constrain(g/i);a.subtract(h*d),!N&&q(h)<n&&(a.set(t.constrain(a.get())),o.useDuration(25).useBaseFriction())}function p(N){u=!N}return{shouldConstrain:l,constrain:b,toggleActive:p}}function Nn(t,s,a,o,c){const n=ke(-s+t,0),i=p(),m=b(),u=v();function l(x,g){return De(x,g)<=1}function b(){const x=i[0],g=fe(i),h=i.lastIndexOf(x),d=i.indexOf(g)+1;return ke(h,d)}function p(){return a.map((x,g)=>{const{min:h,max:d}=n,f=n.constrain(x),y=!g,S=pt(a,g);return y?d:S||l(h,f)?h:l(d,f)?d:f}).map(x=>parseFloat(x.toFixed(3)))}function v(){if(s<=t+c)return[n.max];if(o==="keepSnaps")return i;const{min:x,max:g}=m;return i.slice(x,g)}return{snapsContained:u,scrollContainLimit:m}}function kn(t,s,a){const o=s[0],c=a?o-t:fe(s);return{limit:ke(c,o)}}function _n(t,s,a,o){const n=s.min+.1,i=s.max+.1,{reachedMin:m,reachedMax:u}=ke(n,i);function l(v){return v===1?u(a.get()):v===-1?m(a.get()):!1}function b(v){if(!l(v))return;const N=t*(v*-1);o.forEach(x=>x.add(N))}return{loop:b}}function Cn(t){const{max:s,length:a}=t;function o(n){const i=n-s;return a?i/-a:0}return{get:o}}function Sn(t,s,a,o,c){const{startEdge:n,endEdge:i}=t,{groupSlides:m}=c,u=p().map(s.measure),l=v(),b=N();function p(){return m(o).map(g=>fe(g)[i]-g[0][n]).map(q)}function v(){return o.map(g=>a[n]-g[n]).map(g=>-q(g))}function N(){return m(l).map(g=>g[0]).map((g,h)=>g+u[h])}return{snaps:l,snapsAligned:b}}function En(t,s,a,o,c,n){const{groupSlides:i}=c,{min:m,max:u}=o,l=b();function b(){const v=i(n),N=!t||s==="keepSnaps";return a.length===1?[n]:N?v:v.slice(m,u).map((x,g,h)=>{const d=!g,f=pt(h,g);if(d){const y=fe(h[0])+1;return Bt(y)}if(f){const y=Fe(n)-fe(h)[0]+1;return Bt(y,fe(h)[0])}return x})}return{slideRegistry:l}}function An(t,s,a,o,c){const{reachedAny:n,removeOffset:i,constrain:m}=o;function u(x){return x.concat().sort((g,h)=>q(g)-q(h))[0]}function l(x){const g=t?i(x):m(x),h=s.map((f,y)=>({diff:b(f-g,0),index:y})).sort((f,y)=>q(f.diff)-q(y.diff)),{index:d}=h[0];return{index:d,distance:g}}function b(x,g){const h=[x,x+a,x-a];if(!t)return x;if(!g)return u(h);const d=h.filter(f=>gt(f)===g);return d.length?u(d):fe(h)-a}function p(x,g){const h=s[x]-c.get(),d=b(h,g);return{index:x,distance:d}}function v(x,g){const h=c.get()+x,{index:d,distance:f}=l(h),y=!t&&n(h);if(!g||y)return{index:d,distance:x};const S=s[d]-f,E=x+b(S,0);return{index:d,distance:E}}return{byDistance:v,byIndex:p,shortcut:b}}function Tn(t,s,a,o,c,n,i){function m(p){const v=p.distance,N=p.index!==s.get();n.add(v),v&&(o.duration()?t.start():(t.update(),t.render(1),t.update())),N&&(a.set(s.get()),s.set(p.index),i.emit("select"))}function u(p,v){const N=c.byDistance(p,v);m(N)}function l(p,v){const N=s.clone().set(p),x=c.byIndex(N.get(),v);m(x)}return{distance:u,index:l}}function Dn(t,s,a,o,c,n,i,m){const u={passive:!0,capture:!0};let l=0;function b(N){if(!m)return;function x(g){if(new Date().getTime()-l>10)return;i.emit("slideFocusStart"),t.scrollLeft=0;const f=a.findIndex(y=>y.includes(g));xt(f)&&(c.useDuration(0),o.index(f,0),i.emit("slideFocus"))}n.add(document,"keydown",p,!1),s.forEach((g,h)=>{n.add(g,"focus",d=>{(Ge(m)||m(N,d))&&x(h)},u)})}function p(N){N.code==="Tab"&&(l=new Date().getTime())}return{init:b}}function Te(t){let s=t;function a(){return s}function o(u){s=i(u)}function c(u){s+=i(u)}function n(u){s-=i(u)}function i(u){return xt(u)?u:u.get()}return{get:a,set:o,add:c,subtract:n}}function Qt(t,s){const a=t.scroll==="x"?i:m,o=s.style;let c=null,n=!1;function i(v){return`translate3d(${v}px,0px,0px)`}function m(v){return`translate3d(0px,${v}px,0px)`}function u(v){if(n)return;const N=fn(t.direction(v));N!==c&&(o.transform=a(N),c=N)}function l(v){n=!v}function b(){n||(o.transform="",s.getAttribute("style")||s.removeAttribute("style"))}return{clear:b,to:u,toggleActive:l}}function Ln(t,s,a,o,c,n,i,m,u){const b=Me(c),p=Me(c).reverse(),v=d().concat(f());function N(A,T){return A.reduce((k,F)=>k-c[F],T)}function x(A,T){return A.reduce((k,F)=>N(k,T)>0?k.concat([F]):k,[])}function g(A){return n.map((T,k)=>({start:T-o[k]+.5+A,end:T+s-.5+A}))}function h(A,T,k){const F=g(T);return A.map(w=>{const I=k?0:-a,$=k?a:0,H=k?"end":"start",Y=F[w][H];return{index:w,loopPoint:Y,slideLocation:Te(-1),translate:Qt(t,u[w]),target:()=>m.get()>Y?I:$}})}function d(){const A=i[0],T=x(p,A);return h(T,a,!1)}function f(){const A=s-i[0]-1,T=x(b,A);return h(T,-a,!0)}function y(){return v.every(({index:A})=>{const T=b.filter(k=>k!==A);return N(T,s)<=.1})}function S(){v.forEach(A=>{const{target:T,translate:k,slideLocation:F}=A,w=T();w!==F.get()&&(k.to(w),F.set(w))})}function E(){v.forEach(A=>A.translate.clear())}return{canLoop:y,clear:E,loop:S,loopPoints:v}}function In(t,s,a){let o,c=!1;function n(u){if(!a)return;function l(b){for(const p of b)if(p.type==="childList"){u.reInit(),s.emit("slidesChanged");break}}o=new MutationObserver(b=>{c||(Ge(a)||a(u,b))&&l(b)}),o.observe(t,{childList:!0})}function i(){o&&o.disconnect(),c=!0}return{init:n,destroy:i}}function Pn(t,s,a,o){const c={};let n=null,i=null,m,u=!1;function l(){m=new IntersectionObserver(x=>{u||(x.forEach(g=>{const h=s.indexOf(g.target);c[h]=g}),n=null,i=null,a.emit("slidesInView"))},{root:t.parentElement,threshold:o}),s.forEach(x=>m.observe(x))}function b(){m&&m.disconnect(),u=!0}function p(x){return Oe(c).reduce((g,h)=>{const d=parseInt(h),{isIntersecting:f}=c[d];return(x&&f||!x&&!f)&&g.push(d),g},[])}function v(x=!0){if(x&&n)return n;if(!x&&i)return i;const g=p(x);return x&&(n=g),x||(i=g),g}return{init:l,destroy:b,get:v}}function Mn(t,s,a,o,c,n){const{measureSize:i,startEdge:m,endEdge:u}=t,l=a[0]&&c,b=x(),p=g(),v=a.map(i),N=h();function x(){if(!l)return 0;const f=a[0];return q(s[m]-f[m])}function g(){if(!l)return 0;const f=n.getComputedStyle(fe(o));return parseFloat(f.getPropertyValue(`margin-${u}`))}function h(){return a.map((f,y,S)=>{const E=!y,L=pt(S,y);return E?v[y]+b:L?v[y]+p:S[y+1][m]-f[m]}).map(q)}return{slideSizes:v,slideSizesWithGaps:N,startGap:b,endGap:p}}function On(t,s,a,o,c,n,i,m,u){const{startEdge:l,endEdge:b,direction:p}=t,v=xt(a);function N(d,f){return Me(d).filter(y=>y%f===0).map(y=>d.slice(y,y+f))}function x(d){return d.length?Me(d).reduce((f,y,S)=>{const E=fe(f)||0,L=E===0,A=y===Fe(d),T=c[l]-n[E][l],k=c[l]-n[y][b],F=!o&&L?p(i):0,w=!o&&A?p(m):0,I=q(k-w-(T+F));return S&&I>s+u&&f.push(y),A&&f.push(d.length),f},[]).map((f,y,S)=>{const E=Math.max(S[y-1]||0);return d.slice(E,f)}):[]}function g(d){return v?N(d,a):x(d)}return{groupSlides:g}}function zn(t,s,a,o,c,n,i){const{align:m,axis:u,direction:l,startIndex:b,loop:p,duration:v,dragFree:N,dragThreshold:x,inViewThreshold:g,slidesToScroll:h,skipSnaps:d,containScroll:f,watchResize:y,watchSlides:S,watchDrag:E,watchFocus:L}=n,A=2,T=vn(),k=T.measure(s),F=a.map(T.measure),w=xn(u,l),I=w.measureSize(k),$=jn(I),H=mn(m,I),Y=!p&&!!f,ae=p||!!f,{slideSizes:me,slideSizesWithGaps:te,startGap:oe,endGap:re}=Mn(w,k,F,a,ae,c),X=On(w,I,h,p,k,F,oe,re,A),{snaps:je,snapsAligned:he}=Sn(w,H,k,F,X),ce=-fe(je)+fe(te),{snapsContained:U,scrollContainLimit:ye}=Nn(I,ce,he,f,A),Q=Y?U:he,{limit:W}=kn(ce,Q,p),xe=Kt(Fe(Q),b,p),se=xe.clone(),R=Me(a),_=({dragHandler:V,scrollBody:ie,scrollBounds:Je,options:{loop:Be}})=>{Be||Je.constrain(V.pointerDown()),ie.seek()},z=({scrollBody:V,translate:ie,location:Je,offsetLocation:Be,previousLocation:rs,scrollLooper:is,slideLooper:as,dragHandler:os,animation:cs,eventHandler:jt,scrollBounds:ls,options:{loop:yt}},bt)=>{const wt=V.settled(),ds=!ls.shouldConstrain(),Nt=yt?wt:wt&&ds,kt=Nt&&!os.pointerDown();kt&&cs.stop();const us=Je.get()*bt+rs.get()*(1-bt);Be.set(us),yt&&(is.loop(V.direction()),as.loop()),ie.to(Be.get()),kt&&jt.emit("settle"),Nt||jt.emit("scroll")},B=hn(o,c,()=>_(Re),V=>z(Re,V)),G=.68,ne=Q[xe.get()],le=Te(ne),Z=Te(ne),de=Te(ne),J=Te(ne),r=bn(le,de,Z,J,v,G),C=An(p,Q,ce,W,J),D=Tn(B,xe,se,r,C,J,i),P=Cn(W),M=ze(),ee=Pn(s,a,i,g),{slideRegistry:be}=En(Y,f,Q,ye,X,R),$e=Dn(t,a,be,D,r,M,i,L),Re={ownerDocument:o,ownerWindow:c,eventHandler:i,containerRect:k,slideRects:F,animation:B,axis:w,dragHandler:gn(w,t,o,c,J,pn(w,c),le,B,D,r,C,xe,i,$,N,x,d,G,E),eventStore:M,percentOfView:$,index:xe,indexPrevious:se,limit:W,location:le,offsetLocation:de,previousLocation:Z,options:n,resizeHandler:yn(s,i,c,a,w,y,T),scrollBody:r,scrollBounds:wn(W,de,J,r,$),scrollLooper:_n(ce,W,de,[le,de,Z,J]),scrollProgress:P,scrollSnapList:Q.map(P.get),scrollSnaps:Q,scrollTarget:C,scrollTo:D,slideLooper:Ln(w,I,ce,me,te,je,Q,de,a),slideFocus:$e,slidesHandler:In(s,i,S),slidesInView:ee,slideIndexes:R,slideRegistry:be,slidesToScroll:X,target:J,translate:Qt(w,s)};return Re}function Fn(){let t={},s;function a(l){s=l}function o(l){return t[l]||[]}function c(l){return o(l).forEach(b=>b(s,l)),u}function n(l,b){return t[l]=o(l).concat([b]),u}function i(l,b){return t[l]=o(l).filter(p=>p!==b),u}function m(){t={}}const u={init:a,emit:c,off:i,on:n,clear:m};return u}const $n={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function Rn(t){function s(n,i){return Jt(n,i||{})}function a(n){const i=n.breakpoints||{},m=Oe(i).filter(u=>t.matchMedia(u).matches).map(u=>i[u]).reduce((u,l)=>s(u,l),{});return s(n,m)}function o(n){return n.map(i=>Oe(i.breakpoints||{})).reduce((i,m)=>i.concat(m),[]).map(t.matchMedia)}return{mergeOptions:s,optionsAtMedia:a,optionsMediaQueries:o}}function Bn(t){let s=[];function a(n,i){return s=i.filter(({options:m})=>t.optionsAtMedia(m).active!==!1),s.forEach(m=>m.init(n,t)),i.reduce((m,u)=>Object.assign(m,{[u.name]:u}),{})}function o(){s=s.filter(n=>n.destroy())}return{init:a,destroy:o}}function Ye(t,s,a){const o=t.ownerDocument,c=o.defaultView,n=Rn(c),i=Bn(n),m=ze(),u=Fn(),{mergeOptions:l,optionsAtMedia:b,optionsMediaQueries:p}=n,{on:v,off:N,emit:x}=u,g=w;let h=!1,d,f=l($n,Ye.globalOptions),y=l(f),S=[],E,L,A;function T(){const{container:R,slides:_}=y;L=(ut(R)?t.querySelector(R):R)||t.children[0];const B=ut(_)?L.querySelectorAll(_):_;A=[].slice.call(B||L.children)}function k(R){const _=zn(t,L,A,o,c,R,u);if(R.loop&&!_.slideLooper.canLoop()){const z=Object.assign({},R,{loop:!1});return k(z)}return _}function F(R,_){h||(f=l(f,R),y=b(f),S=_||S,T(),d=k(y),p([f,...S.map(({options:z})=>z)]).forEach(z=>m.add(z,"change",w)),y.active&&(d.translate.to(d.location.get()),d.animation.init(),d.slidesInView.init(),d.slideFocus.init(se),d.eventHandler.init(se),d.resizeHandler.init(se),d.slidesHandler.init(se),d.options.loop&&d.slideLooper.loop(),L.offsetParent&&A.length&&d.dragHandler.init(se),E=i.init(se,S)))}function w(R,_){const z=X();I(),F(l({startIndex:z},R),_),u.emit("reInit")}function I(){d.dragHandler.destroy(),d.eventStore.clear(),d.translate.clear(),d.slideLooper.clear(),d.resizeHandler.destroy(),d.slidesHandler.destroy(),d.slidesInView.destroy(),d.animation.destroy(),i.destroy(),m.clear()}function $(){h||(h=!0,m.clear(),I(),u.emit("destroy"),u.clear())}function H(R,_,z){!y.active||h||(d.scrollBody.useBaseFriction().useDuration(_===!0?0:y.duration),d.scrollTo.index(R,z||0))}function Y(R){const _=d.index.add(1).get();H(_,R,-1)}function ae(R){const _=d.index.add(-1).get();H(_,R,1)}function me(){return d.index.add(1).get()!==X()}function te(){return d.index.add(-1).get()!==X()}function oe(){return d.scrollSnapList}function re(){return d.scrollProgress.get(d.offsetLocation.get())}function X(){return d.index.get()}function je(){return d.indexPrevious.get()}function he(){return d.slidesInView.get()}function ce(){return d.slidesInView.get(!1)}function U(){return E}function ye(){return d}function Q(){return t}function W(){return L}function xe(){return A}const se={canScrollNext:me,canScrollPrev:te,containerNode:W,internalEngine:ye,destroy:$,off:N,on:v,emit:x,plugins:U,previousScrollSnap:je,reInit:g,rootNode:Q,scrollNext:Y,scrollPrev:ae,scrollProgress:re,scrollSnapList:oe,scrollTo:H,selectedScrollSnap:X,slideNodes:xe,slidesInView:he,slidesNotInView:ce};return F(s,a),setTimeout(()=>u.emit("init"),0),se}Ye.globalOptions=void 0;function vt(t={},s=[]){const a=j.useRef(t),o=j.useRef(s),[c,n]=j.useState(),[i,m]=j.useState(),u=j.useCallback(()=>{c&&c.reInit(a.current,o.current)},[c]);return j.useEffect(()=>{ht(a.current,t)||(a.current=t,u())},[t,u]),j.useEffect(()=>{dn(o.current,s)||(o.current=s,u())},[s,u]),j.useEffect(()=>{if(ln()&&i){Ye.globalOptions=vt.globalOptions;const l=Ye(i,a.current,o.current);return n(l),()=>l.destroy()}else n(void 0)},[i,n]),[m,c]}vt.globalOptions=void 0;const Zt=j.createContext(null);function We(){const t=j.useContext(Zt);if(!t)throw new Error("useCarousel must be used within a <Carousel />");return t}const Xt=j.forwardRef(({orientation:t="horizontal",opts:s,setApi:a,plugins:o,className:c,children:n,...i},m)=>{const[u,l]=vt({...s,axis:t==="horizontal"?"x":"y"},o),[b,p]=j.useState(!1),[v,N]=j.useState(!1),x=j.useCallback(f=>{f&&(p(f.canScrollPrev()),N(f.canScrollNext()))},[]),g=j.useCallback(()=>{l==null||l.scrollPrev()},[l]),h=j.useCallback(()=>{l==null||l.scrollNext()},[l]),d=j.useCallback(f=>{f.key==="ArrowLeft"?(f.preventDefault(),g()):f.key==="ArrowRight"&&(f.preventDefault(),h())},[g,h]);return j.useEffect(()=>{!l||!a||a(l)},[l,a]),j.useEffect(()=>{if(l)return x(l),l.on("reInit",x),l.on("select",x),()=>{l==null||l.off("select",x)}},[l,x]),e.jsx(Zt.Provider,{value:{carouselRef:u,api:l,opts:s,orientation:t||((s==null?void 0:s.axis)==="y"?"vertical":"horizontal"),scrollPrev:g,scrollNext:h,canScrollPrev:b,canScrollNext:v},children:e.jsx("div",{ref:m,onKeyDownCapture:d,className:ve("relative",c),role:"region","aria-roledescription":"carousel",...i,children:n})})});Xt.displayName="Carousel";const es=j.forwardRef(({className:t,...s},a)=>{const{carouselRef:o,orientation:c}=We();return e.jsx("div",{ref:o,className:"overflow-hidden",children:e.jsx("div",{ref:a,className:ve("flex",c==="horizontal"?"-ml-4":"-mt-4 flex-col",t),...s})})});es.displayName="CarouselContent";const ts=j.forwardRef(({className:t,...s},a)=>{const{orientation:o}=We();return e.jsx("div",{ref:a,role:"group","aria-roledescription":"slide",className:ve("min-w-0 shrink-0 grow-0 basis-full",o==="horizontal"?"pl-4":"pt-4",t),...s})});ts.displayName="CarouselItem";const ss=j.forwardRef(({className:t,variant:s="outline",size:a="icon",...o},c)=>{const{orientation:n,scrollPrev:i,canScrollPrev:m}=We();return e.jsxs(O,{ref:c,variant:s,size:a,className:ve("absolute h-8 w-8 rounded-full",n==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!m,onClick:i,...o,children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Previous slide"})]})});ss.displayName="CarouselPrevious";const ns=j.forwardRef(({className:t,variant:s="outline",size:a="icon",...o},c)=>{const{orientation:n,scrollNext:i,canScrollNext:m}=We();return e.jsxs(O,{ref:c,variant:s,size:a,className:ve("absolute h-8 w-8 rounded-full",n==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!m,onClick:i,...o,children:[e.jsx(Hs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Next slide"})]})});ns.displayName="CarouselNext";function gr(){const t=Wt(),{user:s}=mt(),{setCurrentProfileId:a,setCurrentProfile:o}=_s(),c=Ds(),n=Gs(),[i,m]=j.useState(null),[u,l]=j.useState(0),[b,p]=j.useState(null),[v,N]=j.useState(null),[x,g]=j.useState(!1),[h,d]=j.useState(null),f=j.useRef(null),[y,S]=j.useState(!1),[E,L]=j.useState(!0),[A,T]=j.useState(0),{data:k,isLoading:F,error:w}=Ts(),{data:I,isLoading:$,error:H}=Ls();j.useEffect(()=>{ue.log("Dashboard data state:",{profiles:(k==null?void 0:k.length)||0,profilesLoading:F,profilesError:w==null?void 0:w.message,appointments:(I==null?void 0:I.length)||0,appointmentsLoading:$,appointmentsError:H==null?void 0:H.message,user:s==null?void 0:s.id})},[k,F,w,I,$,H,s]);const Y=j.useMemo(()=>!k||!Array.isArray(k)?[]:k.map(r=>r.id),[k]),{data:ae,isLoading:me}=Tt(Y,"checkup"),{data:te,isLoading:oe}=Dt(Y,"checkup"),re=j.useMemo(()=>{if(!k||!Array.isArray(k))return null;const r=k.find(C=>C.type==="parent");return(r==null?void 0:r.id)||null},[k]),{data:X,isLoading:je}=Tt(re?[re]:[],"parent"),{data:he,isLoading:ce}=Dt(re?[re]:[],"parent"),U=j.useMemo(()=>{if(!k||!Array.isArray(k))return[];const r=ae||{},C=te||{},D=X||{},P=he||{};return k.map(M=>M.type==="parent"?{...M,checkupAssessment:D[M.id]||null,activeCheckupAssessment:P[M.id]||null}:{...M,checkupAssessment:r[M.id]||null,activeCheckupAssessment:C[M.id]||null})},[k,ae,te,X,he]),ye=F&&!k,Q=me&&ae===void 0&&Y.length>0,W=oe&&te===void 0&&Y.length>0,R=ye||Q||W||je&&X===void 0&&re!==null||ce&&he===void 0&&re!==null;j.useEffect(()=>{async function r(){try{await K.rpc("update_appointment_statuses")}catch(C){console.error("Error updating appointment statuses:",C)}}r()},[]),j.useEffect(()=>{async function r(){try{const C=await It();l(C)}catch(C){console.error("Error loading unread count:",C)}}s!=null&&s.id&&r()},[s==null?void 0:s.id]),j.useEffect(()=>{if(!(s!=null&&s.id))return;const r=Ys(s.id,async()=>{const C=await It();l(C)});return()=>r()},[s==null?void 0:s.id]),j.useEffect(()=>{async function r(){const C=await Mt();C&&(N(C),g(!0))}s!=null&&s.id&&r()},[s==null?void 0:s.id]);const _=j.useMemo(()=>{if(!k||!Array.isArray(k))return null;const r=k.find(C=>C.type==="parent");return(r==null?void 0:r.first_name)||null},[k]),z=j.useCallback(r=>r.type==="parent"?r.gender==="male"?fs:_t:r.type==="child"?r.gender==="male"?ms:hs:_t,[]),B=j.useMemo(()=>I?I.filter(r=>r.status==="scheduled"||r.status==="in_progress"||r.status==="payment_pending"):[],[I]),G=j.useCallback(r=>{if(!r)return"Для меня (родитель)";const C=k==null?void 0:k.find(D=>D.id===r);return C?`${C.first_name}${C.last_name?` ${C.last_name}`:""}`:"Профиль не найден"},[k]),ne=async r=>{try{await c.mutateAsync(r),m(null)}catch{}},le=async r=>{try{await As(r),await n.invalidateQueries({queryKey:["profiles",s==null?void 0:s.id]}),d(null),pe.success("Член семьи удален")}catch(C){ue.error("Error deleting profile:",C),pe.error("Ошибка при удалении члена семьи")}},Z=j.useCallback(()=>{if(!f.current)return;const{scrollLeft:r,scrollWidth:C,clientWidth:D}=f.current;S(r>0),L(r<C-D-10);const M=Math.round(r/336);T(Math.max(0,Math.min(M,U.length-1)))},[U.length]);j.useEffect(()=>{if(U.length===0)return;Z();const r=f.current;if(r)return r.addEventListener("scroll",Z),window.addEventListener("resize",Z),()=>{r.removeEventListener("scroll",Z),window.removeEventListener("resize",Z)}},[U,Z]);const de=j.useCallback(r=>{if(!f.current)return;const C=336,D=C,P=f.current.scrollLeft;let M=r==="left"?P-D:P+D;M=Math.max(0,Math.min(M,f.current.scrollWidth-f.current.clientWidth)),f.current.scrollTo({left:M,behavior:"smooth"});const ee=Math.round(M/C);T(Math.max(0,Math.min(ee,U.length-1)))},[U.length]);j.useCallback(r=>{if(!f.current)return;f.current.scrollTo({left:r*336,behavior:"smooth"}),T(r)},[]);const J=j.useMemo(()=>{const r=U.filter(V=>V.type==="child");if(r.length===0)return{allowed:!1,reason:"no_children"};const C=r.filter(V=>Ue(V.dob).eligible);if(C.length===0)return{allowed:!1,reason:"no_eligible_children"};if(C.find(V=>{const ie=V.activeCheckupAssessment;return ie&&ie.status==="in_progress"&&!ie.completed_at}))return{allowed:!0,reason:"active_checkup_exists"};const P=C.map(V=>{const ie=V.checkupAssessment;return ie&&ie.status==="completed"&&ie.completed_at?new Date(ie.completed_at):null}).filter(V=>V!==null),M=P.length>0?new Date(Math.max(...P.map(V=>V.getTime()))):null;if(!M)return{allowed:!0,reason:"no_previous_checkup"};const ee=C.map(V=>new Date(V.created_at)).filter(V=>!isNaN(V.getTime())),be=ee.length>0?new Date(Math.max(...ee.map(V=>V.getTime()))):null;if(be&&be>M)return{allowed:!0,reason:"new_child_added"};const $e=Math.floor((Date.now()-M.getTime())/(1e3*60*60*24));return $e>=30?{allowed:!0,reason:"month_passed"}:{allowed:!1,reason:"too_soon",daysRemaining:30-$e,lastCheckupDate:M}},[U]);return j.useMemo(()=>U.filter(C=>C.type==="child").some(C=>{var D;return((D=C.checkupAssessment)==null?void 0:D.status)==="completed"}),[U]),j.useMemo(()=>{const r=U.filter(D=>D.type==="child");return r.length===0?!1:r.every(D=>{const P=Ue(D.dob);return!P.eligible&&P.reason==="too_young"})},[U]),j.useCallback(()=>{ue.log("Checkup card clicked");const r=U.filter(P=>P.type==="child");if(r.length===0){t("/family-members");return}const C=r.filter(P=>Ue(P.dob).eligible);if(!J.allowed){if(J.reason==="no_eligible_children"){r.filter(M=>{const ee=Ue(M.dob);return!ee.eligible&&ee.reason==="too_young"}).length>0?pe.error("Чекап предназначен для детей от 3 до 18 лет. Ваш ребёнок ещё слишком маленький для прохождения чекапа."):pe.error("Чекап предназначен для детей от 3 до 18 лет.");return}if(J.reason==="too_soon"){const P=J.daysRemaining||0,M=J.lastCheckupDate?new Date(J.lastCheckupDate).toLocaleDateString("ru-RU"):"";pe.error(`Чекап можно пройти только раз в месяц или после добавления нового ребенка. Последний чекап был пройден ${M}. Повторно можно будет пройти через ${P} ${P===1?"день":P<5?"дня":"дней"}.`)}return}if(J.reason==="active_checkup_exists"){const P=C.find(M=>M.activeCheckupAssessment);if(P){ue.log("Resuming checkup for child:",P.first_name),a(P.id),o(P),t(`/checkup-intro/${P.id}`);return}}const D=C[0];D&&(ue.log("Starting checkup for child:",D.first_name),a(D.id),o(D),t(`/checkup-intro/${D.id}`))},[U,t,a,o,J]),j.useEffect(()=>{w&&(ue.error("Error loading profiles:",w),pe.error("Не удалось загрузить данные. Попробуйте обновить страницу."))},[w]),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 pt-8 pb-8",children:[(w||H)&&e.jsxs("div",{className:"mb-6 rounded-lg border border-destructive bg-destructive/10 p-4",children:[e.jsxs("p",{className:"text-sm font-medium text-destructive mb-2",children:[w&&`Ошибка загрузки профилей: ${w instanceof Error?w.message:"Неизвестная ошибка"}`,H&&`Ошибка загрузки консультаций: ${H instanceof Error?H.message:"Неизвестная ошибка"}`]}),e.jsx(O,{variant:"outline",size:"sm",onClick:()=>window.location.reload(),children:"Обновить страницу"})]}),B.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsx(Ce,{size:"xl",children:"Ваши предстоящие консультации"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(O,{variant:"outline",size:"sm",onClick:()=>t("/cabinet/settings?tab=notifications"),className:"text-xs sm:text-sm",children:[e.jsx(Cs,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Настроить уведомления"})]}),e.jsx(sn,{})]})]}),B.length===1?e.jsx("div",{className:"space-y-4",children:B.map(r=>{var C;return e.jsx("div",{className:`rounded-xl border border-white/30 p-4 sm:p-6 text-card-foreground shadow-soft overflow-hidden ${r.status==="payment_pending"?"border-amber-300/50":""}`,style:{background:r.status==="payment_pending"?"linear-gradient(108deg, rgba(255, 193, 7, 0.35) 0%, rgba(255, 193, 7, 0.2) 100%)":"linear-gradient(108deg, rgba(255, 255, 255, 0.45) 0%, rgba(255, 255, 255, 0.25) 100%)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r.status==="payment_pending"?e.jsxs(ge,{variant:"secondary",className:"bg-honey-pale text-foreground border-honey hover:bg-honey-pale font-light",children:[e.jsx(St,{className:"h-3 w-3 mr-1"}),"Ожидает оплаты"]}):r.payment_id?e.jsxs(ge,{variant:"secondary",className:"bg-sage-pale text-foreground border-sage hover:bg-sage-pale font-light",children:[e.jsx(Et,{className:"h-3 w-3 mr-1"}),"Оплачено"]}):null,r.status==="in_progress"&&e.jsxs(ge,{variant:"default",className:"bg-success hover:bg-success font-light",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-white animate-pulse mr-1"}),"Идет сейчас"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Ne,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Дата и время"}),e.jsx("p",{className:"font-medium truncate",children:Lt(r.scheduled_at)})]})]}),r.appointment_type&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(At,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Тип консультации"}),e.jsxs("p",{className:"font-medium truncate",children:[r.appointment_type.name," (",r.appointment_type.duration_minutes," минут)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Le,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Для кого"}),e.jsx("p",{className:"font-medium truncate",children:G(r.profile_id)})]})]}),r.status==="payment_pending"&&r.payment_expires_at&&e.jsxs("div",{className:"p-3 bg-honey-pale border border-honey rounded-lg",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[e.jsx("strong",{children:"Срок оплаты:"})," ",new Date(r.payment_expires_at).toLocaleString("ru-RU",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Moscow"})," (МСК)"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"После истечения срока запись будет автоматически отменена"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:ml-0 w-full md:w-auto md:min-w-[200px]",children:[r.specialist&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg cursor-pointer hover:bg-muted transition-colors mb-2",onClick:()=>p(r.specialist.id),children:[e.jsxs(Ve,{className:"h-10 w-10",children:[e.jsx(qe,{src:r.specialist.avatar_url||void 0}),e.jsx(He,{children:((C=r.specialist.display_name)==null?void 0:C.split(" ").map(D=>D[0]).join("").slice(0,2).toUpperCase())||"?"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Специалист"}),e.jsx("p",{className:"font-medium",children:r.specialist.display_name}),r.specialist.experience_years&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(dt,{className:"h-3 w-3"}),"Опыт: ",r.specialist.experience_years," лет"]})]}),e.jsx(ot,{className:"h-4 w-4 text-muted-foreground"})]}),r.status!=="payment_pending"&&r.video_room_url&&(()=>{const D=new Date(r.scheduled_at),P=new Date,M=(D.getTime()-P.getTime())/1e3/60;return r.status==="in_progress"||M<=15?e.jsxs(O,{variant:r.status==="in_progress"?"default":"outline",size:"sm",onClick:()=>window.open(r.video_room_url,"_blank"),className:r.status==="in_progress"?"bg-success hover:bg-success/90":"",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),r.status==="in_progress"?"Войти сейчас":"Войти в комнату"]}):e.jsxs(O,{variant:"outline",size:"sm",disabled:!0,className:"opacity-50",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Доступно за 15 мин"]})})(),r.status==="payment_pending"&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Ссылка на оплату отправлена на email"}),r.status!=="payment_pending"&&e.jsxs(Ze,{open:i===r.id,onOpenChange:D=>m(D?r.id:null),children:[e.jsx(Xe,{asChild:!0,children:e.jsxs(O,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-destructive hover:bg-muted/50 font-light",children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),"Отменить"]})}),e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(st,{children:"Отменить консультацию?"}),e.jsx(nt,{children:"Вы уверены, что хотите отменить консультацию? Это действие нельзя отменить."})]}),e.jsxs(rt,{children:[e.jsx(it,{children:"Нет, оставить"}),e.jsx(at,{onClick:()=>ne(r.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Да, отменить"})]})]})]})]})]})},r.id)})}):e.jsxs(Xt,{opts:{align:"start",loop:!1},className:"w-full",children:[e.jsx(es,{className:"-ml-2 md:-ml-4",children:B.map(r=>{var C;return e.jsx(ts,{className:"pl-2 md:pl-4 basis-full md:basis-[calc(50%-8px)] lg:basis-[calc(50%-8px)]",children:e.jsx("div",{className:`rounded-xl border border-white/30 p-4 sm:p-6 text-card-foreground shadow-soft overflow-hidden h-full ${r.status==="payment_pending"?"border-amber-300/50":""}`,style:{background:r.status==="payment_pending"?"linear-gradient(108deg, rgba(255, 193, 7, 0.35) 0%, rgba(255, 193, 7, 0.2) 100%)":"linear-gradient(108deg, rgba(255, 255, 255, 0.45) 0%, rgba(255, 255, 255, 0.25) 100%)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r.status==="payment_pending"?e.jsxs(ge,{variant:"secondary",className:"bg-honey-pale text-foreground border-honey hover:bg-honey-pale font-light",children:[e.jsx(St,{className:"h-3 w-3 mr-1"}),"Ожидает оплаты"]}):r.payment_id?e.jsxs(ge,{variant:"secondary",className:"bg-sage-pale text-foreground border-sage hover:bg-sage-pale font-light",children:[e.jsx(Et,{className:"h-3 w-3 mr-1"}),"Оплачено"]}):null,r.status==="in_progress"&&e.jsxs(ge,{variant:"default",className:"bg-success hover:bg-success font-light",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-white animate-pulse mr-1"}),"Идет сейчас"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Ne,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Дата и время"}),e.jsx("p",{className:"font-medium truncate",children:Lt(r.scheduled_at)})]})]}),r.appointment_type&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(At,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Тип консультации"}),e.jsxs("p",{className:"font-medium truncate",children:[r.appointment_type.name," (",r.appointment_type.duration_minutes," минут)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Le,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Для кого"}),e.jsx("p",{className:"font-medium truncate",children:G(r.profile_id)})]})]}),r.status==="payment_pending"&&r.payment_expires_at&&e.jsxs("div",{className:"p-3 bg-honey-pale border border-honey rounded-lg",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[e.jsx("strong",{children:"Срок оплаты:"})," ",new Date(r.payment_expires_at).toLocaleString("ru-RU",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Moscow"})," (МСК)"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"После истечения срока запись будет автоматически отменена"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[r.specialist&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg cursor-pointer hover:bg-muted transition-colors mb-2",onClick:()=>p(r.specialist.id),children:[e.jsxs(Ve,{className:"h-10 w-10",children:[e.jsx(qe,{src:r.specialist.avatar_url||void 0}),e.jsx(He,{children:((C=r.specialist.display_name)==null?void 0:C.split(" ").map(D=>D[0]).join("").slice(0,2).toUpperCase())||"?"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Специалист"}),e.jsx("p",{className:"font-medium",children:r.specialist.display_name}),r.specialist.experience_years&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(dt,{className:"h-3 w-3"}),"Опыт: ",r.specialist.experience_years," лет"]})]}),e.jsx(ot,{className:"h-4 w-4 text-muted-foreground"})]}),r.status!=="payment_pending"&&r.video_room_url&&(()=>{const D=new Date(r.scheduled_at),P=new Date,M=(D.getTime()-P.getTime())/1e3/60;return r.status==="in_progress"||M<=15?e.jsxs(O,{variant:r.status==="in_progress"?"default":"outline",size:"sm",onClick:()=>window.open(r.video_room_url,"_blank"),className:r.status==="in_progress"?"bg-success hover:bg-success/90":"",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),r.status==="in_progress"?"Войти сейчас":"Войти в комнату"]}):e.jsxs(O,{variant:"outline",size:"sm",disabled:!0,className:"opacity-50",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Доступно за 15 мин"]})})(),r.status==="payment_pending"&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Ссылка на оплату отправлена на email"}),r.status!=="payment_pending"&&e.jsxs(Ze,{open:i===r.id,onOpenChange:D=>m(D?r.id:null),children:[e.jsx(Xe,{asChild:!0,children:e.jsxs(O,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-destructive hover:bg-muted/50 font-light",children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),"Отменить"]})}),e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(st,{children:"Отменить консультацию?"}),e.jsx(nt,{children:"Вы уверены, что хотите отменить консультацию? Это действие нельзя отменить."})]}),e.jsxs(rt,{children:[e.jsx(it,{children:"Нет, оставить"}),e.jsx(at,{onClick:()=>ne(r.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Да, отменить"})]})]})]})]})]})})},r.id)})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4",children:[e.jsx(ss,{className:"static translate-y-0 h-8 w-8"}),e.jsx(ns,{className:"static translate-y-0 h-8 w-8"})]})]})]}),R?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})}):null,_&&e.jsxs("div",{className:"mb-8",children:[e.jsxs(Ce,{size:"xl",className:"mb-2 text-2xl sm:text-3xl",children:["Привет, ",_,"!"]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Добро пожаловать в систему нейротренинга Waves"})]}),e.jsx(an,{profilesCount:U.length,className:"mb-8"}),!1,e.jsxs("div",{className:"mb-12",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx(Ce,{size:"xl",children:"Ваша семья"}),U.length>0&&e.jsxs(O,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground hover:bg-muted/50 font-light",onClick:()=>t("/add-family-member",{state:{from:"cabinet"}}),children:[e.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Добавить члена семьи"]})]}),U.length===0?e.jsxs(we,{className:"border-2 bg-card p-8 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Пока нет членов семьи"}),e.jsxs(O,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground hover:bg-muted/50 font-light",onClick:()=>t("/add-family-member",{state:{from:"cabinet"}}),children:[e.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Добавить члена семьи"]})]}):e.jsxs("div",{className:"relative",children:[y&&e.jsx(O,{variant:"ghost",size:"icon",className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 h-10 w-10 rounded-full bg-white/90 hover:bg-white shadow-md",onClick:()=>de("left"),"aria-label":"Предыдущая карточка",children:e.jsx(Ss,{className:"h-5 w-5 text-ink"})}),E&&e.jsx(O,{variant:"ghost",size:"icon",className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 h-10 w-10 rounded-full bg-white/90 hover:bg-white shadow-md",onClick:()=>de("right"),"aria-label":"Следующая карточка",children:e.jsx(Gt,{className:"h-5 w-5 text-ink"})}),e.jsx("div",{ref:f,className:"flex gap-4 overflow-x-auto pb-4 scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch",touchAction:"pan-x"},onScroll:Z,children:U.map(r=>{var M,ee;const C=r.dob?Es(r.dob):null,D=((M=r.checkupAssessment)==null?void 0:M.status)==="completed",P=(ee=r.checkupAssessment)!=null&&ee.completed_at?new Date(r.checkupAssessment.completed_at).toLocaleDateString("ru-RU"):null;return e.jsx(we,{className:"glass-elegant min-w-[320px] flex-shrink-0 flex flex-col border-2 p-6 transition-all hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col items-center text-center flex-1",children:[e.jsx("img",{src:z(r),alt:`${r.first_name} ${r.last_name||""}`,className:"h-20 w-20 rounded-full object-cover mb-4"}),e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs(Ce,{size:"lg",children:[r.first_name," ",r.last_name||""]})}),C!==null&&e.jsxs("p",{className:"text-muted-foreground mb-2",children:[C," лет"]}),D&&e.jsxs(ge,{variant:"default",className:"bg-success text-success-foreground hover:bg-success font-light mb-2",children:[e.jsx(Yt,{className:"h-3 w-3 mr-1"}),"Чекап завершен"]}),D&&P&&e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Завершен: ",P]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-auto w-full",children:[D&&e.jsxs(O,{variant:"outline",size:"sm",className:"w-full",onClick:()=>t(`/results-report?profileId=${r.id}`),children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"Посмотреть результаты"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{variant:"ghost",size:"sm",className:"flex-1 text-muted-foreground hover:text-foreground hover:bg-muted/50 font-light",onClick:()=>{ue.log("Edit clicked for member:",{id:r.id,name:`${r.first_name} ${r.last_name}`,type:r.type,isParent:r.type==="parent"}),r.type==="parent"?t("/profile",{state:{from:"cabinet"}}):t(`/edit-family-member/${r.id}`,{state:{from:"cabinet"}})},children:[e.jsx(Qe,{name:"pencil",style:"rr",className:"h-4 w-4 mr-2"}),"Редактировать"]}),r.type!=="parent"&&e.jsxs(Ze,{open:h===r.id,onOpenChange:be=>d(be?r.id:null),children:[e.jsx(Xe,{asChild:!0,children:e.jsxs(O,{variant:"ghost",size:"sm",className:"flex-1 text-muted-foreground hover:text-destructive hover:bg-muted/50 font-light",onClick:()=>d(r.id),children:[e.jsx(Qe,{name:"trash",style:"rr",className:"h-4 w-4 mr-2"}),"Удалить"]})}),e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(st,{children:"Удалить члена семьи?"}),e.jsxs(nt,{children:["Вы уверены, что хотите удалить ",r.first_name," ",r.last_name||"","? Это действие нельзя будет отменить."]})]}),e.jsxs(rt,{children:[e.jsx(it,{children:"Отмена"}),e.jsx(at,{onClick:()=>le(r.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Удалить"})]})]})]})]})]})]})},r.id)})})]})]}),e.jsxs("div",{className:"mb-12",children:[e.jsx(Ce,{size:"xl",className:"mb-4",children:"Есть вопросы?"}),e.jsxs(we,{className:"glass-elegant border-2 p-6",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Напишите в поддержку, чтобы решить любые проблемы или попросить помочь."}),e.jsxs(O,{onClick:()=>window.open("https://t.me/waves_support_bot","_blank","noopener,noreferrer"),children:[e.jsx(Qe,{name:"help-circle",style:"rr",className:"h-4 w-4 mr-2"}),"Написать в поддержку"]})]})]}),e.jsx(Se,{open:!!b,onOpenChange:r=>!r&&p(null),children:e.jsx(Ee,{className:"max-w-2xl w-[90vw] max-h-[90vh] overflow-y-auto p-0 bg-background",style:{background:"var(--bg-golden-hour)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed"},children:e.jsx("div",{className:"px-6 pb-6 pt-6",children:b&&e.jsx(Ks,{specialistId:b,showChangeButton:!0,onSpecialistChange:()=>p(null)})})})}),v&&e.jsx(tn,{pendingRating:v,open:x,onClose:()=>{g(!1),N(null)},onSubmitted:async()=>{g(!1),N(null);const r=await Mt();r&&(N(r),g(!0))}})]})}export{gr as default};
