import{x as s,q as a}from"./index-CsvxaYtI.js";import{getCurrentUser as i}from"./profileStorage-CU3CxDLE.js";import"./vendor-radix-J7BmBqsC.js";import"./vendor-charts-CkgrveCd.js";import"./vendor-query-Bb981xLV.js";import"./vendor-react-CI1J5nwZ.js";async function w(){try{const t=await i();if(!t)return null;const{data:e,error:r}=await s.from("users").select("*").eq("id",t.id).single();if(r){if(r.code==="PGRST116")return null;throw r}return e}catch(t){return a.error("Error getting user data:",t),null}}async function m(t){try{const e=await i();if(!e)throw new Error("User not authenticated");const{error:r}=await s.from("users").update(t).eq("id",e.id);if(r)throw r}catch(e){throw a.error("Error updating user data:",e),e}}class n extends Error{constructor(){super("Пользователь с таким номером телефона уже зарегистрирован"),this.name="PhoneAlreadyExistsError"}}async function p(t){var e;try{const r=await i();if(!r)throw new Error("User not authenticated");const{error:o}=await s.from("users").upsert({id:r.id,email:r.email||t.email,...t},{onConflict:"id"});if(o)throw o.code==="23505"&&((e=o.message)!=null&&e.includes("users_phone_unique"))?new n:o}catch(r){throw a.error("Error upserting user data:",r),r}}export{n as PhoneAlreadyExistsError,w as getCurrentUserData,m as updateUserData,p as upsertUserData};
