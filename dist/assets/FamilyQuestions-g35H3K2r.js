import{r as c,j as e}from"./vendor-radix-htwXsPHy.js";import{H as E,P as O,B as w}from"./index-Bu4m9iDU.js";import{f as a,a as q,r as C,w as Q}from"./familyQuestions-ClyXuf5L.js";import{u as R}from"./useAssessment-DfH1ZJ6I.js";import{c as _,d as P}from"./scoring-DyuEFZvw.js";import{u as z,e as B}from"./vendor-react-CI8wve7f.js";import"./vendor-charts-DjioKZbK.js";import"./vendor-query-BNGVDYIL.js";import"./profileStorage-B9P4N8Co.js";import"./assessmentStorage-CZ49b0Rv.js";const b=300;function U(){const l=z(),j=B(),{currentStep:i,loading:d,saveAnswer:p,getSavedAnswer:x,complete:f,assessmentId:g}=R({assessmentType:"family",totalSteps:a.length,profileId:j.profileId}),N=!d&&i>1?i-1:0,[r,u]=c.useState(N),[h,m]=c.useState(a.map(t=>({questionId:t.id,value:null}))),[v,I]=c.useState(!1);if(c.useEffect(()=>{if(!d&&g&&!v){const t=a.map(n=>{const o=x(n.id);return n.isReverse&&o!==null&&o>=0&&o<=5?{questionId:n.id,value:_(o)}:{questionId:n.id,value:o}});if(m(t),i>1){const n=i-1;n>=0&&n<a.length&&u(n)}I(!0)}},[d,g,i,v,x]),c.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[r]),r<0||r>=a.length)return l("/family-intro"),null;const s=a[r];if(!s)return l("/family-intro"),null;const S=(r+1)/a.length*100,A=(()=>{switch(s.answerType){case"wellbeing":return Q;case"relationship":return C;case"frequency":return q;default:return[]}})(),T=async t=>{try{if(!s){console.error("Current question is not defined");return}const n=[...h];n[r]={questionId:s.id,value:t},m(n);const o=s.isReverse===!0?P(t):t;try{await p(s.id,`family_${s.id.toString().padStart(2,"0")}`,s.category,o,s.answerType,r+1)}catch(k){console.error("Error saving answer:",k)}setTimeout(async()=>{r<a.length-1?u(r+1):(await f(),l("/checkup-results"))},b)}catch(n){console.error("Error in handleAnswer:",n)}},y=async()=>{await p(s.id,`family_${s.id.toString().padStart(2,"0")}`,s.category,-1,s.answerType,r+1);const t=[...h];t[r]={questionId:s.id,value:-1},m(t),setTimeout(async()=>{r<a.length-1?u(r+1):(await f(),l("/checkup-results"))},b)};return d?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(E,{}),e.jsx("div",{className:"border-b border-border bg-primary py-4",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(O,{value:S,className:"flex-1 bg-primary-foreground/20"}),e.jsxs("span",{className:"text-sm font-medium text-primary-foreground",children:[r+1," / ",a.length]})]})})}),e.jsx("div",{className:"container mx-auto max-w-4xl px-4 py-12",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"rounded-lg bg-secondary/30 px-6 py-3 text-center",children:e.jsx("span",{className:"font-medium text-secondary-foreground",children:s.category})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-center text-3xl font-bold text-foreground",children:s.text}),e.jsx("div",{className:"space-y-3 pt-8",children:A.map(t=>e.jsx("button",{onClick:()=>T(t.value),className:"w-full rounded-lg border border-border bg-card px-6 py-4 text-center text-base font-medium text-card-foreground transition-all hover:border-primary hover:bg-secondary/50 active:scale-[0.98]",children:t.label},t.value))}),e.jsx("div",{className:"pt-8 text-center",children:r<a.length-1?e.jsx(w,{variant:"ghost",onClick:y,className:"text-muted-foreground hover:text-foreground",children:"Пропустить"}):e.jsx(w,{variant:"ghost",onClick:y,className:"text-muted-foreground hover:text-foreground",children:"Завершить"})})]})]})})]})}export{U as default};
