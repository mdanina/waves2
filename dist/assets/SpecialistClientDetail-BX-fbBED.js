import{r as o,j as e}from"./vendor-radix-CDHcN1cP.js";import{e as ze,u as qe,L as le}from"./vendor-react-D0zZO7ze.js";import{h as Z,Y as me,Z as G,B as w,L as Y,x as re,a as Re,b as Me,c as Pe,d as Ge,e as ee,aS as Oe,C as D,i as E,F as ne,D as L,R as T,v as ie,$ as O,a0 as B,a6 as Be,E as Ue,G as Ve,ak as we,ae as He,aa as Qe,a8 as Ke,a4 as V,_ as oe,al as Xe,X as We,T as Ye,s as Ze,aQ as Je,ab as pe,af as es,aF as ss,a7 as ts,ad as as,V as fe}from"./index-Dt6uKTGi.js";import{S as H}from"./skeleton-DeRb7L9c.js";import{T as rs,a as ns,b as se,c as te}from"./tabs-DSf7QTkF.js";import{S as Q}from"./separator-jFFEuoi3.js";import{d as is}from"./supabase-ai-yOcC_mJm.js";import{D as Ce,f as ls,a as Se,b as be,c as ke,d as cs,e as os}from"./dialog-Bj2cYqgx.js";import{A as ms,h as ds,a as xs,b as us,c as hs,d as ps,e as fs,f as js,g as gs}from"./alert-dialog-DIIe8Egt.js";import{b as ys,g as Ns,u as _s,c as vs,a as ws,d as Cs}from"./supabase-client-documents-Bh14NKuG.js";import{P as Ae}from"./plus-C1Qd69GB.js";import{D as Ss}from"./download-zFy5GEJo.js";import{T as bs}from"./trash-2-DXIhtIVB.js";import{I as ks,F as As}from"./image-B9uhbZ1Z.js";import{C as Ds,a as Es,b as Fs}from"./collapsible-DNQ5F3mW.js";import{B as X}from"./brain-DwkBHore.js";import{S as ae}from"./sparkles-8rUcEhAK.js";import{S as Ts}from"./square-pen-DClxkTk9.js";import{T as Is}from"./trending-up-Ba6hlPqO.js";import{L as $s}from"./lightbulb-DrFpi72E.js";import{S as Ls}from"./save-BUnVifpG.js";import{a as zs,c as qs}from"./resultsCalculations-BE7Im5GD.js";import{a as Rs,g as Ms}from"./checkupQuestions-CelrvA-2.js";import{f as Ps,p as Gs}from"./parentQuestions-wCnSfMAW.js";import{f as je,w as Os,r as Bs,a as Us}from"./familyQuestions-ClyXuf5L.js";import{E as ce}from"./eye-MTBUaJjA.js";import{g as Vs,a as ge,d as W,b as Hs}from"./client-utils-BLj6ZS6T.js";import{P as Qs}from"./phone-BsXMmGev.js";import{M as Ks}from"./map-pin-BeMnFJOI.js";import"./vendor-charts-DMFz3Lzq.js";import"./vendor-query-DyYoeD25.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=Z("Baby",[["path",{d:"M9 12h.01",key:"157uk2"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M19 6.3a9 9 0 0 1 1.8 3.9 2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"5yv0yz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=Z("CircleMinus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=Z("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=Z("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=Z("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);function Zs(a){return a.startsWith("image/")?e.jsx(ks,{className:"h-5 w-5"}):a==="application/pdf"?e.jsx(ne,{className:"h-5 w-5"}):e.jsx(As,{className:"h-5 w-5"})}function _e(a){return a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/(1024*1024)).toFixed(1)} MB`}function Js({clientUserId:a,currentUserId:l}){const{toast:m}=me(),[n,s]=o.useState([]),[u,d]=o.useState(!0),[p,N]=o.useState(!1),[S,k]=o.useState(!1),[b,C]=o.useState(null),[z,t]=o.useState(""),[c,h]=o.useState("other"),x=o.useCallback(async()=>{try{d(!0);const i=await ys(a);s(i)}catch(i){console.error("Error loading documents:",i),m({title:"Ошибка",description:"Не удалось загрузить документы",variant:"destructive"})}finally{d(!1)}},[a,m]);o.useEffect(()=>{x()},[x]);const F=async()=>{if(b)try{N(!0);const i=await _s(b,a,l);await vs({clientUserId:a,uploadedByUserId:l,filePath:i,fileName:b.name,fileSizeBytes:b.size,mimeType:b.type,description:z||void 0,category:c}),await x(),C(null),t(""),h("other"),k(!1),m({title:"Документ загружен",description:`Файл "${b.name}" успешно загружен`})}catch(i){console.error("Error uploading document:",i),m({title:"Ошибка загрузки",description:i instanceof Error?i.message:"Не удалось загрузить документ",variant:"destructive"})}finally{N(!1)}},f=async i=>{try{const r=await ws(i.file_path);window.open(r,"_blank")}catch(r){console.error("Error downloading document:",r),m({title:"Ошибка",description:"Не удалось получить ссылку для скачивания",variant:"destructive"})}},I=async i=>{try{await Cs(i),await x(),m({title:"Документ удалён"})}catch(r){console.error("Error deleting document:",r),m({title:"Ошибка",description:"Не удалось удалить документ",variant:"destructive"})}},_=i=>{var g;const r=(g=i.target.files)==null?void 0:g[0];if(r){if(r.size>10*1024*1024){m({title:"Файл слишком большой",description:"Максимальный размер файла — 10 МБ",variant:"destructive"});return}C(r)}};return u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(G,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(Ce,{open:S,onOpenChange:k,children:[e.jsx(ls,{asChild:!0,children:e.jsxs(w,{children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Загрузить документ"]})}),e.jsxs(Se,{children:[e.jsxs(be,{children:[e.jsx(ke,{children:"Загрузить документ"}),e.jsx(cs,{children:"Выберите файл для загрузки. Поддерживаются PDF, изображения и документы."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"file",children:"Файл"}),e.jsx(re,{id:"file",type:"file",accept:".pdf,.doc,.docx,.png,.jpg,.jpeg,.gif",onChange:_}),b&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[b.name," (",_e(b.size),")"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"category",children:"Категория"}),e.jsxs(Re,{value:c,onValueChange:i=>h(i),children:[e.jsx(Me,{children:e.jsx(Pe,{placeholder:"Выберите категорию"})}),e.jsxs(Ge,{children:[e.jsx(ee,{value:"medical",children:"Медицинский"}),e.jsx(ee,{value:"assessment",children:"Диагностика"}),e.jsx(ee,{value:"consent",children:"Согласие"}),e.jsx(ee,{value:"other",children:"Другое"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"description",children:"Описание (опционально)"}),e.jsx(re,{id:"description",placeholder:"Краткое описание документа",value:z,onChange:i=>t(i.target.value)})]})]}),e.jsxs(os,{children:[e.jsx(w,{variant:"outline",onClick:()=>k(!1),disabled:p,children:"Отмена"}),e.jsx(w,{onClick:F,disabled:!b||p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"mr-2 h-4 w-4 animate-spin"}),"Загрузка..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Загрузить"]})})]})]})]})}),n.length===0?e.jsx(D,{children:e.jsxs(E,{className:"py-12 text-center text-muted-foreground",children:[e.jsx(ne,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"Нет документов"}),e.jsx("p",{className:"text-sm mt-1",children:"Загрузите первый документ для этого клиента"})]})}):e.jsx("div",{className:"space-y-3",children:n.map(i=>e.jsx(D,{children:e.jsx(E,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:Zs(i.mime_type)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i.file_name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:_e(i.file_size_bytes)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(i.created_at).toLocaleDateString("ru-RU")})]}),i.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:i.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",children:Ns(i.category)}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>f(i),title:"Скачать",children:e.jsx(Ss,{className:"h-4 w-4"})}),e.jsxs(ms,{children:[e.jsx(ds,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-destructive",title:"Удалить",children:e.jsx(bs,{className:"h-4 w-4"})})}),e.jsxs(xs,{children:[e.jsxs(us,{children:[e.jsx(hs,{children:"Удалить документ?"}),e.jsxs(ps,{children:['Документ "',i.file_name,'" будет удалён. Это действие нельзя отменить.']})]}),e.jsxs(fs,{children:[e.jsx(js,{children:"Отмена"}),e.jsx(gs,{onClick:()=>I(i.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Удалить"})]})]})]})]})]})})},i.id))})]})}async function De(a){const{data:{user:l}}=await T.auth.getUser();if(!l)throw new Error("Необходима авторизация");const{data:m,error:n}=await T.from("case_summaries").select("*").eq("client_user_id",a).eq("specialist_user_id",l.id).maybeSingle();if(n)throw ie.error("Error fetching case summary:",n),new Error(`Failed to fetch case summary: ${n.message}`);return m}async function et(a){const{clientUserId:l,specialistUserId:m,title:n}=a,s=await De(l);if(s)return s;const{sessionsCount:u,lastSessionDate:d,notesCount:p}=await Ee(l,m),{data:N,error:S}=await T.from("case_summaries").insert({client_user_id:l,specialist_user_id:m,title:n||"Case Summary",summary_type:"manual",sessions_count:u,last_session_date:d,notes_count:p,generation_status:"pending"}).select().single();if(S)throw ie.error("Error creating case summary:",S),new Error(`Failed to create case summary: ${S.message}`);return N}async function st(a,l){const{data:{user:m}}=await T.auth.getUser();if(!m)throw new Error("Необходима авторизация");const n={updated_at:new Date().toISOString()};l.presentingConcerns!==void 0&&(n.presenting_concerns=l.presentingConcerns),l.therapyGoals!==void 0&&(n.therapy_goals=l.therapyGoals),l.progressSummary!==void 0&&(n.progress_summary=l.progressSummary),l.keyThemes!==void 0&&(n.key_themes=l.keyThemes),l.treatmentApproach!==void 0&&(n.treatment_approach=l.treatmentApproach),l.recommendations!==void 0&&(n.recommendations=l.recommendations),l.riskAssessment!==void 0&&(n.risk_assessment=l.riskAssessment);const{data:s,error:u}=await T.from("case_summaries").update(n).eq("id",a).eq("specialist_user_id",m.id).select().single();if(u)throw ie.error("Error updating case summary:",u),new Error(`Failed to update case summary: ${u.message}`);return s}async function tt(a){const{data:{user:l}}=await T.auth.getUser();if(!l)throw new Error("Необходима авторизация");const{data:m,error:n}=await T.from("case_summaries").select("client_user_id").eq("id",a).single();if(n||!m)throw new Error("Case summary not found");const{sessionsCount:s,lastSessionDate:u,notesCount:d}=await Ee(m.client_user_id,l.id),{data:p,error:N}=await T.from("case_summaries").update({sessions_count:s,last_session_date:u,notes_count:d,updated_at:new Date().toISOString()}).eq("id",a).select().single();if(N)throw ie.error("Error refreshing case summary stats:",N),new Error(`Failed to refresh stats: ${N.message}`);return p}async function Ee(a,l){var u;const{count:m,data:n}=await T.from("appointments").select("scheduled_at",{count:"exact"}).eq("user_id",a).eq("specialist_id",l).eq("status","completed").order("scheduled_at",{ascending:!1}).limit(1),{count:s}=await T.from("clinical_notes").select("*",{count:"exact",head:!0}).eq("client_user_id",a).eq("user_id",l).is("deleted_at",null);return{sessionsCount:m||0,lastSessionDate:((u=n==null?void 0:n[0])==null?void 0:u.scheduled_at)||null,notesCount:s||0}}async function at(a){throw new Error("AI сервис не настроен. Обратитесь к администратору.")}function K({title:a,icon:l,value:m,placeholder:n,isEditing:s,onChange:u,multiline:d=!0}){return!s&&!m?null:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Y,{className:"flex items-center gap-2 text-sm font-medium",children:[l,a]}),s?d?e.jsx(Ke,{value:m||"",onChange:p=>u(p.target.value),placeholder:n,rows:3,className:"resize-none"}):e.jsx(re,{value:m||"",onChange:p=>u(p.target.value),placeholder:n}):e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap pl-6",children:m})]})}function rt({clientUserId:a,specialistUserId:l,clientName:m}){var xe,ue,he;const{toast:n}=me(),[s,u]=o.useState(null),[d,p]=o.useState(!0),[N,S]=o.useState(!1),[k,b]=o.useState(!1),[C,z]=o.useState(!1),[t,c]=o.useState(!1),[h,x]=o.useState(!1),[F,f]=o.useState(""),[I,_]=o.useState(""),[i,r]=o.useState(""),[g,$]=o.useState(""),[v,q]=o.useState(""),[j,P]=o.useState(""),[R,M]=o.useState(""),J=o.useCallback(async()=>{var y;try{p(!0);const A=await De(a);u(A),A&&(f(A.presenting_concerns||""),_(A.therapy_goals||""),r(A.progress_summary||""),$(((y=A.key_themes)==null?void 0:y.join(", "))||""),q(A.treatment_approach||""),P(A.recommendations||""),M(A.risk_assessment||""))}catch(A){console.error("Error loading case summary:",A)}finally{p(!1)}},[a]);o.useEffect(()=>{J()},[J]);const Fe=async()=>{try{p(!0);const y=await et({clientUserId:a,specialistUserId:l,title:`Case Summary: ${m}`});u(y),c(!0),x(!0),n({title:"Сводка создана",description:"Теперь вы можете заполнить информацию о клиенте"})}catch(y){console.error("Error creating case summary:",y),n({title:"Ошибка",description:"Не удалось создать сводку",variant:"destructive"})}finally{p(!1)}},Te=async()=>{if(s)try{S(!0);const y=g.split(",").map(A=>A.trim()).filter(A=>A.length>0);await st(s.id,{presentingConcerns:F||null,therapyGoals:I||null,progressSummary:i||null,keyThemes:y.length>0?y:null,treatmentApproach:v||null,recommendations:j||null,riskAssessment:R||null}),await J(),c(!1),n({title:"Сохранено",description:"Изменения успешно сохранены"})}catch(y){console.error("Error saving case summary:",y),n({title:"Ошибка",description:"Не удалось сохранить изменения",variant:"destructive"})}finally{S(!1)}},Ie=async()=>{if(s)try{b(!0);const y=await tt(s.id);u(y),n({title:"Статистика обновлена"})}catch(y){console.error("Error refreshing stats:",y),n({title:"Ошибка",description:"Не удалось обновить статистику",variant:"destructive"})}finally{b(!1)}},$e=()=>{var y;s&&(f(s.presenting_concerns||""),_(s.therapy_goals||""),r(s.progress_summary||""),$(((y=s.key_themes)==null?void 0:y.join(", "))||""),q(s.treatment_approach||""),P(s.recommendations||""),M(s.risk_assessment||"")),c(!1)},de=async()=>{try{z(!0),x(!0),await at(a),await J(),n({title:"Сводка сгенерирована",description:"AI проанализировал данные клиента и создал сводку"})}catch(y){console.error("Error generating case summary:",y),n({title:"Ошибка генерации",description:y instanceof Error?y.message:"Не удалось сгенерировать сводку",variant:"destructive"})}finally{z(!1)}};if(d)return e.jsx(D,{children:e.jsx(E,{className:"py-8 flex items-center justify-center",children:e.jsx(G,{className:"h-6 w-6 animate-spin text-muted-foreground"})})});if(!s)return e.jsx(D,{children:e.jsxs(E,{className:"py-8 text-center",children:[e.jsx(X,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"Case Summary"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Создайте сводку для систематизации информации о клиенте"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[e.jsx(w,{onClick:de,disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"mr-2 h-4 w-4 animate-spin"}),"Генерация..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Сгенерировать AI"]})}),e.jsxs(w,{variant:"outline",onClick:Fe,disabled:C,children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Создать вручную"]})]})]})});const Le=s.presenting_concerns||s.therapy_goals||s.progress_summary||((xe=s.key_themes)==null?void 0:xe.length)||s.treatment_approach||s.recommendations||s.risk_assessment;return e.jsx(D,{children:e.jsxs(Ds,{open:h,onOpenChange:x,children:[e.jsxs(O,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-purple-600"}),e.jsx(B,{className:"text-lg",children:"Case Summary"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!t&&e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"ghost",size:"sm",onClick:de,disabled:C||k,title:"Перегенерировать AI сводку",children:C?e.jsx(G,{className:"h-4 w-4 animate-spin"}):e.jsx(ae,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"sm",onClick:Ie,disabled:k||C,title:"Обновить статистику",children:e.jsx(Be,{className:`h-4 w-4 ${k?"animate-spin":""}`})}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>{c(!0),x(!0)},disabled:C,title:"Редактировать",children:e.jsx(Ts,{className:"h-4 w-4"})})]}),e.jsx(Es,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"sm",children:h?e.jsx(Ue,{className:"h-4 w-4"}):e.jsx(Ve,{className:"h-4 w-4"})})})]})]}),e.jsx(we,{children:e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-1",children:[e.jsxs("span",{children:[s.sessions_count," сессий"]}),e.jsxs("span",{children:[s.notes_count," заметок"]}),s.last_session_date&&e.jsxs("span",{children:["Последняя:"," ",new Date(s.last_session_date).toLocaleDateString("ru-RU")]}),s.summary_type==="auto"&&s.last_generated_at&&e.jsxs(L,{variant:"secondary",className:"text-xs",children:[e.jsx(ae,{className:"h-3 w-3 mr-1"}),"AI ",new Date(s.last_generated_at).toLocaleDateString("ru-RU")]}),C&&e.jsxs(L,{variant:"outline",className:"text-xs",children:[e.jsx(G,{className:"h-3 w-3 mr-1 animate-spin"}),"Генерация..."]})]})})]}),e.jsx(Fs,{children:e.jsxs(E,{className:"space-y-4",children:[(t||((ue=s.key_themes)==null?void 0:ue.length))&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Y,{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Ws,{className:"h-4 w-4"}),"Ключевые темы"]}),t?e.jsx(re,{value:g,onChange:y=>$(y.target.value),placeholder:"Тревога, отношения, самооценка (через запятую)"}):e.jsx("div",{className:"flex flex-wrap gap-1 pl-6",children:(he=s.key_themes)==null?void 0:he.map((y,A)=>e.jsx(L,{variant:"secondary",children:y},A))})]}),e.jsx(Q,{}),e.jsx(K,{title:"Первичные обращения",icon:e.jsx(ne,{className:"h-4 w-4"}),value:t?F:s.presenting_concerns,placeholder:"Опишите причины обращения клиента...",isEditing:t,onChange:f}),e.jsx(K,{title:"Цели терапии",icon:e.jsx(Ys,{className:"h-4 w-4"}),value:t?I:s.therapy_goals,placeholder:"Какие цели поставлены на терапию...",isEditing:t,onChange:_}),e.jsx(K,{title:"Прогресс терапии",icon:e.jsx(Is,{className:"h-4 w-4"}),value:t?i:s.progress_summary,placeholder:"Опишите прогресс клиента...",isEditing:t,onChange:r}),e.jsx(K,{title:"Подход к терапии",icon:e.jsx(X,{className:"h-4 w-4"}),value:t?v:s.treatment_approach,placeholder:"Какие методы и техники используются...",isEditing:t,onChange:q}),e.jsx(K,{title:"Рекомендации",icon:e.jsx($s,{className:"h-4 w-4"}),value:t?j:s.recommendations,placeholder:"Рекомендации для дальнейшей работы...",isEditing:t,onChange:P}),e.jsx(K,{title:"Оценка рисков",icon:e.jsx(He,{className:"h-4 w-4"}),value:t?R:s.risk_assessment,placeholder:"Оценка потенциальных рисков...",isEditing:t,onChange:M}),t&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(w,{variant:"outline",onClick:$e,disabled:N,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Отмена"]}),e.jsx(w,{onClick:Te,disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"mr-2 h-4 w-4 animate-spin"}),"Сохранение..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ls,{className:"mr-2 h-4 w-4"}),"Сохранить"]})})]})]}),!t&&!Le&&e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx("p",{className:"text-sm",children:"Сводка пока пуста"}),e.jsx(w,{variant:"link",onClick:()=>{c(!0)},className:"mt-2",children:"Заполнить информацию"})]})]})})]})})}function ve(a){return"version"in a&&a.version===2}const nt=[{key:"emotion_regulation",label:"Регуляция эмоций",maxScore:24},{key:"behavior",label:"Поведение",maxScore:16},{key:"executive_functions",label:"Исполнительные функции",maxScore:28},{key:"sensory_processing",label:"Сенсорная обработка",maxScore:20},{key:"communication",label:"Коммуникация и речь",maxScore:20},{key:"social_cognition",label:"Социальное познание",maxScore:24},{key:"identity",label:"Самооценка",maxScore:12},{key:"learning",label:"Обучение",maxScore:12},{key:"motivation",label:"Мотивация",maxScore:16},{key:"trauma",label:"Травматический опыт",maxScore:12}],it=[{key:"emotional",label:"Эмоциональные трудности",maxScore:10},{key:"conduct",label:"Поведенческие трудности",maxScore:10},{key:"hyperactivity",label:"Гиперактивность",maxScore:10},{key:"peer_problems",label:"Проблемы со сверстниками",maxScore:10}];function lt({status:a}){switch(a){case"concerning":return e.jsx(Ze,{className:"h-4 w-4 text-coral"});case"borderline":return e.jsx(ye,{className:"h-4 w-4 text-yellow-500"});case"typical":return e.jsx(Ye,{className:"h-4 w-4 text-secondary"});default:return e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"})}}function ct(a){switch(a){case"concerning":return"bg-coral";case"borderline":return"bg-yellow-400";case"typical":return"bg-secondary";default:return"bg-muted"}}function U({label:a,status:l,score:m,maxScore:n}){return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{status:l}),e.jsx("span",{children:a})]}),e.jsx("span",{className:"text-muted-foreground",children:zs(l)})]}),e.jsx("div",{className:"h-2 overflow-hidden rounded-full bg-muted/50",children:e.jsx("div",{className:`h-full ${ct(l)}`,style:{width:`${qs(m,n)}%`}})})]})}function ot({open:a,onOpenChange:l,assessmentId:m,assessmentType:n,ageGroup:s,title:u}){const[d,p]=o.useState([]),[N,S]=o.useState(!1);o.useEffect(()=>{a&&m&&k()},[a,m]);const k=async()=>{S(!0);try{const{data:t,error:c}=await T.from("answers").select("*").eq("assessment_id",m).order("question_id",{ascending:!0});if(c)throw c;p(t||[])}catch(t){console.error("Error loading answers:",t)}finally{S(!1)}},b=t=>{let c=[];switch(n){case"checkup":c=Ms(s||"elementary");break;case"parent":c=Gs;break;case"family":c=je;break}const h=c.find(x=>x.id===t);return(h==null?void 0:h.text)||`Вопрос ${t}`},C=(t,c)=>{var h,x,F,f,I;if(n==="checkup")return((h=Rs.find(_=>_.value===c))==null?void 0:h.label)||`${c}`;if(n==="parent")return((x=Ps.find(_=>_.value===c))==null?void 0:x.label)||`${c}`;if(n==="family"){const _=je.find(i=>i.id===t);return(_==null?void 0:_.answerType)==="wellbeing"?((F=Os.find(i=>i.value===c))==null?void 0:F.label)||`${c}`:(_==null?void 0:_.answerType)==="relationship"?((f=Bs.find(i=>i.value===c))==null?void 0:f.label)||`${c}`:((I=Us.find(i=>i.value===c))==null?void 0:I.label)||`${c}`}return`${c}`},z=(t,c)=>{const h=t/c;return h>=.75?"text-coral":h>=.5?"text-yellow-600":h>=.25?"text-yellow-500":"text-secondary"};return e.jsx(Ce,{open:a,onOpenChange:l,children:e.jsxs(Se,{className:"max-w-2xl max-h-[80vh]",children:[e.jsx(be,{children:e.jsx(ke,{children:u})}),e.jsx(We,{className:"h-[60vh] pr-4",children:N?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(G,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):d.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Ответы не найдены"}):e.jsx("div",{className:"space-y-4",children:d.map((t,c)=>e.jsx("div",{className:"p-3 rounded-lg bg-muted/30 border",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary/10 text-primary text-xs flex items-center justify-center font-medium",children:c+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-foreground",children:b(t.question_id)}),e.jsx("p",{className:`text-sm font-medium mt-1 ${z(t.value,4)}`,children:C(t.question_id,t.value)})]})]})},t.id))})})]})})}function mt({clientUserId:a}){const[l,m]=o.useState(!0),[n,s]=o.useState([]),[u,d]=o.useState(null),[p,N]=o.useState(null),[S,k]=o.useState({open:!1,assessmentId:"",assessmentType:"checkup",ageGroup:void 0,title:""});o.useEffect(()=>{b()},[a]);const b=async()=>{try{m(!0);const{data:t,error:c}=await T.from("profiles").select("*").eq("user_id",a);if(c)throw c;if(!t||t.length===0){m(!1);return}const h=t.map(j=>j.id),{data:x,error:F}=await T.from("assessments").select("*").in("profile_id",h).eq("status","completed").in("assessment_type",["parent","family","checkup"]);if(F)throw F;const f=(x==null?void 0:x.filter(j=>j.assessment_type==="parent"))||[],I=(x==null?void 0:x.filter(j=>j.assessment_type==="family"))||[],_=(x==null?void 0:x.filter(j=>j.assessment_type==="checkup"))||[],i=t.find(j=>j.type==="parent"),r=t.filter(j=>j.type==="child");let g=null,$=null;i&&(g=f.find(j=>j.profile_id===i.id)||null,$=I.find(j=>j.profile_id===i.id)||null),!g&&f.length>0&&(g=f[0]),!$&&I.length>0&&($=I[0]),d(g),N($);const v=[],q=new Map(_.map(j=>[j.profile_id,j]));for(const j of r){const P=q.get(j.id);if(P&&P.results_summary){const R=P.results_summary;v.push({profile:j,assessment:P,results:R,ageGroup:P.age_group||(ve(R)?R.age_group:void 0)})}}s(v)}catch(t){console.error("Error loading checkup data:",t)}finally{m(!1)}},C=(t,c,h,x)=>{k({open:!0,assessmentId:t,assessmentType:c,ageGroup:x,title:h})};if(l)return e.jsxs(D,{children:[e.jsx(O,{children:e.jsx(B,{className:"text-lg",children:"Результаты чекапов"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsx(H,{className:"h-20 w-full"}),e.jsx(H,{className:"h-20 w-full"}),e.jsx(H,{className:"h-20 w-full"})]})]});if(n.length===0&&!u&&!p)return e.jsxs(D,{children:[e.jsx(O,{children:e.jsx(B,{className:"text-lg",children:"Результаты чекапов"})}),e.jsx(E,{children:e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Клиент еще не прошел ни одного чекапа"})})]});const z=t=>t?new Date(t).toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:"numeric"}):"";return e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx(O,{children:e.jsx(B,{className:"text-lg",children:"Результаты чекапов"})}),e.jsxs(E,{className:"space-y-6",children:[n.map(t=>{const c=ve(t.results);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Xs,{className:"h-5 w-5 text-primary"}),e.jsxs("span",{className:"font-medium",children:["Ребенок: ",t.profile.first_name]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[t.assessment.completed_at&&e.jsxs(L,{variant:"outline",className:"text-xs",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),z(t.assessment.completed_at)]}),e.jsxs(w,{variant:"ghost",size:"sm",onClick:()=>C(t.assessment.id,"checkup",`Ответы: ${t.profile.first_name}`,t.ageGroup),children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Ответы"]})]})]}),e.jsx("div",{className:"space-y-3 pl-7",children:c?e.jsx(e.Fragment,{children:nt.map(({key:h,label:x,maxScore:F})=>{const f=t.results[h];return!f||typeof f!="object"||!("status"in f)?null:e.jsx(U,{label:x,status:f.status,score:f.score,maxScore:f.max_score||F},h)})}):e.jsx(e.Fragment,{children:it.map(({key:h,label:x,maxScore:F})=>{const f=t.results[h];return!f||typeof f!="object"||!("status"in f)?null:e.jsx(U,{label:x,status:f.status,score:f.score,maxScore:f.max_score||F},h)})})}),e.jsx(Q,{className:"mt-4"})]},t.profile.id)}),u&&u.results_summary&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-medium",children:"Чекап себя"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[u.completed_at&&e.jsxs(L,{variant:"outline",className:"text-xs",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),z(u.completed_at)]}),e.jsxs(w,{variant:"ghost",size:"sm",onClick:()=>C(u.id,"parent","Ответы: Чекап себя"),children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Ответы"]})]})]}),e.jsx("div",{className:"space-y-3 pl-7",children:(()=>{const t=u.results_summary;return e.jsxs(e.Fragment,{children:[t.anxiety&&e.jsx(U,{label:"Тревожность",status:t.anxiety.status,score:t.anxiety.score,maxScore:6}),t.depression&&e.jsx(U,{label:"Депрессия",status:t.depression.status,score:t.depression.score,maxScore:6})]})})()}),e.jsx(Q,{className:"mt-4"})]}),p&&p.results_summary&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Xe,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-medium",children:"Чекап семьи"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[p.completed_at&&e.jsxs(L,{variant:"outline",className:"text-xs",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),z(p.completed_at)]}),e.jsxs(w,{variant:"ghost",size:"sm",onClick:()=>C(p.id,"family","Ответы: Чекап семьи"),children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Ответы"]})]})]}),e.jsx("div",{className:"space-y-3 pl-7",children:(()=>{const t=p.results_summary;return e.jsxs(e.Fragment,{children:[t.family_stress&&e.jsx(U,{label:"Семейный стресс",status:t.family_stress.status,score:t.family_stress.score,maxScore:4}),t.partner_relationship&&e.jsx(U,{label:"Отношения с партнером",status:t.partner_relationship.status,score:t.partner_relationship.score,maxScore:10}),t.coparenting&&e.jsx(U,{label:"Совместное воспитание",status:t.coparenting.status,score:t.coparenting.score,maxScore:10})]})})()})]})]})]}),e.jsx(ot,{open:S.open,onOpenChange:t=>k(c=>({...c,open:t})),assessmentId:S.assessmentId,assessmentType:S.assessmentType,ageGroup:S.ageGroup,title:S.title})]})}function Ot(){var I,_,i;const{clientId:a}=ze(),l=qe(),{toast:m}=me(),{specialistUser:n}=Je(),[s,u]=o.useState(null),[d,p]=o.useState(null),[N,S]=o.useState([]),[k,b]=o.useState([]),[C,z]=o.useState([]),[t,c]=o.useState(!0),[h,x]=o.useState("info");o.useEffect(()=>{a&&F()},[a]);const F=async()=>{var r;if(a)try{c(!0);const{data:g,error:$}=await T.rpc("get_specialist_clients");if($)throw $;const v=g==null?void 0:g.find(M=>M.client_user_id===a);if(!v){m({title:"Ошибка",description:"Клиент не найден или не назначен вам",variant:"destructive"});return}const{data:q,error:j}=await T.rpc("get_client_profiles",{p_client_user_id:a});j&&console.error("Error loading profiles:",j);const R=(q==null?void 0:q.find(M=>M.type==="parent"))||(q==null?void 0:q[0]);if(z(q||[]),u({id:v.client_user_id,email:v.client_email,phone:v.client_phone,region:v.client_region,created_at:v.assigned_at,profile:R?{first_name:R.first_name,last_name:R.last_name,date_of_birth:R.date_of_birth,gender:R.gender}:void 0}),p({id:v.assignment_id,assignment_type:v.assignment_type,status:v.assignment_status,assigned_at:v.assigned_at,notes:v.notes,profile_id:v.profile_id||null,profile_first_name:v.profile_first_name||null,profile_last_name:v.profile_last_name||null,profile_type:v.profile_type||null}),(r=n==null?void 0:n.specialist)!=null&&r.id){const{data:M}=await T.from("appointments").select(`
            id,
            scheduled_at,
            status,
            notes,
            transcript,
            appointment_type:appointment_types (name, duration_minutes)
          `).eq("user_id",a).eq("specialist_id",n.specialist.id).order("scheduled_at",{ascending:!1});S(M||[])}try{const M=await is(a);b(M)}catch{console.log("No clinical notes for client")}}catch(g){console.error("Error loading client:",g),m({title:"Ошибка",description:"Не удалось загрузить данные клиента",variant:"destructive"})}finally{c(!1)}},f=r=>{const g=Hs(r);return e.jsx(L,{variant:g.variant,className:g.className,children:g.label})};return t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(H,{className:"h-10 w-10"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"h-6 w-48"}),e.jsx(H,{className:"h-4 w-32"})]})]}),e.jsx(H,{className:"h-[400px] w-full"})]}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(w,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx(le,{to:"/specialist/clients",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center text-lg font-semibold",children:Vs(s==null?void 0:s.profile,s==null?void 0:s.email)}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[ge(s==null?void 0:s.profile,s==null?void 0:s.email),d&&e.jsx(L,{variant:d.assignment_type==="primary"?"default":"secondary",children:d.assignment_type==="primary"?"Основной":d.assignment_type==="consultant"?"Консультант":"Временный"})]}),(d==null?void 0:d.profile_first_name)&&e.jsxs("p",{className:"text-primary font-medium",children:["Работаю с: ",d.profile_first_name," ",d.profile_last_name||"",d.profile_type==="child"&&" (ребёнок)",d.profile_type==="partner"&&" (партнёр)"]}),e.jsx("p",{className:"text-muted-foreground",children:s.email||s.phone})]})]}),e.jsx(w,{variant:"outline",asChild:!0,children:e.jsxs(le,{to:`/specialist/messages?client=${a}`,children:[e.jsx(es,{className:"mr-2 h-4 w-4"}),"Написать"]})})]}),e.jsxs(rs,{value:h,onValueChange:x,children:[e.jsxs(ns,{children:[e.jsxs(se,{value:"info",className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Информация"]}),e.jsxs(se,{value:"appointments",className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),"Консультации",N.length>0&&e.jsx(L,{variant:"secondary",className:"ml-1",children:N.length})]}),e.jsxs(se,{value:"notes",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"AI-заметки",k.length>0&&e.jsx(L,{variant:"secondary",className:"ml-1",children:k.length})]}),e.jsxs(se,{value:"documents",className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Документы"]})]}),e.jsxs(te,{value:"info",className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(D,{children:[e.jsx(O,{children:e.jsx(B,{className:"text-lg",children:"Контактные данные"})}),e.jsxs(E,{className:"space-y-4",children:[s.email&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ss,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Qs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.phone})]}),s.region&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ks,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.region})]}),((I=s.profile)==null?void 0:I.date_of_birth)&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:W(s.profile.date_of_birth)})]}),((_=s.profile)==null?void 0:_.gender)&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.profile.gender==="male"?"Мужской":s.profile.gender==="female"?"Женский":s.profile.gender})]})]})]}),e.jsxs(D,{children:[e.jsx(O,{children:e.jsx(B,{className:"text-lg",children:"Статистика"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Всего консультаций"}),e.jsx("span",{className:"font-medium",children:N.length})]}),e.jsx(Q,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Проведено"}),e.jsx("span",{className:"font-medium",children:N.filter(r=>r.status==="completed").length})]}),e.jsx(Q,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"AI-заметок"}),e.jsx("span",{className:"font-medium",children:k.length})]}),e.jsx(Q,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Клиент с"}),e.jsx("span",{className:"font-medium",children:W(s.created_at)})]})]})]}),C.length>0&&e.jsxs(D,{className:"md:col-span-2",children:[e.jsxs(O,{children:[e.jsx(B,{className:"text-lg",children:"Состав семьи"}),e.jsx(we,{children:"Профили, зарегистрированные в аккаунте клиента"})]}),e.jsx(E,{children:e.jsx("div",{className:"flex flex-wrap gap-3",children:C.map(r=>{var g;return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border ${(d==null?void 0:d.profile_id)===r.id?"border-primary bg-primary/5":"border-border"}`,children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center text-sm font-medium",children:[r.first_name[0],((g=r.last_name)==null?void 0:g[0])||""]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-sm",children:[r.first_name," ",r.last_name||""]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.type==="parent"&&"Родитель",r.type==="child"&&"Ребёнок",r.type==="partner"&&"Партнёр",!["parent","child","partner"].includes(r.type)&&r.type,r.date_of_birth&&` • ${W(r.date_of_birth)}`]})]}),(d==null?void 0:d.profile_id)===r.id&&e.jsx(L,{variant:"secondary",className:"ml-2 text-xs",children:"Работаю"})]},r.id)})})})]}),(d==null?void 0:d.notes)&&e.jsxs(D,{className:"md:col-span-2",children:[e.jsx(O,{children:e.jsx(B,{className:"text-lg",children:"Заметки от координатора"})}),e.jsx(E,{children:e.jsx("p",{className:"text-muted-foreground whitespace-pre-wrap",children:d.notes})})]})]}),a&&e.jsx(mt,{clientUserId:a}),a&&((i=n==null?void 0:n.user)==null?void 0:i.id)&&s&&e.jsx(rt,{clientUserId:a,specialistUserId:n.user.id,clientName:ge(s.profile,s.email)})]}),e.jsx(te,{value:"appointments",className:"space-y-4",children:N.length===0?e.jsx(D,{children:e.jsxs(E,{className:"py-12 text-center text-muted-foreground",children:[e.jsx(V,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"Нет консультаций"}),e.jsx("p",{className:"text-sm mt-1",children:"Консультации назначаются администратором"})]})}):e.jsx("div",{className:"space-y-3",children:N.map(r=>{var g,$;return e.jsx(D,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>l(`/specialist/sessions/${r.id}`),children:e.jsx(E,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ts,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((g=r.appointment_type)==null?void 0:g.name)||"Консультация"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(V,{className:"h-3 w-3"}),W(r.scheduled_at,{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),(($=r.appointment_type)==null?void 0:$.duration_minutes)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx(as,{className:"h-3 w-3"}),r.appointment_type.duration_minutes," мин"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[r.transcript&&e.jsxs(L,{variant:"outline",className:"text-xs",children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),"Транскрипт"]}),f(r.status),e.jsx(fe,{className:"h-4 w-4 text-muted-foreground"})]})]})})},r.id)})})}),e.jsxs(te,{value:"notes",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"AI-сгенерированные клинические заметки по сессиям с клиентом"}),e.jsx(w,{asChild:!0,children:e.jsxs(le,{to:"/specialist/sessions",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Перейти к сессиям"]})})]}),k.length===0?e.jsx(D,{children:e.jsxs(E,{className:"py-12 text-center text-muted-foreground",children:[e.jsx(X,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"Нет AI-заметок"}),e.jsx("p",{className:"text-sm mt-1",children:"Создайте клиническую заметку на странице сессии"})]})}):e.jsx("div",{className:"space-y-3",children:k.map(r=>e.jsx(D,{className:r.appointment_id?"cursor-pointer hover:bg-muted/50 transition-colors":"",onClick:()=>r.appointment_id&&l(`/specialist/sessions/${r.appointment_id}`),children:e.jsx(E,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(X,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[W(r.created_at,{day:"numeric",month:"short",year:"numeric"}),r.sections&&e.jsxs(e.Fragment,{children:[" • ",r.sections.length," секций"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:r.status==="finalized"?"default":"outline",children:r.status==="finalized"?"Сохранено":r.status==="draft"?"Черновик":r.status}),e.jsx(fe,{className:"h-4 w-4 text-muted-foreground"})]})]})})},r.id))})]}),e.jsx(te,{value:"documents",children:n!=null&&n.id?e.jsx(Js,{clientUserId:a,currentUserId:n.id}):e.jsx(D,{children:e.jsxs(E,{className:"py-12 text-center text-muted-foreground",children:[e.jsx(Ne,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"Загрузка..."})]})})})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Клиент не найден"}),e.jsxs(w,{variant:"outline",onClick:()=>l("/specialist/clients"),children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Вернуться к списку"]})]})}export{Ot as default};
