import{r as u,j as e}from"./vendor-radix-htwXsPHy.js";import{b as A}from"./vendor-query-BNGVDYIL.js";import{w as K,K as R,C as H,N as L,O as M,h as D,q as k,a as F,b as B,c as E,d as I,e as l,s as j,B as z,au as G,av as J,aw as P,ax as U}from"./index-Bu4m9iDU.js";import{T as W,a as X,b as q,c as n,d as Y,e as i}from"./table-D_Yakl6M.js";import{S as Z}from"./search-qJuoDY49.js";import{E as ee}from"./eye-Cpu7S48v.js";import{f as y}from"./vendor-date-CR4liJ_d.js";import"./vendor-charts-DjioKZbK.js";import"./vendor-react-CI8wve7f.js";function se(){return A({queryKey:["admin-assessments"],queryFn:async()=>{const{data:d,error:m}=await K.from("assessments").select(`
          *,
          profile:profiles(id, first_name, last_name, type, user_id, user:users(id, email))
        `).order("created_at",{ascending:!1}).limit(1e3);if(m)throw m;return(d||[]).map(c=>{var h,r;const t=((h=c.profile)==null?void 0:h[0])||c.profile,x=((r=t==null?void 0:t.user)==null?void 0:r[0])||(t==null?void 0:t.user);return{...c,profile:t,user:x}})}})}const O={emotion_regulation:"Регуляция эмоций",behavior:"Поведение",executive_functions:"Исполнительные функции",sensory_processing:"Сенсорная обработка",communication:"Коммуникация и речь",social_cognition:"Социальное познание",identity:"Самооценка",learning:"Обучение",motivation:"Мотивация",trauma:"Травматический опыт",emotional:"Эмоциональные проблемы",conduct:"Проблемы поведения",hyperactivity:"Гиперактивность",peer_problems:"Проблемы со сверстниками",prosocial:"Просоциальное поведение",total_difficulties:"Общие трудности",anxiety:"Тревожность",depression:"Депрессия",total:"Общий балл",family_stress:"Семейный стресс",partner_relationship:"Отношения с партнером",coparenting:"Совместное воспитание"},re={typical:"bg-green-100 text-green-800",borderline:"bg-yellow-100 text-yellow-800",concerning:"bg-red-100 text-red-800"},ae={typical:"Норма",borderline:"Пограничный",concerning:"Требует внимания"};function he(){var f,_,N,w,b;const[d,m]=u.useState(""),[c,t]=u.useState("all"),[x,h]=u.useState("all"),[r,g]=u.useState(null),{data:o,isLoading:Q}=se(),p=o==null?void 0:o.filter(s=>{var v,C,S,T;const a=s.id.toLowerCase().includes(d.toLowerCase())||((C=(v=s.profile)==null?void 0:v.first_name)==null?void 0:C.toLowerCase().includes(d.toLowerCase()))||((T=(S=s.user)==null?void 0:S.email)==null?void 0:T.toLowerCase().includes(d.toLowerCase())),V=c==="all"||s.status===c,$=x==="all"||s.assessment_type===x;return a&&V&&$});return Q?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(R,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Управление оценками"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Всего оценок: ",(o==null?void 0:o.length)||0]})]}),e.jsxs(H,{children:[e.jsx(L,{children:e.jsx(M,{children:"Фильтры"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(k,{placeholder:"Поиск по ID, имени или email...",value:d,onChange:s=>m(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(F,{value:c,onValueChange:t,children:[e.jsx(B,{className:"w-[180px]",children:e.jsx(E,{placeholder:"Статус"})}),e.jsxs(I,{children:[e.jsx(l,{value:"all",children:"Все статусы"}),e.jsx(l,{value:"in_progress",children:"В процессе"}),e.jsx(l,{value:"completed",children:"Завершено"}),e.jsx(l,{value:"abandoned",children:"Брошено"})]})]}),e.jsxs(F,{value:x,onValueChange:h,children:[e.jsx(B,{className:"w-[180px]",children:e.jsx(E,{placeholder:"Тип"})}),e.jsxs(I,{children:[e.jsx(l,{value:"all",children:"Все типы"}),e.jsx(l,{value:"checkup",children:"Чекап"}),e.jsx(l,{value:"parent",children:"Родитель"}),e.jsx(l,{value:"family",children:"Семья"})]})]})]})]})]}),e.jsxs(H,{children:[e.jsx(L,{children:e.jsx(M,{children:"Список оценок"})}),e.jsx(D,{children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(q,{children:[e.jsx(n,{children:"ID"}),e.jsx(n,{children:"Тип"}),e.jsx(n,{children:"Профиль"}),e.jsx(n,{children:"Пользователь"}),e.jsx(n,{children:"Статус"}),e.jsx(n,{children:"Начато"}),e.jsx(n,{children:"Завершено"}),e.jsx(n,{})]})}),e.jsx(Y,{children:p==null?void 0:p.map(s=>{var a;return e.jsxs(q,{children:[e.jsxs(i,{className:"font-mono text-xs",children:[s.id.slice(0,8),"..."]}),e.jsx(i,{children:e.jsx(j,{variant:"outline",children:s.assessment_type})}),e.jsx(i,{children:s.profile?`${s.profile.first_name} ${s.profile.last_name||""}`.trim():"—"}),e.jsx(i,{children:((a=s.user)==null?void 0:a.email)||"—"}),e.jsx(i,{children:e.jsx(j,{variant:s.status==="completed"?"default":s.status==="in_progress"?"secondary":"destructive",children:s.status==="completed"?"Завершено":s.status==="in_progress"?"В процессе":"Брошено"})}),e.jsx(i,{children:y(new Date(s.started_at),"dd.MM.yyyy HH:mm")}),e.jsx(i,{children:s.completed_at?y(new Date(s.completed_at),"dd.MM.yyyy HH:mm"):"—"}),e.jsx(i,{children:s.status==="completed"&&s.results_summary&&e.jsx(z,{size:"sm",variant:"ghost",onClick:()=>g(s),children:e.jsx(ee,{className:"h-4 w-4"})})})]},s.id)})})]})})]}),e.jsx(G,{open:!!r,onOpenChange:()=>g(null),children:e.jsxs(J,{className:"w-[400px] sm:w-[450px]",children:[e.jsx(P,{children:e.jsxs(U,{children:["Результаты ",(r==null?void 0:r.assessment_type)==="checkup"?"чекапа":"оценки"]})}),r&&e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Профиль:"})," ",((f=r.profile)==null?void 0:f.first_name)||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Дата:"})," ",r.completed_at?y(new Date(r.completed_at),"dd.MM.yyyy HH:mm"):"—"]}),((_=r.results_summary)==null?void 0:_.version)===2&&e.jsxs("p",{children:[e.jsx("strong",{children:"Версия:"})," v2 (10 шкал)"]}),((N=r.results_summary)==null?void 0:N.age_group)&&e.jsxs("p",{children:[e.jsx("strong",{children:"Возрастная группа:"})," ",r.results_summary.age_group==="preschool"?"Дошкольник (3-6)":r.results_summary.age_group==="elementary"?"Младший школьник (7-11)":r.results_summary.age_group==="teenager"?"Подросток (12-18)":r.results_summary.age_group]})]}),e.jsx("div",{className:"space-y-2",children:r.results_summary&&Object.entries(r.results_summary).filter(([s])=>O[s]&&!["version","age_group","calculated_at"].includes(s)).map(([s,a])=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border",children:[e.jsx("span",{className:"text-sm",children:O[s]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-sm",children:(a==null?void 0:a.score)??a}),(a==null?void 0:a.status)&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${re[a.status]||""}`,children:ae[a.status]||a.status})]})]},s))}),((b=(w=r.results_summary)==null?void 0:w.worry_tags)==null?void 0:b.length)>0&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Теги беспокойства:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.results_summary.worry_tags.map(s=>e.jsx(j,{variant:"outline",className:"text-xs",children:s},s))})]})]})]})})]})}export{he as default};
