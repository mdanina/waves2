import{r}from"./vendor-radix-ClAtPGFM.js";import{isRunningAsPWA as g,isPushSupported as l,isIOSPushSupported as d,isSubscribedToPush as m,isIOS as y,setupPushNotifications as w,unsubscribeFromPush as k,getNotificationPermission as I,initializePushNotifications as C}from"./push-notifications-Dxe7eXns.js";function O(){const[o,s]=r.useState("loading"),[b,n]=r.useState(!1),[f,e]=r.useState(null),i=y(),a=g(),p=l()&&(!i||d()),u=r.useCallback(async()=>{if(!l()){s("unsupported");return}if(i&&!d()){s("unsupported");return}if(i&&!a){s("ios-not-installed");return}if(I()==="denied"){s("permission-denied");return}try{const c=await m();s(c?"subscribed":"not-subscribed")}catch(c){console.error("Error checking push status:",c),s("error")}},[i,a]);r.useEffect(()=>{(async()=>{await C(),await u()})()},[u]);const h=r.useCallback(async()=>{n(!0),e(null);try{switch(await w()){case"granted":return s("subscribed"),!0;case"denied":return s("permission-denied"),e("Вы отклонили разрешение на уведомления. Чтобы включить их, измените настройки в браузере."),!1;case"unsupported":return s("unsupported"),e("Ваш браузер не поддерживает push-уведомления."),!1;case"ios-not-pwa":return s("ios-not-installed"),e("На iOS сначала добавьте приложение на главный экран."),!1;case"no-vapid":return s("error"),e("Push-уведомления не настроены на сервере."),!1;case"error":default:return s("error"),e("Не удалось подписаться на уведомления. Попробуйте позже."),!1}}catch(t){return console.error("Subscribe error:",t),s("error"),e("Произошла ошибка при подписке на уведомления."),!1}finally{n(!1)}},[]),S=r.useCallback(async()=>{n(!0),e(null);try{return await k()?(s("not-subscribed"),!0):(e("Не удалось отписаться от уведомлений."),!1)}catch(t){return console.error("Unsubscribe error:",t),e("Произошла ошибка при отписке от уведомлений."),!1}finally{n(!1)}},[]),P=r.useCallback(async()=>{s("loading"),await u()},[u]);return{status:o,isSupported:p,isSubscribed:o==="subscribed",isLoading:o==="loading"||b,error:f,isIOSDevice:i,isPWAInstalled:a,subscribe:h,unsubscribe:S,refresh:P}}export{O as u};
