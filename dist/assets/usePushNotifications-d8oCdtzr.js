import{h as m}from"./index-Dv2C02zj.js";import{r}from"./vendor-radix-htwXsPHy.js";import{isRunningAsPWA as g,isPushSupported as l,isIOSPushSupported as d,isSubscribedToPush as P,isIOS as w,setupPushNotifications as k,unsubscribeFromPush as I,getNotificationPermission as x,initializePushNotifications as C}from"./push-notifications-DY0UVl1r.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=m("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);function v(){const[u,s]=r.useState("loading"),[p,n]=r.useState(!1),[b,e]=r.useState(null),i=w(),a=g(),f=l()&&(!i||d()),o=r.useCallback(async()=>{if(!l()){s("unsupported");return}if(i&&!d()){s("unsupported");return}if(i&&!a){s("ios-not-installed");return}if(x()==="denied"){s("permission-denied");return}try{const c=await P();s(c?"subscribed":"not-subscribed")}catch(c){console.error("Error checking push status:",c),s("error")}},[i,a]);r.useEffect(()=>{(async()=>{await C(),await o()})()},[o]);const h=r.useCallback(async()=>{n(!0),e(null);try{switch(await k()){case"granted":return s("subscribed"),!0;case"denied":return s("permission-denied"),e("Вы отклонили разрешение на уведомления. Чтобы включить их, измените настройки в браузере."),!1;case"unsupported":return s("unsupported"),e("Ваш браузер не поддерживает push-уведомления."),!1;case"ios-not-pwa":return s("ios-not-installed"),e("На iOS сначала добавьте приложение на главный экран."),!1;case"no-vapid":return s("error"),e("Push-уведомления не настроены на сервере."),!1;case"error":default:return s("error"),e("Не удалось подписаться на уведомления. Попробуйте позже."),!1}}catch(t){return console.error("Subscribe error:",t),s("error"),e("Произошла ошибка при подписке на уведомления."),!1}finally{n(!1)}},[]),S=r.useCallback(async()=>{n(!0),e(null);try{return await I()?(s("not-subscribed"),!0):(e("Не удалось отписаться от уведомлений."),!1)}catch(t){return console.error("Unsubscribe error:",t),e("Произошла ошибка при отписке от уведомлений."),!1}finally{n(!1)}},[]),y=r.useCallback(async()=>{s("loading"),await o()},[o]);return{status:u,isSupported:f,isSubscribed:u==="subscribed",isLoading:u==="loading"||p,error:b,isIOSDevice:i,isPWAInstalled:a,subscribe:h,unsubscribe:S,refresh:y}}export{O as S,v as u};
