import{r as i,j as e}from"./vendor-radix-htwXsPHy.js";import{u as A}from"./vendor-query-BNGVDYIL.js";import{u as w,H as C,S as D,a as k,B as r,m as n,g as m}from"./index-Dv2C02zj.js";import{p as S,a as j}from"./friendly-and-clean-face-of-an-adult-person--gender (1)-mshj5uDX.js";import{c as z,a as P}from"./friendly-and-clean-face-of-a-white-boy-7-yo--soft- (1)-BoJK1GJM.js";import{calculateAge as E,getProfiles as F,deleteProfile as I}from"./profileStorage-CNyPVPjQ.js";import{A as M,a as _,b as H,c as Q,d as B,e as L,f as T,g as $}from"./alert-dialog-BJd2NNw3.js";import{u as q,a as O}from"./vendor-react-CI8wve7f.js";import{P as K}from"./pencil-CiJyETcy.js";import{T as R}from"./trash-2-C4DY-mZ7.js";import{P as G}from"./plus-CrCC_Tdd.js";import"./vendor-charts-DjioKZbK.js";const J="/assets/minimalistic-and-friendly-vector-style-illustratio-BD6epQQO.png";function ie(){var p;const l=q(),u=O(),v=A(),{user:o}=w(),[x,f]=i.useState([]),[c,d]=i.useState(null),[y,h]=i.useState(!0);i.useEffect(()=>{let s=!1;async function a(){try{s||h(!0);const t=await F();if(s)return;n.log("Loaded profiles:",t),n.log("Profiles with types:",t.map(g=>({name:g.first_name,type:g.type}))),f(t)}catch(t){s||(n.error("Error loading family members:",t),m.error("Ошибка при загрузке членов семьи"))}finally{s||h(!1)}}return a(),()=>{s=!0}},[u.pathname]);const N=i.useCallback(s=>s.type==="parent"?s.gender==="male"?S:j:s.type==="child"?s.gender==="male"?z:P:j,[]),b=async s=>{try{await I(s),await v.invalidateQueries({queryKey:["profiles",o==null?void 0:o.id]}),f(a=>a.filter(t=>t.id!==s)),d(null),m.success("Член семьи удален")}catch(a){n.error("Error deleting profile:",a),m.error("Ошибка при удалении члена семьи")}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(C,{}),e.jsxs("div",{className:"container mx-auto max-w-2xl px-4 py-12",children:[e.jsx(D,{currentStep:3,totalSteps:3,label:"ПРОФИЛЬ СЕМЬИ"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:J,alt:"Семья",className:"mx-auto mb-6 h-32 w-32 object-contain"}),e.jsx(k,{size:"2xl",className:"mb-4",children:"Члены семьи"}),e.jsx("p",{className:"text-muted-foreground",children:"Добавьте столько членов семьи, сколько хотите! Вы сможете добавлять и управлять членами семьи в вашем кабинете."})]}),e.jsxs("div",{className:"space-y-4",children:[y?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})}):x.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Пока нет членов семьи"})}):x.map(s=>{const a=s.dob?E(s.dob):null;return e.jsxs("div",{className:"flex items-center gap-4 rounded-lg border border-border bg-card p-4 transition-shadow hover:shadow-md",children:[e.jsx("img",{src:N(s),alt:`${s.first_name} ${s.last_name||""}`,className:"h-14 w-14 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-foreground",children:[s.first_name," ",s.last_name||""]}),a!==null&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a," лет"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{variant:"outline",size:"icon",onClick:()=>l(`/edit-family-member/${s.id}`),className:"hover:border-coral hover:text-coral transition-colors",children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(r,{variant:"outline",size:"icon",onClick:()=>d(s.id),className:"hover:border-destructive hover:text-destructive transition-colors",children:e.jsx(R,{className:"h-4 w-4"})})]})]},s.id)}),e.jsxs(r,{variant:"outline",size:"lg",onClick:()=>l("/add-family-member"),className:"h-14 w-full text-base font-medium hover:border-coral hover:text-coral transition-colors",children:[e.jsx(G,{className:"mr-2 h-5 w-5"}),"Добавить члена семьи"]})]}),e.jsx("div",{className:"flex gap-4",children:((p=u.state)==null?void 0:p.from)==="cabinet"?e.jsx(r,{type:"button",size:"lg",onClick:()=>l("/cabinet"),className:"h-14 w-full text-base font-medium",children:"Вернуться в кабинет"}):e.jsxs(e.Fragment,{children:[e.jsx(r,{type:"button",variant:"outline",size:"lg",onClick:()=>l("/family-setup"),className:"h-14 flex-1 text-base font-medium",children:"Назад"}),e.jsx(r,{type:"button",size:"lg",onClick:()=>l("/cabinet"),className:"h-14 flex-1 text-base font-medium",children:"Завершить"})]})})]})]}),e.jsx(M,{open:c!==null,onOpenChange:()=>d(null),children:e.jsxs(_,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Удалить члена семьи?"}),e.jsx(B,{children:"Это действие нельзя отменить. Данные члена семьи будут удалены навсегда."})]}),e.jsxs(L,{children:[e.jsx(T,{children:"Отмена"}),e.jsx($,{onClick:()=>c&&b(c),children:"Удалить"})]})]})})]})}export{ie as default};
