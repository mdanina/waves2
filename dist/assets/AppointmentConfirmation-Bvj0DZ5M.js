import{r as j,j as e}from"./vendor-radix-J7BmBqsC.js";import{u as E,c as I}from"./vendor-react-CI1J5nwZ.js";import{E as L,G as T,J as D,a8 as k,$ as M,a1 as A,a9 as b,Y as P,ab as B,o as C,a3 as F,B as x,H as _,O as H,C as O,y as S,Q as $}from"./index-CsvxaYtI.js";import{h as z,f as V}from"./useAppointments-CyaU3UD4.js";import{b as G,a as R}from"./usePackages-CLKVrbZ9.js";import{u as W}from"./useProfiles-Bh4H3Y1m.js";import{f as Y}from"./moscowTime-Bf471xDt.js";import{u as q}from"./usePushNotifications-yH9xgmQr.js";import{S as J}from"./smartphone-BOhANp-S.js";import"./vendor-charts-CkgrveCd.js";import"./vendor-query-Bb981xLV.js";import"./appointmentStorage-D1wbbDxY.js";import"./profileStorage-CU3CxDLE.js";import"./push-notifications-B1tyBZYU.js";const y="push_notification_modal_dismissed";function K({open:t,onOpenChange:r,onSuccess:l}){const{status:n,isSupported:s,isIOSDevice:g,isPWAInstalled:N,subscribe:i,isLoading:a,error:u}=q(),[h,d]=j.useState(null),m=async()=>{d(null),await i()?(localStorage.setItem(y,"enabled"),r(!1),l==null||l()):u&&d(u)},v=()=>{localStorage.setItem(y,"dismissed"),r(!1)},c=g&&!N;return n==="subscribed"?null:e.jsx(L,{open:t,onOpenChange:r,children:e.jsxs(T,{className:"sm:max-w-md",children:[e.jsxs(D,{children:[e.jsx("div",{className:"mx-auto mb-4 h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(k,{className:"h-8 w-8 text-primary"})}),e.jsx(M,{className:"text-center text-xl",children:"Включить уведомления?"}),e.jsx(A,{className:"text-center",children:"Чтобы не пропустить важные события, включите push-уведомления"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-sage-pale flex items-center justify-center",children:e.jsx(b,{className:"h-4 w-4 text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Напоминания о сессиях"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Получайте уведомления за 36 часов и за 1 час до встречи"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-lavender-pale flex items-center justify-center",children:e.jsx(P,{className:"h-4 w-4 text-secondary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Когда специалист ждёт"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Узнайте мгновенно, когда специалист уже в комнате"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-lilac-pale flex items-center justify-center",children:e.jsx(B,{className:"h-4 w-4 text-lilac"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Новые сообщения"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Не пропустите важные сообщения от специалиста"})]})]})]}),c&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-honey-pale rounded-lg border border-honey",children:[e.jsx(J,{className:"h-5 w-5 text-honey-dark flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-foreground",children:"Для iOS"}),e.jsxs("p",{className:"text-muted-foreground text-xs mt-1",children:["Сначала добавьте приложение на главный экран: нажмите",e.jsx("span",{className:"inline-block mx-1",children:e.jsxs("svg",{className:"inline h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L11 6.414V13a1 1 0 11-2 0V6.414L7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3z"}),e.jsx("path",{d:"M3 14a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"})]})}),"→ «На экран Домой»"]})]})]}),!s&&!c&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted rounded-lg",children:[e.jsx(C,{className:"h-5 w-5 text-muted-foreground flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ваш браузер не поддерживает push-уведомления. Попробуйте Chrome, Firefox или Safari."})]}),h&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-destructive/10 rounded-lg border border-destructive/30",children:[e.jsx(C,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-destructive",children:h})]})]}),e.jsxs(F,{className:"flex-col gap-2 sm:flex-col",children:[e.jsx(x,{onClick:m,disabled:a||!s||c,className:"w-full",children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:e.jsxs("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]})}),"Подключаем..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Включить уведомления"]})}),e.jsx(x,{variant:"ghost",onClick:v,disabled:a,className:"w-full text-muted-foreground",children:"Может быть позже"})]})]})})}function Q(){const t=localStorage.getItem(y);return!(t==="enabled"||t==="dismissed")}function oe(){const t=E(),[r]=I(),l=r.get("appointment_id"),n=r.get("package_id");r.get("payment_id");const{data:s,isLoading:g}=z(l),N=s==null?void 0:s.appointment_type_id,{data:i}=V(N||null),{data:a,isLoading:u}=G(n),h=a==null?void 0:a.package_id,{data:d}=R(h||null),{data:m}=W(),[v,c]=j.useState(!1),p=g||u;j.useEffect(()=>{if(s&&i&&i.price===0&&Q()){const o=setTimeout(()=>{c(!0)},500);return()=>clearTimeout(o)}},[s,i]);const f=s!=null&&s.profile_id?m==null?void 0:m.find(o=>o.id===s.profile_id):null,w=f?`${f.first_name}${f.last_name?` ${f.last_name}`:""}`:s!=null&&s.profile_id?null:"Для меня (родитель)";return j.useEffect(()=>{if(!p&&!s&&!a)if(l||n){const o=setTimeout(()=>{!s&&!a&&t("/cabinet")},2e3);return()=>clearTimeout(o)}else t("/cabinet")},[s,a,p,t,l,n]),p?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(_,{}),e.jsx("div",{className:"container mx-auto px-4 py-20 flex items-center justify-center",children:e.jsx(H,{className:"h-8 w-8 animate-spin text-primary"})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(_,{}),e.jsx("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 pt-8 pb-8",children:e.jsxs(O,{className:"p-8 text-center",children:[e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsx("div",{className:"h-20 w-20 rounded-full bg-success/20 flex items-center justify-center",children:e.jsx(S,{className:"h-12 w-12 text-success"})})}),e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:s?"Консультация записана!":"Пакет успешно приобретен!"}),e.jsx("p",{className:"text-muted-foreground mb-8",children:s?"Ваша консультация успешно записана и оплачена":"Ваш пакет сессий успешно приобретен"}),s&&e.jsxs("div",{className:"mb-8 space-y-4 text-left bg-muted/50 p-6 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Дата и время"}),e.jsx("p",{className:"font-medium",children:Y(s.scheduled_at)})]})]}),i&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Тип консультации"}),e.jsxs("p",{className:"font-medium",children:[i.name," (",i.duration_minutes," минут)"]})]})]}),w&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Для кого"}),e.jsx("p",{className:"font-medium",children:w})]})]})]}),a&&d&&e.jsxs("div",{className:"mb-8 space-y-4 text-left bg-muted/50 p-6 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Пакет"}),e.jsx("p",{className:"font-medium",children:d.name})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Оставшиеся сессии"}),e.jsxs("p",{className:"font-medium",children:[a.sessions_remaining," сессий"]})]})]})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(x,{variant:"outline",onClick:()=>t("/cabinet"),children:"Вернуться в кабинет"}),s&&e.jsx(x,{onClick:()=>t("/appointments"),children:"Записаться еще"}),a&&e.jsx(x,{onClick:()=>t("/packages"),children:"Посмотреть пакеты"})]})]})}),e.jsx(K,{open:v,onOpenChange:c})]})}export{oe as default};
