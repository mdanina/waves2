import{r as l,j as e}from"./vendor-radix-ClAtPGFM.js";import{u as g,H as h,S as b,a as j,b as v,c as N,d as S,e as y,B as f,f as C}from"./index-BetUtCwY.js";import{S as E}from"./StepIndicator-jYxnBoHD.js";import{getCurrentUserData as w,upsertUserData as R}from"./userStorage-Cn4L5CKO.js";import{getProfiles as k}from"./profileStorage-Bslow6L6.js";import{u as z,a as H}from"./vendor-react-C_NXOhYK.js";import"./vendor-charts-DLBwBPLi.js";import"./vendor-query-DNK10Tnx.js";const P=["Москва","Санкт-Петербург","Новосибирск","Екатеринбург","Казань","Нижний Новгород","Челябинск","Самара","Омск","Ростов-на-Дону","Уфа","Красноярск","Воронеж","Пермь","Волгоград"];function q(){const a=z(),o=H(),{user:d}=g(),[r,u]=l.useState(""),[m,n]=l.useState(!0),c=l.useRef(!1);l.useEffect(()=>{async function s(){var t;if(!d){n(!1);return}try{const i=await w();if(i!=null&&i.region&&u(i.region),(await k()).some(p=>p.type==="child")&&(c.current=!0,((t=o.state)==null?void 0:t.from)!=="cabinet")){a("/cabinet",{replace:!0});return}}catch(i){console.error("Error loading region:",i)}finally{n(!1)}}s()},[d,o.state,a]);const x=async()=>{var s;if(r)try{n(!0),await R({region:r});const t=((s=o.state)==null?void 0:s.from)==="cabinet"||c.current;a(t?"/cabinet":r==="Омск"||r==="Волгоград"?"/coming-soon":"/family-setup")}catch(t){console.error("Error saving region:",t),C.error("Ошибка при сохранении региона"),n(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(h,{}),e.jsxs("div",{className:"container mx-auto max-w-2xl px-4 py-12",children:[e.jsx(E,{currentStep:2,totalSteps:3,label:"РЕГИОН"}),e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"text-center",children:e.jsx(b,{size:"2xl",className:"mb-4",children:"В каком регионе вы живете?"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"region",className:"text-sm font-medium text-foreground",children:["Регион ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(j,{value:r,onValueChange:u,children:[e.jsx(v,{id:"region",className:"h-14 text-base rounded-2xl border-2 border-muted bg-white/80 backdrop-blur-sm transition-all duration-200 focus:border-coral-light focus:outline-none focus:ring-0 data-[state=open]:border-coral-light",style:{boxShadow:r?"0 0 0 3px rgba(255, 178, 153, 0.2), 0 10px 25px -5px rgba(255, 178, 153, 0.5), 0 4px 6px -2px rgba(255, 178, 153, 0.3)":void 0},children:e.jsx(N,{placeholder:"Выберите регион"})}),e.jsx(S,{className:"rounded-2xl",children:P.map(s=>e.jsx(y,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(f,{type:"button",variant:"outline",size:"lg",onClick:()=>{var t;const s=((t=o.state)==null?void 0:t.from)==="cabinet"||c.current;a(s?"/cabinet":"/profile")},className:"h-14 flex-1 text-base font-medium",children:"Назад"}),e.jsx(f,{type:"button",size:"lg",onClick:x,disabled:!r||m,className:"h-14 flex-1 text-base font-medium",children:m?"Сохранение...":"Продолжить"})]})]})]})]})]})}export{q as default};
