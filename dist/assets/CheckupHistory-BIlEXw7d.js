import{r as i,j as e}from"./vendor-radix-htwXsPHy.js";import{u as A,H as f,z as D,A as h,C as p,i as g,B as j,D as E,U as R,F as S,m as o,g as N}from"./index-Dv2C02zj.js";import{d as F}from"./assessmentStorage-C8gjZ2L4.js";import{getProfiles as H}from"./profileStorage-CNyPVPjQ.js";import{u as U}from"./vendor-react-CI8wve7f.js";import"./vendor-charts-DjioKZbK.js";import"./vendor-query-BNGVDYIL.js";function T(){const a=U(),{user:n,loading:c}=A(),[d,y]=i.useState([]),[b,m]=i.useState(!0);i.useEffect(()=>{async function s(){if(!c){if(!n){a("/cabinet");return}try{m(!0);const[t,r]=await Promise.allSettled([H(),F()]),w=t.status==="fulfilled"?t.value:[],k=r.status==="fulfilled"?r.value:[];t.status==="rejected"&&o.error("Error loading profiles:",t.reason),r.status==="rejected"&&(o.error("Error loading assessments:",r.reason),N.error("Ошибка при загрузке истории чекапов"));const C=k.map(l=>({...l,profile:l.profile_id&&w.find(_=>_.id===l.profile_id)||null}));y(C)}catch(t){o.error("Error loading checkup history:",t),N.error("Ошибка при загрузке истории чекапов")}finally{m(!1)}}}s()},[n,c,a]);const u=i.useMemo(()=>d.filter(s=>s.status==="completed"&&s.assessment_type==="checkup"),[d]),v=s=>{s.profile_id&&a(`/results-report/${s.profile_id}?assessmentId=${s.id}`)},x={background:"var(--bg-golden-hour)",backgroundAttachment:"fixed"};return b?e.jsxs("div",{className:"min-h-screen bg-background",style:x,children:[e.jsx(f,{}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 py-12",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(D,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Загрузка истории..."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-background",style:x,children:[e.jsx(f,{}),e.jsxs("div",{className:"container mx-auto max-w-6xl px-4 py-12",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(h,{className:"h-8 w-8 text-primary"}),e.jsx("h1",{className:"text-4xl font-bold text-foreground",children:"История чекапов"})]})}),u.length===0?e.jsx(p,{children:e.jsxs(g,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(h,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"История пуста"}),e.jsx("p",{className:"text-muted-foreground text-center mb-4",children:"Вы еще не проходили чекапы. Начните с дашборда!"}),e.jsx(j,{onClick:()=>a("/cabinet"),children:"Перейти к дашборду"})]})}):e.jsx("div",{className:"space-y-4",children:u.map(s=>{const t=s.completed_at||s.created_at,r=new Date(t).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsx(p,{className:"hover:shadow-md transition-shadow",children:e.jsxs(g,{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(E,{className:"h-4 w-4"}),r]}),s.profile&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-medium",children:[s.profile.first_name," ",s.profile.last_name||""]})]})]}),s.profile_id&&e.jsxs(j,{onClick:()=>v(s),size:"sm",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Просмотреть отчет"]})]})},s.id)})})]})]})}export{T as default};
