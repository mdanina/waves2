import{r as s,j as e}from"./vendor-radix-htwXsPHy.js";import{u as z}from"./vendor-query-BNGVDYIL.js";import{S as I}from"./StepIndicator-DbGYq49f.js";import{u as E,j as $,C as F,S as T,A as Q,m as B,o as L,B as o,p as c,f as h}from"./index-Bu4m9iDU.js";import{p as O,a as C}from"./friendly-and-clean-face-of-an-adult-person--gender (1)-mshj5uDX.js";import{c as q,a as H}from"./friendly-and-clean-face-of-a-white-boy-7-yo--soft- (1)-BoJK1GJM.js";import{calculateAge as k,getProfiles as R,deleteProfile as K}from"./profileStorage-B9P4N8Co.js";import{A as W,a as G,b as J,c as U,d as V,e as X,f as Y,g as Z}from"./alert-dialog-DfF31jsr.js";import{u as ee,a as te}from"./vendor-react-CI8wve7f.js";import{P as ae}from"./pencil-BjdfN6Bm.js";import{T as se}from"./trash-2-CYbdFHW9.js";import{P as re}from"./plus-L645YxVk.js";import"./vendor-charts-DjioKZbK.js";const le="/assets/minimalistic-and-friendly-vector-style-illustratio-BD6epQQO.png";function ye(){var N,A;const l=ee(),i=te(),_=z(),{user:d}=E(),[n,g]=s.useState([]),[m,u]=s.useState(null),[D,j]=s.useState(!0);s.useEffect(()=>{let t=!1;async function r(){try{t||j(!0);const a=await R();if(t)return;c.log("Loaded profiles:",a),c.log("Profiles with types:",a.map(w=>({name:w.first_name,type:w.type}))),g(a)}catch(a){t||(c.error("Error loading family members:",a),h.error("Ошибка при загрузке членов семьи"))}finally{t||j(!1)}}return r(),()=>{t=!0}},[i.pathname]);const S=s.useCallback(t=>t.type==="parent"?t.gender==="male"?O:C:t.type==="child"?t.gender==="male"?q:H:C,[]),M=async t=>{try{await K(t),await _.invalidateQueries({queryKey:["profiles",d==null?void 0:d.id]}),g(r=>r.filter(a=>a.id!==t)),u(null),h.success("Член семьи удален")}catch(r){c.error("Error deleting profile:",r),h.error("Ошибка при удалении члена семьи")}},f=s.useMemo(()=>n.find(t=>t.type==="parent"),[n]),y=(f==null?void 0:f.seeking_care)==="yes",v=s.useMemo(()=>n.filter(t=>t.type==="child"),[n]),b=s.useMemo(()=>v.filter(t=>(t.dob?k(t.dob):0)>=6),[v]),p=((N=i.state)==null?void 0:N.from)!=="cabinet",x=s.useMemo(()=>!p||y?!0:b.length>=1,[p,y,b.length]),P=()=>{x&&l("/cabinet")};return e.jsxs("div",{className:"min-h-screen",style:{backgroundImage:`url(${$})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"},children:[e.jsx("div",{className:"container mx-auto max-w-2xl px-4 py-12",children:e.jsxs(F,{className:"rounded-[20px] border-2 bg-white p-8 shadow-[0_4px_20px_rgba(0,0,0,0.06)]",children:[e.jsx(I,{currentStep:3,totalSteps:3,label:"ПРОФИЛЬ СЕМЬИ"}),e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:le,alt:"Семья",className:"mx-auto mb-6 h-32 w-32 object-contain"}),e.jsx(T,{size:"2xl",className:"mb-4",children:"Члены семьи"}),e.jsx("p",{className:"text-muted-foreground",children:"Добавьте только тех членов семьи, которых вы планируете подключить к тренировкам на платформе."})]}),p&&!x&&e.jsxs(Q,{variant:"warning",className:"shadow-[0_0_20px_rgba(255,178,153,0.5)]",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(L,{children:"Нужно выбрать хотя бы одного участника старше 6 лет, чтобы получить доступ к тренировкам."})]}),e.jsxs("div",{className:"space-y-4",children:[D?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})}):n.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Пока нет членов семьи"})}):n.map(t=>{const r=t.dob?k(t.dob):null;return e.jsxs("div",{className:"flex items-center gap-4 rounded-lg border border-border bg-card p-4 transition-shadow hover:shadow-md",children:[e.jsx("img",{src:S(t),alt:`${t.first_name} ${t.last_name||""}`,className:"h-14 w-14 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-foreground",children:[t.first_name," ",t.last_name||""]}),r!==null&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r," лет"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"icon",onClick:()=>{var a;console.log("Edit clicked for member:",{id:t.id,name:`${t.first_name} ${t.last_name}`,type:t.type,isParent:t.type==="parent"}),t.type==="parent"?l("/profile",{state:{from:((a=i.state)==null?void 0:a.from)==="cabinet"?"cabinet":"family-members"}}):l(`/edit-family-member/${t.id}`,{state:i.state?{from:i.state.from}:void 0})},className:"hover:border-coral hover:text-coral transition-colors",children:e.jsx(ae,{className:"h-4 w-4"})}),t.type!=="parent"&&e.jsx(o,{variant:"outline",size:"icon",onClick:()=>u(t.id),className:"hover:border-destructive hover:text-destructive transition-colors",children:e.jsx(se,{className:"h-4 w-4"})})]})]},t.id)}),e.jsxs(o,{variant:"outline",size:"lg",onClick:()=>l("/add-family-member"),className:"h-14 w-full text-base font-medium hover:border-coral hover:text-coral transition-colors",children:[e.jsx(re,{className:"mr-2 h-5 w-5"}),"Добавить члена семьи"]})]}),e.jsx("div",{className:"flex gap-4",children:((A=i.state)==null?void 0:A.from)==="cabinet"?e.jsx(o,{type:"button",size:"lg",onClick:()=>l("/cabinet"),className:"h-14 w-full text-base font-medium",children:"Вернуться в кабинет"}):e.jsxs(e.Fragment,{children:[e.jsx(o,{type:"button",variant:"outline",size:"lg",onClick:()=>l("/family-setup"),className:"h-14 flex-1 text-base font-medium",children:"Назад"}),e.jsx(o,{type:"button",size:"lg",onClick:P,disabled:!x,className:"h-14 flex-1 text-base font-medium",children:"Завершить"})]})})]})]})}),e.jsx(W,{open:m!==null,onOpenChange:()=>u(null),children:e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(U,{children:"Удалить члена семьи?"}),e.jsx(V,{children:"Это действие нельзя отменить. Данные члена семьи будут удалены навсегда."})]}),e.jsxs(X,{children:[e.jsx(Y,{children:"Отмена"}),e.jsx(Z,{onClick:()=>m&&M(m),children:"Удалить"})]})]})})]})}export{ye as default};
