import{r as j,j as e}from"./vendor-radix-CDHcN1cP.js";import{Y as Ut,u as mt,R as K,C as we,i as Ke,Z as _t,_ as Le,$ as fs,a0 as ms,a1 as qe,a2 as Ve,a3 as He,D as ve,B as O,a4 as Ne,a5 as hs,a6 as ct,a7 as Ae,L as xs,a8 as qt,f as pe,x as ps,a9 as gs,v as ue,j as ge,S as Ce,aa as lt,E as vs,G as js,T as Vt,V as Ht,ab as ys,z as bs,U as ws,N as Ue,ac as Ns,s as Ct,r as St,ad as Et,q as ks,P as _s,W as Qe,w as Cs}from"./index-Dt6uKTGi.js";import{u as At,a as Dt}from"./useAssessments-DyPv7xmI.js";import{b as Ss,a as Es}from"./useAppointments-BUGKN8HV.js";import{f as Tt}from"./moscowTime-Bf471xDt.js";import{A as Ze,h as Xe,a as et,b as tt,c as st,d as nt,e as rt,f as it,g as at}from"./alert-dialog-DIIe8Egt.js";import{D as Se,a as Ee,b as Ie,c as Pe,d as Yt,e as Gt,f as As}from"./dialog-Bj2cYqgx.js";import{S as Ds}from"./separator-jFFEuoi3.js";import{B as dt}from"./briefcase-1bvZFsre.js";import{P as Ts}from"./play-Dxb0U6DA.js";import{G as Ls,B as Is}from"./graduation-cap-Bt8R0r0U.js";import{S as Ps}from"./star-B-7iuTXI.js";import{g as Ms,b as Os,a as zs,r as Fs}from"./calendar-feed-DS6aepZN.js";import{C as $s}from"./copy-BQyQHpRi.js";import{T as Rs}from"./trash-2-DXIhtIVB.js";import{u as Wt}from"./vendor-react-D0zZO7ze.js";import{E as Bs}from"./external-link-DbqO2EaT.js";import{A as Us}from"./arrow-right-BGNd1uuT.js";import{s as qs,g as Lt}from"./supabase-messages-C9v4Eu2L.js";import{u as Vs}from"./vendor-query-DyYoeD25.js";import{E as ot}from"./eye-MTBUaJjA.js";import{P as It}from"./plus-C1Qd69GB.js";import{C as Hs}from"./chevron-left-DS2GCxVv.js";import"./vendor-charts-DMFz3Lzq.js";import"./assessmentStorage-BtF7XoQl.js";import"./appointmentStorage-Dmm45BMo.js";const Ys={child_psychology:"Детская психология",family_therapy:"Семейная терапия",cbt:"КПТ",trauma:"Работа с травмой",anxiety:"Тревожные расстройства",depression:"Депрессия",adhd:"СДВГ",autism:"Аутизм",eating_disorders:"Расстройства питания",parenting:"Родительство",psychologist:"Психолог",psychiatrist:"Психиатр",psychotherapist:"Психотерапевт",clinical_psychologist:"Клинический психолог",child_psychologist:"Детский психолог",family_therapist:"Семейный терапевт",neuropsychologist:"Нейропсихолог",logopedist:"Логопед",defectologist:"Дефектолог",art_therapist:"Арт-терапевт",cbt_specialist:"Специалист по КПТ",coordinator:"Координатор"},Gs={higher:"Высшее образование",additional:"Дополнительное образование",certification:"Сертификация",course:"Курс"};function Ws({specialistId:t,showChangeButton:s=!0,onSpecialistChange:n}){const{toast:o}=Ut(),{user:c}=mt(),[r,i]=j.useState(null),[m,u]=j.useState([]),[l,b]=j.useState(!0),[g,v]=j.useState(!1),[N,x]=j.useState(!1),[p,h]=j.useState(""),[d,f]=j.useState(!1),[y,S]=j.useState(!1);j.useEffect(()=>{A()},[t,c]);const A=async()=>{if(c)try{b(!0);let w=null;if(t){const{data:I,error:$}=await K.from("specialists").select("*").eq("id",t).single();if($)throw $;w=I}else{const{data:I,error:$}=await K.from("client_assignments").select("specialist_id").eq("client_user_id",c.id).eq("status","active").single();if($){if($.code==="PGRST116"){i(null),b(!1);return}throw $}const{data:H,error:Y}=await K.from("specialists").select("*").eq("id",I.specialist_id).single();if(Y)throw Y;w=H}if(i(w),w){const{data:I}=await K.from("specialist_education").select("*").eq("specialist_id",w.id).order("year_end",{ascending:!1,nullsFirst:!1});u(I||[]);const{data:$}=await K.from("specialist_change_requests").select("id").eq("client_user_id",c.id).eq("status","pending").single();S(!!$)}}catch(w){console.error("Error loading specialist data:",w),o({title:"Ошибка",description:"Не удалось загрузить данные специалиста",variant:"destructive"})}finally{b(!1)}},L=w=>{const I=w.match(/(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);if(I)return`https://www.youtube.com/embed/${I[1]}`;const $=w.match(/vimeo\.com\/(?:video\/)?(\d+)/);return $?`https://player.vimeo.com/video/${$[1]}`:null},E=async()=>{if(!(!c||!r))try{f(!0);const{error:w}=await K.from("specialist_change_requests").insert({client_user_id:c.id,current_specialist_id:r.id,reason:p||null,status:"pending"});if(w)throw w;o({title:"Запрос отправлен",description:"Координатор рассмотрит ваш запрос на смену специалиста"}),x(!1),h(""),S(!0),n==null||n()}catch(w){console.error("Error submitting change request:",w),o({title:"Ошибка",description:"Не удалось отправить запрос",variant:"destructive"})}finally{f(!1)}},D=w=>w.split(" ").map($=>$[0]).join("").toUpperCase().slice(0,2),k=(w,I)=>w&&I?`${w} - ${I}`:I?`${I}`:w?`с ${w}`:null;if(l)return e.jsx(we,{children:e.jsx(Ke,{className:"flex items-center justify-center py-12",children:e.jsx(_t,{className:"h-8 w-8 animate-spin text-muted-foreground"})})});if(!r)return e.jsx(we,{children:e.jsxs(Ke,{className:"py-8 text-center",children:[e.jsx(Le,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Вам пока не назначен специалист. После установочной встречи координатор подберёт для вас подходящего специалиста."})]})});const F=r.video_intro_url?L(r.video_intro_url):null;return e.jsxs(e.Fragment,{children:[e.jsxs(we,{children:[e.jsx(fs,{children:e.jsxs(ms,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5"}),"Ваш специалист"]})}),e.jsxs(Ke,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(qe,{className:"h-20 w-20",children:[e.jsx(Ve,{src:r.avatar_url||void 0}),e.jsx(He,{className:"text-xl",children:D(r.display_name)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold",children:r.display_name}),r.experience_years&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(dt,{className:"h-4 w-4"}),"Опыт работы: ",r.experience_years," лет"]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx(ve,{variant:r.is_available?"default":"secondary",children:r.is_available?"Доступен":"Не в сети"})})]})]}),r.specialization_codes.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Специализации:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.specialization_codes.map(w=>e.jsx(ve,{variant:"outline",children:Ys[w]||w},w))})]}),r.bio&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"О специалисте:"}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:r.bio})]}),r.video_intro_url&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Видеовизитка:"}),e.jsxs(O,{variant:"outline",onClick:()=>v(!0),className:"w-full sm:w-auto",children:[e.jsx(Ts,{className:"mr-2 h-4 w-4"}),"Смотреть видео"]})]}),m.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium mb-3 flex items-center gap-2",children:[e.jsx(Ls,{className:"h-4 w-4"}),"Образование:"]}),e.jsx("div",{className:"space-y-3",children:m.map(w=>e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Is,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:w.institution})]}),w.specialty&&e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:w.specialty}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground pl-6",children:[k(w.year_start,w.year_end)&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"h-3 w-3"}),k(w.year_start,w.year_end)]}),e.jsx("span",{className:"px-2 py-0.5 bg-muted rounded",children:Gs[w.education_type]||w.education_type})]})]},w.id))})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(Ds,{}),y?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground p-3 bg-muted/50 rounded-lg",children:[e.jsx(hs,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Ваш запрос на смену специалиста рассматривается"})]}):e.jsxs(O,{variant:"outline",onClick:()=>x(!0),className:"w-full",children:[e.jsx(ct,{className:"mr-2 h-4 w-4"}),"Запросить смену специалиста"]})]})]})]}),e.jsx(Se,{open:g,onOpenChange:v,children:e.jsxs(Ee,{className:"max-w-3xl w-[90vw] p-0",children:[e.jsx(Ie,{className:"px-6 pt-6",children:e.jsxs(Pe,{children:["Видеовизитка ",r.display_name]})}),e.jsx("div",{className:"px-6 pb-6",children:F?e.jsx("div",{className:"relative w-full",style:{paddingBottom:"56.25%"},children:e.jsx("iframe",{className:"absolute top-0 left-0 w-full h-full rounded-lg",src:F,title:"Видеовизитка специалиста",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ae,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground",children:["Видео доступно по"," ",e.jsx("a",{href:r.video_intro_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"ссылке"})]})]})})]})}),e.jsx(Se,{open:N,onOpenChange:x,children:e.jsxs(Ee,{children:[e.jsxs(Ie,{children:[e.jsx(Pe,{children:"Запросить смену специалиста"}),e.jsx(Yt,{children:"Если вы чувствуете, что текущий специалист вам не подходит, вы можете запросить смену. Координатор подберет вам другого специалиста."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(xs,{htmlFor:"change-reason",children:"Причина смены (необязательно)"}),e.jsx(qt,{id:"change-reason",value:p,onChange:w=>h(w.target.value),placeholder:"Опишите, почему вы хотите сменить специалиста...",rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Это поможет координатору лучше подобрать нового специалиста"})]})}),e.jsxs(Gt,{children:[e.jsx(O,{variant:"outline",onClick:()=>x(!1),disabled:d,children:"Отмена"}),e.jsx(O,{onClick:E,disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"mr-2 h-4 w-4 animate-spin"}),"Отправка..."]}):"Отправить запрос"})]})]})})]})}async function Pt(){const{data:{user:t}}=await K.auth.getUser();if(!t)return null;const{data:s,error:n}=await K.rpc("get_pending_ratings_for_user",{p_user_id:t.id});return n?(console.error("Error fetching pending rating:",n),null):!s||s.length===0?null:s[0]}async function Js(t){const{data:{user:s}}=await K.auth.getUser();if(!s)return{success:!1,error:"Пользователь не авторизован"};const{error:n}=await K.from("specialist_ratings").insert({appointment_id:t.appointment_id,client_user_id:s.id,specialist_id:t.specialist_id,rating:t.rating,review_text:t.review_text||null});return n?(console.error("Error submitting rating:",n),{success:!1,error:n.message}):{success:!0}}async function Ks(t){const{error:s}=await K.from("appointments").update({rating_skipped:!0}).eq("id",t);return s?(console.error("Error skipping rating:",s),{success:!1,error:s.message}):{success:!0}}async function Qs(t){if(!t||t.length===0)return"";const{data:s,error:n}=await K.from("specializations").select("name").in("code",t);return n?(console.error("Error fetching specialization names:",n),""):(s==null?void 0:s.map(o=>o.name).join(", "))||""}function Zs(t){return new Date(t).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Moscow"})}function Xs({pendingRating:t,open:s,onClose:n,onSubmitted:o}){const[c,r]=j.useState(0),[i,m]=j.useState(0),[u,l]=j.useState(""),[b,g]=j.useState(!1),[v,N]=j.useState("");j.useEffect(()=>{r(0),m(0),l(""),N("")},[t==null?void 0:t.appointment_id]),j.useEffect(()=>{var f;((f=t==null?void 0:t.specialization_codes)==null?void 0:f.length)>0&&Qs(t.specialization_codes).then(N)},[t==null?void 0:t.specialization_codes]);const x=async()=>{if(c===0){pe.error("Пожалуйста, выберите оценку");return}g(!0);const f=await Js({appointment_id:t.appointment_id,specialist_id:t.specialist_id,rating:c,review_text:u.trim()||void 0});g(!1),f.success?(pe.success("Спасибо за вашу оценку!"),o()):pe.error(f.error||"Не удалось отправить оценку")},p=async()=>{g(!0);const f=await Ks(t.appointment_id);g(!1),f.success?n():pe.error(f.error||"Не удалось пропустить оценку")},h=f=>f.split(" ").map(y=>y[0]).join("").slice(0,2).toUpperCase(),d=i||c;return e.jsx(Se,{open:s,onOpenChange:f=>!f&&n(),children:e.jsxs(Ee,{className:"sm:max-w-md",children:[e.jsx(Ie,{children:e.jsx(Pe,{className:"text-center text-xl",children:"Как прошла консультация?"})}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs(qe,{className:"h-14 w-14",children:[e.jsx(Ve,{src:t.specialist_avatar||void 0}),e.jsx(He,{className:"bg-primary/10 text-primary text-lg",children:h(t.specialist_name)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"font-semibold text-foreground truncate",children:t.specialist_name})]}),v&&e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:v}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Ne,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Zs(t.scheduled_at)})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 py-4",children:[e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(f=>e.jsx("button",{type:"button",onClick:()=>r(f),onMouseEnter:()=>m(f),onMouseLeave:()=>m(0),className:"p-1 transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded","aria-label":`Оценка ${f} из 5`,children:e.jsx(Ps,{className:`h-10 w-10 transition-colors ${f<=d?"fill-yellow-400 text-yellow-400":"fill-none text-muted-foreground/50"}`})},f))}),d>0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d===1&&"Очень плохо",d===2&&"Плохо",d===3&&"Нормально",d===4&&"Хорошо",d===5&&"Отлично"]})]}),e.jsxs("div",{children:[e.jsx(qt,{placeholder:"Поделитесь впечатлениями (необязательно)...",value:u,onChange:f=>l(f.target.value),rows:3,maxLength:1e3,className:"resize-none"}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right mt-1",children:[u.length,"/1000"]})]}),e.jsxs(Gt,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(O,{variant:"ghost",onClick:p,disabled:b,className:"w-full sm:w-auto",children:"Пропустить"}),e.jsx(O,{onClick:x,disabled:b||c===0,className:"w-full sm:w-auto",children:b?"Отправка...":"Отправить"})]})]})})}function en({trigger:t}){const[s,n]=j.useState(!1),[o,c]=j.useState(!1),[r,i]=j.useState(null),[m,u]=j.useState(!1),{toast:l}=Ut();j.useEffect(()=>{s&&b()},[s]);const b=async()=>{c(!0);try{const p=await Ms();i(p?Os(p):null)}catch(p){console.error("Ошибка загрузки токена:",p)}finally{c(!1)}},g=async()=>{c(!0);try{const p=await zs();i(p.feedUrl),l({title:"Ссылка создана",description:"Скопируйте ссылку и добавьте в свой календарь"})}catch(p){l({title:"Ошибка",description:p instanceof Error?p.message:"Не удалось создать ссылку",variant:"destructive"})}finally{c(!1)}},v=async()=>{c(!0);try{await Fs(),i(null),l({title:"Ссылка отозвана",description:"Старая ссылка больше не работает"})}catch(p){l({title:"Ошибка",description:p instanceof Error?p.message:"Не удалось отозвать ссылку",variant:"destructive"})}finally{c(!1)}},N=async()=>{if(r)try{await navigator.clipboard.writeText(r),u(!0),l({title:"Скопировано",description:"Ссылка скопирована в буфер обмена"}),setTimeout(()=>u(!1),2e3)}catch{l({title:"Ошибка",description:"Не удалось скопировать ссылку",variant:"destructive"})}},x=e.jsxs(O,{variant:"outline",size:"sm",className:"text-xs sm:text-sm",children:[e.jsx(Ne,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Добавить в календарь"})]});return e.jsxs(Se,{open:s,onOpenChange:n,children:[e.jsx(As,{asChild:!0,children:t||x}),e.jsxs(Ee,{className:"sm:max-w-md",children:[e.jsxs(Ie,{children:[e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-primary"}),"Добавьте сессии себе в календарь"]}),e.jsx(Yt,{children:"Создайте ссылку и добавьте её в календарь."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Google Календарь"}),e.jsx("p",{className:"text-muted-foreground",children:"Меню «Другие календари» — «Добавить по URL»"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Apple Календарь"}),e.jsx("p",{className:"text-muted-foreground",children:"Меню «Файл» — «Подписка на новый календарь...»"})]})]}),r?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ps,{value:r,readOnly:!0,className:"font-mono text-xs"}),e.jsx(O,{variant:"outline",size:"icon",onClick:N,disabled:o,children:m?e.jsx(gs,{className:"h-4 w-4 text-green-500"}):e.jsx($s,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{variant:"outline",size:"sm",onClick:g,disabled:o,className:"flex-1",children:[e.jsx(ct,{className:`h-4 w-4 mr-2 ${o?"animate-spin":""}`}),"Обновить ссылку"]}),e.jsx(O,{variant:"outline",size:"sm",onClick:v,disabled:o,className:"text-destructive hover:text-destructive",children:e.jsx(Rs,{className:"h-4 w-4"})})]})]}):e.jsxs(O,{onClick:g,disabled:o,className:"w-full bg-primary hover:bg-primary/90",children:[o?e.jsx(ct,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Создать ссылку"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Календарь будет автоматически обновляться при изменении ваших сессий. Не передавайте эту ссылку третьим лицам."})]})]})]})}const _e="waves_onboarding_checklist",tn=[{id:"pay_licenses",title:"Оплатить лицензию",description:"Приобретите лицензию для начала работы",autoCheck:!0,link:"/cabinet/licenses",linkText:"Открыть"},{id:"order_device",title:"Заказать доставку устройства",description:"Оформите заказ на устройство нейрофидбэка",autoCheck:!0,link:"/cabinet/device",linkText:"Открыть"},{id:"learn_neurofeedback",title:"Познакомиться с методом нейрофидбэка",description:"Узнайте, как работает технология",link:"https://waves.ai/neurofeedback",linkText:"Открыть"},{id:"fill_profiles",title:"Заполнить профили участников",description:"Добавьте информацию о себе и членах семьи",autoCheck:!0,link:"/add-family-member",linkText:"Создать нового"},{id:"set_training_goals",title:"Настроить цели тренировок",description:"Выберите цели для каждого участника",autoCheck:!1,link:"/cabinet/goals",linkText:"Открыть"},{id:"download_app",title:"Скачать мобильное приложение",description:"Установите приложение Waves на телефон",link:"https://waves.ai/app",linkText:"Скачать",requiresDevice:!0},{id:"bind_licenses",title:"Привязать лицензии к участнику и устройству",description:"Настройте привязку лицензий к участникам и устройству",link:"/cabinet/licenses",linkText:"Открыть",requiresDevice:!0},{id:"test_device",title:"Подключить и протестировать устройство",description:"Убедитесь, что устройство работает корректно",link:"/cabinet/device",linkText:"Открыть",requiresDevice:!0},{id:"complete_tutorial",title:"Пройти инструктаж в мобильном приложении",description:"Завершите обучение в приложении",requiresDevice:!0}];function Mt(){try{const t=localStorage.getItem("waves_licenses");if(!t)return!1;const s=JSON.parse(t);return!Array.isArray(s)||s.length===0?!1:s.some(n=>n.status==="active")}catch{return!1}}function Ot(t){if(!t)return!1;try{return localStorage.getItem(`waves_device_${t}`)!==null}catch{return!1}}function zt(t){if(!t)return!1;try{const s=localStorage.getItem(`waves_device_${t}`);if(!s)return!1;const n=JSON.parse(s);return(n==null?void 0:n.status)==="delivered"||(n==null?void 0:n.status)==="setup_pending"||(n==null?void 0:n.status)==="setup_complete"}catch{return!1}}function sn(t={}){const{user:s}=mt(),{profilesCount:n=0}=t,[o,c]=j.useState({hasLicense:t.hasLicense??Mt(),hasDevice:t.hasDevice??Ot(s==null?void 0:s.id),isDeviceDelivered:zt(s==null?void 0:s.id)});j.useEffect(()=>{const h=()=>{c({hasLicense:t.hasLicense??Mt(),hasDevice:t.hasDevice??Ot(s==null?void 0:s.id),isDeviceDelivered:zt(s==null?void 0:s.id)})};h();const d=y=>{var S,A;((S=y.key)!=null&&S.includes("waves_licenses")||(A=y.key)!=null&&A.includes("waves_device"))&&h()};window.addEventListener("storage",d);const f=setInterval(h,2e3);return()=>{window.removeEventListener("storage",d),clearInterval(f)}},[s==null?void 0:s.id,t.hasLicense,t.hasDevice]);const[r,i]=j.useState(()=>{if(typeof window>"u")return{items:{}};try{const h=localStorage.getItem(`${_e}_${(s==null?void 0:s.id)||"guest"}`);if(h)return JSON.parse(h)}catch(h){console.error("Error loading checklist state:",h)}return{items:{}}});j.useEffect(()=>{if(!(s!=null&&s.id))return;(async()=>{try{const{data:d,error:f}=await K.from("users").select("onboarding_checklist").eq("id",s.id).single();if(f&&f.code!=="PGRST116"){ue.error("Error loading checklist from DB:",f);const y=localStorage.getItem(`${_e}_${s.id}`);y&&i(JSON.parse(y));return}if(d!=null&&d.onboarding_checklist)i(d.onboarding_checklist),localStorage.setItem(`${_e}_${s.id}`,JSON.stringify(d.onboarding_checklist));else{const y=localStorage.getItem(`${_e}_${s.id}`);if(y){const S=JSON.parse(y);i(S),await K.from("users").update({onboarding_checklist:S}).eq("id",s.id)}else i({items:{}})}}catch(d){ue.error("Error loading checklist state:",d);const f=localStorage.getItem(`${_e}_${s.id}`);f&&i(JSON.parse(f))}})()},[s==null?void 0:s.id]),j.useEffect(()=>{if(!(s!=null&&s.id))return;const d=setTimeout(async()=>{try{localStorage.setItem(`${_e}_${s.id}`,JSON.stringify(r));const{error:f}=await K.from("users").update({onboarding_checklist:r}).eq("id",s.id);f&&ue.error("Error saving checklist to DB:",f)}catch(f){ue.error("Error saving checklist state:",f)}},500);return()=>clearTimeout(d)},[r,s==null?void 0:s.id]);const m=j.useMemo(()=>tn.map(h=>{let d=r.items[h.id]||!1;return h.id==="pay_licenses"&&h.autoCheck&&(d=o.hasLicense),h.id==="order_device"&&h.autoCheck&&(d=o.hasDevice),h.id==="fill_profiles"&&h.autoCheck&&(d=n>=1),{...h,completed:d,disabled:h.requiresDevice&&!o.isDeviceDelivered}}),[r.items,n,o]),u=j.useMemo(()=>{const h=m.filter(y=>y.completed).length,d=m.length,f=Math.round(h/d*100);return{completed:h,total:d,percentage:f}},[m]),l=u.completed===u.total,b=!!r.dismissedAt,g=j.useCallback((h,d=!0)=>{i(f=>({...f,items:{...f.items,[h]:d}}))},[]),v=j.useCallback(h=>{i(d=>({...d,items:{...d.items,[h]:!d.items[h]}}))},[]),N=j.useCallback(()=>{i(h=>({...h,dismissedAt:new Date().toISOString()}))},[]),x=j.useCallback(()=>{i(h=>({...h,dismissedAt:void 0}))},[]),p=j.useCallback(()=>{i({items:{}})},[]);return{items:m,progress:u,isCompleted:l,isDismissed:b,markCompleted:g,toggleItem:v,dismiss:N,restore:x,reset:p}}function nn({profilesCount:t=0,className:s}){const n=Wt(),{items:o,progress:c,isCompleted:r,isDismissed:i,toggleItem:m,dismiss:u,restore:l,markCompleted:b}=sn({profilesCount:t}),[g,v]=j.useState(!0),[N,x]=j.useState(!1),[p,h]=j.useState(!1);if(j.useEffect(()=>{i&&!r&&l()},[i,r,l]),j.useEffect(()=>{r&&!i&&h(!0)},[r,i]),i)return null;const d=o.findIndex(y=>!y.completed),f=d!==-1?o[d]:null;return e.jsx("div",{className:ge("transition-all duration-500",N&&"opacity-0 scale-95 -translate-y-4",s),children:e.jsxs(we,{className:"bg-white overflow-hidden border-0",children:[e.jsxs("div",{className:"p-4 sm:p-6 cursor-pointer",onClick:()=>v(!g),children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Ce,{size:"xl",className:"truncate",children:p?"Отлично! Все готово":"С чего начать?"}),p&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:"Вы выполнили все шаги для начала работы"})]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-coral to-coral-light transition-all duration-500",style:{width:`${c.percentage}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[c.percentage,"%"]})]}),r&&e.jsx(O,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-foreground",onClick:y=>{y.stopPropagation(),u()},children:e.jsx(lt,{className:"h-4 w-4"})}),e.jsx(O,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-foreground",onClick:y=>{y.stopPropagation(),v(!g)},children:g?e.jsx(vs,{className:"h-4 w-4"}):e.jsx(js,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"sm:hidden mt-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-coral to-coral-light transition-all duration-500",style:{width:`${c.percentage}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[c.percentage,"%"]})]})})]}),e.jsx("div",{className:ge("overflow-hidden transition-all duration-300",g?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"),children:e.jsx("div",{className:"px-4 sm:px-6 pb-4 sm:pb-6 space-y-2",children:o.map((y,S)=>e.jsx(rn,{item:y,index:S,isCurrent:(f==null?void 0:f.id)===y.id,onToggle:()=>!y.autoCheck&&m(y.id),onNavigate:A=>{const L=o.find(E=>E.id==="fill_profiles");L&&A===L.link&&t===0?n("/profile"):n(A)},onMarkCompleted:A=>b(A,!0)},y.id))})})]})})}function rn({item:t,index:s,isCurrent:n,onToggle:o,onNavigate:c,onMarkCompleted:r}){var N;const i=!t.autoCheck,m=(N=t.link)==null?void 0:N.startsWith("/"),[u,l]=j.useState(!1),b=j.useRef(null),g=t.id==="learn_neurofeedback",v=g?"https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1&origin="+encodeURIComponent(window.location.origin):null;return j.useEffect(()=>{if(!u||!g)return;let x=null,p=null;const h={value:!1},d=()=>window.YT&&window.YT.Player?Promise.resolve():new Promise(y=>{var D;if(document.querySelector('script[src="https://www.youtube.com/iframe_api"]')){const k=setInterval(()=>{window.YT&&window.YT.Player&&(clearInterval(k),y())},100);return}const A=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{A&&A(),y()};const L=document.createElement("script");L.src="https://www.youtube.com/iframe_api",L.async=!0;const E=document.getElementsByTagName("script")[0];(D=E.parentNode)==null||D.insertBefore(L,E)});return(async()=>{try{await d(),p=setInterval(()=>{if(b.current&&window.YT&&window.YT.Player){clearInterval(p);try{x=new window.YT.Player(b.current,{events:{onStateChange:y=>{if(y.data===0&&!h.value)try{const S=x.getCurrentTime(),A=x.getDuration();A>0&&S>=A-1&&(h.value=!0,r(t.id),setTimeout(()=>{l(!1)},1e3))}catch{h.value=!0,r(t.id),setTimeout(()=>{l(!1)},1e3)}},onReady:()=>{},onError:y=>{console.error("YouTube player error:",y)}}})}catch(y){console.error("Error initializing YouTube player:",y)}}},100)}catch(y){console.error("Error loading YouTube API:",y)}})(),()=>{if(p&&clearInterval(p),x&&typeof x.destroy=="function")try{x.destroy()}catch(y){console.error("Error destroying YouTube player:",y)}}},[u,g,t.id,r]),e.jsxs("div",{className:ge("flex items-start gap-3 p-3 rounded-xl transition-all duration-200",n&&!t.completed&&!t.disabled&&"bg-white/50",t.completed&&"opacity-60",t.disabled&&"opacity-50 cursor-not-allowed",(i||t.completed)&&!t.disabled&&"cursor-pointer hover:bg-white/50"),onClick:!t.disabled&&(i?o:t.completed?()=>o():void 0),children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:t.completed?e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center shadow-sm",style:{background:"linear-gradient(108deg, rgba(34, 197, 94, 0.25) 0%, rgba(34, 197, 94, 0.14) 100%)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(34, 197, 94, 0.3)"},children:e.jsx(Vt,{className:"h-4 w-4 text-green-600"})}):e.jsx("div",{className:ge("w-6 h-6 rounded-full border flex items-center justify-center transition-colors",n&&"border-coral"),style:{background:n?"linear-gradient(108deg, rgba(255, 138, 91, 0.25) 0%, rgba(255, 138, 91, 0.14) 100%)":"linear-gradient(108deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.14) 100%)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:n?"1px solid rgba(255, 138, 91, 0.3)":"1px solid rgba(0, 0, 0, 0.1)"},children:e.jsx("span",{className:"text-xs font-medium text-foreground",children:s+1})})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:ge("transition-all",t.completed&&"line-through text-muted-foreground",t.disabled&&"opacity-50"),children:t.title}),t.disabled&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Откроется после получения устройства"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:t.link&&!t.completed&&!t.disabled&&e.jsxs(e.Fragment,{children:[e.jsxs(O,{variant:"ghost",size:"sm",className:"h-7 px-2 text-coral hover:text-coral hover:bg-coral/10",onClick:x=>{x.stopPropagation(),g?l(!0):m?c(t.link):window.open(t.link,"_blank","noopener,noreferrer")},children:[e.jsx("span",{className:"text-xs mr-1",children:t.linkText||"Открыть"}),m?e.jsx(Ht,{className:"h-3 w-3"}):e.jsx(Bs,{className:"h-3 w-3"})]}),g&&e.jsx(Se,{open:u,onOpenChange:l,children:e.jsxs(Ee,{className:"max-w-4xl w-[90vw] p-0",children:[e.jsx(Ie,{className:"px-6 pt-6",children:e.jsx(Pe,{children:t.title})}),e.jsx("div",{className:"px-6 pb-6",children:v&&e.jsx("div",{className:"relative w-full",style:{paddingBottom:"56.25%"},children:e.jsx("iframe",{ref:b,className:"absolute top-0 left-0 w-full h-full rounded-lg",src:v,title:t.title,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})})]})})]})})]})})]})}function an(t){return Object.prototype.toString.call(t)==="[object Object]"}function Ft(t){return an(t)||Array.isArray(t)}function on(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function ht(t,s){const n=Object.keys(t),o=Object.keys(s);if(n.length!==o.length)return!1;const c=JSON.stringify(Object.keys(t.breakpoints||{})),r=JSON.stringify(Object.keys(s.breakpoints||{}));return c!==r?!1:n.every(i=>{const m=t[i],u=s[i];return typeof m=="function"?`${m}`==`${u}`:!Ft(m)||!Ft(u)?m===u:ht(m,u)})}function $t(t){return t.concat().sort((s,n)=>s.name>n.name?1:-1).map(s=>s.options)}function cn(t,s){if(t.length!==s.length)return!1;const n=$t(t),o=$t(s);return n.every((c,r)=>{const i=o[r];return ht(c,i)})}function xt(t){return typeof t=="number"}function ut(t){return typeof t=="string"}function Ge(t){return typeof t=="boolean"}function Rt(t){return Object.prototype.toString.call(t)==="[object Object]"}function V(t){return Math.abs(t)}function pt(t){return Math.sign(t)}function Te(t,s){return V(t-s)}function ln(t,s){if(t===0||s===0||V(t)<=V(s))return 0;const n=Te(V(t),V(s));return V(n/t)}function dn(t){return Math.round(t*100)/100}function Me(t){return Oe(t).map(Number)}function fe(t){return t[Fe(t)]}function Fe(t){return Math.max(0,t.length-1)}function gt(t,s){return s===Fe(t)}function Bt(t,s=0){return Array.from(Array(t),(n,o)=>s+o)}function Oe(t){return Object.keys(t)}function Jt(t,s){return[t,s].reduce((n,o)=>(Oe(o).forEach(c=>{const r=n[c],i=o[c],m=Rt(r)&&Rt(i);n[c]=m?Jt(r,i):i}),n),{})}function ft(t,s){return typeof s.MouseEvent<"u"&&t instanceof s.MouseEvent}function un(t,s){const n={start:o,center:c,end:r};function o(){return 0}function c(u){return r(u)/2}function r(u){return s-u}function i(u,l){return ut(t)?n[t](u):t(s,u,l)}return{measure:i}}function ze(){let t=[];function s(c,r,i,m={passive:!0}){let u;if("addEventListener"in c)c.addEventListener(r,i,m),u=()=>c.removeEventListener(r,i,m);else{const l=c;l.addListener(i),u=()=>l.removeListener(i)}return t.push(u),o}function n(){t=t.filter(c=>c())}const o={add:s,clear:n};return o}function fn(t,s,n,o){const c=ze(),r=1e3/60;let i=null,m=0,u=0;function l(){c.add(t,"visibilitychange",()=>{t.hidden&&x()})}function b(){N(),c.clear()}function g(h){if(!u)return;i||(i=h,n(),n());const d=h-i;for(i=h,m+=d;m>=r;)n(),m-=r;const f=m/r;o(f),u&&(u=s.requestAnimationFrame(g))}function v(){u||(u=s.requestAnimationFrame(g))}function N(){s.cancelAnimationFrame(u),i=null,m=0,u=0}function x(){i=null,m=0}return{init:l,destroy:b,start:v,stop:N,update:n,render:o}}function mn(t,s){const n=s==="rtl",o=t==="y",c=o?"y":"x",r=o?"x":"y",i=!o&&n?-1:1,m=b(),u=g();function l(x){const{height:p,width:h}=x;return o?p:h}function b(){return o?"top":n?"right":"left"}function g(){return o?"bottom":n?"left":"right"}function v(x){return x*i}return{scroll:c,cross:r,startEdge:m,endEdge:u,measureSize:l,direction:v}}function ke(t=0,s=0){const n=V(t-s);function o(l){return l<t}function c(l){return l>s}function r(l){return o(l)||c(l)}function i(l){return r(l)?o(l)?t:s:l}function m(l){return n?l-n*Math.ceil((l-s)/n):l}return{length:n,max:s,min:t,constrain:i,reachedAny:r,reachedMax:c,reachedMin:o,removeOffset:m}}function Kt(t,s,n){const{constrain:o}=ke(0,t),c=t+1;let r=i(s);function i(v){return n?V((c+v)%c):o(v)}function m(){return r}function u(v){return r=i(v),g}function l(v){return b().set(m()+v)}function b(){return Kt(t,m(),n)}const g={get:m,set:u,add:l,clone:b};return g}function hn(t,s,n,o,c,r,i,m,u,l,b,g,v,N,x,p,h,d,f){const{cross:y,direction:S}=t,A=["INPUT","SELECT","TEXTAREA"],L={passive:!1},E=ze(),D=ze(),k=ke(50,225).constrain(N.measure(20)),F={mouse:300,touch:400},w={mouse:500,touch:600},I=x?43:25;let $=!1,H=0,Y=0,ae=!1,me=!1,te=!1,oe=!1;function re(_){if(!f)return;function z(G){(Ge(f)||f(_,G))&&ye(G)}const B=s;E.add(B,"dragstart",G=>G.preventDefault(),L).add(B,"touchmove",()=>{},L).add(B,"touchend",()=>{}).add(B,"touchstart",z).add(B,"mousedown",z).add(B,"touchcancel",W).add(B,"contextmenu",W).add(B,"click",xe,!0)}function X(){E.clear(),D.clear()}function je(){const _=oe?n:s;D.add(_,"touchmove",Q,L).add(_,"touchend",W).add(_,"mousemove",Q,L).add(_,"mouseup",W)}function he(_){const z=_.nodeName||"";return A.includes(z)}function ce(){return(x?w:F)[oe?"mouse":"touch"]}function U(_,z){const B=g.add(pt(_)*-1),G=b.byDistance(_,!x).distance;return x||V(_)<k?G:h&&z?G*.5:b.byIndex(B.get(),0).distance}function ye(_){const z=ft(_,o);oe=z,te=x&&z&&!_.buttons&&$,$=Te(c.get(),i.get())>=2,!(z&&_.button!==0)&&(he(_.target)||(ae=!0,r.pointerDown(_),l.useFriction(0).useDuration(0),c.set(i),je(),H=r.readPoint(_),Y=r.readPoint(_,y),v.emit("pointerDown")))}function Q(_){if(!ft(_,o)&&_.touches.length>=2)return W(_);const B=r.readPoint(_),G=r.readPoint(_,y),ne=Te(B,H),le=Te(G,Y);if(!me&&!oe&&(!_.cancelable||(me=ne>le,!me)))return W(_);const Z=r.pointerMove(_);ne>p&&(te=!0),l.useFriction(.3).useDuration(.75),m.start(),c.add(S(Z)),_.preventDefault()}function W(_){const B=b.byDistance(0,!1).index!==g.get(),G=r.pointerUp(_)*ce(),ne=U(S(G),B),le=ln(G,ne),Z=I-10*le,de=d+le/50;me=!1,ae=!1,D.clear(),l.useDuration(Z).useFriction(de),u.distance(ne,!x),oe=!1,v.emit("pointerUp")}function xe(_){te&&(_.stopPropagation(),_.preventDefault(),te=!1)}function se(){return ae}return{init:re,destroy:X,pointerDown:se}}function xn(t,s){let o,c;function r(g){return g.timeStamp}function i(g,v){const x=`client${(v||t.scroll)==="x"?"X":"Y"}`;return(ft(g,s)?g:g.touches[0])[x]}function m(g){return o=g,c=g,i(g)}function u(g){const v=i(g)-i(c),N=r(g)-r(o)>170;return c=g,N&&(o=g),v}function l(g){if(!o||!c)return 0;const v=i(c)-i(o),N=r(g)-r(o),x=r(g)-r(c)>170,p=v/N;return N&&!x&&V(p)>.1?p:0}return{pointerDown:m,pointerMove:u,pointerUp:l,readPoint:i}}function pn(){function t(n){const{offsetTop:o,offsetLeft:c,offsetWidth:r,offsetHeight:i}=n;return{top:o,right:c+r,bottom:o+i,left:c,width:r,height:i}}return{measure:t}}function gn(t){function s(o){return t*(o/100)}return{measure:s}}function vn(t,s,n,o,c,r,i){const m=[t].concat(o);let u,l,b=[],g=!1;function v(h){return c.measureSize(i.measure(h))}function N(h){if(!r)return;l=v(t),b=o.map(v);function d(f){for(const y of f){if(g)return;const S=y.target===t,A=o.indexOf(y.target),L=S?l:b[A],E=v(S?t:o[A]);if(V(E-L)>=.5){h.reInit(),s.emit("resize");break}}}u=new ResizeObserver(f=>{(Ge(r)||r(h,f))&&d(f)}),n.requestAnimationFrame(()=>{m.forEach(f=>u.observe(f))})}function x(){g=!0,u&&u.disconnect()}return{init:N,destroy:x}}function jn(t,s,n,o,c,r){let i=0,m=0,u=c,l=r,b=t.get(),g=0;function v(){const L=o.get()-t.get(),E=!u;let D=0;return E?(i=0,n.set(o),t.set(o),D=L):(n.set(t),i+=L/u,i*=l,b+=i,t.add(i),D=b-g),m=pt(D),g=b,A}function N(){const L=o.get()-s.get();return V(L)<.001}function x(){return u}function p(){return m}function h(){return i}function d(){return y(c)}function f(){return S(r)}function y(L){return u=L,A}function S(L){return l=L,A}const A={direction:p,duration:x,velocity:h,seek:v,settled:N,useBaseFriction:f,useBaseDuration:d,useFriction:S,useDuration:y};return A}function yn(t,s,n,o,c){const r=c.measure(10),i=c.measure(50),m=ke(.1,.99);let u=!1;function l(){return!(u||!t.reachedAny(n.get())||!t.reachedAny(s.get()))}function b(N){if(!l())return;const x=t.reachedMin(s.get())?"min":"max",p=V(t[x]-s.get()),h=n.get()-s.get(),d=m.constrain(p/i);n.subtract(h*d),!N&&V(h)<r&&(n.set(t.constrain(n.get())),o.useDuration(25).useBaseFriction())}function g(N){u=!N}return{shouldConstrain:l,constrain:b,toggleActive:g}}function bn(t,s,n,o,c){const r=ke(-s+t,0),i=g(),m=b(),u=v();function l(x,p){return Te(x,p)<=1}function b(){const x=i[0],p=fe(i),h=i.lastIndexOf(x),d=i.indexOf(p)+1;return ke(h,d)}function g(){return n.map((x,p)=>{const{min:h,max:d}=r,f=r.constrain(x),y=!p,S=gt(n,p);return y?d:S||l(h,f)?h:l(d,f)?d:f}).map(x=>parseFloat(x.toFixed(3)))}function v(){if(s<=t+c)return[r.max];if(o==="keepSnaps")return i;const{min:x,max:p}=m;return i.slice(x,p)}return{snapsContained:u,scrollContainLimit:m}}function wn(t,s,n){const o=s[0],c=n?o-t:fe(s);return{limit:ke(c,o)}}function Nn(t,s,n,o){const r=s.min+.1,i=s.max+.1,{reachedMin:m,reachedMax:u}=ke(r,i);function l(v){return v===1?u(n.get()):v===-1?m(n.get()):!1}function b(v){if(!l(v))return;const N=t*(v*-1);o.forEach(x=>x.add(N))}return{loop:b}}function kn(t){const{max:s,length:n}=t;function o(r){const i=r-s;return n?i/-n:0}return{get:o}}function _n(t,s,n,o,c){const{startEdge:r,endEdge:i}=t,{groupSlides:m}=c,u=g().map(s.measure),l=v(),b=N();function g(){return m(o).map(p=>fe(p)[i]-p[0][r]).map(V)}function v(){return o.map(p=>n[r]-p[r]).map(p=>-V(p))}function N(){return m(l).map(p=>p[0]).map((p,h)=>p+u[h])}return{snaps:l,snapsAligned:b}}function Cn(t,s,n,o,c,r){const{groupSlides:i}=c,{min:m,max:u}=o,l=b();function b(){const v=i(r),N=!t||s==="keepSnaps";return n.length===1?[r]:N?v:v.slice(m,u).map((x,p,h)=>{const d=!p,f=gt(h,p);if(d){const y=fe(h[0])+1;return Bt(y)}if(f){const y=Fe(r)-fe(h)[0]+1;return Bt(y,fe(h)[0])}return x})}return{slideRegistry:l}}function Sn(t,s,n,o,c){const{reachedAny:r,removeOffset:i,constrain:m}=o;function u(x){return x.concat().sort((p,h)=>V(p)-V(h))[0]}function l(x){const p=t?i(x):m(x),h=s.map((f,y)=>({diff:b(f-p,0),index:y})).sort((f,y)=>V(f.diff)-V(y.diff)),{index:d}=h[0];return{index:d,distance:p}}function b(x,p){const h=[x,x+n,x-n];if(!t)return x;if(!p)return u(h);const d=h.filter(f=>pt(f)===p);return d.length?u(d):fe(h)-n}function g(x,p){const h=s[x]-c.get(),d=b(h,p);return{index:x,distance:d}}function v(x,p){const h=c.get()+x,{index:d,distance:f}=l(h),y=!t&&r(h);if(!p||y)return{index:d,distance:x};const S=s[d]-f,A=x+b(S,0);return{index:d,distance:A}}return{byDistance:v,byIndex:g,shortcut:b}}function En(t,s,n,o,c,r,i){function m(g){const v=g.distance,N=g.index!==s.get();r.add(v),v&&(o.duration()?t.start():(t.update(),t.render(1),t.update())),N&&(n.set(s.get()),s.set(g.index),i.emit("select"))}function u(g,v){const N=c.byDistance(g,v);m(N)}function l(g,v){const N=s.clone().set(g),x=c.byIndex(N.get(),v);m(x)}return{distance:u,index:l}}function An(t,s,n,o,c,r,i,m){const u={passive:!0,capture:!0};let l=0;function b(N){if(!m)return;function x(p){if(new Date().getTime()-l>10)return;i.emit("slideFocusStart"),t.scrollLeft=0;const f=n.findIndex(y=>y.includes(p));xt(f)&&(c.useDuration(0),o.index(f,0),i.emit("slideFocus"))}r.add(document,"keydown",g,!1),s.forEach((p,h)=>{r.add(p,"focus",d=>{(Ge(m)||m(N,d))&&x(h)},u)})}function g(N){N.code==="Tab"&&(l=new Date().getTime())}return{init:b}}function De(t){let s=t;function n(){return s}function o(u){s=i(u)}function c(u){s+=i(u)}function r(u){s-=i(u)}function i(u){return xt(u)?u:u.get()}return{get:n,set:o,add:c,subtract:r}}function Qt(t,s){const n=t.scroll==="x"?i:m,o=s.style;let c=null,r=!1;function i(v){return`translate3d(${v}px,0px,0px)`}function m(v){return`translate3d(0px,${v}px,0px)`}function u(v){if(r)return;const N=dn(t.direction(v));N!==c&&(o.transform=n(N),c=N)}function l(v){r=!v}function b(){r||(o.transform="",s.getAttribute("style")||s.removeAttribute("style"))}return{clear:b,to:u,toggleActive:l}}function Dn(t,s,n,o,c,r,i,m,u){const b=Me(c),g=Me(c).reverse(),v=d().concat(f());function N(E,D){return E.reduce((k,F)=>k-c[F],D)}function x(E,D){return E.reduce((k,F)=>N(k,D)>0?k.concat([F]):k,[])}function p(E){return r.map((D,k)=>({start:D-o[k]+.5+E,end:D+s-.5+E}))}function h(E,D,k){const F=p(D);return E.map(w=>{const I=k?0:-n,$=k?n:0,H=k?"end":"start",Y=F[w][H];return{index:w,loopPoint:Y,slideLocation:De(-1),translate:Qt(t,u[w]),target:()=>m.get()>Y?I:$}})}function d(){const E=i[0],D=x(g,E);return h(D,n,!1)}function f(){const E=s-i[0]-1,D=x(b,E);return h(D,-n,!0)}function y(){return v.every(({index:E})=>{const D=b.filter(k=>k!==E);return N(D,s)<=.1})}function S(){v.forEach(E=>{const{target:D,translate:k,slideLocation:F}=E,w=D();w!==F.get()&&(k.to(w),F.set(w))})}function A(){v.forEach(E=>E.translate.clear())}return{canLoop:y,clear:A,loop:S,loopPoints:v}}function Tn(t,s,n){let o,c=!1;function r(u){if(!n)return;function l(b){for(const g of b)if(g.type==="childList"){u.reInit(),s.emit("slidesChanged");break}}o=new MutationObserver(b=>{c||(Ge(n)||n(u,b))&&l(b)}),o.observe(t,{childList:!0})}function i(){o&&o.disconnect(),c=!0}return{init:r,destroy:i}}function Ln(t,s,n,o){const c={};let r=null,i=null,m,u=!1;function l(){m=new IntersectionObserver(x=>{u||(x.forEach(p=>{const h=s.indexOf(p.target);c[h]=p}),r=null,i=null,n.emit("slidesInView"))},{root:t.parentElement,threshold:o}),s.forEach(x=>m.observe(x))}function b(){m&&m.disconnect(),u=!0}function g(x){return Oe(c).reduce((p,h)=>{const d=parseInt(h),{isIntersecting:f}=c[d];return(x&&f||!x&&!f)&&p.push(d),p},[])}function v(x=!0){if(x&&r)return r;if(!x&&i)return i;const p=g(x);return x&&(r=p),x||(i=p),p}return{init:l,destroy:b,get:v}}function In(t,s,n,o,c,r){const{measureSize:i,startEdge:m,endEdge:u}=t,l=n[0]&&c,b=x(),g=p(),v=n.map(i),N=h();function x(){if(!l)return 0;const f=n[0];return V(s[m]-f[m])}function p(){if(!l)return 0;const f=r.getComputedStyle(fe(o));return parseFloat(f.getPropertyValue(`margin-${u}`))}function h(){return n.map((f,y,S)=>{const A=!y,L=gt(S,y);return A?v[y]+b:L?v[y]+g:S[y+1][m]-f[m]}).map(V)}return{slideSizes:v,slideSizesWithGaps:N,startGap:b,endGap:g}}function Pn(t,s,n,o,c,r,i,m,u){const{startEdge:l,endEdge:b,direction:g}=t,v=xt(n);function N(d,f){return Me(d).filter(y=>y%f===0).map(y=>d.slice(y,y+f))}function x(d){return d.length?Me(d).reduce((f,y,S)=>{const A=fe(f)||0,L=A===0,E=y===Fe(d),D=c[l]-r[A][l],k=c[l]-r[y][b],F=!o&&L?g(i):0,w=!o&&E?g(m):0,I=V(k-w-(D+F));return S&&I>s+u&&f.push(y),E&&f.push(d.length),f},[]).map((f,y,S)=>{const A=Math.max(S[y-1]||0);return d.slice(A,f)}):[]}function p(d){return v?N(d,n):x(d)}return{groupSlides:p}}function Mn(t,s,n,o,c,r,i){const{align:m,axis:u,direction:l,startIndex:b,loop:g,duration:v,dragFree:N,dragThreshold:x,inViewThreshold:p,slidesToScroll:h,skipSnaps:d,containScroll:f,watchResize:y,watchSlides:S,watchDrag:A,watchFocus:L}=r,E=2,D=pn(),k=D.measure(s),F=n.map(D.measure),w=mn(u,l),I=w.measureSize(k),$=gn(I),H=un(m,I),Y=!g&&!!f,ae=g||!!f,{slideSizes:me,slideSizesWithGaps:te,startGap:oe,endGap:re}=In(w,k,F,n,ae,c),X=Pn(w,I,h,g,k,F,oe,re,E),{snaps:je,snapsAligned:he}=_n(w,H,k,F,X),ce=-fe(je)+fe(te),{snapsContained:U,scrollContainLimit:ye}=bn(I,ce,he,f,E),Q=Y?U:he,{limit:W}=wn(ce,Q,g),xe=Kt(Fe(Q),b,g),se=xe.clone(),R=Me(n),_=({dragHandler:q,scrollBody:ie,scrollBounds:Je,options:{loop:Be}})=>{Be||Je.constrain(q.pointerDown()),ie.seek()},z=({scrollBody:q,translate:ie,location:Je,offsetLocation:Be,previousLocation:rs,scrollLooper:is,slideLooper:as,dragHandler:os,animation:cs,eventHandler:jt,scrollBounds:ls,options:{loop:yt}},bt)=>{const wt=q.settled(),ds=!ls.shouldConstrain(),Nt=yt?wt:wt&&ds,kt=Nt&&!os.pointerDown();kt&&cs.stop();const us=Je.get()*bt+rs.get()*(1-bt);Be.set(us),yt&&(is.loop(q.direction()),as.loop()),ie.to(Be.get()),kt&&jt.emit("settle"),Nt||jt.emit("scroll")},B=fn(o,c,()=>_(Re),q=>z(Re,q)),G=.68,ne=Q[xe.get()],le=De(ne),Z=De(ne),de=De(ne),J=De(ne),a=jn(le,de,Z,J,v,G),C=Sn(g,Q,ce,W,J),T=En(B,xe,se,a,C,J,i),P=kn(W),M=ze(),ee=Ln(s,n,i,p),{slideRegistry:be}=Cn(Y,f,Q,ye,X,R),$e=An(t,n,be,T,a,M,i,L),Re={ownerDocument:o,ownerWindow:c,eventHandler:i,containerRect:k,slideRects:F,animation:B,axis:w,dragHandler:hn(w,t,o,c,J,xn(w,c),le,B,T,a,C,xe,i,$,N,x,d,G,A),eventStore:M,percentOfView:$,index:xe,indexPrevious:se,limit:W,location:le,offsetLocation:de,previousLocation:Z,options:r,resizeHandler:vn(s,i,c,n,w,y,D),scrollBody:a,scrollBounds:yn(W,de,J,a,$),scrollLooper:Nn(ce,W,de,[le,de,Z,J]),scrollProgress:P,scrollSnapList:Q.map(P.get),scrollSnaps:Q,scrollTarget:C,scrollTo:T,slideLooper:Dn(w,I,ce,me,te,je,Q,de,n),slideFocus:$e,slidesHandler:Tn(s,i,S),slidesInView:ee,slideIndexes:R,slideRegistry:be,slidesToScroll:X,target:J,translate:Qt(w,s)};return Re}function On(){let t={},s;function n(l){s=l}function o(l){return t[l]||[]}function c(l){return o(l).forEach(b=>b(s,l)),u}function r(l,b){return t[l]=o(l).concat([b]),u}function i(l,b){return t[l]=o(l).filter(g=>g!==b),u}function m(){t={}}const u={init:n,emit:c,off:i,on:r,clear:m};return u}const zn={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function Fn(t){function s(r,i){return Jt(r,i||{})}function n(r){const i=r.breakpoints||{},m=Oe(i).filter(u=>t.matchMedia(u).matches).map(u=>i[u]).reduce((u,l)=>s(u,l),{});return s(r,m)}function o(r){return r.map(i=>Oe(i.breakpoints||{})).reduce((i,m)=>i.concat(m),[]).map(t.matchMedia)}return{mergeOptions:s,optionsAtMedia:n,optionsMediaQueries:o}}function $n(t){let s=[];function n(r,i){return s=i.filter(({options:m})=>t.optionsAtMedia(m).active!==!1),s.forEach(m=>m.init(r,t)),i.reduce((m,u)=>Object.assign(m,{[u.name]:u}),{})}function o(){s=s.filter(r=>r.destroy())}return{init:n,destroy:o}}function Ye(t,s,n){const o=t.ownerDocument,c=o.defaultView,r=Fn(c),i=$n(r),m=ze(),u=On(),{mergeOptions:l,optionsAtMedia:b,optionsMediaQueries:g}=r,{on:v,off:N,emit:x}=u,p=w;let h=!1,d,f=l(zn,Ye.globalOptions),y=l(f),S=[],A,L,E;function D(){const{container:R,slides:_}=y;L=(ut(R)?t.querySelector(R):R)||t.children[0];const B=ut(_)?L.querySelectorAll(_):_;E=[].slice.call(B||L.children)}function k(R){const _=Mn(t,L,E,o,c,R,u);if(R.loop&&!_.slideLooper.canLoop()){const z=Object.assign({},R,{loop:!1});return k(z)}return _}function F(R,_){h||(f=l(f,R),y=b(f),S=_||S,D(),d=k(y),g([f,...S.map(({options:z})=>z)]).forEach(z=>m.add(z,"change",w)),y.active&&(d.translate.to(d.location.get()),d.animation.init(),d.slidesInView.init(),d.slideFocus.init(se),d.eventHandler.init(se),d.resizeHandler.init(se),d.slidesHandler.init(se),d.options.loop&&d.slideLooper.loop(),L.offsetParent&&E.length&&d.dragHandler.init(se),A=i.init(se,S)))}function w(R,_){const z=X();I(),F(l({startIndex:z},R),_),u.emit("reInit")}function I(){d.dragHandler.destroy(),d.eventStore.clear(),d.translate.clear(),d.slideLooper.clear(),d.resizeHandler.destroy(),d.slidesHandler.destroy(),d.slidesInView.destroy(),d.animation.destroy(),i.destroy(),m.clear()}function $(){h||(h=!0,m.clear(),I(),u.emit("destroy"),u.clear())}function H(R,_,z){!y.active||h||(d.scrollBody.useBaseFriction().useDuration(_===!0?0:y.duration),d.scrollTo.index(R,z||0))}function Y(R){const _=d.index.add(1).get();H(_,R,-1)}function ae(R){const _=d.index.add(-1).get();H(_,R,1)}function me(){return d.index.add(1).get()!==X()}function te(){return d.index.add(-1).get()!==X()}function oe(){return d.scrollSnapList}function re(){return d.scrollProgress.get(d.offsetLocation.get())}function X(){return d.index.get()}function je(){return d.indexPrevious.get()}function he(){return d.slidesInView.get()}function ce(){return d.slidesInView.get(!1)}function U(){return A}function ye(){return d}function Q(){return t}function W(){return L}function xe(){return E}const se={canScrollNext:me,canScrollPrev:te,containerNode:W,internalEngine:ye,destroy:$,off:N,on:v,emit:x,plugins:U,previousScrollSnap:je,reInit:p,rootNode:Q,scrollNext:Y,scrollPrev:ae,scrollProgress:re,scrollSnapList:oe,scrollTo:H,selectedScrollSnap:X,slideNodes:xe,slidesInView:he,slidesNotInView:ce};return F(s,n),setTimeout(()=>u.emit("init"),0),se}Ye.globalOptions=void 0;function vt(t={},s=[]){const n=j.useRef(t),o=j.useRef(s),[c,r]=j.useState(),[i,m]=j.useState(),u=j.useCallback(()=>{c&&c.reInit(n.current,o.current)},[c]);return j.useEffect(()=>{ht(n.current,t)||(n.current=t,u())},[t,u]),j.useEffect(()=>{cn(o.current,s)||(o.current=s,u())},[s,u]),j.useEffect(()=>{if(on()&&i){Ye.globalOptions=vt.globalOptions;const l=Ye(i,n.current,o.current);return r(l),()=>l.destroy()}else r(void 0)},[i,r]),[m,c]}vt.globalOptions=void 0;const Zt=j.createContext(null);function We(){const t=j.useContext(Zt);if(!t)throw new Error("useCarousel must be used within a <Carousel />");return t}const Xt=j.forwardRef(({orientation:t="horizontal",opts:s,setApi:n,plugins:o,className:c,children:r,...i},m)=>{const[u,l]=vt({...s,axis:t==="horizontal"?"x":"y"},o),[b,g]=j.useState(!1),[v,N]=j.useState(!1),x=j.useCallback(f=>{f&&(g(f.canScrollPrev()),N(f.canScrollNext()))},[]),p=j.useCallback(()=>{l==null||l.scrollPrev()},[l]),h=j.useCallback(()=>{l==null||l.scrollNext()},[l]),d=j.useCallback(f=>{f.key==="ArrowLeft"?(f.preventDefault(),p()):f.key==="ArrowRight"&&(f.preventDefault(),h())},[p,h]);return j.useEffect(()=>{!l||!n||n(l)},[l,n]),j.useEffect(()=>{if(l)return x(l),l.on("reInit",x),l.on("select",x),()=>{l==null||l.off("select",x)}},[l,x]),e.jsx(Zt.Provider,{value:{carouselRef:u,api:l,opts:s,orientation:t||((s==null?void 0:s.axis)==="y"?"vertical":"horizontal"),scrollPrev:p,scrollNext:h,canScrollPrev:b,canScrollNext:v},children:e.jsx("div",{ref:m,onKeyDownCapture:d,className:ge("relative",c),role:"region","aria-roledescription":"carousel",...i,children:r})})});Xt.displayName="Carousel";const es=j.forwardRef(({className:t,...s},n)=>{const{carouselRef:o,orientation:c}=We();return e.jsx("div",{ref:o,className:"overflow-hidden",children:e.jsx("div",{ref:n,className:ge("flex",c==="horizontal"?"-ml-4":"-mt-4 flex-col",t),...s})})});es.displayName="CarouselContent";const ts=j.forwardRef(({className:t,...s},n)=>{const{orientation:o}=We();return e.jsx("div",{ref:n,role:"group","aria-roledescription":"slide",className:ge("min-w-0 shrink-0 grow-0 basis-full",o==="horizontal"?"pl-4":"pt-4",t),...s})});ts.displayName="CarouselItem";const ss=j.forwardRef(({className:t,variant:s="outline",size:n="icon",...o},c)=>{const{orientation:r,scrollPrev:i,canScrollPrev:m}=We();return e.jsxs(O,{ref:c,variant:s,size:n,className:ge("absolute h-8 w-8 rounded-full",r==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!m,onClick:i,...o,children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Previous slide"})]})});ss.displayName="CarouselPrevious";const ns=j.forwardRef(({className:t,variant:s="outline",size:n="icon",...o},c)=>{const{orientation:r,scrollNext:i,canScrollNext:m}=We();return e.jsxs(O,{ref:c,variant:s,size:n,className:ge("absolute h-8 w-8 rounded-full",r==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!m,onClick:i,...o,children:[e.jsx(Us,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Next slide"})]})});ns.displayName="CarouselNext";function fr(){const t=Wt(),{user:s}=mt(),{setCurrentProfileId:n,setCurrentProfile:o}=bs(),c=Ss(),r=Vs(),[i,m]=j.useState(null),[u,l]=j.useState(0),[b,g]=j.useState(null),[v,N]=j.useState(null),[x,p]=j.useState(!1),[h,d]=j.useState(null),f=j.useRef(null),[y,S]=j.useState(!1),[A,L]=j.useState(!0),[E,D]=j.useState(0),{data:k,isLoading:F,error:w}=ws(),{data:I,isLoading:$,error:H}=Es();j.useEffect(()=>{ue.log("Dashboard data state:",{profiles:(k==null?void 0:k.length)||0,profilesLoading:F,profilesError:w==null?void 0:w.message,appointments:(I==null?void 0:I.length)||0,appointmentsLoading:$,appointmentsError:H==null?void 0:H.message,user:s==null?void 0:s.id})},[k,F,w,I,$,H,s]);const Y=j.useMemo(()=>!k||!Array.isArray(k)?[]:k.map(a=>a.id),[k]),{data:ae,isLoading:me}=At(Y,"checkup"),{data:te,isLoading:oe}=Dt(Y,"checkup"),re=j.useMemo(()=>{if(!k||!Array.isArray(k))return null;const a=k.find(C=>C.type==="parent");return(a==null?void 0:a.id)||null},[k]),{data:X,isLoading:je}=At(re?[re]:[],"parent"),{data:he,isLoading:ce}=Dt(re?[re]:[],"parent"),U=j.useMemo(()=>{if(!k||!Array.isArray(k))return[];const a=ae||{},C=te||{},T=X||{},P=he||{};return k.map(M=>M.type==="parent"?{...M,checkupAssessment:T[M.id]||null,activeCheckupAssessment:P[M.id]||null}:{...M,checkupAssessment:a[M.id]||null,activeCheckupAssessment:C[M.id]||null})},[k,ae,te,X,he]),ye=F&&!k,Q=me&&ae===void 0&&Y.length>0,W=oe&&te===void 0&&Y.length>0,R=ye||Q||W||je&&X===void 0&&re!==null||ce&&he===void 0&&re!==null;j.useEffect(()=>{async function a(){try{await K.rpc("update_appointment_statuses")}catch(C){console.error("Error updating appointment statuses:",C)}}a()},[]),j.useEffect(()=>{async function a(){try{const C=await Lt();l(C)}catch(C){console.error("Error loading unread count:",C)}}s!=null&&s.id&&a()},[s==null?void 0:s.id]),j.useEffect(()=>{if(!(s!=null&&s.id))return;const a=qs(s.id,async()=>{const C=await Lt();l(C)});return()=>a()},[s==null?void 0:s.id]),j.useEffect(()=>{async function a(){const C=await Pt();C&&(N(C),p(!0))}s!=null&&s.id&&a()},[s==null?void 0:s.id]);const _=j.useMemo(()=>{if(!k||!Array.isArray(k))return null;const a=k.find(C=>C.type==="parent");return(a==null?void 0:a.first_name)||null},[k]),z=j.useCallback(a=>({type:a.type==="partner"||a.type==="parent"?"parent":"child",gender:a.gender||"female"}),[]),B=j.useMemo(()=>I?I.filter(a=>a.status==="scheduled"||a.status==="in_progress"||a.status==="payment_pending"):[],[I]),G=j.useCallback(a=>{if(!a)return"Для меня (родитель)";const C=k==null?void 0:k.find(T=>T.id===a);return C?`${C.first_name}${C.last_name?` ${C.last_name}`:""}`:"Профиль не найден"},[k]),ne=async a=>{try{await c.mutateAsync(a),m(null)}catch{}},le=async a=>{try{await Cs(a),await r.invalidateQueries({queryKey:["profiles",s==null?void 0:s.id]}),d(null),pe.success("Член семьи удален")}catch(C){ue.error("Error deleting profile:",C),pe.error("Ошибка при удалении члена семьи")}},Z=j.useCallback(()=>{if(!f.current)return;const{scrollLeft:a,scrollWidth:C,clientWidth:T}=f.current;S(a>0),L(a<C-T-10);const M=Math.round(a/336);D(Math.max(0,Math.min(M,U.length-1)))},[U.length]);j.useEffect(()=>{if(U.length===0)return;Z();const a=f.current;if(a)return a.addEventListener("scroll",Z),window.addEventListener("resize",Z),()=>{a.removeEventListener("scroll",Z),window.removeEventListener("resize",Z)}},[U,Z]);const de=j.useCallback(a=>{if(!f.current)return;const C=336,T=C,P=f.current.scrollLeft;let M=a==="left"?P-T:P+T;M=Math.max(0,Math.min(M,f.current.scrollWidth-f.current.clientWidth)),f.current.scrollTo({left:M,behavior:"smooth"});const ee=Math.round(M/C);D(Math.max(0,Math.min(ee,U.length-1)))},[U.length]);j.useCallback(a=>{if(!f.current)return;f.current.scrollTo({left:a*336,behavior:"smooth"}),D(a)},[]);const J=j.useMemo(()=>{const a=U.filter(q=>q.type==="child");if(a.length===0)return{allowed:!1,reason:"no_children"};const C=a.filter(q=>Ue(q.dob).eligible);if(C.length===0)return{allowed:!1,reason:"no_eligible_children"};if(C.find(q=>{const ie=q.activeCheckupAssessment;return ie&&ie.status==="in_progress"&&!ie.completed_at}))return{allowed:!0,reason:"active_checkup_exists"};const P=C.map(q=>{const ie=q.checkupAssessment;return ie&&ie.status==="completed"&&ie.completed_at?new Date(ie.completed_at):null}).filter(q=>q!==null),M=P.length>0?new Date(Math.max(...P.map(q=>q.getTime()))):null;if(!M)return{allowed:!0,reason:"no_previous_checkup"};const ee=C.map(q=>new Date(q.created_at)).filter(q=>!isNaN(q.getTime())),be=ee.length>0?new Date(Math.max(...ee.map(q=>q.getTime()))):null;if(be&&be>M)return{allowed:!0,reason:"new_child_added"};const $e=Math.floor((Date.now()-M.getTime())/(1e3*60*60*24));return $e>=30?{allowed:!0,reason:"month_passed"}:{allowed:!1,reason:"too_soon",daysRemaining:30-$e,lastCheckupDate:M}},[U]);return j.useMemo(()=>U.filter(C=>C.type==="child").some(C=>{var T;return((T=C.checkupAssessment)==null?void 0:T.status)==="completed"}),[U]),j.useMemo(()=>{const a=U.filter(T=>T.type==="child");return a.length===0?!1:a.every(T=>{const P=Ue(T.dob);return!P.eligible&&P.reason==="too_young"})},[U]),j.useCallback(()=>{ue.log("Checkup card clicked");const a=U.filter(P=>P.type==="child");if(a.length===0){t("/family-members");return}const C=a.filter(P=>Ue(P.dob).eligible);if(!J.allowed){if(J.reason==="no_eligible_children"){a.filter(M=>{const ee=Ue(M.dob);return!ee.eligible&&ee.reason==="too_young"}).length>0?pe.error("Чекап предназначен для детей от 3 до 18 лет. Ваш ребёнок ещё слишком маленький для прохождения чекапа."):pe.error("Чекап предназначен для детей от 3 до 18 лет.");return}if(J.reason==="too_soon"){const P=J.daysRemaining||0,M=J.lastCheckupDate?new Date(J.lastCheckupDate).toLocaleDateString("ru-RU"):"";pe.error(`Чекап можно пройти только раз в месяц или после добавления нового ребенка. Последний чекап был пройден ${M}. Повторно можно будет пройти через ${P} ${P===1?"день":P<5?"дня":"дней"}.`)}return}if(J.reason==="active_checkup_exists"){const P=C.find(M=>M.activeCheckupAssessment);if(P){ue.log("Resuming checkup for child:",P.first_name),n(P.id),o(P),t(`/checkup-intro/${P.id}`);return}}const T=C[0];T&&(ue.log("Starting checkup for child:",T.first_name),n(T.id),o(T),t(`/checkup-intro/${T.id}`))},[U,t,n,o,J]),j.useEffect(()=>{w&&(ue.error("Error loading profiles:",w),pe.error("Не удалось загрузить данные. Попробуйте обновить страницу."))},[w]),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 pt-8 pb-8",children:[(w||H)&&e.jsxs("div",{className:"mb-6 rounded-lg border border-destructive bg-destructive/10 p-4",children:[e.jsxs("p",{className:"text-sm font-medium text-destructive mb-2",children:[w&&`Ошибка загрузки профилей: ${w instanceof Error?w.message:"Неизвестная ошибка"}`,H&&`Ошибка загрузки консультаций: ${H instanceof Error?H.message:"Неизвестная ошибка"}`]}),e.jsx(O,{variant:"outline",size:"sm",onClick:()=>window.location.reload(),children:"Обновить страницу"})]}),B.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsx(Ce,{size:"xl",children:"Ваши предстоящие консультации"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(O,{variant:"outline",size:"sm",onClick:()=>t("/cabinet/settings?tab=notifications"),className:"text-xs sm:text-sm",children:[e.jsx(Ns,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Настроить уведомления"})]}),e.jsx(en,{})]})]}),B.length===1?e.jsx("div",{className:"space-y-4",children:B.map(a=>{var C;return e.jsx("div",{className:`rounded-xl border border-white/30 p-4 sm:p-6 text-card-foreground shadow-soft overflow-hidden ${a.status==="payment_pending"?"border-amber-300/50":""}`,style:{background:a.status==="payment_pending"?"linear-gradient(108deg, rgba(255, 193, 7, 0.35) 0%, rgba(255, 193, 7, 0.2) 100%)":"linear-gradient(108deg, rgba(255, 255, 255, 0.45) 0%, rgba(255, 255, 255, 0.25) 100%)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.status==="payment_pending"?e.jsxs(ve,{variant:"secondary",className:"bg-honey-pale text-foreground border-honey hover:bg-honey-pale font-light",children:[e.jsx(Ct,{className:"h-3 w-3 mr-1"}),"Ожидает оплаты"]}):a.payment_id?e.jsxs(ve,{variant:"secondary",className:"bg-sage-pale text-foreground border-sage hover:bg-sage-pale font-light",children:[e.jsx(St,{className:"h-3 w-3 mr-1"}),"Оплачено"]}):null,a.status==="in_progress"&&e.jsxs(ve,{variant:"default",className:"bg-success hover:bg-success font-light",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-white animate-pulse mr-1"}),"Идет сейчас"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Ne,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Дата и время"}),e.jsx("p",{className:"font-medium truncate",children:Tt(a.scheduled_at)})]})]}),a.appointment_type&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Et,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Тип консультации"}),e.jsxs("p",{className:"font-medium truncate",children:[a.appointment_type.name," (",a.appointment_type.duration_minutes," минут)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Le,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Для кого"}),e.jsx("p",{className:"font-medium truncate",children:G(a.profile_id)})]})]}),a.status==="payment_pending"&&a.payment_expires_at&&e.jsxs("div",{className:"p-3 bg-honey-pale border border-honey rounded-lg",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[e.jsx("strong",{children:"Срок оплаты:"})," ",new Date(a.payment_expires_at).toLocaleString("ru-RU",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Moscow"})," (МСК)"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"После истечения срока запись будет автоматически отменена"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:ml-0 w-full md:w-auto md:min-w-[200px]",children:[a.specialist&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg cursor-pointer hover:bg-muted transition-colors mb-2",onClick:()=>g(a.specialist.id),children:[e.jsxs(qe,{className:"h-10 w-10",children:[e.jsx(Ve,{src:a.specialist.avatar_url||void 0}),e.jsx(He,{children:((C=a.specialist.display_name)==null?void 0:C.split(" ").map(T=>T[0]).join("").slice(0,2).toUpperCase())||"?"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Специалист"}),e.jsx("p",{className:"font-medium",children:a.specialist.display_name}),a.specialist.experience_years&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(dt,{className:"h-3 w-3"}),"Опыт: ",a.specialist.experience_years," лет"]})]}),e.jsx(ot,{className:"h-4 w-4 text-muted-foreground"})]}),a.status!=="payment_pending"&&a.video_room_url&&(()=>{const T=new Date(a.scheduled_at),P=new Date,M=(T.getTime()-P.getTime())/1e3/60;return a.status==="in_progress"||M<=15?e.jsxs(O,{variant:a.status==="in_progress"?"default":"outline",size:"sm",onClick:()=>window.open(a.video_room_url,"_blank"),className:a.status==="in_progress"?"bg-success hover:bg-success/90":"",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),a.status==="in_progress"?"Войти сейчас":"Войти в комнату"]}):e.jsxs(O,{variant:"outline",size:"sm",disabled:!0,className:"opacity-50",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Доступно за 15 мин"]})})(),a.status==="payment_pending"&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Ссылка на оплату отправлена на email"}),a.status!=="payment_pending"&&e.jsxs(Ze,{open:i===a.id,onOpenChange:T=>m(T?a.id:null),children:[e.jsx(Xe,{asChild:!0,children:e.jsxs(O,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-destructive hover:bg-muted/50 font-light",children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),"Отменить"]})}),e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(st,{children:"Отменить консультацию?"}),e.jsx(nt,{children:"Вы уверены, что хотите отменить консультацию? Это действие нельзя отменить."})]}),e.jsxs(rt,{children:[e.jsx(it,{children:"Нет, оставить"}),e.jsx(at,{onClick:()=>ne(a.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Да, отменить"})]})]})]})]})]})},a.id)})}):e.jsxs(Xt,{opts:{align:"start",loop:!1},className:"w-full",children:[e.jsx(es,{className:"-ml-2 md:-ml-4",children:B.map(a=>{var C;return e.jsx(ts,{className:"pl-2 md:pl-4 basis-full md:basis-[calc(50%-8px)] lg:basis-[calc(50%-8px)]",children:e.jsx("div",{className:`rounded-xl border border-white/30 p-4 sm:p-6 text-card-foreground shadow-soft overflow-hidden h-full ${a.status==="payment_pending"?"border-amber-300/50":""}`,style:{background:a.status==="payment_pending"?"linear-gradient(108deg, rgba(255, 193, 7, 0.35) 0%, rgba(255, 193, 7, 0.2) 100%)":"linear-gradient(108deg, rgba(255, 255, 255, 0.45) 0%, rgba(255, 255, 255, 0.25) 100%)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.status==="payment_pending"?e.jsxs(ve,{variant:"secondary",className:"bg-honey-pale text-foreground border-honey hover:bg-honey-pale font-light",children:[e.jsx(Ct,{className:"h-3 w-3 mr-1"}),"Ожидает оплаты"]}):a.payment_id?e.jsxs(ve,{variant:"secondary",className:"bg-sage-pale text-foreground border-sage hover:bg-sage-pale font-light",children:[e.jsx(St,{className:"h-3 w-3 mr-1"}),"Оплачено"]}):null,a.status==="in_progress"&&e.jsxs(ve,{variant:"default",className:"bg-success hover:bg-success font-light",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-white animate-pulse mr-1"}),"Идет сейчас"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Ne,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Дата и время"}),e.jsx("p",{className:"font-medium truncate",children:Tt(a.scheduled_at)})]})]}),a.appointment_type&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Et,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Тип консультации"}),e.jsxs("p",{className:"font-medium truncate",children:[a.appointment_type.name," (",a.appointment_type.duration_minutes," минут)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Le,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Для кого"}),e.jsx("p",{className:"font-medium truncate",children:G(a.profile_id)})]})]}),a.status==="payment_pending"&&a.payment_expires_at&&e.jsxs("div",{className:"p-3 bg-honey-pale border border-honey rounded-lg",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[e.jsx("strong",{children:"Срок оплаты:"})," ",new Date(a.payment_expires_at).toLocaleString("ru-RU",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Moscow"})," (МСК)"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"После истечения срока запись будет автоматически отменена"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[a.specialist&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg cursor-pointer hover:bg-muted transition-colors mb-2",onClick:()=>g(a.specialist.id),children:[e.jsxs(qe,{className:"h-10 w-10",children:[e.jsx(Ve,{src:a.specialist.avatar_url||void 0}),e.jsx(He,{children:((C=a.specialist.display_name)==null?void 0:C.split(" ").map(T=>T[0]).join("").slice(0,2).toUpperCase())||"?"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Специалист"}),e.jsx("p",{className:"font-medium",children:a.specialist.display_name}),a.specialist.experience_years&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(dt,{className:"h-3 w-3"}),"Опыт: ",a.specialist.experience_years," лет"]})]}),e.jsx(ot,{className:"h-4 w-4 text-muted-foreground"})]}),a.status!=="payment_pending"&&a.video_room_url&&(()=>{const T=new Date(a.scheduled_at),P=new Date,M=(T.getTime()-P.getTime())/1e3/60;return a.status==="in_progress"||M<=15?e.jsxs(O,{variant:a.status==="in_progress"?"default":"outline",size:"sm",onClick:()=>window.open(a.video_room_url,"_blank"),className:a.status==="in_progress"?"bg-success hover:bg-success/90":"",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),a.status==="in_progress"?"Войти сейчас":"Войти в комнату"]}):e.jsxs(O,{variant:"outline",size:"sm",disabled:!0,className:"opacity-50",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Доступно за 15 мин"]})})(),a.status==="payment_pending"&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Ссылка на оплату отправлена на email"}),a.status!=="payment_pending"&&e.jsxs(Ze,{open:i===a.id,onOpenChange:T=>m(T?a.id:null),children:[e.jsx(Xe,{asChild:!0,children:e.jsxs(O,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-destructive hover:bg-muted/50 font-light",children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),"Отменить"]})}),e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(st,{children:"Отменить консультацию?"}),e.jsx(nt,{children:"Вы уверены, что хотите отменить консультацию? Это действие нельзя отменить."})]}),e.jsxs(rt,{children:[e.jsx(it,{children:"Нет, оставить"}),e.jsx(at,{onClick:()=>ne(a.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Да, отменить"})]})]})]})]})]})})},a.id)})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4",children:[e.jsx(ss,{className:"static translate-y-0 h-8 w-8"}),e.jsx(ns,{className:"static translate-y-0 h-8 w-8"})]})]})]}),R?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})}):null,e.jsxs("div",{className:"mb-8",children:[e.jsx(Ce,{size:"xl",className:"mb-2 text-2xl sm:text-3xl",children:_?`Привет, ${_}!`:"Привет!"}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Добро пожаловать в систему нейротренинга Waves"})]}),e.jsx(nn,{profilesCount:U.length,className:"mb-8"}),!1,e.jsxs("div",{className:"mb-12",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx(Ce,{size:"xl",children:"Ваша семья"}),U.length>0&&e.jsxs(O,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground hover:bg-muted/50 font-light",onClick:()=>t("/family-members",{state:{from:"cabinet"}}),children:[e.jsx(It,{className:"h-4 w-4 mr-2"}),"Добавить члена семьи"]})]}),U.length===0?e.jsxs(we,{className:"border-2 bg-card p-8 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Пока нет членов семьи"}),e.jsxs(O,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground hover:bg-muted/50 font-light",onClick:()=>t("/profile"),children:[e.jsx(It,{className:"h-4 w-4 mr-2"}),"Добавить члена семьи"]})]}):e.jsxs("div",{className:"relative",children:[y&&e.jsx(O,{variant:"ghost",size:"icon",className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 h-10 w-10 rounded-full bg-white/90 hover:bg-white shadow-md",onClick:()=>de("left"),"aria-label":"Предыдущая карточка",children:e.jsx(Hs,{className:"h-5 w-5 text-ink"})}),A&&e.jsx(O,{variant:"ghost",size:"icon",className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 h-10 w-10 rounded-full bg-white/90 hover:bg-white shadow-md",onClick:()=>de("right"),"aria-label":"Следующая карточка",children:e.jsx(Ht,{className:"h-5 w-5 text-ink"})}),e.jsx("div",{ref:f,className:"flex gap-4 overflow-x-auto pb-4 scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch",touchAction:"pan-x"},onScroll:Z,children:U.map(a=>{var M,ee;const C=a.dob?ks(a.dob):null,T=((M=a.checkupAssessment)==null?void 0:M.status)==="completed",P=(ee=a.checkupAssessment)!=null&&ee.completed_at?new Date(a.checkupAssessment.completed_at).toLocaleDateString("ru-RU"):null;return e.jsx(we,{className:"glass-elegant min-w-[320px] flex-shrink-0 flex flex-col border-2 p-6 transition-all hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col items-center text-center flex-1",children:[e.jsx("div",{className:"mb-4",children:e.jsx(_s,{...z(a),size:"lg"})}),e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs(Ce,{size:"lg",children:[a.first_name," ",a.last_name||""]})}),C!==null&&e.jsxs("p",{className:"text-muted-foreground mb-2",children:[C," лет"]}),T&&e.jsxs(ve,{variant:"default",className:"bg-success text-success-foreground hover:bg-success font-light mb-2",children:[e.jsx(Vt,{className:"h-3 w-3 mr-1"}),"Чекап завершен"]}),T&&P&&e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Завершен: ",P]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-auto w-full",children:[T&&e.jsxs(O,{variant:"outline",size:"sm",className:"w-full",onClick:()=>t(`/results-report?profileId=${a.id}`),children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"Посмотреть результаты"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{variant:"ghost",size:"sm",className:"flex-1 text-muted-foreground hover:text-foreground hover:bg-muted/50 font-light",onClick:()=>{ue.log("Edit clicked for member:",{id:a.id,name:`${a.first_name} ${a.last_name}`,type:a.type,isParent:a.type==="parent"}),a.type==="parent"?t("/profile",{state:{from:"cabinet"}}):t(`/edit-family-member/${a.id}`,{state:{from:"cabinet"}})},children:[e.jsx(Qe,{name:"pencil",style:"rr",className:"h-4 w-4 mr-2"}),"Редактировать"]}),a.type!=="parent"&&e.jsxs(Ze,{open:h===a.id,onOpenChange:be=>d(be?a.id:null),children:[e.jsx(Xe,{asChild:!0,children:e.jsxs(O,{variant:"ghost",size:"sm",className:"flex-1 text-muted-foreground hover:text-destructive hover:bg-muted/50 font-light",onClick:()=>d(a.id),children:[e.jsx(Qe,{name:"trash",style:"rr",className:"h-4 w-4 mr-2"}),"Удалить"]})}),e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(st,{children:"Удалить члена семьи?"}),e.jsxs(nt,{children:["Вы уверены, что хотите удалить ",a.first_name," ",a.last_name||"","? Это действие нельзя будет отменить."]})]}),e.jsxs(rt,{children:[e.jsx(it,{children:"Отмена"}),e.jsx(at,{onClick:()=>le(a.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Удалить"})]})]})]})]})]})]})},a.id)})})]})]}),e.jsxs("div",{className:"mb-12",children:[e.jsx(Ce,{size:"xl",className:"mb-4",children:"Есть вопросы?"}),e.jsxs(we,{className:"glass-elegant border-2 p-6",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Напишите в поддержку, чтобы решить любые проблемы или попросить помочь."}),e.jsxs(O,{onClick:()=>window.open("https://t.me/waves_support_bot","_blank","noopener,noreferrer"),children:[e.jsx(Qe,{name:"help-circle",style:"rr",className:"h-4 w-4 mr-2"}),"Написать в поддержку"]})]})]}),e.jsx(Se,{open:!!b,onOpenChange:a=>!a&&g(null),children:e.jsx(Ee,{className:"max-w-2xl w-[90vw] max-h-[90vh] overflow-y-auto p-0 bg-background",style:{background:"var(--bg-golden-hour)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed"},children:e.jsx("div",{className:"px-6 pb-6 pt-6",children:b&&e.jsx(Ws,{specialistId:b,showChangeButton:!0,onSpecialistChange:()=>g(null)})})})}),v&&e.jsx(Xs,{pendingRating:v,open:x,onClose:()=>{p(!1),N(null)},onSubmitted:async()=>{p(!1),N(null);const a=await Pt();a&&(N(a),p(!0))}})]})}export{fr as default};
