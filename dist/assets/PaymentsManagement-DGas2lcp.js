import{r as m,j as e}from"./vendor-radix-ClAtPGFM.js";import{b as w}from"./vendor-query-DNK10Tnx.js";import{w as L,N as _,C as f,Q as g,R as v,h as p,q as T,a as I,b as D,c as H,d as y,e as l,s as Q}from"./index-BetUtCwY.js";import{T as R,a as q,b as C,c as t,d as F,e as c}from"./table-z2RnJ62P.js";import{S as M}from"./search-CNh4vawW.js";import{f as B}from"./vendor-date-CR4liJ_d.js";import"./vendor-charts-DLBwBPLi.js";import"./vendor-react-C_NXOhYK.js";function E(){return w({queryKey:["admin-payments"],queryFn:async()=>{const{data:d,error:n}=await L.from("payments").select(`
          *,
          user:users!payments_user_id_fkey(id, email)
        `).order("created_at",{ascending:!1}).limit(1e3);if(n)throw n;return(d||[]).map(r=>{var o;return{...r,user:((o=r.user)==null?void 0:o[0])||r.user}})}})}function O(){const[d,n]=m.useState(""),[r,o]=m.useState("all"),{data:a,isLoading:N}=E(),u=a==null?void 0:a.filter(s=>{var x,h,j;const i=s.id.toLowerCase().includes(d.toLowerCase())||((h=(x=s.user)==null?void 0:x.email)==null?void 0:h.toLowerCase().includes(d.toLowerCase()))||((j=s.external_payment_id)==null?void 0:j.toLowerCase().includes(d.toLowerCase())),b=r==="all"||s.status===r;return i&&b}),S=(a==null?void 0:a.filter(s=>s.status==="completed").reduce((s,i)=>s+Number(i.amount||0),0))||0;return N?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Управление платежами"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Всего платежей: ",(a==null?void 0:a.length)||0," | Общая выручка: ",S.toLocaleString()," ₽"]})]}),e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(v,{children:"Фильтры"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(T,{placeholder:"Поиск по ID, email или внешнему ID...",value:d,onChange:s=>n(s.target.value),className:"pl-10"})]}),e.jsxs(I,{value:r,onValueChange:o,children:[e.jsx(D,{className:"w-[180px]",children:e.jsx(H,{placeholder:"Статус"})}),e.jsxs(y,{children:[e.jsx(l,{value:"all",children:"Все статусы"}),e.jsx(l,{value:"pending",children:"Ожидает"}),e.jsx(l,{value:"processing",children:"Обрабатывается"}),e.jsx(l,{value:"completed",children:"Завершено"}),e.jsx(l,{value:"failed",children:"Неудачно"}),e.jsx(l,{value:"cancelled",children:"Отменено"}),e.jsx(l,{value:"refunded",children:"Возврат"})]})]})]})]}),e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(v,{children:"Список платежей"})}),e.jsx(p,{children:e.jsxs(R,{children:[e.jsx(q,{children:e.jsxs(C,{children:[e.jsx(t,{children:"ID"}),e.jsx(t,{children:"Пользователь"}),e.jsx(t,{children:"Сумма"}),e.jsx(t,{children:"Метод оплаты"}),e.jsx(t,{children:"Статус"}),e.jsx(t,{children:"Внешний ID"}),e.jsx(t,{children:"Дата создания"})]})}),e.jsx(F,{children:u==null?void 0:u.map(s=>{var i;return e.jsxs(C,{children:[e.jsxs(c,{className:"font-mono text-xs",children:[s.id.slice(0,8),"..."]}),e.jsx(c,{children:((i=s.user)==null?void 0:i.email)||"—"}),e.jsxs(c,{className:"font-medium",children:[Number(s.amount||0).toLocaleString()," ",s.currency]}),e.jsx(c,{children:s.payment_method||"—"}),e.jsx(c,{children:e.jsx(Q,{variant:s.status==="completed"?"default":s.status==="failed"||s.status==="cancelled"?"destructive":"secondary",children:s.status==="pending"?"Ожидает":s.status==="processing"?"Обрабатывается":s.status==="completed"?"Завершено":s.status==="failed"?"Неудачно":s.status==="cancelled"?"Отменено":"Возврат"})}),e.jsx(c,{className:"font-mono text-xs",children:s.external_payment_id||"—"}),e.jsx(c,{children:B(new Date(s.created_at),"dd.MM.yyyy HH:mm")})]},s.id)})})]})})]})]})}export{O as default};
