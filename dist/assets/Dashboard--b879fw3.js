import{j as e,r as j}from"./vendor-radix-htwXsPHy.js";import{p as ms,a as kt}from"./friendly-and-clean-face-of-an-adult-person--gender (1)-mshj5uDX.js";import{c as hs,a as xs}from"./friendly-and-clean-face-of-a-white-boy-7-yo--soft- (1)-BoJK1GJM.js";import{i as ue,J as Vt,u as ht,w as ne,C as ke,h as Je,K as St,U as Ie,N as ps,O as gs,Q as Be,R as Ve,T as qe,s as ae,B as z,G as be,V as js,W as ct,X as Me,Y as Pe,Z as He,_ as Ge,$ as De,a0 as qt,L as vs,a1 as Ht,a2 as Gt,f as ve,a3 as bs,q as ys,a4 as Ns,S as Ne,a5 as dt,t as ws,v as Cs,x as Kt,z as Wt,a6 as _s,r as ks,p as _e,a7 as Ss,m as Qe,a8 as Et,E as At,a9 as Dt,y as Es}from"./index-Bu4m9iDU.js";import{isEligibleForCheckup as Ue,CHECKUP_MIN_AGE as Lt,CHECKUP_MAX_AGE as As,calculateAge as Ds,deleteProfile as Ls}from"./profileStorage-B9P4N8Co.js";import{u as Ts}from"./useProfiles-CiC7oZdw.js";import{u as Tt,a as It}from"./useAssessments-BfRHCaDz.js";import{b as Is,a as Ms}from"./useAppointments-ddne6K8C.js";import{f as Mt}from"./moscowTime-Bf471xDt.js";import{A as Ze,h as Xe,a as et,b as tt,c as st,d as nt,e as rt,f as it,g as at}from"./alert-dialog-DfF31jsr.js";import{S as Ps}from"./separator-B1iwS2pb.js";import{B as ut}from"./briefcase-DYrbDXcI.js";import{P as zs}from"./play-C2cCYCAr.js";import{G as Fs,B as Os}from"./graduation-cap-C_7XX4oT.js";import{S as $s}from"./star-DwqDFoed.js";import{g as Rs,b as Us,a as Bs,r as Vs}from"./calendar-feed-JC8QkbUh.js";import{C as qs}from"./copy-CQ-apAZK.js";import{T as Yt}from"./trash-2-CYbdFHW9.js";import{u as Jt}from"./vendor-react-CI8wve7f.js";import{S as Hs}from"./sparkles-BEEHuGWZ.js";import{E as Gs}from"./external-link-B2_JFenJ.js";import{A as Ks}from"./arrow-right-BknVaqXq.js";import{s as Ws,g as Pt}from"./supabase-messages-CBT2AE_V.js";import{u as Ys}from"./vendor-query-BNGVDYIL.js";import{E as ot}from"./eye-Cpu7S48v.js";import{P as zt}from"./plus-L645YxVk.js";import{P as Js}from"./pencil-BjdfN6Bm.js";import"./vendor-charts-DjioKZbK.js";import"./assessmentStorage-CZ49b0Rv.js";import"./appointmentStorage-C-Jgm17Y.js";const Qs="/assets/friendly-and-clean-vector-style-illustration-of-a--eflqllss.png",Zs="/assets/minimalistic-and-friendly-vector-style-illustratio%20(1)-o6xpfYcR.png",Xs={coral:"bg-gradient-to-br from-[#ffd4c4] via-[#ffb299] to-[#ff8a65]",blue:"bg-gradient-to-br from-[#E8F5FE] via-[#D4EDFC] to-[#C0E5FA]",pink:"bg-gradient-to-br from-[#FFE8F0] via-[#FFD6E8] to-[#FFC4E0]",lavender:"bg-[#F0E8F8]"};function Ft({children:t,className:s,gradient:i,hover:a=!1,...o}){return e.jsx("div",{...o,className:ue("rounded-[20px] p-6 shadow-[0_4px_20px_rgba(0,0,0,0.06)]",i?Xs[i]:"bg-white",a&&"transition-all duration-300 hover:shadow-[0_6px_30px_rgba(0,0,0,0.1)] hover:scale-[1.02]",s),children:t})}const en={child_psychology:"Детская психология",family_therapy:"Семейная терапия",cbt:"КПТ",trauma:"Работа с травмой",anxiety:"Тревожные расстройства",depression:"Депрессия",adhd:"СДВГ",autism:"Аутизм",eating_disorders:"Расстройства питания",parenting:"Родительство",psychologist:"Психолог",psychiatrist:"Психиатр",psychotherapist:"Психотерапевт",clinical_psychologist:"Клинический психолог",child_psychologist:"Детский психолог",family_therapist:"Семейный терапевт",neuropsychologist:"Нейропсихолог",logopedist:"Логопед",defectologist:"Дефектолог",art_therapist:"Арт-терапевт",cbt_specialist:"Специалист по КПТ",coordinator:"Координатор"},tn={higher:"Высшее образование",additional:"Дополнительное образование",certification:"Сертификация",course:"Курс"};function sn({specialistId:t,showChangeButton:s=!0,onSpecialistChange:i}){const{toast:a}=Vt(),{user:o}=ht(),[r,l]=j.useState(null),[f,d]=j.useState([]),[c,v]=j.useState(!0),[p,g]=j.useState(!1),[N,u]=j.useState(!1),[h,b]=j.useState(""),[m,x]=j.useState(!1),[C,T]=j.useState(!1);j.useEffect(()=>{O()},[t,o]);const O=async()=>{if(o)try{v(!0);let y=null;if(t){const{data:D,error:R}=await ne.from("specialists").select("*").eq("id",t).single();if(R)throw R;y=D}else{const{data:D,error:R}=await ne.from("client_assignments").select("specialist_id").eq("client_user_id",o.id).eq("status","active").single();if(R){if(R.code==="PGRST116"){l(null),v(!1);return}throw R}const{data:G,error:K}=await ne.from("specialists").select("*").eq("id",D.specialist_id).single();if(K)throw K;y=G}if(l(y),y){const{data:D}=await ne.from("specialist_education").select("*").eq("specialist_id",y.id).order("year_end",{ascending:!1,nullsFirst:!1});d(D||[]);const{data:R}=await ne.from("specialist_change_requests").select("id").eq("client_user_id",o.id).eq("status","pending").single();T(!!R)}}catch(y){console.error("Error loading specialist data:",y),a({title:"Ошибка",description:"Не удалось загрузить данные специалиста",variant:"destructive"})}finally{v(!1)}},P=y=>{const D=y.match(/(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);if(D)return`https://www.youtube.com/embed/${D[1]}`;const R=y.match(/vimeo\.com\/(?:video\/)?(\d+)/);return R?`https://player.vimeo.com/video/${R[1]}`:null},S=async()=>{if(!(!o||!r))try{x(!0);const{error:y}=await ne.from("specialist_change_requests").insert({client_user_id:o.id,current_specialist_id:r.id,reason:h||null,status:"pending"});if(y)throw y;a({title:"Запрос отправлен",description:"Координатор рассмотрит ваш запрос на смену специалиста"}),u(!1),b(""),T(!0),i==null||i()}catch(y){console.error("Error submitting change request:",y),a({title:"Ошибка",description:"Не удалось отправить запрос",variant:"destructive"})}finally{x(!1)}},A=y=>y.split(" ").map(R=>R[0]).join("").toUpperCase().slice(0,2),k=(y,D)=>y&&D?`${y} - ${D}`:D?`${D}`:y?`с ${y}`:null;if(c)return e.jsx(ke,{children:e.jsx(Je,{className:"flex items-center justify-center py-12",children:e.jsx(St,{className:"h-8 w-8 animate-spin text-muted-foreground"})})});if(!r)return e.jsx(ke,{children:e.jsxs(Je,{className:"py-8 text-center",children:[e.jsx(Ie,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Вам пока не назначен специалист. После установочной встречи координатор подберёт для вас подходящего специалиста."})]})});const $=r.video_intro_url?P(r.video_intro_url):null;return e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(ps,{children:e.jsxs(gs,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5"}),"Ваш специалист"]})}),e.jsxs(Je,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(Be,{className:"h-20 w-20",children:[e.jsx(Ve,{src:r.avatar_url||void 0}),e.jsx(qe,{className:"text-xl",children:A(r.display_name)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold",children:r.display_name}),r.experience_years&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(ut,{className:"h-4 w-4"}),"Опыт работы: ",r.experience_years," лет"]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx(ae,{variant:r.is_available?"default":"secondary",children:r.is_available?"Доступен":"Не в сети"})})]})]}),r.specialization_codes.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Специализации:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.specialization_codes.map(y=>e.jsx(ae,{variant:"outline",children:en[y]||y},y))})]}),r.bio&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"О специалисте:"}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:r.bio})]}),r.video_intro_url&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Видеовизитка:"}),e.jsxs(z,{variant:"outline",onClick:()=>g(!0),className:"w-full sm:w-auto",children:[e.jsx(zs,{className:"mr-2 h-4 w-4"}),"Смотреть видео"]})]}),f.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium mb-3 flex items-center gap-2",children:[e.jsx(Fs,{className:"h-4 w-4"}),"Образование:"]}),e.jsx("div",{className:"space-y-3",children:f.map(y=>e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Os,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:y.institution})]}),y.specialty&&e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:y.specialty}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground pl-6",children:[k(y.year_start,y.year_end)&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),k(y.year_start,y.year_end)]}),e.jsx("span",{className:"px-2 py-0.5 bg-muted rounded",children:tn[y.education_type]||y.education_type})]})]},y.id))})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(Ps,{}),C?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground p-3 bg-muted/50 rounded-lg",children:[e.jsx(js,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Ваш запрос на смену специалиста рассматривается"})]}):e.jsxs(z,{variant:"outline",onClick:()=>u(!0),className:"w-full",children:[e.jsx(ct,{className:"mr-2 h-4 w-4"}),"Запросить смену специалиста"]})]})]})]}),e.jsx(Me,{open:p,onOpenChange:g,children:e.jsxs(Pe,{className:"max-w-3xl w-[90vw] p-0",children:[e.jsx(He,{className:"px-6 pt-6",children:e.jsxs(Ge,{children:["Видеовизитка ",r.display_name]})}),e.jsx("div",{className:"px-6 pb-6",children:$?e.jsx("div",{className:"relative w-full",style:{paddingBottom:"56.25%"},children:e.jsx("iframe",{className:"absolute top-0 left-0 w-full h-full rounded-lg",src:$,title:"Видеовизитка специалиста",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(De,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground",children:["Видео доступно по"," ",e.jsx("a",{href:r.video_intro_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"ссылке"})]})]})})]})}),e.jsx(Me,{open:N,onOpenChange:u,children:e.jsxs(Pe,{children:[e.jsxs(He,{children:[e.jsx(Ge,{children:"Запросить смену специалиста"}),e.jsx(qt,{children:"Если вы чувствуете, что текущий специалист вам не подходит, вы можете запросить смену. Координатор подберет вам другого специалиста."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(vs,{htmlFor:"change-reason",children:"Причина смены (необязательно)"}),e.jsx(Ht,{id:"change-reason",value:h,onChange:y=>b(y.target.value),placeholder:"Опишите, почему вы хотите сменить специалиста...",rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Это поможет координатору лучше подобрать нового специалиста"})]})}),e.jsxs(Gt,{children:[e.jsx(z,{variant:"outline",onClick:()=>u(!1),disabled:m,children:"Отмена"}),e.jsx(z,{onClick:S,disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"mr-2 h-4 w-4 animate-spin"}),"Отправка..."]}):"Отправить запрос"})]})]})})]})}async function Ot(){const{data:{user:t}}=await ne.auth.getUser();if(!t)return null;const{data:s,error:i}=await ne.rpc("get_pending_ratings_for_user",{p_user_id:t.id});return i?(console.error("Error fetching pending rating:",i),null):!s||s.length===0?null:s[0]}async function nn(t){const{data:{user:s}}=await ne.auth.getUser();if(!s)return{success:!1,error:"Пользователь не авторизован"};const{error:i}=await ne.from("specialist_ratings").insert({appointment_id:t.appointment_id,client_user_id:s.id,specialist_id:t.specialist_id,rating:t.rating,review_text:t.review_text||null});return i?(console.error("Error submitting rating:",i),{success:!1,error:i.message}):{success:!0}}async function rn(t){const{error:s}=await ne.from("appointments").update({rating_skipped:!0}).eq("id",t);return s?(console.error("Error skipping rating:",s),{success:!1,error:s.message}):{success:!0}}async function an(t){if(!t||t.length===0)return"";const{data:s,error:i}=await ne.from("specializations").select("name").in("code",t);return i?(console.error("Error fetching specialization names:",i),""):(s==null?void 0:s.map(a=>a.name).join(", "))||""}function on(t){return new Date(t).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Moscow"})}function ln({pendingRating:t,open:s,onClose:i,onSubmitted:a}){const[o,r]=j.useState(0),[l,f]=j.useState(0),[d,c]=j.useState(""),[v,p]=j.useState(!1),[g,N]=j.useState("");j.useEffect(()=>{r(0),f(0),c(""),N("")},[t==null?void 0:t.appointment_id]),j.useEffect(()=>{var x;((x=t==null?void 0:t.specialization_codes)==null?void 0:x.length)>0&&an(t.specialization_codes).then(N)},[t==null?void 0:t.specialization_codes]);const u=async()=>{if(o===0){ve.error("Пожалуйста, выберите оценку");return}p(!0);const x=await nn({appointment_id:t.appointment_id,specialist_id:t.specialist_id,rating:o,review_text:d.trim()||void 0});p(!1),x.success?(ve.success("Спасибо за вашу оценку!"),a()):ve.error(x.error||"Не удалось отправить оценку")},h=async()=>{p(!0);const x=await rn(t.appointment_id);p(!1),x.success?i():ve.error(x.error||"Не удалось пропустить оценку")},b=x=>x.split(" ").map(C=>C[0]).join("").slice(0,2).toUpperCase(),m=l||o;return e.jsx(Me,{open:s,onOpenChange:x=>!x&&i(),children:e.jsxs(Pe,{className:"sm:max-w-md",children:[e.jsx(He,{children:e.jsx(Ge,{className:"text-center text-xl",children:"Как прошла консультация?"})}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs(Be,{className:"h-14 w-14",children:[e.jsx(Ve,{src:t.specialist_avatar||void 0}),e.jsx(qe,{className:"bg-primary/10 text-primary text-lg",children:b(t.specialist_name)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"font-semibold text-foreground truncate",children:t.specialist_name})]}),g&&e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:g}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(be,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:on(t.scheduled_at)})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 py-4",children:[e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(x=>e.jsx("button",{type:"button",onClick:()=>r(x),onMouseEnter:()=>f(x),onMouseLeave:()=>f(0),className:"p-1 transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded","aria-label":`Оценка ${x} из 5`,children:e.jsx($s,{className:`h-10 w-10 transition-colors ${x<=m?"fill-yellow-400 text-yellow-400":"fill-none text-muted-foreground/50"}`})},x))}),m>0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[m===1&&"Очень плохо",m===2&&"Плохо",m===3&&"Нормально",m===4&&"Хорошо",m===5&&"Отлично"]})]}),e.jsxs("div",{children:[e.jsx(Ht,{placeholder:"Поделитесь впечатлениями (необязательно)...",value:d,onChange:x=>c(x.target.value),rows:3,maxLength:1e3,className:"resize-none"}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right mt-1",children:[d.length,"/1000"]})]}),e.jsxs(Gt,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(z,{variant:"ghost",onClick:h,disabled:v,className:"w-full sm:w-auto",children:"Пропустить"}),e.jsx(z,{onClick:u,disabled:v||o===0,className:"w-full sm:w-auto",children:v?"Отправка...":"Отправить"})]})]})})}function cn({trigger:t}){const[s,i]=j.useState(!1),[a,o]=j.useState(!1),[r,l]=j.useState(null),[f,d]=j.useState(!1),{toast:c}=Vt();j.useEffect(()=>{s&&v()},[s]);const v=async()=>{o(!0);try{const h=await Rs();l(h?Us(h):null)}catch(h){console.error("Ошибка загрузки токена:",h)}finally{o(!1)}},p=async()=>{o(!0);try{const h=await Bs();l(h.feedUrl),c({title:"Ссылка создана",description:"Скопируйте ссылку и добавьте в свой календарь"})}catch(h){c({title:"Ошибка",description:h instanceof Error?h.message:"Не удалось создать ссылку",variant:"destructive"})}finally{o(!1)}},g=async()=>{o(!0);try{await Vs(),l(null),c({title:"Ссылка отозвана",description:"Старая ссылка больше не работает"})}catch(h){c({title:"Ошибка",description:h instanceof Error?h.message:"Не удалось отозвать ссылку",variant:"destructive"})}finally{o(!1)}},N=async()=>{if(r)try{await navigator.clipboard.writeText(r),d(!0),c({title:"Скопировано",description:"Ссылка скопирована в буфер обмена"}),setTimeout(()=>d(!1),2e3)}catch{c({title:"Ошибка",description:"Не удалось скопировать ссылку",variant:"destructive"})}},u=e.jsxs(z,{variant:"outline",size:"sm",className:"text-xs sm:text-sm",children:[e.jsx(be,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Добавить в календарь"})]});return e.jsxs(Me,{open:s,onOpenChange:i,children:[e.jsx(bs,{asChild:!0,children:t||u}),e.jsxs(Pe,{className:"sm:max-w-md",children:[e.jsxs(He,{children:[e.jsxs(Ge,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5 text-primary"}),"Добавьте сессии себе в календарь"]}),e.jsx(qt,{children:"Создайте ссылку и добавьте её в календарь."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Google Календарь"}),e.jsx("p",{className:"text-muted-foreground",children:"Меню «Другие календари» — «Добавить по URL»"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Apple Календарь"}),e.jsx("p",{className:"text-muted-foreground",children:"Меню «Файл» — «Подписка на новый календарь...»"})]})]}),r?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ys,{value:r,readOnly:!0,className:"font-mono text-xs"}),e.jsx(z,{variant:"outline",size:"icon",onClick:N,disabled:a,children:f?e.jsx(Ns,{className:"h-4 w-4 text-green-500"}):e.jsx(qs,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"outline",size:"sm",onClick:p,disabled:a,className:"flex-1",children:[e.jsx(ct,{className:`h-4 w-4 mr-2 ${a?"animate-spin":""}`}),"Обновить ссылку"]}),e.jsx(z,{variant:"outline",size:"sm",onClick:g,disabled:a,className:"text-destructive hover:text-destructive",children:e.jsx(Yt,{className:"h-4 w-4"})})]})]}):e.jsxs(z,{onClick:p,disabled:a,className:"w-full bg-primary hover:bg-primary/90",children:[a?e.jsx(ct,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(be,{className:"h-4 w-4 mr-2"}),"Создать ссылку"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Календарь будет автоматически обновляться при изменении ваших сессий. Не передавайте эту ссылку третьим лицам."})]})]})]})}const lt="waves_onboarding_checklist",dn=[{id:"fill_profiles",title:"Заполнить профили участников",description:"Добавьте информацию о себе и членах семьи",autoCheck:!0},{id:"select_goals",title:"Выбрать цели тренинга",description:"Определите, чего хотите достичь с помощью нейрофидбэка",link:"/cabinet/goals",linkText:"Выбрать цели"},{id:"learn_neurofeedback",title:"Познакомиться с методом нейрофидбэка",description:"Узнайте, как работает технология",link:"https://waves.ai/neurofeedback",linkText:"Узнать больше"},{id:"download_app",title:"Скачать мобильное приложение",description:"Установите приложение Waves на телефон",link:"https://waves.ai/app",linkText:"Скачать приложение"},{id:"order_device",title:"Заказать доставку устройства для тренировки",description:"Оформите заказ на устройство нейрофидбэка",link:"/cabinet/device",linkText:"Заказать"},{id:"pay_licenses",title:"Оплатить лицензии для участников",description:"Активируйте доступ для всех членов семьи",link:"/cabinet/licenses",linkText:"Выбрать план"},{id:"test_device",title:"Подключить и протестировать устройство",description:"Убедитесь, что устройство работает корректно"},{id:"complete_tutorial",title:"Пройти инструктаж в мобильном приложении",description:"Завершите обучение в приложении"}];function un(t={}){const{user:s}=ht(),{profilesCount:i=0}=t,[a,o]=j.useState(()=>{if(typeof window>"u")return{items:{}};try{const u=localStorage.getItem(`${lt}_${(s==null?void 0:s.id)||"guest"}`);if(u)return JSON.parse(u)}catch(u){console.error("Error loading checklist state:",u)}return{items:{}}});j.useEffect(()=>{if(s!=null&&s.id)try{const u=localStorage.getItem(`${lt}_${s.id}`);o(u?JSON.parse(u):{items:{}})}catch(u){console.error("Error loading checklist state:",u),o({items:{}})}},[s==null?void 0:s.id]),j.useEffect(()=>{if(s!=null&&s.id)try{localStorage.setItem(`${lt}_${s.id}`,JSON.stringify(a))}catch(u){console.error("Error saving checklist state:",u)}},[a,s==null?void 0:s.id]);const r=j.useMemo(()=>dn.map(u=>{let h=a.items[u.id]||!1;return u.id==="fill_profiles"&&u.autoCheck&&(h=i>=1),{...u,completed:h}}),[a.items,i]),l=j.useMemo(()=>{const u=r.filter(m=>m.completed).length,h=r.length,b=Math.round(u/h*100);return{completed:u,total:h,percentage:b}},[r]),f=l.completed===l.total,d=!!a.dismissedAt,c=j.useCallback((u,h=!0)=>{o(b=>({...b,items:{...b.items,[u]:h}}))},[]),v=j.useCallback(u=>{o(h=>({...h,items:{...h.items,[u]:!h.items[u]}}))},[]),p=j.useCallback(()=>{o(u=>({...u,dismissedAt:new Date().toISOString()}))},[]),g=j.useCallback(()=>{o(u=>({...u,dismissedAt:void 0}))},[]),N=j.useCallback(()=>{o({items:{}})},[]);return{items:r,progress:l,isCompleted:f,isDismissed:d,markCompleted:c,toggleItem:v,dismiss:p,restore:g,reset:N}}function fn({profilesCount:t=0,className:s}){const i=Jt(),{items:a,progress:o,isCompleted:r,isDismissed:l,toggleItem:f,dismiss:d}=un({profilesCount:t}),[c,v]=j.useState(!0),[p,g]=j.useState(!1),[N,u]=j.useState(!1);if(j.useEffect(()=>{if(r&&!l){u(!0);const m=setTimeout(()=>{g(!0),setTimeout(()=>{d()},500)},3e3);return()=>clearTimeout(m)}},[r,l,d]),l)return null;const h=a.findIndex(m=>!m.completed),b=h!==-1?a[h]:null;return e.jsx("div",{className:ue("transition-all duration-500",p&&"opacity-0 scale-95 -translate-y-4",s),children:e.jsxs(ke,{className:"glass-elegant border-2 overflow-hidden",children:[e.jsxs("div",{className:"p-4 sm:p-6 cursor-pointer",onClick:()=>v(!c),children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-honey/20 flex-shrink-0",children:e.jsx(Hs,{className:"h-5 w-5 text-honey"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Ne,{size:"lg",className:"truncate",children:N?"Отлично! Все готово":"Начните работу с Waves"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:N?"Вы выполнили все шаги для начала работы":`Выполнено ${o.completed} из ${o.total} шагов`})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-coral to-coral-light transition-all duration-500",style:{width:`${o.percentage}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[o.percentage,"%"]})]}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-foreground",onClick:m=>{m.stopPropagation(),d()},children:e.jsx(dt,{className:"h-4 w-4"})}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-foreground",onClick:m=>{m.stopPropagation(),v(!c)},children:c?e.jsx(ws,{className:"h-4 w-4"}):e.jsx(Cs,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"sm:hidden mt-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-coral to-coral-light transition-all duration-500",style:{width:`${o.percentage}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[o.percentage,"%"]})]})})]}),e.jsx("div",{className:ue("overflow-hidden transition-all duration-300",c?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"),children:e.jsx("div",{className:"px-4 sm:px-6 pb-4 sm:pb-6 space-y-2",children:a.map((m,x)=>e.jsx(mn,{item:m,index:x,isCurrent:(b==null?void 0:b.id)===m.id,onToggle:()=>!m.autoCheck&&f(m.id),onNavigate:C=>i(C)},m.id))})})]})})}function mn({item:t,index:s,isCurrent:i,onToggle:a,onNavigate:o}){var f;const r=!t.autoCheck,l=(f=t.link)==null?void 0:f.startsWith("/");return e.jsxs("div",{className:ue("flex items-start gap-3 p-3 rounded-xl transition-all duration-200",i&&!t.completed&&"bg-honey/10 border border-honey/30",t.completed&&"opacity-60",r&&!t.completed&&"cursor-pointer hover:bg-white/50"),onClick:r?a:void 0,children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:t.completed?e.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-success to-success/80 flex items-center justify-center shadow-sm",children:e.jsx(Kt,{className:"h-4 w-4 text-white"})}):e.jsx("div",{className:ue("w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors",i?"border-coral bg-coral/10":"border-muted-foreground/30 bg-white/50"),children:e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:s+1})})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:ue("font-medium transition-all",t.completed&&"line-through text-muted-foreground"),children:t.title}),t.description&&!t.completed&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[t.autoCheck&&!t.completed&&e.jsx(ae,{variant:"secondary",className:"text-xs font-light",children:"Автоматически"}),t.link&&!t.completed&&e.jsxs(z,{variant:"ghost",size:"sm",className:"h-7 px-2 text-coral hover:text-coral hover:bg-coral/10",onClick:d=>{d.stopPropagation(),l?o(t.link):window.open(t.link,"_blank","noopener,noreferrer")},children:[e.jsx("span",{className:"text-xs mr-1",children:t.linkText||"Открыть"}),l?e.jsx(Wt,{className:"h-3 w-3"}):e.jsx(Gs,{className:"h-3 w-3"})]})]})]})})]})}function hn(t){return Object.prototype.toString.call(t)==="[object Object]"}function $t(t){return hn(t)||Array.isArray(t)}function xn(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function xt(t,s){const i=Object.keys(t),a=Object.keys(s);if(i.length!==a.length)return!1;const o=JSON.stringify(Object.keys(t.breakpoints||{})),r=JSON.stringify(Object.keys(s.breakpoints||{}));return o!==r?!1:i.every(l=>{const f=t[l],d=s[l];return typeof f=="function"?`${f}`==`${d}`:!$t(f)||!$t(d)?f===d:xt(f,d)})}function Rt(t){return t.concat().sort((s,i)=>s.name>i.name?1:-1).map(s=>s.options)}function pn(t,s){if(t.length!==s.length)return!1;const i=Rt(t),a=Rt(s);return i.every((o,r)=>{const l=a[r];return xt(o,l)})}function pt(t){return typeof t=="number"}function ft(t){return typeof t=="string"}function We(t){return typeof t=="boolean"}function Ut(t){return Object.prototype.toString.call(t)==="[object Object]"}function q(t){return Math.abs(t)}function gt(t){return Math.sign(t)}function Te(t,s){return q(t-s)}function gn(t,s){if(t===0||s===0||q(t)<=q(s))return 0;const i=Te(q(t),q(s));return q(i/t)}function jn(t){return Math.round(t*100)/100}function ze(t){return Fe(t).map(Number)}function fe(t){return t[$e(t)]}function $e(t){return Math.max(0,t.length-1)}function jt(t,s){return s===$e(t)}function Bt(t,s=0){return Array.from(Array(t),(i,a)=>s+a)}function Fe(t){return Object.keys(t)}function Qt(t,s){return[t,s].reduce((i,a)=>(Fe(a).forEach(o=>{const r=i[o],l=a[o],f=Ut(r)&&Ut(l);i[o]=f?Qt(r,l):l}),i),{})}function mt(t,s){return typeof s.MouseEvent<"u"&&t instanceof s.MouseEvent}function vn(t,s){const i={start:a,center:o,end:r};function a(){return 0}function o(d){return r(d)/2}function r(d){return s-d}function l(d,c){return ft(t)?i[t](d):t(s,d,c)}return{measure:l}}function Oe(){let t=[];function s(o,r,l,f={passive:!0}){let d;if("addEventListener"in o)o.addEventListener(r,l,f),d=()=>o.removeEventListener(r,l,f);else{const c=o;c.addListener(l),d=()=>c.removeListener(l)}return t.push(d),a}function i(){t=t.filter(o=>o())}const a={add:s,clear:i};return a}function bn(t,s,i,a){const o=Oe(),r=1e3/60;let l=null,f=0,d=0;function c(){o.add(t,"visibilitychange",()=>{t.hidden&&u()})}function v(){N(),o.clear()}function p(b){if(!d)return;l||(l=b,i(),i());const m=b-l;for(l=b,f+=m;f>=r;)i(),f-=r;const x=f/r;a(x),d&&(d=s.requestAnimationFrame(p))}function g(){d||(d=s.requestAnimationFrame(p))}function N(){s.cancelAnimationFrame(d),l=null,f=0,d=0}function u(){l=null,f=0}return{init:c,destroy:v,start:g,stop:N,update:i,render:a}}function yn(t,s){const i=s==="rtl",a=t==="y",o=a?"y":"x",r=a?"x":"y",l=!a&&i?-1:1,f=v(),d=p();function c(u){const{height:h,width:b}=u;return a?h:b}function v(){return a?"top":i?"right":"left"}function p(){return a?"bottom":i?"left":"right"}function g(u){return u*l}return{scroll:o,cross:r,startEdge:f,endEdge:d,measureSize:c,direction:g}}function Se(t=0,s=0){const i=q(t-s);function a(c){return c<t}function o(c){return c>s}function r(c){return a(c)||o(c)}function l(c){return r(c)?a(c)?t:s:c}function f(c){return i?c-i*Math.ceil((c-s)/i):c}return{length:i,max:s,min:t,constrain:l,reachedAny:r,reachedMax:o,reachedMin:a,removeOffset:f}}function Zt(t,s,i){const{constrain:a}=Se(0,t),o=t+1;let r=l(s);function l(g){return i?q((o+g)%o):a(g)}function f(){return r}function d(g){return r=l(g),p}function c(g){return v().set(f()+g)}function v(){return Zt(t,f(),i)}const p={get:f,set:d,add:c,clone:v};return p}function Nn(t,s,i,a,o,r,l,f,d,c,v,p,g,N,u,h,b,m,x){const{cross:C,direction:T}=t,O=["INPUT","SELECT","TEXTAREA"],P={passive:!1},S=Oe(),A=Oe(),k=Se(50,225).constrain(N.measure(20)),$={mouse:300,touch:400},y={mouse:500,touch:600},D=u?43:25;let R=!1,G=0,K=0,oe=!1,me=!1,te=!1,le=!1;function re(_){if(!x)return;function F(W){(We(x)||x(_,W))&&we(W)}const V=s;S.add(V,"dragstart",W=>W.preventDefault(),P).add(V,"touchmove",()=>{},P).add(V,"touchend",()=>{}).add(V,"touchstart",F).add(V,"mousedown",F).add(V,"touchcancel",Y).add(V,"contextmenu",Y).add(V,"click",xe,!0)}function ee(){S.clear(),A.clear()}function ye(){const _=le?i:s;A.add(_,"touchmove",X,P).add(_,"touchend",Y).add(_,"mousemove",X,P).add(_,"mouseup",Y)}function he(_){const F=_.nodeName||"";return O.includes(F)}function ce(){return(u?y:$)[le?"mouse":"touch"]}function U(_,F){const V=p.add(gt(_)*-1),W=v.byDistance(_,!u).distance;return u||q(_)<k?W:b&&F?W*.5:v.byIndex(V.get(),0).distance}function we(_){const F=mt(_,a);le=F,te=u&&F&&!_.buttons&&R,R=Te(o.get(),l.get())>=2,!(F&&_.button!==0)&&(he(_.target)||(oe=!0,r.pointerDown(_),c.useFriction(0).useDuration(0),o.set(l),ye(),G=r.readPoint(_),K=r.readPoint(_,C),g.emit("pointerDown")))}function X(_){if(!mt(_,a)&&_.touches.length>=2)return Y(_);const V=r.readPoint(_),W=r.readPoint(_,C),ie=Te(V,G),J=Te(W,K);if(!me&&!le&&(!_.cancelable||(me=ie>J,!me)))return Y(_);const pe=r.pointerMove(_);ie>h&&(te=!0),c.useFriction(.3).useDuration(.75),f.start(),o.add(T(pe)),_.preventDefault()}function Y(_){const V=v.byDistance(0,!1).index!==p.get(),W=r.pointerUp(_)*ce(),ie=U(T(W),V),J=gn(W,ie),pe=D-10*J,ge=m+J/50;me=!1,oe=!1,A.clear(),c.useDuration(pe).useFriction(ge),d.distance(ie,!u),le=!1,g.emit("pointerUp")}function xe(_){te&&(_.stopPropagation(),_.preventDefault(),te=!1)}function se(){return oe}return{init:re,destroy:ee,pointerDown:se}}function wn(t,s){let a,o;function r(p){return p.timeStamp}function l(p,g){const u=`client${(g||t.scroll)==="x"?"X":"Y"}`;return(mt(p,s)?p:p.touches[0])[u]}function f(p){return a=p,o=p,l(p)}function d(p){const g=l(p)-l(o),N=r(p)-r(a)>170;return o=p,N&&(a=p),g}function c(p){if(!a||!o)return 0;const g=l(o)-l(a),N=r(p)-r(a),u=r(p)-r(o)>170,h=g/N;return N&&!u&&q(h)>.1?h:0}return{pointerDown:f,pointerMove:d,pointerUp:c,readPoint:l}}function Cn(){function t(i){const{offsetTop:a,offsetLeft:o,offsetWidth:r,offsetHeight:l}=i;return{top:a,right:o+r,bottom:a+l,left:o,width:r,height:l}}return{measure:t}}function _n(t){function s(a){return t*(a/100)}return{measure:s}}function kn(t,s,i,a,o,r,l){const f=[t].concat(a);let d,c,v=[],p=!1;function g(b){return o.measureSize(l.measure(b))}function N(b){if(!r)return;c=g(t),v=a.map(g);function m(x){for(const C of x){if(p)return;const T=C.target===t,O=a.indexOf(C.target),P=T?c:v[O],S=g(T?t:a[O]);if(q(S-P)>=.5){b.reInit(),s.emit("resize");break}}}d=new ResizeObserver(x=>{(We(r)||r(b,x))&&m(x)}),i.requestAnimationFrame(()=>{f.forEach(x=>d.observe(x))})}function u(){p=!0,d&&d.disconnect()}return{init:N,destroy:u}}function Sn(t,s,i,a,o,r){let l=0,f=0,d=o,c=r,v=t.get(),p=0;function g(){const P=a.get()-t.get(),S=!d;let A=0;return S?(l=0,i.set(a),t.set(a),A=P):(i.set(t),l+=P/d,l*=c,v+=l,t.add(l),A=v-p),f=gt(A),p=v,O}function N(){const P=a.get()-s.get();return q(P)<.001}function u(){return d}function h(){return f}function b(){return l}function m(){return C(o)}function x(){return T(r)}function C(P){return d=P,O}function T(P){return c=P,O}const O={direction:h,duration:u,velocity:b,seek:g,settled:N,useBaseFriction:x,useBaseDuration:m,useFriction:T,useDuration:C};return O}function En(t,s,i,a,o){const r=o.measure(10),l=o.measure(50),f=Se(.1,.99);let d=!1;function c(){return!(d||!t.reachedAny(i.get())||!t.reachedAny(s.get()))}function v(N){if(!c())return;const u=t.reachedMin(s.get())?"min":"max",h=q(t[u]-s.get()),b=i.get()-s.get(),m=f.constrain(h/l);i.subtract(b*m),!N&&q(b)<r&&(i.set(t.constrain(i.get())),a.useDuration(25).useBaseFriction())}function p(N){d=!N}return{shouldConstrain:c,constrain:v,toggleActive:p}}function An(t,s,i,a,o){const r=Se(-s+t,0),l=p(),f=v(),d=g();function c(u,h){return Te(u,h)<=1}function v(){const u=l[0],h=fe(l),b=l.lastIndexOf(u),m=l.indexOf(h)+1;return Se(b,m)}function p(){return i.map((u,h)=>{const{min:b,max:m}=r,x=r.constrain(u),C=!h,T=jt(i,h);return C?m:T||c(b,x)?b:c(m,x)?m:x}).map(u=>parseFloat(u.toFixed(3)))}function g(){if(s<=t+o)return[r.max];if(a==="keepSnaps")return l;const{min:u,max:h}=f;return l.slice(u,h)}return{snapsContained:d,scrollContainLimit:f}}function Dn(t,s,i){const a=s[0],o=i?a-t:fe(s);return{limit:Se(o,a)}}function Ln(t,s,i,a){const r=s.min+.1,l=s.max+.1,{reachedMin:f,reachedMax:d}=Se(r,l);function c(g){return g===1?d(i.get()):g===-1?f(i.get()):!1}function v(g){if(!c(g))return;const N=t*(g*-1);a.forEach(u=>u.add(N))}return{loop:v}}function Tn(t){const{max:s,length:i}=t;function a(r){const l=r-s;return i?l/-i:0}return{get:a}}function In(t,s,i,a,o){const{startEdge:r,endEdge:l}=t,{groupSlides:f}=o,d=p().map(s.measure),c=g(),v=N();function p(){return f(a).map(h=>fe(h)[l]-h[0][r]).map(q)}function g(){return a.map(h=>i[r]-h[r]).map(h=>-q(h))}function N(){return f(c).map(h=>h[0]).map((h,b)=>h+d[b])}return{snaps:c,snapsAligned:v}}function Mn(t,s,i,a,o,r){const{groupSlides:l}=o,{min:f,max:d}=a,c=v();function v(){const g=l(r),N=!t||s==="keepSnaps";return i.length===1?[r]:N?g:g.slice(f,d).map((u,h,b)=>{const m=!h,x=jt(b,h);if(m){const C=fe(b[0])+1;return Bt(C)}if(x){const C=$e(r)-fe(b)[0]+1;return Bt(C,fe(b)[0])}return u})}return{slideRegistry:c}}function Pn(t,s,i,a,o){const{reachedAny:r,removeOffset:l,constrain:f}=a;function d(u){return u.concat().sort((h,b)=>q(h)-q(b))[0]}function c(u){const h=t?l(u):f(u),b=s.map((x,C)=>({diff:v(x-h,0),index:C})).sort((x,C)=>q(x.diff)-q(C.diff)),{index:m}=b[0];return{index:m,distance:h}}function v(u,h){const b=[u,u+i,u-i];if(!t)return u;if(!h)return d(b);const m=b.filter(x=>gt(x)===h);return m.length?d(m):fe(b)-i}function p(u,h){const b=s[u]-o.get(),m=v(b,h);return{index:u,distance:m}}function g(u,h){const b=o.get()+u,{index:m,distance:x}=c(b),C=!t&&r(b);if(!h||C)return{index:m,distance:u};const T=s[m]-x,O=u+v(T,0);return{index:m,distance:O}}return{byDistance:g,byIndex:p,shortcut:v}}function zn(t,s,i,a,o,r,l){function f(p){const g=p.distance,N=p.index!==s.get();r.add(g),g&&(a.duration()?t.start():(t.update(),t.render(1),t.update())),N&&(i.set(s.get()),s.set(p.index),l.emit("select"))}function d(p,g){const N=o.byDistance(p,g);f(N)}function c(p,g){const N=s.clone().set(p),u=o.byIndex(N.get(),g);f(u)}return{distance:d,index:c}}function Fn(t,s,i,a,o,r,l,f){const d={passive:!0,capture:!0};let c=0;function v(N){if(!f)return;function u(h){if(new Date().getTime()-c>10)return;l.emit("slideFocusStart"),t.scrollLeft=0;const x=i.findIndex(C=>C.includes(h));pt(x)&&(o.useDuration(0),a.index(x,0),l.emit("slideFocus"))}r.add(document,"keydown",p,!1),s.forEach((h,b)=>{r.add(h,"focus",m=>{(We(f)||f(N,m))&&u(b)},d)})}function p(N){N.code==="Tab"&&(c=new Date().getTime())}return{init:v}}function Le(t){let s=t;function i(){return s}function a(d){s=l(d)}function o(d){s+=l(d)}function r(d){s-=l(d)}function l(d){return pt(d)?d:d.get()}return{get:i,set:a,add:o,subtract:r}}function Xt(t,s){const i=t.scroll==="x"?l:f,a=s.style;let o=null,r=!1;function l(g){return`translate3d(${g}px,0px,0px)`}function f(g){return`translate3d(0px,${g}px,0px)`}function d(g){if(r)return;const N=jn(t.direction(g));N!==o&&(a.transform=i(N),o=N)}function c(g){r=!g}function v(){r||(a.transform="",s.getAttribute("style")||s.removeAttribute("style"))}return{clear:v,to:d,toggleActive:c}}function On(t,s,i,a,o,r,l,f,d){const v=ze(o),p=ze(o).reverse(),g=m().concat(x());function N(S,A){return S.reduce((k,$)=>k-o[$],A)}function u(S,A){return S.reduce((k,$)=>N(k,A)>0?k.concat([$]):k,[])}function h(S){return r.map((A,k)=>({start:A-a[k]+.5+S,end:A+s-.5+S}))}function b(S,A,k){const $=h(A);return S.map(y=>{const D=k?0:-i,R=k?i:0,G=k?"end":"start",K=$[y][G];return{index:y,loopPoint:K,slideLocation:Le(-1),translate:Xt(t,d[y]),target:()=>f.get()>K?D:R}})}function m(){const S=l[0],A=u(p,S);return b(A,i,!1)}function x(){const S=s-l[0]-1,A=u(v,S);return b(A,-i,!0)}function C(){return g.every(({index:S})=>{const A=v.filter(k=>k!==S);return N(A,s)<=.1})}function T(){g.forEach(S=>{const{target:A,translate:k,slideLocation:$}=S,y=A();y!==$.get()&&(k.to(y),$.set(y))})}function O(){g.forEach(S=>S.translate.clear())}return{canLoop:C,clear:O,loop:T,loopPoints:g}}function $n(t,s,i){let a,o=!1;function r(d){if(!i)return;function c(v){for(const p of v)if(p.type==="childList"){d.reInit(),s.emit("slidesChanged");break}}a=new MutationObserver(v=>{o||(We(i)||i(d,v))&&c(v)}),a.observe(t,{childList:!0})}function l(){a&&a.disconnect(),o=!0}return{init:r,destroy:l}}function Rn(t,s,i,a){const o={};let r=null,l=null,f,d=!1;function c(){f=new IntersectionObserver(u=>{d||(u.forEach(h=>{const b=s.indexOf(h.target);o[b]=h}),r=null,l=null,i.emit("slidesInView"))},{root:t.parentElement,threshold:a}),s.forEach(u=>f.observe(u))}function v(){f&&f.disconnect(),d=!0}function p(u){return Fe(o).reduce((h,b)=>{const m=parseInt(b),{isIntersecting:x}=o[m];return(u&&x||!u&&!x)&&h.push(m),h},[])}function g(u=!0){if(u&&r)return r;if(!u&&l)return l;const h=p(u);return u&&(r=h),u||(l=h),h}return{init:c,destroy:v,get:g}}function Un(t,s,i,a,o,r){const{measureSize:l,startEdge:f,endEdge:d}=t,c=i[0]&&o,v=u(),p=h(),g=i.map(l),N=b();function u(){if(!c)return 0;const x=i[0];return q(s[f]-x[f])}function h(){if(!c)return 0;const x=r.getComputedStyle(fe(a));return parseFloat(x.getPropertyValue(`margin-${d}`))}function b(){return i.map((x,C,T)=>{const O=!C,P=jt(T,C);return O?g[C]+v:P?g[C]+p:T[C+1][f]-x[f]}).map(q)}return{slideSizes:g,slideSizesWithGaps:N,startGap:v,endGap:p}}function Bn(t,s,i,a,o,r,l,f,d){const{startEdge:c,endEdge:v,direction:p}=t,g=pt(i);function N(m,x){return ze(m).filter(C=>C%x===0).map(C=>m.slice(C,C+x))}function u(m){return m.length?ze(m).reduce((x,C,T)=>{const O=fe(x)||0,P=O===0,S=C===$e(m),A=o[c]-r[O][c],k=o[c]-r[C][v],$=!a&&P?p(l):0,y=!a&&S?p(f):0,D=q(k-y-(A+$));return T&&D>s+d&&x.push(C),S&&x.push(m.length),x},[]).map((x,C,T)=>{const O=Math.max(T[C-1]||0);return m.slice(O,x)}):[]}function h(m){return g?N(m,i):u(m)}return{groupSlides:h}}function Vn(t,s,i,a,o,r,l){const{align:f,axis:d,direction:c,startIndex:v,loop:p,duration:g,dragFree:N,dragThreshold:u,inViewThreshold:h,slidesToScroll:b,skipSnaps:m,containScroll:x,watchResize:C,watchSlides:T,watchDrag:O,watchFocus:P}=r,S=2,A=Cn(),k=A.measure(s),$=i.map(A.measure),y=yn(d,c),D=y.measureSize(k),R=_n(D),G=vn(f,D),K=!p&&!!x,oe=p||!!x,{slideSizes:me,slideSizesWithGaps:te,startGap:le,endGap:re}=Un(y,k,$,i,oe,o),ee=Bn(y,D,b,p,k,$,le,re,S),{snaps:ye,snapsAligned:he}=In(y,G,k,$,ee),ce=-fe(ye)+fe(te),{snapsContained:U,scrollContainLimit:we}=An(D,ce,he,x,S),X=K?U:he,{limit:Y}=Dn(ce,X,p),xe=Zt($e(X),v,p),se=xe.clone(),B=ze(i),_=({dragHandler:de,scrollBody:Ee,scrollBounds:Re,options:{loop:H}})=>{H||Re.constrain(de.pointerDown()),Ee.seek()},F=({scrollBody:de,translate:Ee,location:Re,offsetLocation:H,previousLocation:je,scrollLooper:as,slideLooper:os,dragHandler:ls,animation:cs,eventHandler:bt,scrollBounds:ds,options:{loop:yt}},Nt)=>{const wt=de.settled(),us=!ds.shouldConstrain(),Ct=yt?wt:wt&&us,_t=Ct&&!ls.pointerDown();_t&&cs.stop();const fs=Re.get()*Nt+je.get()*(1-Nt);H.set(fs),yt&&(as.loop(de.direction()),os.loop()),Ee.to(H.get()),_t&&bt.emit("settle"),Ct||bt.emit("scroll")},V=bn(a,o,()=>_(Z),de=>F(Z,de)),W=.68,ie=X[xe.get()],J=Le(ie),pe=Le(ie),ge=Le(ie),I=Le(ie),Q=Sn(J,ge,pe,I,g,W),Ae=Pn(p,X,ce,Y,I),Ce=zn(V,xe,se,Q,Ae,I,l),n=Tn(Y),w=Oe(),E=Rn(s,i,l,h),{slideRegistry:L}=Mn(K,x,X,we,ee,B),M=Fn(t,i,L,Ce,Q,w,l,P),Z={ownerDocument:a,ownerWindow:o,eventHandler:l,containerRect:k,slideRects:$,animation:V,axis:y,dragHandler:Nn(y,t,a,o,I,wn(y,o),J,V,Ce,Q,Ae,xe,l,R,N,u,m,W,O),eventStore:w,percentOfView:R,index:xe,indexPrevious:se,limit:Y,location:J,offsetLocation:ge,previousLocation:pe,options:r,resizeHandler:kn(s,l,o,i,y,C,A),scrollBody:Q,scrollBounds:En(Y,ge,I,Q,R),scrollLooper:Ln(ce,Y,ge,[J,ge,pe,I]),scrollProgress:n,scrollSnapList:X.map(n.get),scrollSnaps:X,scrollTarget:Ae,scrollTo:Ce,slideLooper:On(y,D,ce,me,te,ye,X,ge,i),slideFocus:M,slidesHandler:$n(s,l,T),slidesInView:E,slideIndexes:B,slideRegistry:L,slidesToScroll:ee,target:I,translate:Xt(y,s)};return Z}function qn(){let t={},s;function i(c){s=c}function a(c){return t[c]||[]}function o(c){return a(c).forEach(v=>v(s,c)),d}function r(c,v){return t[c]=a(c).concat([v]),d}function l(c,v){return t[c]=a(c).filter(p=>p!==v),d}function f(){t={}}const d={init:i,emit:o,off:l,on:r,clear:f};return d}const Hn={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function Gn(t){function s(r,l){return Qt(r,l||{})}function i(r){const l=r.breakpoints||{},f=Fe(l).filter(d=>t.matchMedia(d).matches).map(d=>l[d]).reduce((d,c)=>s(d,c),{});return s(r,f)}function a(r){return r.map(l=>Fe(l.breakpoints||{})).reduce((l,f)=>l.concat(f),[]).map(t.matchMedia)}return{mergeOptions:s,optionsAtMedia:i,optionsMediaQueries:a}}function Kn(t){let s=[];function i(r,l){return s=l.filter(({options:f})=>t.optionsAtMedia(f).active!==!1),s.forEach(f=>f.init(r,t)),l.reduce((f,d)=>Object.assign(f,{[d.name]:d}),{})}function a(){s=s.filter(r=>r.destroy())}return{init:i,destroy:a}}function Ke(t,s,i){const a=t.ownerDocument,o=a.defaultView,r=Gn(o),l=Kn(r),f=Oe(),d=qn(),{mergeOptions:c,optionsAtMedia:v,optionsMediaQueries:p}=r,{on:g,off:N,emit:u}=d,h=y;let b=!1,m,x=c(Hn,Ke.globalOptions),C=c(x),T=[],O,P,S;function A(){const{container:B,slides:_}=C;P=(ft(B)?t.querySelector(B):B)||t.children[0];const V=ft(_)?P.querySelectorAll(_):_;S=[].slice.call(V||P.children)}function k(B){const _=Vn(t,P,S,a,o,B,d);if(B.loop&&!_.slideLooper.canLoop()){const F=Object.assign({},B,{loop:!1});return k(F)}return _}function $(B,_){b||(x=c(x,B),C=v(x),T=_||T,A(),m=k(C),p([x,...T.map(({options:F})=>F)]).forEach(F=>f.add(F,"change",y)),C.active&&(m.translate.to(m.location.get()),m.animation.init(),m.slidesInView.init(),m.slideFocus.init(se),m.eventHandler.init(se),m.resizeHandler.init(se),m.slidesHandler.init(se),m.options.loop&&m.slideLooper.loop(),P.offsetParent&&S.length&&m.dragHandler.init(se),O=l.init(se,T)))}function y(B,_){const F=ee();D(),$(c({startIndex:F},B),_),d.emit("reInit")}function D(){m.dragHandler.destroy(),m.eventStore.clear(),m.translate.clear(),m.slideLooper.clear(),m.resizeHandler.destroy(),m.slidesHandler.destroy(),m.slidesInView.destroy(),m.animation.destroy(),l.destroy(),f.clear()}function R(){b||(b=!0,f.clear(),D(),d.emit("destroy"),d.clear())}function G(B,_,F){!C.active||b||(m.scrollBody.useBaseFriction().useDuration(_===!0?0:C.duration),m.scrollTo.index(B,F||0))}function K(B){const _=m.index.add(1).get();G(_,B,-1)}function oe(B){const _=m.index.add(-1).get();G(_,B,1)}function me(){return m.index.add(1).get()!==ee()}function te(){return m.index.add(-1).get()!==ee()}function le(){return m.scrollSnapList}function re(){return m.scrollProgress.get(m.offsetLocation.get())}function ee(){return m.index.get()}function ye(){return m.indexPrevious.get()}function he(){return m.slidesInView.get()}function ce(){return m.slidesInView.get(!1)}function U(){return O}function we(){return m}function X(){return t}function Y(){return P}function xe(){return S}const se={canScrollNext:me,canScrollPrev:te,containerNode:Y,internalEngine:we,destroy:R,off:N,on:g,emit:u,plugins:U,previousScrollSnap:ye,reInit:h,rootNode:X,scrollNext:K,scrollPrev:oe,scrollProgress:re,scrollSnapList:le,scrollTo:G,selectedScrollSnap:ee,slideNodes:xe,slidesInView:he,slidesNotInView:ce};return $(s,i),setTimeout(()=>d.emit("init"),0),se}Ke.globalOptions=void 0;function vt(t={},s=[]){const i=j.useRef(t),a=j.useRef(s),[o,r]=j.useState(),[l,f]=j.useState(),d=j.useCallback(()=>{o&&o.reInit(i.current,a.current)},[o]);return j.useEffect(()=>{xt(i.current,t)||(i.current=t,d())},[t,d]),j.useEffect(()=>{pn(a.current,s)||(a.current=s,d())},[s,d]),j.useEffect(()=>{if(xn()&&l){Ke.globalOptions=vt.globalOptions;const c=Ke(l,i.current,a.current);return r(c),()=>c.destroy()}else r(void 0)},[l,r]),[f,o]}vt.globalOptions=void 0;const es=j.createContext(null);function Ye(){const t=j.useContext(es);if(!t)throw new Error("useCarousel must be used within a <Carousel />");return t}const ts=j.forwardRef(({orientation:t="horizontal",opts:s,setApi:i,plugins:a,className:o,children:r,...l},f)=>{const[d,c]=vt({...s,axis:t==="horizontal"?"x":"y"},a),[v,p]=j.useState(!1),[g,N]=j.useState(!1),u=j.useCallback(x=>{x&&(p(x.canScrollPrev()),N(x.canScrollNext()))},[]),h=j.useCallback(()=>{c==null||c.scrollPrev()},[c]),b=j.useCallback(()=>{c==null||c.scrollNext()},[c]),m=j.useCallback(x=>{x.key==="ArrowLeft"?(x.preventDefault(),h()):x.key==="ArrowRight"&&(x.preventDefault(),b())},[h,b]);return j.useEffect(()=>{!c||!i||i(c)},[c,i]),j.useEffect(()=>{if(c)return u(c),c.on("reInit",u),c.on("select",u),()=>{c==null||c.off("select",u)}},[c,u]),e.jsx(es.Provider,{value:{carouselRef:d,api:c,opts:s,orientation:t||((s==null?void 0:s.axis)==="y"?"vertical":"horizontal"),scrollPrev:h,scrollNext:b,canScrollPrev:v,canScrollNext:g},children:e.jsx("div",{ref:f,onKeyDownCapture:m,className:ue("relative",o),role:"region","aria-roledescription":"carousel",...l,children:r})})});ts.displayName="Carousel";const ss=j.forwardRef(({className:t,...s},i)=>{const{carouselRef:a,orientation:o}=Ye();return e.jsx("div",{ref:a,className:"overflow-hidden",children:e.jsx("div",{ref:i,className:ue("flex",o==="horizontal"?"-ml-4":"-mt-4 flex-col",t),...s})})});ss.displayName="CarouselContent";const ns=j.forwardRef(({className:t,...s},i)=>{const{orientation:a}=Ye();return e.jsx("div",{ref:i,role:"group","aria-roledescription":"slide",className:ue("min-w-0 shrink-0 grow-0 basis-full",a==="horizontal"?"pl-4":"pt-4",t),...s})});ns.displayName="CarouselItem";const rs=j.forwardRef(({className:t,variant:s="outline",size:i="icon",...a},o)=>{const{orientation:r,scrollPrev:l,canScrollPrev:f}=Ye();return e.jsxs(z,{ref:o,variant:s,size:i,className:ue("absolute h-8 w-8 rounded-full",r==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!f,onClick:l,...a,children:[e.jsx(_s,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Previous slide"})]})});rs.displayName="CarouselPrevious";const is=j.forwardRef(({className:t,variant:s="outline",size:i="icon",...a},o)=>{const{orientation:r,scrollNext:l,canScrollNext:f}=Ye();return e.jsxs(z,{ref:o,variant:s,size:i,className:ue("absolute h-8 w-8 rounded-full",r==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!f,onClick:l,...a,children:[e.jsx(Ks,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Next slide"})]})});is.displayName="CarouselNext";function Cr(){const t=Jt(),{user:s}=ht(),{setCurrentProfileId:i,setCurrentProfile:a}=ks(),o=Is(),r=Ys(),[l,f]=j.useState(null),[d,c]=j.useState(0),[v,p]=j.useState(null),[g,N]=j.useState(null),[u,h]=j.useState(!1),[b,m]=j.useState(null),x=j.useRef(null),[C,T]=j.useState(!1),[O,P]=j.useState(!0),[S,A]=j.useState(0),{data:k,isLoading:$,error:y}=Ts(),{data:D,isLoading:R,error:G}=Ms();j.useEffect(()=>{_e.log("Dashboard data state:",{profiles:(k==null?void 0:k.length)||0,profilesLoading:$,profilesError:y==null?void 0:y.message,appointments:(D==null?void 0:D.length)||0,appointmentsLoading:R,appointmentsError:G==null?void 0:G.message,user:s==null?void 0:s.id})},[k,$,y,D,R,G,s]);const K=j.useMemo(()=>!k||!Array.isArray(k)?[]:k.map(n=>n.id),[k]),{data:oe,isLoading:me}=Tt(K,"checkup"),{data:te,isLoading:le}=It(K,"checkup"),re=j.useMemo(()=>{if(!k||!Array.isArray(k))return null;const n=k.find(w=>w.type==="parent");return(n==null?void 0:n.id)||null},[k]),{data:ee,isLoading:ye}=Tt(re?[re]:[],"parent"),{data:he,isLoading:ce}=It(re?[re]:[],"parent"),U=j.useMemo(()=>{if(!k||!Array.isArray(k))return[];const n=oe||{},w=te||{},E=ee||{},L=he||{};return k.map(M=>M.type==="parent"?{...M,checkupAssessment:E[M.id]||null,activeCheckupAssessment:L[M.id]||null}:{...M,checkupAssessment:n[M.id]||null,activeCheckupAssessment:w[M.id]||null})},[k,oe,te,ee,he]),we=$&&!k,X=me&&oe===void 0&&K.length>0,Y=le&&te===void 0&&K.length>0,B=we||X||Y||ye&&ee===void 0&&re!==null||ce&&he===void 0&&re!==null;j.useEffect(()=>{async function n(){try{await ne.rpc("update_appointment_statuses")}catch(w){console.error("Error updating appointment statuses:",w)}}n()},[]),j.useEffect(()=>{async function n(){try{const w=await Pt();c(w)}catch(w){console.error("Error loading unread count:",w)}}s!=null&&s.id&&n()},[s==null?void 0:s.id]),j.useEffect(()=>{if(!(s!=null&&s.id))return;const n=Ws(s.id,async()=>{const w=await Pt();c(w)});return()=>n()},[s==null?void 0:s.id]),j.useEffect(()=>{async function n(){const w=await Ot();w&&(N(w),h(!0))}s!=null&&s.id&&n()},[s==null?void 0:s.id]),j.useMemo(()=>{if(!k||!Array.isArray(k))return null;const n=k.find(w=>w.type==="parent");return(n==null?void 0:n.first_name)||null},[k]);const _=j.useCallback(n=>n.type==="parent"?n.gender==="male"?ms:kt:n.type==="child"?n.gender==="male"?hs:xs:kt,[]),F=j.useMemo(()=>D?D.filter(n=>n.status==="scheduled"||n.status==="in_progress"||n.status==="payment_pending"):[],[D]),V=j.useCallback(n=>{if(!n)return"Для меня (родитель)";const w=k==null?void 0:k.find(E=>E.id===n);return w?`${w.first_name}${w.last_name?` ${w.last_name}`:""}`:"Профиль не найден"},[k]),W=async n=>{try{await o.mutateAsync(n),f(null)}catch{}},ie=async n=>{try{await Ls(n),await r.invalidateQueries({queryKey:["profiles",s==null?void 0:s.id]}),m(null),ve.success("Член семьи удален")}catch(w){_e.error("Error deleting profile:",w),ve.error("Ошибка при удалении члена семьи")}},J=j.useCallback(()=>{if(!x.current)return;const{scrollLeft:n,scrollWidth:w,clientWidth:E}=x.current;T(n>0),P(n<w-E-10);const M=Math.round(n/336);A(Math.max(0,Math.min(M,U.length-1)))},[U.length]);j.useEffect(()=>{if(U.length===0)return;J();const n=x.current;if(n)return n.addEventListener("scroll",J),window.addEventListener("resize",J),()=>{n.removeEventListener("scroll",J),window.removeEventListener("resize",J)}},[U,J]);const pe=j.useCallback(n=>{if(!x.current)return;const w=336,E=w,L=x.current.scrollLeft;let M=n==="left"?L-E:L+E;M=Math.max(0,Math.min(M,x.current.scrollWidth-x.current.clientWidth)),x.current.scrollTo({left:M,behavior:"smooth"});const Z=Math.round(M/w);A(Math.max(0,Math.min(Z,U.length-1)))},[U.length]),ge=j.useCallback(n=>{if(!x.current)return;x.current.scrollTo({left:n*336,behavior:"smooth"}),A(n)},[]),I=j.useMemo(()=>{const n=U.filter(H=>H.type==="child");if(n.length===0)return{allowed:!1,reason:"no_children"};const w=n.filter(H=>Ue(H.dob).eligible);if(w.length===0)return{allowed:!1,reason:"no_eligible_children"};if(w.find(H=>{const je=H.activeCheckupAssessment;return je&&je.status==="in_progress"&&!je.completed_at}))return{allowed:!0,reason:"active_checkup_exists"};const L=w.map(H=>{const je=H.checkupAssessment;return je&&je.status==="completed"&&je.completed_at?new Date(je.completed_at):null}).filter(H=>H!==null),M=L.length>0?new Date(Math.max(...L.map(H=>H.getTime()))):null;if(!M)return{allowed:!0,reason:"no_previous_checkup"};const Z=w.map(H=>new Date(H.created_at)).filter(H=>!isNaN(H.getTime())),de=Z.length>0?new Date(Math.max(...Z.map(H=>H.getTime()))):null;if(de&&de>M)return{allowed:!0,reason:"new_child_added"};const Ee=Math.floor((Date.now()-M.getTime())/(1e3*60*60*24));return Ee>=30?{allowed:!0,reason:"month_passed"}:{allowed:!1,reason:"too_soon",daysRemaining:30-Ee,lastCheckupDate:M}},[U]),Q=j.useMemo(()=>U.filter(w=>w.type==="child").some(w=>{var E;return((E=w.checkupAssessment)==null?void 0:E.status)==="completed"}),[U]),Ae=j.useMemo(()=>{const n=U.filter(E=>E.type==="child");return n.length===0?!1:n.every(E=>{const L=Ue(E.dob);return!L.eligible&&L.reason==="too_young"})},[U]),Ce=j.useCallback(()=>{_e.log("Checkup card clicked");const n=U.filter(L=>L.type==="child");if(n.length===0){t("/family-members");return}const w=n.filter(L=>Ue(L.dob).eligible);if(!I.allowed){if(I.reason==="no_eligible_children"){n.filter(M=>{const Z=Ue(M.dob);return!Z.eligible&&Z.reason==="too_young"}).length>0?ve.error("Чекап предназначен для детей от 3 до 18 лет. Ваш ребёнок ещё слишком маленький для прохождения чекапа."):ve.error("Чекап предназначен для детей от 3 до 18 лет.");return}if(I.reason==="too_soon"){const L=I.daysRemaining||0,M=I.lastCheckupDate?new Date(I.lastCheckupDate).toLocaleDateString("ru-RU"):"";ve.error(`Чекап можно пройти только раз в месяц или после добавления нового ребенка. Последний чекап был пройден ${M}. Повторно можно будет пройти через ${L} ${L===1?"день":L<5?"дня":"дней"}.`)}return}if(I.reason==="active_checkup_exists"){const L=w.find(M=>M.activeCheckupAssessment);if(L){_e.log("Resuming checkup for child:",L.first_name),i(L.id),a(L),t(`/checkup-intro/${L.id}`);return}}const E=w[0];E&&(_e.log("Starting checkup for child:",E.first_name),i(E.id),a(E),t(`/checkup-intro/${E.id}`))},[U,t,i,a,I]);return j.useEffect(()=>{y&&(_e.error("Error loading profiles:",y),ve.error("Не удалось загрузить данные. Попробуйте обновить страницу."))},[y]),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 pt-8 pb-8",children:[(y||G)&&e.jsxs("div",{className:"mb-6 rounded-lg border border-destructive bg-destructive/10 p-4",children:[e.jsxs("p",{className:"text-sm font-medium text-destructive mb-2",children:[y&&`Ошибка загрузки профилей: ${y instanceof Error?y.message:"Неизвестная ошибка"}`,G&&`Ошибка загрузки консультаций: ${G instanceof Error?G.message:"Неизвестная ошибка"}`]}),e.jsx(z,{variant:"outline",size:"sm",onClick:()=>window.location.reload(),children:"Обновить страницу"})]}),F.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsx(Ne,{size:"xl",children:"Ваши предстоящие консультации"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>t("/cabinet/settings?tab=notifications"),className:"text-xs sm:text-sm",children:[e.jsx(Ss,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Настроить уведомления"})]}),e.jsx(cn,{})]})]}),F.length===1?e.jsx("div",{className:"space-y-4",children:F.map(n=>{var w;return e.jsx("div",{className:`rounded-xl border border-white/30 p-4 sm:p-6 text-card-foreground shadow-soft overflow-hidden ${n.status==="payment_pending"?"border-amber-300/50":""}`,style:{background:n.status==="payment_pending"?"linear-gradient(108deg, rgba(255, 193, 7, 0.35) 0%, rgba(255, 193, 7, 0.2) 100%)":"linear-gradient(108deg, rgba(255, 255, 255, 0.45) 0%, rgba(255, 255, 255, 0.25) 100%)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n.status==="payment_pending"?e.jsxs(ae,{variant:"secondary",className:"bg-honey-pale text-foreground border-honey hover:bg-honey-pale font-light",children:[e.jsx(Qe,{className:"h-3 w-3 mr-1"}),"Ожидает оплаты"]}):n.payment_id?e.jsxs(ae,{variant:"secondary",className:"bg-sage-pale text-foreground border-sage hover:bg-sage-pale font-light",children:[e.jsx(Et,{className:"h-3 w-3 mr-1"}),"Оплачено"]}):null,n.status==="in_progress"&&e.jsxs(ae,{variant:"default",className:"bg-success hover:bg-success font-light",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-white animate-pulse mr-1"}),"Идет сейчас"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(be,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Дата и время"}),e.jsx("p",{className:"font-medium truncate",children:Mt(n.scheduled_at)})]})]}),n.appointment_type&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(At,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Тип консультации"}),e.jsxs("p",{className:"font-medium truncate",children:[n.appointment_type.name," (",n.appointment_type.duration_minutes," минут)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Ie,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Для кого"}),e.jsx("p",{className:"font-medium truncate",children:V(n.profile_id)})]})]}),n.status==="payment_pending"&&n.payment_expires_at&&e.jsxs("div",{className:"p-3 bg-honey-pale border border-honey rounded-lg",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[e.jsx("strong",{children:"Срок оплаты:"})," ",new Date(n.payment_expires_at).toLocaleString("ru-RU",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Moscow"})," (МСК)"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"После истечения срока запись будет автоматически отменена"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:ml-0 w-full md:w-auto md:min-w-[200px]",children:[n.specialist&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg cursor-pointer hover:bg-muted transition-colors mb-2",onClick:()=>p(n.specialist.id),children:[e.jsxs(Be,{className:"h-10 w-10",children:[e.jsx(Ve,{src:n.specialist.avatar_url||void 0}),e.jsx(qe,{children:((w=n.specialist.display_name)==null?void 0:w.split(" ").map(E=>E[0]).join("").slice(0,2).toUpperCase())||"?"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Специалист"}),e.jsx("p",{className:"font-medium",children:n.specialist.display_name}),n.specialist.experience_years&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(ut,{className:"h-3 w-3"}),"Опыт: ",n.specialist.experience_years," лет"]})]}),e.jsx(ot,{className:"h-4 w-4 text-muted-foreground"})]}),n.status!=="payment_pending"&&n.video_room_url&&(()=>{const E=new Date(n.scheduled_at),L=new Date,M=(E.getTime()-L.getTime())/1e3/60;return n.status==="in_progress"||M<=15?e.jsxs(z,{variant:n.status==="in_progress"?"default":"outline",size:"sm",onClick:()=>window.open(n.video_room_url,"_blank"),className:n.status==="in_progress"?"bg-success hover:bg-success/90":"",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),n.status==="in_progress"?"Войти сейчас":"Войти в комнату"]}):e.jsxs(z,{variant:"outline",size:"sm",disabled:!0,className:"opacity-50",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Доступно за 15 мин"]})})(),n.status==="payment_pending"&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Ссылка на оплату отправлена на email"}),n.status!=="payment_pending"&&e.jsxs(Ze,{open:l===n.id,onOpenChange:E=>f(E?n.id:null),children:[e.jsx(Xe,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-destructive hover:bg-muted/50 font-light",children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"Отменить"]})}),e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(st,{children:"Отменить консультацию?"}),e.jsx(nt,{children:"Вы уверены, что хотите отменить консультацию? Это действие нельзя отменить."})]}),e.jsxs(rt,{children:[e.jsx(it,{children:"Нет, оставить"}),e.jsx(at,{onClick:()=>W(n.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Да, отменить"})]})]})]})]})]})},n.id)})}):e.jsxs(ts,{opts:{align:"start",loop:!1},className:"w-full",children:[e.jsx(ss,{className:"-ml-2 md:-ml-4",children:F.map(n=>{var w;return e.jsx(ns,{className:"pl-2 md:pl-4 basis-full md:basis-[calc(50%-8px)] lg:basis-[calc(50%-8px)]",children:e.jsx("div",{className:`rounded-xl border border-white/30 p-4 sm:p-6 text-card-foreground shadow-soft overflow-hidden h-full ${n.status==="payment_pending"?"border-amber-300/50":""}`,style:{background:n.status==="payment_pending"?"linear-gradient(108deg, rgba(255, 193, 7, 0.35) 0%, rgba(255, 193, 7, 0.2) 100%)":"linear-gradient(108deg, rgba(255, 255, 255, 0.45) 0%, rgba(255, 255, 255, 0.25) 100%)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n.status==="payment_pending"?e.jsxs(ae,{variant:"secondary",className:"bg-honey-pale text-foreground border-honey hover:bg-honey-pale font-light",children:[e.jsx(Qe,{className:"h-3 w-3 mr-1"}),"Ожидает оплаты"]}):n.payment_id?e.jsxs(ae,{variant:"secondary",className:"bg-sage-pale text-foreground border-sage hover:bg-sage-pale font-light",children:[e.jsx(Et,{className:"h-3 w-3 mr-1"}),"Оплачено"]}):null,n.status==="in_progress"&&e.jsxs(ae,{variant:"default",className:"bg-success hover:bg-success font-light",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-white animate-pulse mr-1"}),"Идет сейчас"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(be,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Дата и время"}),e.jsx("p",{className:"font-medium truncate",children:Mt(n.scheduled_at)})]})]}),n.appointment_type&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(At,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Тип консультации"}),e.jsxs("p",{className:"font-medium truncate",children:[n.appointment_type.name," (",n.appointment_type.duration_minutes," минут)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white flex-shrink-0",children:e.jsx(Ie,{className:"h-5 w-5 text-ink"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Для кого"}),e.jsx("p",{className:"font-medium truncate",children:V(n.profile_id)})]})]}),n.status==="payment_pending"&&n.payment_expires_at&&e.jsxs("div",{className:"p-3 bg-honey-pale border border-honey rounded-lg",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[e.jsx("strong",{children:"Срок оплаты:"})," ",new Date(n.payment_expires_at).toLocaleString("ru-RU",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Moscow"})," (МСК)"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"После истечения срока запись будет автоматически отменена"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[n.specialist&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg cursor-pointer hover:bg-muted transition-colors mb-2",onClick:()=>p(n.specialist.id),children:[e.jsxs(Be,{className:"h-10 w-10",children:[e.jsx(Ve,{src:n.specialist.avatar_url||void 0}),e.jsx(qe,{children:((w=n.specialist.display_name)==null?void 0:w.split(" ").map(E=>E[0]).join("").slice(0,2).toUpperCase())||"?"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Специалист"}),e.jsx("p",{className:"font-medium",children:n.specialist.display_name}),n.specialist.experience_years&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(ut,{className:"h-3 w-3"}),"Опыт: ",n.specialist.experience_years," лет"]})]}),e.jsx(ot,{className:"h-4 w-4 text-muted-foreground"})]}),n.status!=="payment_pending"&&n.video_room_url&&(()=>{const E=new Date(n.scheduled_at),L=new Date,M=(E.getTime()-L.getTime())/1e3/60;return n.status==="in_progress"||M<=15?e.jsxs(z,{variant:n.status==="in_progress"?"default":"outline",size:"sm",onClick:()=>window.open(n.video_room_url,"_blank"),className:n.status==="in_progress"?"bg-success hover:bg-success/90":"",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),n.status==="in_progress"?"Войти сейчас":"Войти в комнату"]}):e.jsxs(z,{variant:"outline",size:"sm",disabled:!0,className:"opacity-50",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Доступно за 15 мин"]})})(),n.status==="payment_pending"&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Ссылка на оплату отправлена на email"}),n.status!=="payment_pending"&&e.jsxs(Ze,{open:l===n.id,onOpenChange:E=>f(E?n.id:null),children:[e.jsx(Xe,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-destructive hover:bg-muted/50 font-light",children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"Отменить"]})}),e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(st,{children:"Отменить консультацию?"}),e.jsx(nt,{children:"Вы уверены, что хотите отменить консультацию? Это действие нельзя отменить."})]}),e.jsxs(rt,{children:[e.jsx(it,{children:"Нет, оставить"}),e.jsx(at,{onClick:()=>W(n.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Да, отменить"})]})]})]})]})]})})},n.id)})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4",children:[e.jsx(rs,{className:"static translate-y-0 h-8 w-8"}),e.jsx(is,{className:"static translate-y-0 h-8 w-8"})]})]})]}),B?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})}):null,e.jsx(fn,{profilesCount:U.length,className:"mb-8"}),e.jsx("div",{className:"mb-8",children:e.jsx(Ne,{size:"xl",className:"mb-4",children:"С чего начать?"})}),Ae&&e.jsxs("div",{className:"mb-8 flex items-start gap-3 rounded-xl border border-amber-200 bg-amber-50 p-4 text-amber-800",children:[e.jsx(Qe,{className:"mt-0.5 h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Чекап для детей до ",Lt," лет пока недоступен"]}),e.jsxs("p",{className:"mt-1 text-amber-700",children:["Наш чекап разработан для детей от ",Lt," до ",As," лет. Однако вы можете получить консультацию специалиста для себя как родителя. Для этого напишите в поддержку — мы поможем записаться."]}),e.jsxs(z,{variant:"outline",size:"sm",className:"mt-3 border-amber-300 text-amber-800 hover:bg-amber-100",onClick:()=>window.open("https://t.me/waves_support_bot","_blank","noopener,noreferrer"),children:[e.jsx(Dt,{className:"h-4 w-4 mr-2"}),"Написать в поддержку"]})]})]}),e.jsxs("div",{className:"mb-12 grid gap-6 md:grid-cols-2 md:items-stretch",children:[e.jsx("div",{className:"flex flex-col gap-4 h-full",children:e.jsxs(Ft,{className:`group relative overflow-hidden p-8 transition-all flex flex-col ${I.allowed?"cursor-pointer hover:scale-[1.02] active:scale-[0.98]":"cursor-not-allowed opacity-75"}`,gradient:I.allowed?"pink":void 0,hover:I.allowed,style:{height:"100%",minHeight:"340px"},onClick:n=>{if(!I.allowed){n.preventDefault(),n.stopPropagation();return}n.preventDefault(),n.stopPropagation(),Ce()},role:"button",tabIndex:I.allowed?0:-1,onKeyDown:n=>{I.allowed&&(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),Ce())},children:[e.jsx("div",{className:"absolute top-4 right-4 w-12 h-12 rounded-full bg-honey flex items-center justify-center shadow-soft pointer-events-none z-10",children:e.jsx("span",{className:"text-ink font-light text-xl",children:"1"})}),e.jsxs("div",{className:"flex flex-col items-center text-center justify-center flex-1",onClick:n=>{if(!I.allowed){n.stopPropagation();return}n.stopPropagation(),Ce()},children:[e.jsx("img",{src:Zs,alt:"Проверка психического здоровья семьи",className:`mb-6 h-40 w-auto object-contain transition-transform pointer-events-none ${I.allowed?"group-hover:scale-110":""}`}),e.jsx(Ne,{size:"lg",className:`mb-2 transition-colors pointer-events-none ${I.allowed?"group-hover:text-coral":"text-muted-foreground"}`,children:"Пройти чекап"}),I.allowed&&I.reason==="active_checkup_exists"&&e.jsx("p",{className:`text-lg font-medium pointer-events-none ${I.allowed?"text-muted-foreground":"text-muted-foreground/70"}`,children:"Продолжить проверку"}),!I.allowed&&I.reason==="too_soon"&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs(ae,{variant:"secondary",className:"bg-muted text-muted-foreground border border-border/50 px-4 py-2 rounded-full font-light hover:bg-muted",children:[e.jsx(be,{className:"h-3.5 w-3.5 mr-2"}),I.daysRemaining?`Повторно можно пройти через ${I.daysRemaining} ${I.daysRemaining===1?"день":I.daysRemaining<5?"дня":"дней"}`:"Чекап можно пройти только раз в месяц или после добавления нового ребенка"]})})]})]})}),e.jsx("div",{children:e.jsxs(Ft,{className:`group relative overflow-hidden p-8 transition-all flex flex-col ${Q?"cursor-pointer hover:scale-[1.02] active:scale-[0.98]":"cursor-not-allowed opacity-75"}`,gradient:Q?"lavender":void 0,hover:Q,style:{height:"100%",minHeight:"340px"},onClick:()=>Q&&t("/appointments"),role:Q?"button":void 0,tabIndex:Q?0:-1,onKeyDown:n=>{Q&&(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),t("/appointments"))},children:[e.jsx("div",{className:"absolute top-4 right-4 w-12 h-12 rounded-full bg-honey flex items-center justify-center shadow-soft pointer-events-none z-10",children:e.jsx("span",{className:"text-ink font-light text-xl",children:"2"})}),e.jsxs("div",{className:"flex flex-col items-center text-center justify-center flex-1",children:[e.jsx("img",{src:Qs,alt:"Waves Portal",className:`mb-6 h-40 w-auto object-contain transition-transform pointer-events-none ${Q?"group-hover:scale-110":""}`}),e.jsx(Ne,{size:"lg",className:`mb-2 transition-colors pointer-events-none ${Q?"text-foreground group-hover:text-coral":"text-muted-foreground"}`,children:"Получить консультацию"}),!Q&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs(ae,{variant:"secondary",className:"bg-muted text-muted-foreground border border-border/50 px-4 py-2 rounded-full font-light hover:bg-muted",children:[e.jsx(be,{className:"h-3.5 w-3.5 mr-2"}),"Для доступа к консультациям пройдите чекап"]})})]})]})})]}),e.jsxs("div",{className:"mb-12",children:[e.jsx(Ne,{size:"xl",className:"mb-4",children:"Есть вопросы?"}),e.jsxs(ke,{className:"glass-elegant border-2 p-6",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Напишите в поддержку, чтобы решить любые проблемы или записаться к специалисту напрямую без предварительной диагностики."}),e.jsxs(z,{onClick:()=>window.open("https://t.me/waves_support_bot","_blank","noopener,noreferrer"),children:[e.jsx(Dt,{className:"h-4 w-4 mr-2"}),"Написать в поддержку"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx(Ne,{size:"xl",children:"Ваша семья"}),U.length>0&&e.jsxs(z,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground hover:bg-muted/50 font-light",onClick:()=>t("/add-family-member",{state:{from:"cabinet"}}),children:[e.jsx(zt,{className:"h-4 w-4 mr-2"}),"Добавить члена семьи"]})]}),U.length===0?e.jsxs(ke,{className:"border-2 bg-card p-8 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Пока нет членов семьи"}),e.jsxs(z,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground hover:bg-muted/50 font-light",onClick:()=>t("/add-family-member",{state:{from:"cabinet"}}),children:[e.jsx(zt,{className:"h-4 w-4 mr-2"}),"Добавить члена семьи"]})]}):e.jsxs("div",{className:"relative",children:[C&&e.jsx(z,{variant:"ghost",size:"icon",className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 h-10 w-10 rounded-full bg-white/90 hover:bg-white shadow-md",onClick:()=>pe("left"),"aria-label":"Предыдущая карточка",children:e.jsx(Es,{className:"h-5 w-5 text-ink"})}),O&&e.jsx(z,{variant:"ghost",size:"icon",className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 h-10 w-10 rounded-full bg-white/90 hover:bg-white shadow-md",onClick:()=>pe("right"),"aria-label":"Следующая карточка",children:e.jsx(Wt,{className:"h-5 w-5 text-ink"})}),e.jsx("div",{ref:x,className:"flex gap-4 overflow-x-auto pb-4 scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch",touchAction:"pan-x"},onScroll:J,children:U.map(n=>{var M,Z;const w=n.dob?Ds(n.dob):null,E=((M=n.checkupAssessment)==null?void 0:M.status)==="completed",L=(Z=n.checkupAssessment)!=null&&Z.completed_at?new Date(n.checkupAssessment.completed_at).toLocaleDateString("ru-RU"):null;return e.jsx(ke,{className:"glass-elegant min-w-[320px] flex-shrink-0 flex flex-col border-2 p-6 transition-all hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col items-center text-center flex-1",children:[e.jsx("img",{src:_(n),alt:`${n.first_name} ${n.last_name||""}`,className:"h-20 w-20 rounded-full object-cover mb-4"}),e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs(Ne,{size:"lg",children:[n.first_name," ",n.last_name||""]})}),w!==null&&e.jsxs("p",{className:"text-muted-foreground mb-2",children:[w," лет"]}),E&&e.jsxs(ae,{variant:"default",className:"bg-success text-success-foreground hover:bg-success font-light mb-2",children:[e.jsx(Kt,{className:"h-3 w-3 mr-1"}),"Чекап завершен"]}),E&&L&&e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Завершен: ",L]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-auto w-full",children:[E&&e.jsxs(z,{variant:"outline",size:"sm",className:"w-full",onClick:()=>t(`/results-report?profileId=${n.id}`),children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"Посмотреть результаты"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"ghost",size:"sm",className:"flex-1 text-muted-foreground hover:text-foreground hover:bg-muted/50 font-light",onClick:()=>{_e.log("Edit clicked for member:",{id:n.id,name:`${n.first_name} ${n.last_name}`,type:n.type,isParent:n.type==="parent"}),n.type==="parent"?t("/profile",{state:{from:"cabinet"}}):t(`/edit-family-member/${n.id}`,{state:{from:"cabinet"}})},children:[e.jsx(Js,{className:"h-4 w-4 mr-2"}),"Редактировать"]}),n.type!=="parent"&&e.jsxs(Ze,{open:b===n.id,onOpenChange:de=>m(de?n.id:null),children:[e.jsx(Xe,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"flex-1 text-muted-foreground hover:text-destructive hover:bg-muted/50 font-light",onClick:()=>m(n.id),children:[e.jsx(Yt,{className:"h-4 w-4 mr-2"}),"Удалить"]})}),e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(st,{children:"Удалить члена семьи?"}),e.jsxs(nt,{children:["Вы уверены, что хотите удалить ",n.first_name," ",n.last_name||"","? Это действие нельзя будет отменить."]})]}),e.jsxs(rt,{children:[e.jsx(it,{children:"Отмена"}),e.jsx(at,{onClick:()=>ie(n.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Удалить"})]})]})]})]})]})]})},n.id)})}),U.length>1&&e.jsx("div",{className:"flex justify-center gap-2 mt-4",children:U.map((n,w)=>e.jsx("button",{className:`h-2 w-2 rounded-full transition-colors ${w===S?"bg-coral-light":"bg-muted-foreground/30 hover:bg-muted-foreground/60"}`,onClick:()=>ge(w),"aria-label":`Перейти к карточке ${w+1}`},w))})]})]}),e.jsx(Me,{open:!!v,onOpenChange:n=>!n&&p(null),children:e.jsx(Pe,{className:"max-w-2xl w-[90vw] max-h-[90vh] overflow-y-auto p-0 bg-background",style:{background:"var(--bg-golden-hour)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed"},children:e.jsx("div",{className:"px-6 pb-6 pt-6",children:v&&e.jsx(sn,{specialistId:v,showChangeButton:!0,onSpecialistChange:()=>p(null)})})})}),g&&e.jsx(ln,{pendingRating:g,open:u,onClose:()=>{h(!1),N(null)},onSubmitted:async()=>{h(!1),N(null);const n=await Ot();n&&(N(n),h(!0))}})]})}export{Cr as default};
