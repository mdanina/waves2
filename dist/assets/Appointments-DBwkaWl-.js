import{r as a,j as e}from"./vendor-radix-J7BmBqsC.js";import{H as F,O as P,C as o,aa as _,B as c,a9 as G,L as A,t as B,a0 as L,ab as H,a5 as V}from"./index-CsvxaYtI.js";import{R as W,a as $}from"./radio-group-DaEomwmN.js";import{c as Y,u as q,d as D,e as U,a as X,b as J}from"./useAppointments-CyaU3UD4.js";import{u as K}from"./useProfiles-Bh4H3Y1m.js";import{u as Q}from"./useAssessments-v2X3fjfe.js";import{F as Z,h as ee}from"./appointmentStorage-D1wbbDxY.js";import{f as se}from"./payment-DTuz5w0b.js";import{u as te}from"./vendor-react-CI1J5nwZ.js";import{G as re}from"./gift-DXVN0wLk.js";import{L as ae}from"./lock-Dh4_7Z3d.js";import"./vendor-charts-CkgrveCd.js";import"./vendor-query-Bb981xLV.js";import"./profileStorage-CU3CxDLE.js";import"./assessmentStorage-kMcQQ0-2.js";function Ce(){const u=te(),{data:i,isLoading:E}=Y(),{data:d,isLoading:T}=q(),{data:S}=D(),{data:n,isLoading:M}=U(),{data:m,isLoading:I}=X(),{data:x}=K();J();const[l,p]=a.useState(null),[ie,ne]=a.useState(null),[f,O]=a.useState(!1),C=a.useMemo(()=>x?x.filter(s=>s.type==="child"):[],[x]),R=a.useMemo(()=>C.map(s=>s.id),[C]),{data:h}=Q(R,"checkup"),j=a.useMemo(()=>h?Object.values(h).some(s=>(s==null?void 0:s.status)==="completed"):!1,[h]);a.useEffect(()=>{async function s(){const r=await ee();O(r)}s()},[d,m]);const{freeConsultations:g,paidConsultations:w}=a.useMemo(()=>{if(!i)return{freeConsultations:[],paidConsultations:[]};const s=i.filter(v=>v.price===0),r=i.filter(v=>v.price>0);return{freeConsultations:s,paidConsultations:r}},[i]),N=(n==null?void 0:n.expired)??!1,t=(n==null?void 0:n.daysLeft)??null,b=a.useMemo(()=>g.length?d?[]:j?f?N?[]:g:[]:[]:[],[g,d,j,f,N]),k=!!d||!!S;a.useMemo(()=>m?m.filter(s=>s.status==="scheduled"):[],[m]);const z=()=>{l&&u(`/appointments/booking?type=${l}`)},y={background:"var(--bg-golden-hour)",backgroundAttachment:"fixed"};return E||T||I||M?e.jsxs("div",{className:"min-h-screen bg-background",style:y,children:[e.jsx(F,{}),e.jsx("div",{className:"container mx-auto px-4 py-20 flex items-center justify-center",children:e.jsx(P,{className:"h-8 w-8 animate-spin text-primary"})})]}):e.jsxs("div",{className:"min-h-screen bg-background",style:y,children:[e.jsx(F,{}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 pt-8 pb-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Записаться на консультацию"}),e.jsx("p",{className:"text-muted-foreground",children:"Выберите тип консультации"})]}),e.jsxs("div",{className:"mb-8 flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary text-primary-foreground text-sm font-medium",children:"1"}),e.jsx("span",{className:"font-medium",children:"Выберите тип консультации"})]}),e.jsx("div",{className:"h-px flex-1 bg-border"}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-muted text-muted-foreground text-sm font-medium",children:"2"}),e.jsx("span",{children:"Выберите дату и время"})]})]}),i&&i.length>0?e.jsx(W,{value:l||void 0,onValueChange:p,children:e.jsxs("div",{className:"space-y-4 mb-8",children:[j&&f&&!d&&N&&e.jsx(o,{className:"p-4 border-destructive bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_,{className:"h-5 w-5 text-destructive shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-destructive",children:"Срок бесплатной консультации истёк"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Бесплатная 30-минутная консультация с координатором была доступна в течение ",Z," дней после завершения чекапа. Для записи к специалисту, пожалуйста, свяжитесь с нашей поддержкой."]}),e.jsx(c,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>u("/cabinet/messages"),children:"Написать в поддержку"})]})]})}),b.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-foreground flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-primary"}),"Бесплатные консультации"]}),t!==null&&t>0&&e.jsx(o,{className:`p-3 ${t<=3?"border-warning bg-warning/10":"border-muted bg-muted/50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:`h-4 w-4 ${t<=3?"text-warning":"text-muted-foreground"}`}),e.jsx("p",{className:`text-sm ${t<=3?"text-warning font-medium":"text-muted-foreground"}`,children:t<=3?`Осталось ${t} ${t===1?"день":t<=4?"дня":"дней"} для записи на бесплатную консультацию`:`Бесплатная консультация доступна ещё ${t} ${t===1?"день":t<=4?"дня":"дней"}`})]})}),b.map(s=>e.jsx(o,{className:`p-6 cursor-pointer transition-all ${l===s.id?"border-2 border-primary bg-primary/5":"border border-border hover:border-primary/50"}`,onClick:()=>p(s.id),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx($,{value:s.id,id:s.id,className:"mt-1"}),e.jsx(A,{htmlFor:s.id,className:"flex-1 cursor-pointer",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:s.name}),e.jsx(B,{variant:"default",className:"bg-success text-success-foreground",children:"Бесплатно"})]}),e.jsxs("p",{className:"text-muted-foreground mb-2",children:[s.duration_minutes," минут"]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]}),e.jsx("div",{className:"ml-4 flex items-center gap-2",children:e.jsxs(c,{variant:"outline",size:"sm",className:"pointer-events-none",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Видеозвонок"]})})]})})]})},s.id))]}),w.length>0&&e.jsxs("div",{className:"space-y-4",children:[b.length>0&&e.jsx("h2",{className:"text-lg font-semibold text-foreground mt-6",children:"Платные консультации"}),!k&&e.jsx(o,{className:"p-4 border-primary/30 bg-primary/5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(H,{className:"h-5 w-5 text-primary shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Хотите записаться к специалисту напрямую?"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Напишите нам, расскажите о своём запросе, и мы подберём подходящего специалиста."}),e.jsx(c,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>u("/cabinet/messages"),children:"Написать в поддержку"})]})]})}),w.map(s=>{const r=!k;return e.jsx(o,{className:`p-6 transition-all ${r?"opacity-50 cursor-not-allowed border border-border":l===s.id?"border-2 border-primary bg-primary/5 cursor-pointer":"border border-border hover:border-primary/50 cursor-pointer"}`,onClick:()=>!r&&p(s.id),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx($,{value:s.id,id:s.id,className:"mt-1",disabled:r}),e.jsx(A,{htmlFor:s.id,className:`flex-1 ${r?"cursor-not-allowed":"cursor-pointer"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:s.name}),e.jsx("span",{className:"text-lg font-bold text-primary",children:se(s.price)}),r&&e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs("p",{className:"text-muted-foreground mb-2",children:[s.duration_minutes," минут"]}),r?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Сначала пройдите бесплатную консультацию"}):s.description?e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}):null]}),e.jsx("div",{className:"ml-4 flex items-center gap-2",children:e.jsxs(c,{variant:"outline",size:"sm",className:"pointer-events-none",disabled:r,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Видеозвонок"]})})]})})]})},s.id)})]})]})}):e.jsx(o,{className:"p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Нет доступных типов консультаций. Пожалуйста, обратитесь к администратору."})}),l&&e.jsx("div",{className:"flex justify-center",children:e.jsxs(c,{size:"lg",onClick:z,className:"min-w-[200px]",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Подтвердить тип консультации"]})})]})]})}export{Ce as default};
