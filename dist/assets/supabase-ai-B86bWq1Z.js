import{v as a}from"./index-Dv2C02zj.js";async function _(){const{data:e,error:r}=await a.from("note_block_templates").select("*").eq("is_active",!0).order("position",{ascending:!0});if(r)throw new Error(r.message);return e||[]}async function d(){const{data:{user:e}}=await a.auth.getUser(),{data:r,error:t}=await a.from("clinical_note_templates").select("*").eq("is_active",!0).or(`is_system.eq.true,user_id.eq.${e==null?void 0:e.id},user_id.is.null`).order("is_default",{ascending:!1});if(t)throw new Error(t.message);return r||[]}async function w(e,r){const{data:{user:t}}=await a.auth.getUser();if(!t)throw new Error("Необходима авторизация");const{data:s,error:o}=await a.from("clinical_note_templates").select("is_system, user_id").eq("id",e).single();if(o)throw new Error(o.message);if(!s)throw new Error("Шаблон не найден");if(s.is_system)throw new Error("Системные шаблоны нельзя редактировать");if(s.user_id!==t.id)throw new Error("Вы можете редактировать только свои шаблоны");const{error:i}=await a.from("clinical_note_templates").update({block_template_ids:r}).eq("id",e);if(i)throw new Error(i.message)}async function m(e,r){const{data:{user:t}}=await a.auth.getUser();if(!t)throw new Error("Необходима авторизация");const{data:s,error:o}=await a.from("clinical_note_templates").select("block_template_ids, is_system, user_id").eq("id",e).single();if(o)throw new Error(o.message);if(!s)throw new Error("Шаблон не найден");if(s.is_system)throw new Error("Системные шаблоны нельзя редактировать");if(s.user_id!==t.id)throw new Error("Вы можете редактировать только свои шаблоны");if(s.block_template_ids.includes(r))throw new Error("Блок уже добавлен в шаблон");const i=[...s.block_template_ids,r],{error:n}=await a.from("clinical_note_templates").update({block_template_ids:i}).eq("id",e);if(n)throw new Error(n.message)}async function f(e,r){const{data:{user:t}}=await a.auth.getUser();if(!t)throw new Error("Необходима авторизация");const{data:s,error:o}=await a.from("clinical_note_templates").select("block_template_ids, is_system, user_id").eq("id",e).single();if(o)throw new Error(o.message);if(!s)throw new Error("Шаблон не найден");if(s.is_system)throw new Error("Системные шаблоны нельзя редактировать");if(s.user_id!==t.id)throw new Error("Вы можете редактировать только свои шаблоны");const i=s.block_template_ids.filter(c=>c!==r),{error:n}=await a.from("clinical_note_templates").update({block_template_ids:i}).eq("id",e);if(n)throw new Error(n.message)}async function u(e,r,t,s,o=!1){const{data:{user:i}}=await a.auth.getUser();if(!i)throw new Error("Необходима авторизация");o&&await a.from("clinical_note_templates").update({is_default:!1}).eq("user_id",i.id).eq("is_default",!0);const{data:n,error:c}=await a.from("clinical_note_templates").insert({user_id:i.id,name:e,name_en:r,description:t,block_template_ids:s,is_default:o,is_system:!1,is_active:!0}).select().single();if(c)throw new Error(c.message);return n}async function p(e){throw new Error("AI сервис не настроен. Обратитесь к администратору.")}async function h(e){const{data:r,error:t}=await a.from("clinical_notes").select(`
      *,
      sections:clinical_note_sections (
        *,
        block_template:note_block_templates (*)
      ),
      template:clinical_note_templates (*)
    `).eq("appointment_id",e).is("deleted_at",null).order("created_at",{ascending:!1});if(t)throw new Error(t.message);return r||[]}async function g(e){const{data:r,error:t}=await a.from("clinical_notes").select(`
      *,
      sections:clinical_note_sections (
        *,
        block_template:note_block_templates (*)
      ),
      template:clinical_note_templates (*)
    `).eq("client_user_id",e).is("deleted_at",null).order("created_at",{ascending:!1});if(t)throw new Error(t.message);return r||[]}async function E(e,r){const{error:t}=await a.from("clinical_note_sections").update({content:r,updated_at:new Date().toISOString()}).eq("id",e);if(t)throw new Error(t.message)}async function y(e){throw new Error("AI сервис не настроен. Обратитесь к администратору.")}export{p as a,h as b,y as c,g as d,_ as e,u as f,d as g,w as h,m as i,f as r,E as u};
