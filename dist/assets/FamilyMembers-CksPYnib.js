import{r as t,j as e}from"./vendor-radix-J7BmBqsC.js";import{u as H}from"./vendor-query-Bb981xLV.js";import{S as O}from"./StepIndicator-DWX8F6yO.js";import{u as Q,j as S,C as D,m as z,S as P,B as i,A as q,o as B,p as R,q as m,f as g}from"./index-CsvxaYtI.js";import{p as J,a as I}from"./friendly-and-clean-face-of-an-adult-person--gender (1)-mshj5uDX.js";import{c as K,a as W}from"./friendly-and-clean-face-of-a-white-boy-7-yo--soft- (1)-BoJK1GJM.js";import{calculateAge as M,getProfiles as G,deleteProfile as U}from"./profileStorage-CU3CxDLE.js";import{A as V,a as X,b as Y,c as Z,d as ee,e as se,f as te,g as ae}from"./alert-dialog-COnYxGom.js";import{u as re,a as ne}from"./vendor-react-CI1J5nwZ.js";import{P as le}from"./pencil-DsYcog_b.js";import{T as ie}from"./trash-2-BiEfhxdN.js";import{P as oe}from"./plus-CNlpg7MV.js";import"./vendor-charts-CkgrveCd.js";const ce="/assets/minimalistic-and-friendly-vector-style-illustratio-BD6epQQO.png";function de(){const[n,a]=t.useState(null);return t.useEffect(()=>{try{const d=localStorage.getItem("waves_licenses"),c=d?JSON.parse(d):[];a(c.length>0)}catch{a(!1)}},[]),n}function Ae(){var A,k,C;const n=re(),a=ne(),d=H(),{user:c}=Q(),[o,j]=t.useState([]),[u,x]=t.useState(null),[E,b]=t.useState(!0),L=de(),y=((A=a.state)==null?void 0:A.from)==="cabinet";t.useEffect(()=>{let s=!1;async function l(){try{s||b(!0);const r=await G();if(s)return;m.log("Loaded profiles:",r),m.log("Profiles with types:",r.map(_=>({name:_.first_name,type:_.type}))),j(r)}catch(r){s||(m.error("Error loading family members:",r),g.error("Ошибка при загрузке членов семьи"))}finally{s||b(!1)}}return l(),()=>{s=!0}},[a.pathname]);const $=t.useCallback(s=>s.type==="parent"?s.gender==="male"?J:I:s.type==="child"?s.gender==="male"?K:W:I,[]),F=async s=>{try{await U(s),await d.invalidateQueries({queryKey:["profiles",c==null?void 0:c.id]}),j(l=>l.filter(r=>r.id!==s)),x(null),g.success("Член семьи удален")}catch(l){m.error("Error deleting profile:",l),g.error("Ошибка при удалении члена семьи")}},h=t.useMemo(()=>o.find(s=>s.type==="parent"),[o]),v=(h==null?void 0:h.seeking_care)==="yes",N=t.useMemo(()=>o.filter(s=>s.type==="child"),[o]),w=t.useMemo(()=>N.filter(s=>(s.dob?M(s.dob):0)>=6),[N]),f=((k=a.state)==null?void 0:k.from)!=="cabinet",p=t.useMemo(()=>!f||v?!0:w.length>=1,[f,v,w.length]),T=()=>{p&&n("/cabinet")};return y&&L===!1?e.jsx("div",{className:"min-h-screen",style:{backgroundImage:`url(${S})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"},children:e.jsx("div",{className:"container mx-auto max-w-2xl px-4 py-12",children:e.jsx(D,{className:"rounded-[20px] border-2 bg-white p-8 shadow-[0_4px_20px_rgba(0,0,0,0.06)]",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-6 rounded-full bg-muted/50 flex items-center justify-center",children:e.jsx(z,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx(P,{size:"xl",className:"mb-4",children:"Управление участниками"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Раздел станет доступен после приобретения лицензии. Здесь вы сможете добавить членов семьи, которые будут использовать платформу."}),e.jsxs(i,{onClick:()=>n("/cabinet/licenses"),className:"bg-gradient-to-r from-coral to-coral-light hover:opacity-90",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Приобрести лицензию"]})]})})})}):e.jsxs("div",{className:"min-h-screen",style:{backgroundImage:`url(${S})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"},children:[e.jsx("div",{className:"container mx-auto max-w-2xl px-4 py-12",children:e.jsxs(D,{className:"rounded-[20px] border-2 bg-white p-8 shadow-[0_4px_20px_rgba(0,0,0,0.06)]",children:[!y&&e.jsx(O,{currentStep:3,totalSteps:3,label:"ПРОФИЛЬ СЕМЬИ"}),e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:ce,alt:"Семья",className:"mx-auto mb-6 h-32 w-32 object-contain"}),e.jsx(P,{size:"2xl",className:"mb-4",children:"Члены семьи"}),e.jsx("p",{className:"text-muted-foreground",children:"Добавьте только тех членов семьи, которых вы планируете подключить к тренировкам на платформе."})]}),f&&!p&&e.jsxs(q,{variant:"warning",className:"shadow-[0_0_20px_rgba(255,178,153,0.5)]",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(R,{children:"Нужно выбрать хотя бы одного участника старше 6 лет, чтобы получить доступ к тренировкам."})]}),e.jsxs("div",{className:"space-y-4",children:[E?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})}):o.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Пока нет членов семьи"})}):o.map(s=>{const l=s.dob?M(s.dob):null;return e.jsxs("div",{className:"flex items-center gap-4 rounded-lg border border-border bg-card p-4 transition-shadow hover:shadow-md",children:[e.jsx("img",{src:$(s),alt:`${s.first_name} ${s.last_name||""}`,className:"h-14 w-14 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-foreground",children:[s.first_name," ",s.last_name||""]}),l!==null&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l," лет"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",size:"icon",onClick:()=>{var r;console.log("Edit clicked for member:",{id:s.id,name:`${s.first_name} ${s.last_name}`,type:s.type,isParent:s.type==="parent"}),s.type==="parent"?n("/profile",{state:{from:((r=a.state)==null?void 0:r.from)==="cabinet"?"cabinet":"family-members"}}):n(`/edit-family-member/${s.id}`,{state:a.state?{from:a.state.from}:void 0})},className:"hover:border-coral hover:text-coral transition-colors",children:e.jsx(le,{className:"h-4 w-4"})}),s.type!=="parent"&&e.jsx(i,{variant:"outline",size:"icon",onClick:()=>x(s.id),className:"hover:border-destructive hover:text-destructive transition-colors",children:e.jsx(ie,{className:"h-4 w-4"})})]})]},s.id)}),e.jsxs(i,{variant:"outline",size:"lg",onClick:()=>n("/add-family-member"),className:"h-14 w-full text-base font-medium hover:border-coral hover:text-coral transition-colors",children:[e.jsx(oe,{className:"mr-2 h-5 w-5"}),"Добавить члена семьи"]})]}),e.jsx("div",{className:"flex gap-4",children:((C=a.state)==null?void 0:C.from)==="cabinet"?e.jsx(i,{type:"button",size:"lg",onClick:()=>n("/cabinet"),className:"h-14 w-full text-base font-medium",children:"Вернуться в кабинет"}):e.jsxs(e.Fragment,{children:[e.jsx(i,{type:"button",variant:"outline",size:"lg",onClick:()=>n("/family-setup"),className:"h-14 flex-1 text-base font-medium",children:"Назад"}),e.jsx(i,{type:"button",size:"lg",onClick:T,disabled:!p,className:"h-14 flex-1 text-base font-medium",children:"Завершить"})]})})]})]})}),e.jsx(V,{open:u!==null,onOpenChange:()=>x(null),children:e.jsxs(X,{children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Удалить члена семьи?"}),e.jsx(ee,{children:"Это действие нельзя отменить. Данные члена семьи будут удалены навсегда."})]}),e.jsxs(se,{children:[e.jsx(te,{children:"Отмена"}),e.jsx(ae,{onClick:()=>u&&F(u),children:"Удалить"})]})]})})]})}export{Ae as default};
