import{r,j as e}from"./vendor-radix-CDHcN1cP.js";import{U as P,H as F,Z as _,C as o,ae as G,B as c,ad as B,L as A,D,a7 as L,af as H,a9 as U}from"./index-Dt6uKTGi.js";import{R as V,a as $}from"./radio-group-BCLlkBMv.js";import{c as W,u as Y,d as q,e as X,a as Z,b as J}from"./useAppointments-BUGKN8HV.js";import{u as K}from"./useAssessments-DyPv7xmI.js";import{F as Q,h as ee}from"./appointmentStorage-Dmm45BMo.js";import{f as se}from"./payment-D8K9xJGc.js";import{u as te}from"./vendor-react-D0zZO7ze.js";import{G as ae}from"./gift-Ch5TlsV8.js";import{L as re}from"./lock-tC1SW_5C.js";import"./vendor-charts-DMFz3Lzq.js";import"./vendor-query-DyYoeD25.js";import"./assessmentStorage-BtF7XoQl.js";function be(){const u=te(),{data:i,isLoading:E}=W(),{data:d,isLoading:T}=Y(),{data:S}=q(),{data:n,isLoading:M}=X(),{data:m,isLoading:I}=Z(),{data:x}=P();J();const[l,f]=r.useState(null),[ie,ne]=r.useState(null),[p,R]=r.useState(!1),C=r.useMemo(()=>x?x.filter(s=>s.type==="child"):[],[x]),z=r.useMemo(()=>C.map(s=>s.id),[C]),{data:h}=K(z,"checkup"),j=r.useMemo(()=>h?Object.values(h).some(s=>(s==null?void 0:s.status)==="completed"):!1,[h]);r.useEffect(()=>{async function s(){const a=await ee();R(a)}s()},[d,m]);const{freeConsultations:g,paidConsultations:w}=r.useMemo(()=>{if(!i)return{freeConsultations:[],paidConsultations:[]};const s=i.filter(v=>v.price===0),a=i.filter(v=>v.price>0);return{freeConsultations:s,paidConsultations:a}},[i]),N=(n==null?void 0:n.expired)??!1,t=(n==null?void 0:n.daysLeft)??null,b=r.useMemo(()=>g.length?d?[]:j?p?N?[]:g:[]:[]:[],[g,d,j,p,N]),k=!!d||!!S;r.useMemo(()=>m?m.filter(s=>s.status==="scheduled"):[],[m]);const O=()=>{l&&u(`/appointments/booking?type=${l}`)},y={background:"var(--bg-golden-hour)",backgroundAttachment:"fixed"};return E||T||I||M?e.jsxs("div",{className:"min-h-screen bg-background",style:y,children:[e.jsx(F,{}),e.jsx("div",{className:"container mx-auto px-4 py-20 flex items-center justify-center",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-primary"})})]}):e.jsxs("div",{className:"min-h-screen bg-background",style:y,children:[e.jsx(F,{}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 pt-8 pb-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"Записаться на консультацию"}),e.jsx("p",{className:"text-muted-foreground",children:"Выберите тип консультации"})]}),e.jsxs("div",{className:"mb-8 flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary text-primary-foreground text-sm font-medium",children:"1"}),e.jsx("span",{className:"font-medium",children:"Выберите тип консультации"})]}),e.jsx("div",{className:"h-px flex-1 bg-border"}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-muted text-muted-foreground text-sm font-medium",children:"2"}),e.jsx("span",{children:"Выберите дату и время"})]})]}),i&&i.length>0?e.jsx(V,{value:l||void 0,onValueChange:f,children:e.jsxs("div",{className:"space-y-4 mb-8",children:[j&&p&&!d&&N&&e.jsx(o,{className:"p-4 border-destructive bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(G,{className:"h-5 w-5 text-destructive shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-destructive",children:"Срок бесплатной консультации истёк"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Бесплатная 30-минутная консультация с координатором была доступна в течение ",Q," дней после завершения чекапа. Для записи к специалисту, пожалуйста, свяжитесь с нашей поддержкой."]}),e.jsx(c,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>u("/cabinet/messages"),children:"Написать в поддержку"})]})]})}),b.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-foreground flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-primary"}),"Бесплатные консультации"]}),t!==null&&t>0&&e.jsx(o,{className:`p-3 ${t<=3?"border-warning bg-warning/10":"border-muted bg-muted/50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:`h-4 w-4 ${t<=3?"text-warning":"text-muted-foreground"}`}),e.jsx("p",{className:`text-sm ${t<=3?"text-warning font-medium":"text-muted-foreground"}`,children:t<=3?`Осталось ${t} ${t===1?"день":t<=4?"дня":"дней"} для записи на бесплатную консультацию`:`Бесплатная консультация доступна ещё ${t} ${t===1?"день":t<=4?"дня":"дней"}`})]})}),b.map(s=>e.jsx(o,{className:`p-6 cursor-pointer transition-all ${l===s.id?"border-2 border-primary bg-primary/5":"border border-border hover:border-primary/50"}`,onClick:()=>f(s.id),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx($,{value:s.id,id:s.id,className:"mt-1"}),e.jsx(A,{htmlFor:s.id,className:"flex-1 cursor-pointer",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:s.name}),e.jsx(D,{variant:"default",className:"bg-success text-success-foreground",children:"Бесплатно"})]}),e.jsxs("p",{className:"text-muted-foreground mb-2",children:[s.duration_minutes," минут"]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]}),e.jsx("div",{className:"ml-4 flex items-center gap-2",children:e.jsxs(c,{variant:"outline",size:"sm",className:"pointer-events-none",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Видеозвонок"]})})]})})]})},s.id))]}),w.length>0&&e.jsxs("div",{className:"space-y-4",children:[b.length>0&&e.jsx("h2",{className:"text-lg font-semibold text-foreground mt-6",children:"Платные консультации"}),!k&&e.jsx(o,{className:"p-4 border-primary/30 bg-primary/5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(H,{className:"h-5 w-5 text-primary shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Хотите записаться к специалисту напрямую?"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Напишите нам, расскажите о своём запросе, и мы подберём подходящего специалиста."}),e.jsx(c,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>u("/cabinet/messages"),children:"Написать в поддержку"})]})]})}),w.map(s=>{const a=!k;return e.jsx(o,{className:`p-6 transition-all ${a?"opacity-50 cursor-not-allowed border border-border":l===s.id?"border-2 border-primary bg-primary/5 cursor-pointer":"border border-border hover:border-primary/50 cursor-pointer"}`,onClick:()=>!a&&f(s.id),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx($,{value:s.id,id:s.id,className:"mt-1",disabled:a}),e.jsx(A,{htmlFor:s.id,className:`flex-1 ${a?"cursor-not-allowed":"cursor-pointer"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:s.name}),e.jsx("span",{className:"text-lg font-bold text-primary",children:se(s.price)}),a&&e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs("p",{className:"text-muted-foreground mb-2",children:[s.duration_minutes," минут"]}),a?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Сначала пройдите бесплатную консультацию"}):s.description?e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}):null]}),e.jsx("div",{className:"ml-4 flex items-center gap-2",children:e.jsxs(c,{variant:"outline",size:"sm",className:"pointer-events-none",disabled:a,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Видеозвонок"]})})]})})]})},s.id)})]})]})}):e.jsx(o,{className:"p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Нет доступных типов консультаций. Пожалуйста, обратитесь к администратору."})}),l&&e.jsx("div",{className:"flex justify-center",children:e.jsxs(c,{size:"lg",onClick:O,className:"min-w-[200px]",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Подтвердить тип консультации"]})})]})]})}export{be as default};
