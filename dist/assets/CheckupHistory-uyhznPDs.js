import{r as i,j as e}from"./vendor-radix-htwXsPHy.js";import{u as _,D as f,S as k,E,C as x,h as p,B as h,G as D,U as S,F as R,p as o,f as j}from"./index-Bu4m9iDU.js";import{d as A}from"./assessmentStorage-CZ49b0Rv.js";import{getProfiles as F}from"./profileStorage-B9P4N8Co.js";import{u as U}from"./vendor-react-CI8wve7f.js";import"./vendor-charts-DjioKZbK.js";import"./vendor-query-BNGVDYIL.js";function I(){const a=U(),{user:n,loading:c}=_(),[d,g]=i.useState([]),[N,m]=i.useState(!0);i.useEffect(()=>{async function s(){if(!c){if(!n){a("/cabinet");return}try{m(!0);const[t,r]=await Promise.allSettled([F(),A()]),v=t.status==="fulfilled"?t.value:[],w=r.status==="fulfilled"?r.value:[];t.status==="rejected"&&o.error("Error loading profiles:",t.reason),r.status==="rejected"&&(o.error("Error loading assessments:",r.reason),j.error("Ошибка при загрузке истории чекапов"));const b=w.map(l=>({...l,profile:l.profile_id&&v.find(C=>C.id===l.profile_id)||null}));g(b)}catch(t){o.error("Error loading checkup history:",t),j.error("Ошибка при загрузке истории чекапов")}finally{m(!1)}}}s()},[n,c,a]);const u=i.useMemo(()=>d.filter(s=>s.status==="completed"&&s.assessment_type==="checkup"),[d]),y=s=>{s.profile_id&&a(`/results-report/${s.profile_id}?assessmentId=${s.id}`)};return e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 pt-8 pb-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(f,{className:"h-8 w-8 text-primary shrink-0"}),e.jsx(k,{size:"2xl",children:"История чекапов"})]})}),N?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(E,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Загрузка истории..."})]}):u.length===0?e.jsx(x,{children:e.jsxs(p,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(f,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"История пуста"}),e.jsx("p",{className:"text-muted-foreground text-center mb-4",children:"Вы еще не проходили чекапы. Начните с дашборда!"}),e.jsx(h,{onClick:()=>a("/cabinet"),children:"Перейти к дашборду"})]})}):e.jsx("div",{className:"space-y-4",children:u.map(s=>{const t=s.completed_at||s.created_at,r=new Date(t).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsx(x,{className:"hover:shadow-md transition-shadow",children:e.jsxs(p,{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(D,{className:"h-4 w-4"}),r]}),s.profile&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-medium",children:[s.profile.first_name," ",s.profile.last_name||""]})]})]}),s.profile_id&&e.jsxs(h,{onClick:()=>y(s),size:"sm",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Просмотреть отчет"]})]})},s.id)})})]})}export{I as default};
