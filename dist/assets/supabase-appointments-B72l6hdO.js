import{w as s,p as o}from"./index-BetUtCwY.js";async function m(e,n,r){const{data:i,error:t}=await s.from("appointments").select(`
      *,
      appointment_type:appointment_types (id, name, duration_minutes, price),
      profile:profiles (id, first_name, last_name),
      client_user:users!appointments_user_id_fkey (id, email, phone)
    `).eq("specialist_id",e).gte("scheduled_at",n.toISOString()).lte("scheduled_at",r.toISOString()).order("scheduled_at",{ascending:!0});if(t)throw o.error("Error loading appointments:",t),t;return i||[]}async function _(){const{data:e,error:n}=await s.rpc("get_specialist_clients");if(n)throw o.error("Error loading assigned clients:",n),n;if(!e||e.length===0)return[];const r=e.map(a=>a.client_user_id),{data:i,error:t}=await s.from("profiles").select("id, user_id, first_name, last_name").in("user_id",r);return t&&o.error("Error loading profiles:",t),e.map(a=>{const p=i==null?void 0:i.find(l=>l.user_id===a.client_user_id);return{id:a.client_user_id,email:a.client_email,phone:a.client_phone,region:a.client_region,profile:p?{id:p.id,first_name:p.first_name,last_name:p.last_name}:void 0}})}async function d(e){const{error:n}=await s.from("appointments").delete().eq("id",e);if(n)throw o.error("Error deleting appointment:",n),n}async function u(e){const{data:n,error:r}=await s.from("appointments").select("id, parent_appointment_id, recurring_pattern").eq("id",e).single();if(r)throw o.error("Error fetching appointment:",r),r;const i=n.parent_appointment_id||n.id,{error:t}=await s.from("appointments").delete().or(`id.eq.${i},parent_appointment_id.eq.${i}`);if(t)throw o.error("Error deleting recurring appointments:",t),t}function f(e){if(!e)return"Неизвестный клиент";if(e.profile){const{first_name:n,last_name:r}=e.profile;return r?`${n} ${r}`:n}return e.email||e.phone||"Клиент"}function g(e,n){const r=`appointments:specialist_id=eq.${e}`,i=s.channel(r).on("postgres_changes",{event:"INSERT",schema:"public",table:"appointments",filter:`specialist_id=eq.${e}`},t=>{n("INSERT",t.new)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"appointments",filter:`specialist_id=eq.${e}`},t=>{n("UPDATE",t.new,t.old)}).on("postgres_changes",{event:"DELETE",schema:"public",table:"appointments",filter:`specialist_id=eq.${e}`},t=>{n("DELETE",null,t.old)}).subscribe();return()=>{s.removeChannel(i)}}function E(e,n){const r=`client_assignments:specialist_id=eq.${e}`,i=s.channel(r).on("postgres_changes",{event:"INSERT",schema:"public",table:"client_assignments",filter:`specialist_id=eq.${e}`},t=>{n("INSERT",t.new)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"client_assignments",filter:`specialist_id=eq.${e}`},t=>{n("UPDATE",t.new,t.old)}).on("postgres_changes",{event:"DELETE",schema:"public",table:"client_assignments",filter:`specialist_id=eq.${e}`},t=>{n("DELETE",null,t.old)}).subscribe();return()=>{s.removeChannel(i)}}export{_ as a,m as b,g as c,u as d,d as e,f as g,E as s};
