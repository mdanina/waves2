import{r as c,j as e}from"./vendor-radix-htwXsPHy.js";import{H as E,P as k,B as q}from"./index-Dv2C02zj.js";import{p as a,f as O}from"./parentQuestions-wCnSfMAW.js";import{u as Q}from"./useAssessment-C2QUmuMo.js";import{a as C,b as P}from"./scoring-DyuEFZvw.js";import{u as R,e as _}from"./vendor-react-CI8wve7f.js";import"./vendor-charts-DjioKZbK.js";import"./vendor-query-BNGVDYIL.js";import"./profileStorage-CNyPVPjQ.js";import"./assessmentStorage-C8gjZ2L4.js";const y=300;function J(){const d=R(),w=_(),{currentStep:i,loading:l,saveAnswer:p,getSavedAnswer:x,complete:f,assessmentId:g}=Q({assessmentType:"parent",totalSteps:a.length,profileId:w.profileId}),j=!l&&i>1?i-1:0,[s,u]=c.useState(j),[h,m]=c.useState(a.map(t=>({questionId:t.id,value:null}))),[v,b]=c.useState(!1);if(c.useEffect(()=>{if(!l&&g&&!v){const t=a.map(n=>{const o=x(n.id);return n.isReverse&&o!==null&&o>=0&&o<=3?{questionId:n.id,value:C(o)}:{questionId:n.id,value:o}});if(m(t),i>1){const n=i-1;n>=0&&n<a.length&&u(n)}b(!0)}},[l,g,i,v,x]),c.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[s]),s<0||s>=a.length)return d("/parent-intro"),null;const r=a[s];if(!r)return d("/parent-intro"),null;const N=(s+1)/a.length*100,I=(()=>{switch(r.answerType){case"frequency":return O;default:return[]}})(),S=async t=>{try{if(!r){console.error("Current question is not defined");return}const n=[...h];n[s]={questionId:r.id,value:t},m(n);const o=r.isReverse===!0?P(t):t;try{await p(r.id,`parent_${r.id.toString().padStart(2,"0")}`,r.category,o,r.answerType,s+1)}catch(T){console.error("Error saving answer:",T)}setTimeout(async()=>{s<a.length-1?u(s+1):(await f(),d("/family-intro"))},y)}catch(n){console.error("Error in handleAnswer:",n)}},A=async()=>{await p(r.id,`parent_${r.id.toString().padStart(2,"0")}`,r.category,-1,r.answerType,s+1);const t=[...h];t[s]={questionId:r.id,value:-1},m(t),setTimeout(async()=>{s<a.length-1?u(s+1):(await f(),d("/family-intro"))},y)};return l?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(E,{}),e.jsx("div",{className:"border-b border-border bg-primary py-4",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(k,{value:N,className:"flex-1 bg-primary-foreground/20"}),e.jsxs("span",{className:"text-sm font-medium text-primary-foreground",children:[s+1," / ",a.length]})]})})}),e.jsx("div",{className:"container mx-auto max-w-4xl px-4 py-12",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"rounded-lg bg-secondary/30 px-6 py-3 text-center",children:e.jsx("span",{className:"font-medium text-secondary-foreground",children:r.category})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-center text-muted-foreground",children:"В течение последних двух недель, как часто вас беспокоили следующие проблемы:"}),e.jsx("h2",{className:"text-center text-3xl font-bold text-foreground",children:r.text}),e.jsx("div",{className:"space-y-3 pt-8",children:I.map(t=>e.jsx("button",{onClick:()=>S(t.value),className:"w-full rounded-lg border border-border bg-card px-6 py-4 text-center text-base font-medium text-card-foreground transition-all hover:border-primary hover:bg-secondary/50 active:scale-[0.98]",children:t.label},t.value))}),e.jsx("div",{className:"pt-8 text-center",children:e.jsx(q,{variant:"ghost",onClick:A,className:"text-muted-foreground hover:text-foreground",children:"Пропустить"})})]})]})})]})}export{J as default};
