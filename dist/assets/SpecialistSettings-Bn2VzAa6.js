import{r as a,a as K,b as Ue,j as s}from"./vendor-radix-J7BmBqsC.js";import{g as er,N as yn,B as re,C as Ie,R as ke,T as Me,af as Oe,h as Le,F as tr,t as lt,O as De,E as Gt,G as Jt,J as Qt,$ as Zt,a1 as en,L as H,r as me,a2 as nr,aI as rr,a3 as sr,x as Rt,aL as ir,a8 as or,a9 as tn,aM as ar,aA as lr}from"./index-CsvxaYtI.js";import{S as yt}from"./switch-CChs6D0W.js";import{S as Ye}from"./separator-B5qA960N.js";import{T as cr,a as dr,b as st,c as it}from"./tabs-CT8W70EM.js";import{g as ur,s as fr}from"./supabase-specialist-schedule-BsySnTxr.js";import{S as jt}from"./skeleton-CX4qEpye.js";import{A as hr,a as gr,b as pr,c as mr,d as vr,e as xr,f as br,g as wr}from"./alert-dialog-COnYxGom.js";import{g as yr,e as jr,f as nn,h as Sr,r as Cr,i as Nr}from"./supabase-ai-CXYeb-fP.js";import{P as rn}from"./plus-CNlpg7MV.js";import{S as Dr}from"./star-DQWG-27u.js";import{L as Rr}from"./lock-Dh4_7Z3d.js";import{C as Er}from"./copy-BIipb-ws.js";import{T as jn}from"./trash-2-BiEfhxdN.js";import{G as Tr}from"./grip-vertical-DbOjk_Y8.js";import{S as sn}from"./shield-DlVB15hX.js";import{S as on}from"./save-Dg65xQN1.js";import{M as Ar}from"./monitor-9G4TNKAU.js";import"./vendor-charts-CkgrveCd.js";import"./vendor-query-Bb981xLV.js";import"./vendor-react-CI1J5nwZ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=er("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);function kr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.useMemo(()=>r=>{t.forEach(i=>i(r))},t)}const gt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function _e(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function Mt(e){return"nodeType"in e}function q(e){var t,n;return e?_e(e)?e:Mt(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function Ot(e){const{Document:t}=q(e);return e instanceof t}function Ze(e){return _e(e)?!1:e instanceof q(e).HTMLElement}function Sn(e){return e instanceof q(e).SVGElement}function Fe(e){return e?_e(e)?e.document:Mt(e)?Ot(e)?e:Ze(e)||Sn(e)?e.ownerDocument:document:document:document}const fe=gt?a.useLayoutEffect:a.useEffect;function Lt(e){const t=a.useRef(e);return fe(()=>{t.current=e}),a.useCallback(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t.current==null?void 0:t.current(...r)},[])}function Mr(){const e=a.useRef(null),t=a.useCallback((r,i)=>{e.current=setInterval(r,i)},[]),n=a.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function qe(e,t){t===void 0&&(t=[e]);const n=a.useRef(e);return fe(()=>{n.current!==e&&(n.current=e)},t),n}function et(e,t){const n=a.useRef();return a.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function dt(e){const t=Lt(e),n=a.useRef(null),r=a.useCallback(i=>{i!==n.current&&(t==null||t(i,n.current)),n.current=i},[]);return[n,r]}function Et(e){const t=a.useRef();return a.useEffect(()=>{t.current=e},[e]),t.current}let St={};function tt(e,t){return a.useMemo(()=>{if(t)return t;const n=St[e]==null?0:St[e]+1;return St[e]=n,e+"-"+n},[e,t])}function Cn(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.reduce((o,c)=>{const l=Object.entries(c);for(const[d,u]of l){const h=o[d];h!=null&&(o[d]=h+e*u)}return o},{...t})}}const Be=Cn(1),Ge=Cn(-1);function Or(e){return"clientX"in e&&"clientY"in e}function Bt(e){if(!e)return!1;const{KeyboardEvent:t}=q(e.target);return t&&e instanceof t}function Lr(e){if(!e)return!1;const{TouchEvent:t}=q(e.target);return t&&e instanceof t}function Tt(e){if(Lr(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Or(e)?{x:e.clientX,y:e.clientY}:null}const Je=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Je.Translate.toString(e),Je.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),an="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Br(e){return e.matches(an)?e:e.querySelector(an)}const _r={display:"none"};function Fr(e){let{id:t,value:n}=e;return K.createElement("div",{id:t,style:_r},n)}function Pr(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const i={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return K.createElement("div",{id:t,style:i,role:"status","aria-live":r,"aria-atomic":!0},n)}function zr(){const[e,t]=a.useState("");return{announce:a.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const Nn=a.createContext(null);function $r(e){const t=a.useContext(Nn);a.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Xr(){const[e]=a.useState(()=>new Set),t=a.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[a.useCallback(r=>{let{type:i,event:o}=r;e.forEach(c=>{var l;return(l=c[i])==null?void 0:l.call(c,o)})},[e]),t]}const Wr={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Yr={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Ur(e){let{announcements:t=Yr,container:n,hiddenTextDescribedById:r,screenReaderInstructions:i=Wr}=e;const{announce:o,announcement:c}=zr(),l=tt("DndLiveRegion"),[d,u]=a.useState(!1);if(a.useEffect(()=>{u(!0)},[]),$r(a.useMemo(()=>({onDragStart(g){let{active:p}=g;o(t.onDragStart({active:p}))},onDragMove(g){let{active:p,over:m}=g;t.onDragMove&&o(t.onDragMove({active:p,over:m}))},onDragOver(g){let{active:p,over:m}=g;o(t.onDragOver({active:p,over:m}))},onDragEnd(g){let{active:p,over:m}=g;o(t.onDragEnd({active:p,over:m}))},onDragCancel(g){let{active:p,over:m}=g;o(t.onDragCancel({active:p,over:m}))}}),[o,t])),!d)return null;const h=K.createElement(K.Fragment,null,K.createElement(Fr,{id:r,value:i.draggable}),K.createElement(Pr,{id:l,announcement:c}));return n?Ue.createPortal(h,n):h}var B;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(B||(B={}));function ut(){}function ln(e,t){return a.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Hr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const oe=Object.freeze({x:0,y:0});function Dn(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Rn(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function Vr(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function cn(e){let{left:t,top:n,height:r,width:i}=e;return[{x:t,y:n},{x:t+i,y:n},{x:t,y:n+r},{x:t+i,y:n+r}]}function En(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function dn(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const Kr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const i=dn(t,t.left,t.top),o=[];for(const c of r){const{id:l}=c,d=n.get(l);if(d){const u=Dn(dn(d),i);o.push({id:l,data:{droppableContainer:c,value:u}})}}return o.sort(Rn)},qr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const i=cn(t),o=[];for(const c of r){const{id:l}=c,d=n.get(l);if(d){const u=cn(d),h=i.reduce((p,m,N)=>p+Dn(u[N],m),0),g=Number((h/4).toFixed(4));o.push({id:l,data:{droppableContainer:c,value:g}})}}return o.sort(Rn)};function Gr(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),i=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),c=i-r,l=o-n;if(r<i&&n<o){const d=t.width*t.height,u=e.width*e.height,h=c*l,g=h/(d+u-h);return Number(g.toFixed(4))}return 0}const Jr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const i=[];for(const o of r){const{id:c}=o,l=n.get(c);if(l){const d=Gr(l,t);d>0&&i.push({id:c,data:{droppableContainer:o,value:d}})}}return i.sort(Vr)};function Qr(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function Tn(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:oe}function Zr(e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i.reduce((c,l)=>({...c,top:c.top+e*l.y,bottom:c.bottom+e*l.y,left:c.left+e*l.x,right:c.right+e*l.x}),{...n})}}const es=Zr(1);function ts(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function ns(e,t,n){const r=ts(t);if(!r)return e;const{scaleX:i,scaleY:o,x:c,y:l}=r,d=e.left-c-(1-i)*parseFloat(n),u=e.top-l-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),h=i?e.width/i:e.width,g=o?e.height/o:e.height;return{width:h,height:g,top:u,right:d+h,bottom:u+g,left:d}}const rs={ignoreTransform:!1};function Pe(e,t){t===void 0&&(t=rs);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:u,transformOrigin:h}=q(e).getComputedStyle(e);u&&(n=ns(n,u,h))}const{top:r,left:i,width:o,height:c,bottom:l,right:d}=n;return{top:r,left:i,width:o,height:c,bottom:l,right:d}}function un(e){return Pe(e,{ignoreTransform:!0})}function ss(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function is(e,t){return t===void 0&&(t=q(e).getComputedStyle(e)),t.position==="fixed"}function os(e,t){t===void 0&&(t=q(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(i=>{const o=t[i];return typeof o=="string"?n.test(o):!1})}function pt(e,t){const n=[];function r(i){if(t!=null&&n.length>=t||!i)return n;if(Ot(i)&&i.scrollingElement!=null&&!n.includes(i.scrollingElement))return n.push(i.scrollingElement),n;if(!Ze(i)||Sn(i)||n.includes(i))return n;const o=q(e).getComputedStyle(i);return i!==e&&os(i,o)&&n.push(i),is(i,o)?n:r(i.parentNode)}return e?r(e):n}function An(e){const[t]=pt(e,1);return t??null}function Ct(e){return!gt||!e?null:_e(e)?e:Mt(e)?Ot(e)||e===Fe(e).scrollingElement?window:Ze(e)?e:null:null}function In(e){return _e(e)?e.scrollX:e.scrollLeft}function kn(e){return _e(e)?e.scrollY:e.scrollTop}function At(e){return{x:In(e),y:kn(e)}}var z;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(z||(z={}));function Mn(e){return!gt||!e?!1:e===document.scrollingElement}function On(e){const t={x:0,y:0},n=Mn(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},i=e.scrollTop<=t.y,o=e.scrollLeft<=t.x,c=e.scrollTop>=r.y,l=e.scrollLeft>=r.x;return{isTop:i,isLeft:o,isBottom:c,isRight:l,maxScroll:r,minScroll:t}}const as={x:.2,y:.2};function ls(e,t,n,r,i){let{top:o,left:c,right:l,bottom:d}=n;r===void 0&&(r=10),i===void 0&&(i=as);const{isTop:u,isBottom:h,isLeft:g,isRight:p}=On(e),m={x:0,y:0},N={x:0,y:0},v={height:t.height*i.y,width:t.width*i.x};return!u&&o<=t.top+v.height?(m.y=z.Backward,N.y=r*Math.abs((t.top+v.height-o)/v.height)):!h&&d>=t.bottom-v.height&&(m.y=z.Forward,N.y=r*Math.abs((t.bottom-v.height-d)/v.height)),!p&&l>=t.right-v.width?(m.x=z.Forward,N.x=r*Math.abs((t.right-v.width-l)/v.width)):!g&&c<=t.left+v.width&&(m.x=z.Backward,N.x=r*Math.abs((t.left+v.width-c)/v.width)),{direction:m,speed:N}}function cs(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:c}=window;return{top:0,left:0,right:o,bottom:c,width:o,height:c}}const{top:t,left:n,right:r,bottom:i}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:i,width:e.clientWidth,height:e.clientHeight}}function Ln(e){return e.reduce((t,n)=>Be(t,At(n)),oe)}function ds(e){return e.reduce((t,n)=>t+In(n),0)}function us(e){return e.reduce((t,n)=>t+kn(n),0)}function fs(e,t){if(t===void 0&&(t=Pe),!e)return;const{top:n,left:r,bottom:i,right:o}=t(e);An(e)&&(i<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const hs=[["x",["left","right"],ds],["y",["top","bottom"],us]];class _t{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=pt(n),i=Ln(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[o,c,l]of hs)for(const d of c)Object.defineProperty(this,d,{get:()=>{const u=l(r),h=i[o]-u;return this.rect[d]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class He{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var i;(i=this.target)==null||i.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function gs(e){const{EventTarget:t}=q(e);return e instanceof t?e:Fe(e)}function Nt(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var ne;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(ne||(ne={}));function fn(e){e.preventDefault()}function ps(e){e.stopPropagation()}var k;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(k||(k={}));const Bn={start:[k.Space,k.Enter],cancel:[k.Esc],end:[k.Space,k.Enter,k.Tab]},ms=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case k.Right:return{...n,x:n.x+25};case k.Left:return{...n,x:n.x-25};case k.Down:return{...n,y:n.y+25};case k.Up:return{...n,y:n.y-25}}};class Ft{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new He(Fe(n)),this.windowListeners=new He(q(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(ne.Resize,this.handleCancel),this.windowListeners.add(ne.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(ne.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&fs(r),n(oe)}handleKeyDown(t){if(Bt(t)){const{active:n,context:r,options:i}=this.props,{keyboardCodes:o=Bn,coordinateGetter:c=ms,scrollBehavior:l="smooth"}=i,{code:d}=t;if(o.end.includes(d)){this.handleEnd(t);return}if(o.cancel.includes(d)){this.handleCancel(t);return}const{collisionRect:u}=r.current,h=u?{x:u.left,y:u.top}:oe;this.referenceCoordinates||(this.referenceCoordinates=h);const g=c(t,{active:n,context:r.current,currentCoordinates:h});if(g){const p=Ge(g,h),m={x:0,y:0},{scrollableAncestors:N}=r.current;for(const v of N){const y=t.code,{isTop:S,isRight:C,isLeft:j,isBottom:E,maxScroll:A,minScroll:T}=On(v),D=cs(v),R={x:Math.min(y===k.Right?D.right-D.width/2:D.right,Math.max(y===k.Right?D.left:D.left+D.width/2,g.x)),y:Math.min(y===k.Down?D.bottom-D.height/2:D.bottom,Math.max(y===k.Down?D.top:D.top+D.height/2,g.y))},M=y===k.Right&&!C||y===k.Left&&!j,O=y===k.Down&&!E||y===k.Up&&!S;if(M&&R.x!==g.x){const I=v.scrollLeft+p.x,$=y===k.Right&&I<=A.x||y===k.Left&&I>=T.x;if($&&!p.y){v.scrollTo({left:I,behavior:l});return}$?m.x=v.scrollLeft-I:m.x=y===k.Right?v.scrollLeft-A.x:v.scrollLeft-T.x,m.x&&v.scrollBy({left:-m.x,behavior:l});break}else if(O&&R.y!==g.y){const I=v.scrollTop+p.y,$=y===k.Down&&I<=A.y||y===k.Up&&I>=T.y;if($&&!p.x){v.scrollTo({top:I,behavior:l});return}$?m.y=v.scrollTop-I:m.y=y===k.Down?v.scrollTop-A.y:v.scrollTop-T.y,m.y&&v.scrollBy({top:-m.y,behavior:l});break}}this.handleMove(t,Be(Ge(g,this.referenceCoordinates),m))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Ft.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=Bn,onActivation:i}=t,{active:o}=n;const{code:c}=e.nativeEvent;if(r.start.includes(c)){const l=o.activatorNode.current;return l&&e.target!==l?!1:(e.preventDefault(),i==null||i({event:e.nativeEvent}),!0)}return!1}}];function hn(e){return!!(e&&"distance"in e)}function gn(e){return!!(e&&"delay"in e)}class Pt{constructor(t,n,r){var i;r===void 0&&(r=gs(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:o}=t,{target:c}=o;this.props=t,this.events=n,this.document=Fe(c),this.documentListeners=new He(this.document),this.listeners=new He(r),this.windowListeners=new He(q(c)),this.initialCoordinates=(i=Tt(o))!=null?i:oe,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(ne.Resize,this.handleCancel),this.windowListeners.add(ne.DragStart,fn),this.windowListeners.add(ne.VisibilityChange,this.handleCancel),this.windowListeners.add(ne.ContextMenu,fn),this.documentListeners.add(ne.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(gn(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(hn(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:i}=this.props;i(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(ne.Click,ps,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(ne.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:i,props:o}=this,{onMove:c,options:{activationConstraint:l}}=o;if(!i)return;const d=(n=Tt(t))!=null?n:oe,u=Ge(i,d);if(!r&&l){if(hn(l)){if(l.tolerance!=null&&Nt(u,l.tolerance))return this.handleCancel();if(Nt(u,l.distance))return this.handleStart()}if(gn(l)&&Nt(u,l.tolerance))return this.handleCancel();this.handlePending(l,u);return}t.cancelable&&t.preventDefault(),c(d)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===k.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const vs={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class zt extends Pt{constructor(t){const{event:n}=t,r=Fe(n.target);super(t,vs,r)}}zt.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const xs={move:{name:"mousemove"},end:{name:"mouseup"}};var It;(function(e){e[e.RightClick=2]="RightClick"})(It||(It={}));class bs extends Pt{constructor(t){super(t,xs,Fe(t.event.target))}}bs.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===It.RightClick?!1:(r==null||r({event:n}),!0)}}];const Dt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class ws extends Pt{constructor(t){super(t,Dt)}static setup(){return window.addEventListener(Dt.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Dt.move.name,t)};function t(){}}}ws.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:i}=n;return i.length>1?!1:(r==null||r({event:n}),!0)}}];var Ve;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(Ve||(Ve={}));var ft;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(ft||(ft={}));function ys(e){let{acceleration:t,activator:n=Ve.Pointer,canScroll:r,draggingRect:i,enabled:o,interval:c=5,order:l=ft.TreeOrder,pointerCoordinates:d,scrollableAncestors:u,scrollableAncestorRects:h,delta:g,threshold:p}=e;const m=Ss({delta:g,disabled:!o}),[N,v]=Mr(),y=a.useRef({x:0,y:0}),S=a.useRef({x:0,y:0}),C=a.useMemo(()=>{switch(n){case Ve.Pointer:return d?{top:d.y,bottom:d.y,left:d.x,right:d.x}:null;case Ve.DraggableRect:return i}},[n,i,d]),j=a.useRef(null),E=a.useCallback(()=>{const T=j.current;if(!T)return;const D=y.current.x*S.current.x,R=y.current.y*S.current.y;T.scrollBy(D,R)},[]),A=a.useMemo(()=>l===ft.TreeOrder?[...u].reverse():u,[l,u]);a.useEffect(()=>{if(!o||!u.length||!C){v();return}for(const T of A){if((r==null?void 0:r(T))===!1)continue;const D=u.indexOf(T),R=h[D];if(!R)continue;const{direction:M,speed:O}=ls(T,R,C,t,p);for(const I of["x","y"])m[I][M[I]]||(O[I]=0,M[I]=0);if(O.x>0||O.y>0){v(),j.current=T,N(E,c),y.current=O,S.current=M;return}}y.current={x:0,y:0},S.current={x:0,y:0},v()},[t,E,r,v,o,c,JSON.stringify(C),JSON.stringify(m),N,u,A,h,JSON.stringify(p)])}const js={x:{[z.Backward]:!1,[z.Forward]:!1},y:{[z.Backward]:!1,[z.Forward]:!1}};function Ss(e){let{delta:t,disabled:n}=e;const r=Et(t);return et(i=>{if(n||!r||!i)return js;const o={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[z.Backward]:i.x[z.Backward]||o.x===-1,[z.Forward]:i.x[z.Forward]||o.x===1},y:{[z.Backward]:i.y[z.Backward]||o.y===-1,[z.Forward]:i.y[z.Forward]||o.y===1}}},[n,t,r])}function Cs(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return et(i=>{var o;return t==null?null:(o=r??i)!=null?o:null},[r,t])}function Ns(e,t){return a.useMemo(()=>e.reduce((n,r)=>{const{sensor:i}=r,o=i.activators.map(c=>({eventName:c.eventName,handler:t(c.handler,r)}));return[...n,...o]},[]),[e,t])}var Qe;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Qe||(Qe={}));var kt;(function(e){e.Optimized="optimized"})(kt||(kt={}));const pn=new Map;function Ds(e,t){let{dragging:n,dependencies:r,config:i}=t;const[o,c]=a.useState(null),{frequency:l,measure:d,strategy:u}=i,h=a.useRef(e),g=y(),p=qe(g),m=a.useCallback(function(S){S===void 0&&(S=[]),!p.current&&c(C=>C===null?S:C.concat(S.filter(j=>!C.includes(j))))},[p]),N=a.useRef(null),v=et(S=>{if(g&&!n)return pn;if(!S||S===pn||h.current!==e||o!=null){const C=new Map;for(let j of e){if(!j)continue;if(o&&o.length>0&&!o.includes(j.id)&&j.rect.current){C.set(j.id,j.rect.current);continue}const E=j.node.current,A=E?new _t(d(E),E):null;j.rect.current=A,A&&C.set(j.id,A)}return C}return S},[e,o,n,g,d]);return a.useEffect(()=>{h.current=e},[e]),a.useEffect(()=>{g||m()},[n,g]),a.useEffect(()=>{o&&o.length>0&&c(null)},[JSON.stringify(o)]),a.useEffect(()=>{g||typeof l!="number"||N.current!==null||(N.current=setTimeout(()=>{m(),N.current=null},l))},[l,g,m,...r]),{droppableRects:v,measureDroppableContainers:m,measuringScheduled:o!=null};function y(){switch(u){case Qe.Always:return!1;case Qe.BeforeDragging:return n;default:return!n}}}function _n(e,t){return et(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Rs(e,t){return _n(e,t)}function Es(e){let{callback:t,disabled:n}=e;const r=Lt(t),i=a.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return a.useEffect(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function mt(e){let{callback:t,disabled:n}=e;const r=Lt(t),i=a.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return a.useEffect(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function Ts(e){return new _t(Pe(e),e)}function mn(e,t,n){t===void 0&&(t=Ts);const[r,i]=a.useState(null);function o(){i(d=>{if(!e)return null;if(e.isConnected===!1){var u;return(u=d??n)!=null?u:null}const h=t(e);return JSON.stringify(d)===JSON.stringify(h)?d:h})}const c=Es({callback(d){if(e)for(const u of d){const{type:h,target:g}=u;if(h==="childList"&&g instanceof HTMLElement&&g.contains(e)){o();break}}}}),l=mt({callback:o});return fe(()=>{o(),e?(l==null||l.observe(e),c==null||c.observe(document.body,{childList:!0,subtree:!0})):(l==null||l.disconnect(),c==null||c.disconnect())},[e]),r}function As(e){const t=_n(e);return Tn(e,t)}const vn=[];function Is(e){const t=a.useRef(e),n=et(r=>e?r&&r!==vn&&e&&t.current&&e.parentNode===t.current.parentNode?r:pt(e):vn,[e]);return a.useEffect(()=>{t.current=e},[e]),n}function ks(e){const[t,n]=a.useState(null),r=a.useRef(e),i=a.useCallback(o=>{const c=Ct(o.target);c&&n(l=>l?(l.set(c,At(c)),new Map(l)):null)},[]);return a.useEffect(()=>{const o=r.current;if(e!==o){c(o);const l=e.map(d=>{const u=Ct(d);return u?(u.addEventListener("scroll",i,{passive:!0}),[u,At(u)]):null}).filter(d=>d!=null);n(l.length?new Map(l):null),r.current=e}return()=>{c(e),c(o)};function c(l){l.forEach(d=>{const u=Ct(d);u==null||u.removeEventListener("scroll",i)})}},[i,e]),a.useMemo(()=>e.length?t?Array.from(t.values()).reduce((o,c)=>Be(o,c),oe):Ln(e):oe,[e,t])}function xn(e,t){t===void 0&&(t=[]);const n=a.useRef(null);return a.useEffect(()=>{n.current=null},t),a.useEffect(()=>{const r=e!==oe;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?Ge(e,n.current):oe}function Ms(e){a.useEffect(()=>{if(!gt)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function Os(e,t){return a.useMemo(()=>e.reduce((n,r)=>{let{eventName:i,handler:o}=r;return n[i]=c=>{o(c,t)},n},{}),[e,t])}function Fn(e){return a.useMemo(()=>e?ss(e):null,[e])}const bn=[];function Ls(e,t){t===void 0&&(t=Pe);const[n]=e,r=Fn(n?q(n):null),[i,o]=a.useState(bn);function c(){o(()=>e.length?e.map(d=>Mn(d)?r:new _t(t(d),d)):bn)}const l=mt({callback:c});return fe(()=>{l==null||l.disconnect(),c(),e.forEach(d=>l==null?void 0:l.observe(d))},[e]),i}function Bs(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Ze(t)?t:e}function _s(e){let{measure:t}=e;const[n,r]=a.useState(null),i=a.useCallback(u=>{for(const{target:h}of u)if(Ze(h)){r(g=>{const p=t(h);return g?{...g,width:p.width,height:p.height}:p});break}},[t]),o=mt({callback:i}),c=a.useCallback(u=>{const h=Bs(u);o==null||o.disconnect(),h&&(o==null||o.observe(h)),r(h?t(h):null)},[t,o]),[l,d]=dt(c);return a.useMemo(()=>({nodeRef:l,rect:n,setRef:d}),[n,l,d])}const Fs=[{sensor:zt,options:{}},{sensor:Ft,options:{}}],Ps={current:{}},ct={draggable:{measure:un},droppable:{measure:un,strategy:Qe.WhileDragging,frequency:kt.Optimized},dragOverlay:{measure:Pe}};class Ke extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const zs={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ke,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:ut},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:ct,measureDroppableContainers:ut,windowRect:null,measuringScheduled:!1},$s={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:ut,draggableNodes:new Map,over:null,measureDroppableContainers:ut},vt=a.createContext($s),Pn=a.createContext(zs);function Xs(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ke}}}function Ws(e,t){switch(t.type){case B.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case B.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case B.DragEnd:case B.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case B.RegisterDroppable:{const{element:n}=t,{id:r}=n,i=new Ke(e.droppable.containers);return i.set(r,n),{...e,droppable:{...e.droppable,containers:i}}}case B.SetDroppableDisabled:{const{id:n,key:r,disabled:i}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const c=new Ke(e.droppable.containers);return c.set(n,{...o,disabled:i}),{...e,droppable:{...e.droppable,containers:c}}}case B.UnregisterDroppable:{const{id:n,key:r}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;const o=new Ke(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function Ys(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:i}=a.useContext(vt),o=Et(r),c=Et(n==null?void 0:n.id);return a.useEffect(()=>{if(!t&&!r&&o&&c!=null){if(!Bt(o)||document.activeElement===o.target)return;const l=i.get(c);if(!l)return;const{activatorNode:d,node:u}=l;if(!d.current&&!u.current)return;requestAnimationFrame(()=>{for(const h of[d.current,u.current]){if(!h)continue;const g=Br(h);if(g){g.focus();break}}})}},[r,t,i,c,o]),null}function Us(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((i,o)=>o({transform:i,...r}),n):n}function Hs(e){return a.useMemo(()=>({draggable:{...ct.draggable,...e==null?void 0:e.draggable},droppable:{...ct.droppable,...e==null?void 0:e.droppable},dragOverlay:{...ct.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function Vs(e){let{activeNode:t,measure:n,initialRect:r,config:i=!0}=e;const o=a.useRef(!1),{x:c,y:l}=typeof i=="boolean"?{x:i,y:i}:i;fe(()=>{if(!c&&!l||!t){o.current=!1;return}if(o.current||!r)return;const u=t==null?void 0:t.node.current;if(!u||u.isConnected===!1)return;const h=n(u),g=Tn(h,r);if(c||(g.x=0),l||(g.y=0),o.current=!0,Math.abs(g.x)>0||Math.abs(g.y)>0){const p=An(u);p&&p.scrollBy({top:g.y,left:g.x})}},[t,c,l,r,n])}const zn=a.createContext({...oe,scaleX:1,scaleY:1});var Ne;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ne||(Ne={}));const Ks=a.memo(function(t){var n,r,i,o;let{id:c,accessibility:l,autoScroll:d=!0,children:u,sensors:h=Fs,collisionDetection:g=Jr,measuring:p,modifiers:m,...N}=t;const v=a.useReducer(Ws,void 0,Xs),[y,S]=v,[C,j]=Xr(),[E,A]=a.useState(Ne.Uninitialized),T=E===Ne.Initialized,{draggable:{active:D,nodes:R,translate:M},droppable:{containers:O}}=y,I=D!=null?R.get(D):null,$=a.useRef({initial:null,translated:null}),_=a.useMemo(()=>{var U;return D!=null?{id:D,data:(U=I==null?void 0:I.data)!=null?U:Ps,rect:$}:null},[D,I]),Y=a.useRef(null),[ae,le]=a.useState(null),[F,ve]=a.useState(null),V=qe(N,Object.values(N)),he=tt("DndDescribedBy",c),xe=a.useMemo(()=>O.getEnabled(),[O]),P=Hs(p),{droppableRects:G,measureDroppableContainers:se,measuringScheduled:ge}=Ds(xe,{dragging:T,dependencies:[M.x,M.y],config:P.droppable}),x=Cs(R,D),X=a.useMemo(()=>F?Tt(F):null,[F]),f=Zn(),w=Rs(x,P.draggable.measure);Vs({activeNode:D!=null?R.get(D):null,config:f.layoutShiftCompensation,initialRect:w,measure:P.draggable.measure});const b=mn(x,P.draggable.measure,w),ie=mn(x?x.parentElement:null),ee=a.useRef({activatorEvent:null,active:null,activeNode:x,collisionRect:null,collisions:null,droppableRects:G,draggableNodes:R,draggingNode:null,draggingNodeRect:null,droppableContainers:O,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),ce=O.getNodeFor((n=ee.current.over)==null?void 0:n.id),L=_s({measure:P.dragOverlay.measure}),be=(r=L.nodeRef.current)!=null?r:x,Re=T?(i=L.rect)!=null?i:b:null,Xt=!!(L.nodeRef.current&&L.rect),Wt=As(Xt?null:b),xt=Fn(be?q(be):null),we=Is(T?ce??x:null),nt=Ls(we),rt=Us(m,{transform:{x:M.x-Wt.x,y:M.y-Wt.y,scaleX:1,scaleY:1},activatorEvent:F,active:_,activeNodeRect:b,containerNodeRect:ie,draggingNodeRect:Re,over:ee.current.over,overlayNodeRect:L.rect,scrollableAncestors:we,scrollableAncestorRects:nt,windowRect:xt}),Yt=X?Be(X,M):null,Ut=ks(we),Hn=xn(Ut),Vn=xn(Ut,[b]),Ee=Be(rt,Hn),Te=Re?es(Re,rt):null,ze=_&&Te?g({active:_,collisionRect:Te,droppableRects:G,droppableContainers:xe,pointerCoordinates:Yt}):null,Ht=En(ze,"id"),[ye,Vt]=a.useState(null),Kn=Xt?rt:Be(rt,Vn),qn=Qr(Kn,(o=ye==null?void 0:ye.rect)!=null?o:null,b),bt=a.useRef(null),Kt=a.useCallback((U,J)=>{let{sensor:Q,options:je}=J;if(Y.current==null)return;const te=R.get(Y.current);if(!te)return;const Z=U.nativeEvent,de=new Q({active:Y.current,activeNode:te,event:Z,options:je,context:ee,onAbort(W){if(!R.get(W))return;const{onDragAbort:ue}=V.current,pe={id:W};ue==null||ue(pe),C({type:"onDragAbort",event:pe})},onPending(W,Se,ue,pe){if(!R.get(W))return;const{onDragPending:Xe}=V.current,Ce={id:W,constraint:Se,initialCoordinates:ue,offset:pe};Xe==null||Xe(Ce),C({type:"onDragPending",event:Ce})},onStart(W){const Se=Y.current;if(Se==null)return;const ue=R.get(Se);if(!ue)return;const{onDragStart:pe}=V.current,$e={activatorEvent:Z,active:{id:Se,data:ue.data,rect:$}};Ue.unstable_batchedUpdates(()=>{pe==null||pe($e),A(Ne.Initializing),S({type:B.DragStart,initialCoordinates:W,active:Se}),C({type:"onDragStart",event:$e}),le(bt.current),ve(Z)})},onMove(W){S({type:B.DragMove,coordinates:W})},onEnd:Ae(B.DragEnd),onCancel:Ae(B.DragCancel)});bt.current=de;function Ae(W){return async function(){const{active:ue,collisions:pe,over:$e,scrollAdjustedTranslate:Xe}=ee.current;let Ce=null;if(ue&&Xe){const{cancelDrop:We}=V.current;Ce={activatorEvent:Z,active:ue,collisions:pe,delta:Xe,over:$e},W===B.DragEnd&&typeof We=="function"&&await Promise.resolve(We(Ce))&&(W=B.DragCancel)}Y.current=null,Ue.unstable_batchedUpdates(()=>{S({type:W}),A(Ne.Uninitialized),Vt(null),le(null),ve(null),bt.current=null;const We=W===B.DragEnd?"onDragEnd":"onDragCancel";if(Ce){const wt=V.current[We];wt==null||wt(Ce),C({type:We,event:Ce})}})}}},[R]),Gn=a.useCallback((U,J)=>(Q,je)=>{const te=Q.nativeEvent,Z=R.get(je);if(Y.current!==null||!Z||te.dndKit||te.defaultPrevented)return;const de={active:Z};U(Q,J.options,de)===!0&&(te.dndKit={capturedBy:J.sensor},Y.current=je,Kt(Q,J))},[R,Kt]),qt=Ns(h,Gn);Ms(h),fe(()=>{b&&E===Ne.Initializing&&A(Ne.Initialized)},[b,E]),a.useEffect(()=>{const{onDragMove:U}=V.current,{active:J,activatorEvent:Q,collisions:je,over:te}=ee.current;if(!J||!Q)return;const Z={active:J,activatorEvent:Q,collisions:je,delta:{x:Ee.x,y:Ee.y},over:te};Ue.unstable_batchedUpdates(()=>{U==null||U(Z),C({type:"onDragMove",event:Z})})},[Ee.x,Ee.y]),a.useEffect(()=>{const{active:U,activatorEvent:J,collisions:Q,droppableContainers:je,scrollAdjustedTranslate:te}=ee.current;if(!U||Y.current==null||!J||!te)return;const{onDragOver:Z}=V.current,de=je.get(Ht),Ae=de&&de.rect.current?{id:de.id,rect:de.rect.current,data:de.data,disabled:de.disabled}:null,W={active:U,activatorEvent:J,collisions:Q,delta:{x:te.x,y:te.y},over:Ae};Ue.unstable_batchedUpdates(()=>{Vt(Ae),Z==null||Z(W),C({type:"onDragOver",event:W})})},[Ht]),fe(()=>{ee.current={activatorEvent:F,active:_,activeNode:x,collisionRect:Te,collisions:ze,droppableRects:G,draggableNodes:R,draggingNode:be,draggingNodeRect:Re,droppableContainers:O,over:ye,scrollableAncestors:we,scrollAdjustedTranslate:Ee},$.current={initial:Re,translated:Te}},[_,x,ze,Te,R,be,Re,G,O,ye,we,Ee]),ys({...f,delta:M,draggingRect:Te,pointerCoordinates:Yt,scrollableAncestors:we,scrollableAncestorRects:nt});const Jn=a.useMemo(()=>({active:_,activeNode:x,activeNodeRect:b,activatorEvent:F,collisions:ze,containerNodeRect:ie,dragOverlay:L,draggableNodes:R,droppableContainers:O,droppableRects:G,over:ye,measureDroppableContainers:se,scrollableAncestors:we,scrollableAncestorRects:nt,measuringConfiguration:P,measuringScheduled:ge,windowRect:xt}),[_,x,b,F,ze,ie,L,R,O,G,ye,se,we,nt,P,ge,xt]),Qn=a.useMemo(()=>({activatorEvent:F,activators:qt,active:_,activeNodeRect:b,ariaDescribedById:{draggable:he},dispatch:S,draggableNodes:R,over:ye,measureDroppableContainers:se}),[F,qt,_,b,S,he,R,ye,se]);return K.createElement(Nn.Provider,{value:j},K.createElement(vt.Provider,{value:Qn},K.createElement(Pn.Provider,{value:Jn},K.createElement(zn.Provider,{value:qn},u)),K.createElement(Ys,{disabled:(l==null?void 0:l.restoreFocus)===!1})),K.createElement(Ur,{...l,hiddenTextDescribedById:he}));function Zn(){const U=(ae==null?void 0:ae.autoScrollEnabled)===!1,J=typeof d=="object"?d.enabled===!1:d===!1,Q=T&&!U&&!J;return typeof d=="object"?{...d,enabled:Q}:{enabled:Q}}}),qs=a.createContext(null),wn="button",Gs="Draggable";function Js(e){let{id:t,data:n,disabled:r=!1,attributes:i}=e;const o=tt(Gs),{activators:c,activatorEvent:l,active:d,activeNodeRect:u,ariaDescribedById:h,draggableNodes:g,over:p}=a.useContext(vt),{role:m=wn,roleDescription:N="draggable",tabIndex:v=0}=i??{},y=(d==null?void 0:d.id)===t,S=a.useContext(y?zn:qs),[C,j]=dt(),[E,A]=dt(),T=Os(c,t),D=qe(n);fe(()=>(g.set(t,{id:t,key:o,node:C,activatorNode:E,data:D}),()=>{const M=g.get(t);M&&M.key===o&&g.delete(t)}),[g,t]);const R=a.useMemo(()=>({role:m,tabIndex:v,"aria-disabled":r,"aria-pressed":y&&m===wn?!0:void 0,"aria-roledescription":N,"aria-describedby":h.draggable}),[r,m,v,y,N,h.draggable]);return{active:d,activatorEvent:l,activeNodeRect:u,attributes:R,isDragging:y,listeners:r?void 0:T,node:C,over:p,setNodeRef:j,setActivatorNodeRef:A,transform:S}}function Qs(){return a.useContext(Pn)}const Zs="Droppable",ei={timeout:25};function ti(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:i}=e;const o=tt(Zs),{active:c,dispatch:l,over:d,measureDroppableContainers:u}=a.useContext(vt),h=a.useRef({disabled:n}),g=a.useRef(!1),p=a.useRef(null),m=a.useRef(null),{disabled:N,updateMeasurementsFor:v,timeout:y}={...ei,...i},S=qe(v??r),C=a.useCallback(()=>{if(!g.current){g.current=!0;return}m.current!=null&&clearTimeout(m.current),m.current=setTimeout(()=>{u(Array.isArray(S.current)?S.current:[S.current]),m.current=null},y)},[y]),j=mt({callback:C,disabled:N||!c}),E=a.useCallback((R,M)=>{j&&(M&&(j.unobserve(M),g.current=!1),R&&j.observe(R))},[j]),[A,T]=dt(E),D=qe(t);return a.useEffect(()=>{!j||!A.current||(j.disconnect(),g.current=!1,j.observe(A.current))},[A,j]),a.useEffect(()=>(l({type:B.RegisterDroppable,element:{id:r,key:o,disabled:n,node:A,rect:p,data:D}}),()=>l({type:B.UnregisterDroppable,key:o,id:r})),[r]),a.useEffect(()=>{n!==h.current.disabled&&(l({type:B.SetDroppableDisabled,id:r,key:o,disabled:n}),h.current.disabled=n)},[r,o,n,l]),{active:c,rect:p,isOver:(d==null?void 0:d.id)===r,node:A,over:d,setNodeRef:T}}function $t(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function ni(e,t){return e.reduce((n,r,i)=>{const o=t.get(r);return o&&(n[i]=o),n},Array(e.length))}function ot(e){return e!==null&&e>=0}function ri(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function si(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const $n=e=>{let{rects:t,activeIndex:n,overIndex:r,index:i}=e;const o=$t(t,r,n),c=t[i],l=o[i];return!l||!c?null:{x:l.left-c.left,y:l.top-c.top,scaleX:l.width/c.width,scaleY:l.height/c.height}},at={scaleX:1,scaleY:1},ii=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:i,rects:o,overIndex:c}=e;const l=(t=o[n])!=null?t:r;if(!l)return null;if(i===n){const u=o[c];return u?{x:0,y:n<c?u.top+u.height-(l.top+l.height):u.top-l.top,...at}:null}const d=oi(o,i,n);return i>n&&i<=c?{x:0,y:-l.height-d,...at}:i<n&&i>=c?{x:0,y:l.height+d,...at}:{x:0,y:0,...at}};function oi(e,t,n){const r=e[t],i=e[t-1],o=e[t+1];return r?n<t?i?r.top-(i.top+i.height):o?o.top-(r.top+r.height):0:o?o.top-(r.top+r.height):i?r.top-(i.top+i.height):0:0}const Xn="Sortable",Wn=K.createContext({activeIndex:-1,containerId:Xn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:$n,disabled:{draggable:!1,droppable:!1}});function ai(e){let{children:t,id:n,items:r,strategy:i=$n,disabled:o=!1}=e;const{active:c,dragOverlay:l,droppableRects:d,over:u,measureDroppableContainers:h}=Qs(),g=tt(Xn,n),p=l.rect!==null,m=a.useMemo(()=>r.map(T=>typeof T=="object"&&"id"in T?T.id:T),[r]),N=c!=null,v=c?m.indexOf(c.id):-1,y=u?m.indexOf(u.id):-1,S=a.useRef(m),C=!ri(m,S.current),j=y!==-1&&v===-1||C,E=si(o);fe(()=>{C&&N&&h(m)},[C,m,N,h]),a.useEffect(()=>{S.current=m},[m]);const A=a.useMemo(()=>({activeIndex:v,containerId:g,disabled:E,disableTransforms:j,items:m,overIndex:y,useDragOverlay:p,sortedRects:ni(m,d),strategy:i}),[v,g,E.draggable,E.droppable,j,m,y,d,p,i]);return K.createElement(Wn.Provider,{value:A},t)}const li=e=>{let{id:t,items:n,activeIndex:r,overIndex:i}=e;return $t(n,r,i).indexOf(t)},ci=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:i,items:o,newIndex:c,previousItems:l,previousContainerId:d,transition:u}=e;return!u||!r||l!==o&&i===c?!1:n?!0:c!==i&&t===d},di={duration:200,easing:"ease"},Yn="transform",ui=Je.Transition.toString({property:Yn,duration:0,easing:"linear"}),fi={roleDescription:"sortable"};function hi(e){let{disabled:t,index:n,node:r,rect:i}=e;const[o,c]=a.useState(null),l=a.useRef(n);return fe(()=>{if(!t&&n!==l.current&&r.current){const d=i.current;if(d){const u=Pe(r.current,{ignoreTransform:!0}),h={x:d.left-u.left,y:d.top-u.top,scaleX:d.width/u.width,scaleY:d.height/u.height};(h.x||h.y)&&c(h)}}n!==l.current&&(l.current=n)},[t,n,r,i]),a.useEffect(()=>{o&&c(null)},[o]),o}function gi(e){let{animateLayoutChanges:t=ci,attributes:n,disabled:r,data:i,getNewIndex:o=li,id:c,strategy:l,resizeObserverConfig:d,transition:u=di}=e;const{items:h,containerId:g,activeIndex:p,disabled:m,disableTransforms:N,sortedRects:v,overIndex:y,useDragOverlay:S,strategy:C}=a.useContext(Wn),j=pi(r,m),E=h.indexOf(c),A=a.useMemo(()=>({sortable:{containerId:g,index:E,items:h},...i}),[g,i,E,h]),T=a.useMemo(()=>h.slice(h.indexOf(c)),[h,c]),{rect:D,node:R,isOver:M,setNodeRef:O}=ti({id:c,data:A,disabled:j.droppable,resizeObserverConfig:{updateMeasurementsFor:T,...d}}),{active:I,activatorEvent:$,activeNodeRect:_,attributes:Y,setNodeRef:ae,listeners:le,isDragging:F,over:ve,setActivatorNodeRef:V,transform:he}=Js({id:c,data:A,attributes:{...fi,...n},disabled:j.draggable}),xe=kr(O,ae),P=!!I,G=P&&!N&&ot(p)&&ot(y),se=!S&&F,ge=se&&G?he:null,X=G?ge??(l??C)({rects:v,activeNodeRect:_,activeIndex:p,overIndex:y,index:E}):null,f=ot(p)&&ot(y)?o({id:c,items:h,activeIndex:p,overIndex:y}):E,w=I==null?void 0:I.id,b=a.useRef({activeId:w,items:h,newIndex:f,containerId:g}),ie=h!==b.current.items,ee=t({active:I,containerId:g,isDragging:F,isSorting:P,id:c,index:E,items:h,newIndex:b.current.newIndex,previousItems:b.current.items,previousContainerId:b.current.containerId,transition:u,wasDragging:b.current.activeId!=null}),ce=hi({disabled:!ee,index:E,node:R,rect:D});return a.useEffect(()=>{P&&b.current.newIndex!==f&&(b.current.newIndex=f),g!==b.current.containerId&&(b.current.containerId=g),h!==b.current.items&&(b.current.items=h)},[P,f,g,h]),a.useEffect(()=>{if(w===b.current.activeId)return;if(w!=null&&b.current.activeId==null){b.current.activeId=w;return}const be=setTimeout(()=>{b.current.activeId=w},50);return()=>clearTimeout(be)},[w]),{active:I,activeIndex:p,attributes:Y,data:A,rect:D,index:E,newIndex:f,items:h,isOver:M,isSorting:P,isDragging:F,listeners:le,node:R,overIndex:y,over:ve,setNodeRef:xe,setActivatorNodeRef:V,setDroppableNodeRef:O,setDraggableNodeRef:ae,transform:ce??X,transition:L()};function L(){if(ce||ie&&b.current.newIndex===E)return ui;if(!(se&&!Bt($)||!u)&&(P||ee))return Je.Transition.toString({...u,property:Yn})}}function pi(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}function ht(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const mi=[k.Down,k.Right,k.Up,k.Left],vi=(e,t)=>{let{context:{active:n,collisionRect:r,droppableRects:i,droppableContainers:o,over:c,scrollableAncestors:l}}=t;if(mi.includes(e.code)){if(e.preventDefault(),!n||!r)return;const d=[];o.getEnabled().forEach(g=>{if(!g||g!=null&&g.disabled)return;const p=i.get(g.id);if(p)switch(e.code){case k.Down:r.top<p.top&&d.push(g);break;case k.Up:r.top>p.top&&d.push(g);break;case k.Left:r.left>p.left&&d.push(g);break;case k.Right:r.left<p.left&&d.push(g);break}});const u=qr({collisionRect:r,droppableRects:i,droppableContainers:d});let h=En(u,"id");if(h===(c==null?void 0:c.id)&&u.length>1&&(h=u[1].id),h!=null){const g=o.get(n.id),p=o.get(h),m=p?i.get(p.id):null,N=p==null?void 0:p.node.current;if(N&&m&&g&&p){const y=pt(N).some((T,D)=>l[D]!==T),S=Un(g,p),C=xi(g,p),j=y||!S?{x:0,y:0}:{x:C?r.width-m.width:0,y:C?r.height-m.height:0},E={x:m.left,y:m.top};return j.x&&j.y?E:Ge(E,j)}}}};function Un(e,t){return!ht(e)||!ht(t)?!1:e.data.current.sortable.containerId===t.data.current.sortable.containerId}function xi(e,t){return!ht(e)||!ht(t)||!Un(e,t)?!1:e.data.current.sortable.index<t.data.current.sortable.index}function bi({block:e,onRemove:t,canRemove:n}){const{attributes:r,listeners:i,setNodeRef:o,transform:c,transition:l,isDragging:d}=gi({id:e.id}),u={transform:Je.Transform.toString(c),transition:l,opacity:d?.5:1};return s.jsxs("div",{ref:o,style:u,className:"flex items-center gap-2 p-3 bg-muted/50 rounded-lg border",children:[s.jsx("button",{className:"cursor-grab active:cursor-grabbing touch-none",...r,...i,children:s.jsx(Tr,{className:"h-4 w-4 text-muted-foreground"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-sm truncate",children:e.name}),e.description&&s.jsx("p",{className:"text-xs text-muted-foreground truncate",children:e.description})]}),s.jsx(lt,{variant:"outline",className:"text-xs flex-shrink-0",children:e.category}),n&&s.jsx(re,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:t,children:s.jsx(jn,{className:"h-4 w-4"})})]})}function wi(){const{toast:e}=yn(),[t,n]=a.useState([]),[r,i]=a.useState([]),[o,c]=a.useState(!0),[l,d]=a.useState(null),[u,h]=a.useState([]),[g,p]=a.useState(!1),[m,N]=a.useState(""),[v,y]=a.useState(""),[S,C]=a.useState([]),[j,E]=a.useState(!1),[A,T]=a.useState(!1),[D,R]=a.useState(!1),[M,O]=a.useState(!1),[I,$]=a.useState(null),[_,Y]=a.useState(!1),[ae,le]=a.useState(!1),F=Hr(ln(zt),ln(Ft,{coordinateGetter:vi}));a.useEffect(()=>{ve()},[]);const ve=async()=>{try{c(!0);const[f,w]=await Promise.all([yr(),jr()]);n(f),i(w)}catch(f){console.error("Error loading templates:",f),e({title:"Ошибка",description:"Не удалось загрузить шаблоны",variant:"destructive"})}finally{c(!1)}},V=f=>{d(f);const w=f.block_template_ids.map(b=>r.find(ie=>ie.id===b)).filter(Boolean);h(w)},he=async()=>{if(!m.trim()){e({title:"Ошибка",description:"Введите название шаблона",variant:"destructive"});return}if(S.length===0){e({title:"Ошибка",description:"Выберите хотя бы один блок",variant:"destructive"});return}try{E(!0);const f=await nn(m.trim(),null,v.trim()||null,S,t.filter(w=>!w.is_system).length===0);n(w=>[...w,f]),p(!1),N(""),y(""),C([]),e({title:"Шаблон создан",description:"Новый шаблон успешно создан"}),V(f)}catch(f){console.error("Error creating template:",f),e({title:"Ошибка",description:f instanceof Error?f.message:"Не удалось создать шаблон",variant:"destructive"})}finally{E(!1)}},xe=async f=>{try{const w=await nn(`${f.name} (копия)`,null,f.description,f.block_template_ids,!1);n(b=>[...b,w]),e({title:"Шаблон скопирован",description:"Копия шаблона создана"})}catch(w){console.error("Error duplicating template:",w),e({title:"Ошибка",description:"Не удалось скопировать шаблон",variant:"destructive"})}},P=async()=>{if(I)try{Y(!0);const{error:f}=await Rt.from("clinical_note_templates").update({is_active:!1}).eq("id",I.id);if(f)throw f;n(w=>w.filter(b=>b.id!==I.id)),(l==null?void 0:l.id)===I.id&&(d(null),h([])),O(!1),$(null),e({title:"Шаблон удалён",description:"Шаблон успешно удалён"})}catch(f){console.error("Error deleting template:",f),e({title:"Ошибка",description:"Не удалось удалить шаблон",variant:"destructive"})}finally{Y(!1)}},G=async f=>{if(l)try{R(!0),await Nr(l.id,f);const w=r.find(b=>b.id===f);w&&(h(b=>[...b,w]),d(b=>b?{...b,block_template_ids:[...b.block_template_ids,f]}:null)),T(!1),e({title:"Блок добавлен",description:"Блок успешно добавлен в шаблон"})}catch(w){console.error("Error adding block:",w),e({title:"Ошибка",description:w instanceof Error?w.message:"Не удалось добавить блок",variant:"destructive"})}finally{R(!1)}},se=async f=>{if(l)try{await Cr(l.id,f),h(w=>w.filter(b=>b.id!==f)),d(w=>w?{...w,block_template_ids:w.block_template_ids.filter(b=>b!==f)}:null),e({title:"Блок удалён",description:"Блок удалён из шаблона"})}catch(w){console.error("Error removing block:",w),e({title:"Ошибка",description:w instanceof Error?w.message:"Не удалось удалить блок",variant:"destructive"})}},ge=async f=>{const{active:w,over:b}=f;if(!b||w.id===b.id||!l)return;const ie=u.findIndex(L=>L.id===w.id),ee=u.findIndex(L=>L.id===b.id),ce=$t(u,ie,ee);h(ce);try{le(!0),await Sr(l.id,ce.map(L=>L.id)),d(L=>L?{...L,block_template_ids:ce.map(be=>be.id)}:null)}catch(L){console.error("Error saving block order:",L),h(u),e({title:"Ошибка",description:"Не удалось сохранить порядок блоков",variant:"destructive"})}finally{le(!1)}},x=r.filter(f=>!(l!=null&&l.block_template_ids.includes(f.id))),X=l&&!l.is_system;return o?s.jsxs("div",{className:"space-y-4",children:[s.jsx(jt,{className:"h-10 w-48"}),s.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[s.jsx(jt,{className:"h-64"}),s.jsx(jt,{className:"h-64"})]})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold",children:"Шаблоны AI-заметок"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Создавайте и настраивайте шаблоны для генерации клинических заметок"})]}),s.jsxs(re,{onClick:()=>p(!0),children:[s.jsx(rn,{className:"h-4 w-4 mr-2"}),"Новый шаблон"]})]}),s.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[s.jsxs(Ie,{children:[s.jsxs(ke,{children:[s.jsx(Me,{className:"text-base",children:"Мои шаблоны"}),s.jsx(Oe,{children:"Выберите шаблон для редактирования"})]}),s.jsx(Le,{className:"space-y-2",children:t.length===0?s.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"У вас пока нет шаблонов. Создайте первый шаблон."}):t.map(f=>s.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${(l==null?void 0:l.id)===f.id?"border-primary bg-primary/5":"hover:bg-muted/50"}`,onClick:()=>V(f),children:[s.jsx(tr,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-medium truncate",children:f.name}),f.is_default&&s.jsx(Dr,{className:"h-3.5 w-3.5 text-yellow-500 flex-shrink-0"}),f.is_system&&s.jsx(Rr,{className:"h-3.5 w-3.5 text-muted-foreground flex-shrink-0"})]}),f.description&&s.jsx("p",{className:"text-xs text-muted-foreground truncate",children:f.description}),s.jsxs("p",{className:"text-xs text-muted-foreground",children:[f.block_template_ids.length," блоков"]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(re,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:w=>{w.stopPropagation(),xe(f)},title:"Копировать",children:s.jsx(Er,{className:"h-4 w-4"})}),!f.is_system&&s.jsx(re,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:w=>{w.stopPropagation(),$(f),O(!0)},title:"Удалить",children:s.jsx(jn,{className:"h-4 w-4"})})]})]},f.id))})]}),s.jsxs(Ie,{children:[s.jsx(ke,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx(Me,{className:"text-base",children:l?l.name:"Блоки шаблона"}),s.jsx(Oe,{children:l?X?"Перетаскивайте блоки для изменения порядка":"Системный шаблон (только просмотр)":"Выберите шаблон слева"})]}),X&&s.jsxs(re,{variant:"outline",size:"sm",onClick:()=>T(!0),disabled:x.length===0,children:[s.jsx(rn,{className:"h-4 w-4 mr-1"}),"Добавить блок"]})]})}),s.jsxs(Le,{children:[l?u.length===0?s.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"В шаблоне пока нет блоков"}):X?s.jsx(Ks,{sensors:F,collisionDetection:Kr,onDragEnd:ge,children:s.jsx(ai,{items:u.map(f=>f.id),strategy:ii,children:s.jsx("div",{className:"space-y-2",children:u.map(f=>s.jsx(bi,{block:f,onRemove:()=>se(f.id),canRemove:u.length>1},f.id))})})}):s.jsx("div",{className:"space-y-2",children:u.map((f,w)=>s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted/50 rounded-lg border",children:[s.jsxs("span",{className:"text-sm text-muted-foreground w-6",children:[w+1,"."]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-sm truncate",children:f.name}),f.description&&s.jsx("p",{className:"text-xs text-muted-foreground truncate",children:f.description})]}),s.jsx(lt,{variant:"outline",className:"text-xs flex-shrink-0",children:f.category})]},f.id))}):s.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Выберите шаблон для просмотра и редактирования блоков"}),ae&&s.jsxs("div",{className:"flex items-center justify-center mt-4 text-sm text-muted-foreground",children:[s.jsx(De,{className:"h-4 w-4 animate-spin mr-2"}),"Сохранение..."]})]})]})]}),s.jsx(Gt,{open:g,onOpenChange:p,children:s.jsxs(Jt,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[s.jsxs(Qt,{children:[s.jsx(Zt,{children:"Новый шаблон"}),s.jsx(en,{children:"Создайте собственный шаблон для генерации AI-заметок"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(H,{htmlFor:"template-name",children:"Название шаблона"}),s.jsx(me,{id:"template-name",value:m,onChange:f=>N(f.target.value),placeholder:"Например: Мой шаблон для EMDR"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(H,{htmlFor:"template-description",children:"Описание (опционально)"}),s.jsx(nr,{id:"template-description",value:v,onChange:f=>y(f.target.value),placeholder:"Краткое описание шаблона",rows:2})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(H,{children:"Выберите блоки"}),s.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Выберите блоки, которые будут включены в шаблон. Порядок можно изменить после создания."}),s.jsx("div",{className:"border rounded-lg p-3 max-h-64 overflow-y-auto space-y-2",children:r.map(f=>s.jsxs("label",{className:"flex items-start gap-3 p-2 rounded hover:bg-muted/50 cursor-pointer",children:[s.jsx(rr,{checked:S.includes(f.id),onCheckedChange:w=>{C(b=>w?[...b,f.id]:b.filter(ie=>ie!==f.id))}}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-sm",children:f.name}),f.description&&s.jsx("p",{className:"text-xs text-muted-foreground",children:f.description})]}),s.jsx(lt,{variant:"outline",className:"text-xs flex-shrink-0",children:f.category})]},f.id))}),s.jsxs("p",{className:"text-xs text-muted-foreground",children:["Выбрано блоков: ",S.length]})]})]}),s.jsxs(sr,{children:[s.jsx(re,{variant:"outline",onClick:()=>{p(!1),N(""),y(""),C([])},children:"Отмена"}),s.jsx(re,{onClick:he,disabled:j,children:j?s.jsxs(s.Fragment,{children:[s.jsx(De,{className:"h-4 w-4 mr-2 animate-spin"}),"Создание..."]}):"Создать шаблон"})]})]})}),s.jsx(Gt,{open:A,onOpenChange:T,children:s.jsxs(Jt,{children:[s.jsxs(Qt,{children:[s.jsx(Zt,{children:"Добавить блок"}),s.jsx(en,{children:"Выберите блок для добавления в шаблон"})]}),s.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:x.length===0?s.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Все доступные блоки уже добавлены в шаблон"}):x.map(f=>s.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border hover:bg-muted/50 cursor-pointer",onClick:()=>G(f.id),children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-sm",children:f.name}),f.description&&s.jsx("p",{className:"text-xs text-muted-foreground",children:f.description})]}),s.jsx(lt,{variant:"outline",className:"text-xs flex-shrink-0",children:f.category})]},f.id))}),D&&s.jsxs("div",{className:"flex items-center justify-center text-sm text-muted-foreground",children:[s.jsx(De,{className:"h-4 w-4 animate-spin mr-2"}),"Добавление..."]})]})}),s.jsx(hr,{open:M,onOpenChange:O,children:s.jsxs(gr,{children:[s.jsxs(pr,{children:[s.jsx(mr,{children:"Удалить шаблон?"}),s.jsxs(vr,{children:['Шаблон "',I==null?void 0:I.name,'" будет удалён. Это действие нельзя отменить.']})]}),s.jsxs(xr,{children:[s.jsx(br,{disabled:_,children:"Отмена"}),s.jsx(wr,{onClick:P,disabled:_,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:_?s.jsxs(s.Fragment,{children:[s.jsx(De,{className:"h-4 w-4 mr-2 animate-spin"}),"Удаление..."]}):"Удалить"})]})]})})]})}function Xi(){const{toast:e}=yn(),{specialistUser:t,refreshSpecialistProfile:n}=ir(),r=t==null?void 0:t.specialist,[i,o]=a.useState(!0),[c,l]=a.useState(!0),[d,u]=a.useState(!0),[h,g]=a.useState(!1);a.useEffect(()=>{r!=null&&r.notification_settings&&(o(r.notification_settings.email_notifications??!0),l(r.notification_settings.appointment_reminders??!0),u(r.notification_settings.new_client_notifications??!0))},[r==null?void 0:r.notification_settings]);const[p,m]=a.useState(""),[N,v]=a.useState(""),[y,S]=a.useState(!1),[C,j]=a.useState("09:00"),[E,A]=a.useState("18:00"),[T,D]=a.useState(["mon","tue","wed","thu","fri"]),[R,M]=a.useState(""),[O,I]=a.useState(""),[$,_]=a.useState(60),[Y,ae]=a.useState(15),[le,F]=a.useState(!1),[ve,V]=a.useState(!0);a.useEffect(()=>{xe()},[]);const he=async()=>{if(r!=null&&r.id)try{g(!0);const{error:x}=await Rt.from("specialists").update({notification_settings:{email_notifications:i,appointment_reminders:c,new_client_notifications:d},updated_at:new Date().toISOString()}).eq("id",r.id);if(x)throw x;await n(),e({title:"Настройки сохранены",description:"Настройки уведомлений успешно обновлены"})}catch(x){console.error("Error saving notification settings:",x),e({title:"Ошибка",description:"Не удалось сохранить настройки уведомлений",variant:"destructive"})}finally{g(!1)}},xe=async()=>{var x,X;try{V(!0);const f=await ur();f&&(j(f.work_start_time.slice(0,5)),A(f.work_end_time.slice(0,5)),D(f.work_days),M(((x=f.break_start_time)==null?void 0:x.slice(0,5))||""),I(((X=f.break_end_time)==null?void 0:X.slice(0,5))||""),_(f.default_slot_duration),ae(f.buffer_between_appointments))}catch(f){console.error("Error loading schedule:",f)}finally{V(!1)}},P=async()=>{if(T.length===0){e({title:"Ошибка",description:"Выберите хотя бы один рабочий день",variant:"destructive"});return}try{F(!0),await fr({workStartTime:C,workEndTime:E,workDays:T,breakStartTime:R||null,breakEndTime:O||null,defaultSlotDuration:$,bufferBetweenAppointments:Y}),e({title:"Расписание сохранено",description:"Ваше рабочее расписание успешно обновлено"})}catch(x){console.error("Error saving schedule:",x),e({title:"Ошибка",description:"Не удалось сохранить расписание",variant:"destructive"})}finally{F(!1)}},G=async()=>{if(p!==N){e({title:"Ошибка",description:"Пароли не совпадают",variant:"destructive"});return}if(p.length<8){e({title:"Ошибка",description:"Пароль должен содержать минимум 8 символов",variant:"destructive"});return}try{S(!0);const{error:x}=await Rt.auth.updateUser({password:p});if(x)throw x;e({title:"Пароль изменён",description:"Ваш пароль успешно обновлён"}),m(""),v("")}catch(x){console.error("Error changing password:",x),e({title:"Ошибка",description:"Не удалось изменить пароль",variant:"destructive"})}finally{S(!1)}},se=x=>{D(X=>X.includes(x)?X.filter(f=>f!==x):[...X,x])},ge={mon:"Пн",tue:"Вт",wed:"Ср",thu:"Чт",fri:"Пт",sat:"Сб",sun:"Вс"};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Настройки"}),s.jsx("p",{className:"text-muted-foreground",children:"Управление настройками аккаунта и предпочтениями"})]}),s.jsxs(cr,{defaultValue:"notifications",className:"space-y-6",children:[s.jsxs(dr,{children:[s.jsxs(st,{value:"notifications",className:"flex items-center gap-2",children:[s.jsx(or,{className:"h-4 w-4"}),"Уведомления"]}),s.jsxs(st,{value:"schedule",className:"flex items-center gap-2",children:[s.jsx(tn,{className:"h-4 w-4"}),"Расписание"]}),s.jsxs(st,{value:"security",className:"flex items-center gap-2",children:[s.jsx(sn,{className:"h-4 w-4"}),"Безопасность"]}),s.jsxs(st,{value:"templates",className:"flex items-center gap-2",children:[s.jsx(ar,{className:"h-4 w-4"}),"Шаблоны AI"]})]}),s.jsx(it,{value:"notifications",className:"space-y-4",children:s.jsxs(Ie,{children:[s.jsxs(ke,{children:[s.jsxs(Me,{className:"flex items-center gap-2",children:[s.jsx(lr,{className:"h-5 w-5"}),"Email-уведомления"]}),s.jsx(Oe,{children:"Настройте какие уведомления вы хотите получать на почту"})]}),s.jsxs(Le,{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(H,{children:"Уведомления о записях"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Получать уведомления о новых записях от клиентов"})]}),s.jsx(yt,{checked:i,onCheckedChange:o})]}),s.jsx(Ye,{}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(H,{children:"Напоминания о консультациях"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Получать напоминания за 30 минут до консультации"})]}),s.jsx(yt,{checked:c,onCheckedChange:l})]}),s.jsx(Ye,{}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(H,{children:"Новые клиенты"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Уведомления о назначении новых клиентов"})]}),s.jsx(yt,{checked:d,onCheckedChange:u})]}),s.jsx(Ye,{}),s.jsx(re,{onClick:he,disabled:h,children:h?s.jsxs(s.Fragment,{children:[s.jsx(De,{className:"mr-2 h-4 w-4 animate-spin"}),"Сохранение..."]}):s.jsxs(s.Fragment,{children:[s.jsx(on,{className:"mr-2 h-4 w-4"}),"Сохранить настройки"]})})]})]})}),s.jsx(it,{value:"schedule",className:"space-y-4",children:s.jsxs(Ie,{children:[s.jsxs(ke,{children:[s.jsxs(Me,{className:"flex items-center gap-2",children:[s.jsx(tn,{className:"h-5 w-5"}),"Рабочие часы"]}),s.jsx(Oe,{children:"Укажите ваши рабочие часы для отображения доступных слотов"})]}),s.jsx(Le,{className:"space-y-6",children:ve?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx(De,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(H,{htmlFor:"start-time",children:"Начало рабочего дня"}),s.jsx(me,{id:"start-time",type:"time",value:C,onChange:x=>j(x.target.value)})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(H,{htmlFor:"end-time",children:"Конец рабочего дня"}),s.jsx(me,{id:"end-time",type:"time",value:E,onChange:x=>A(x.target.value)})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(H,{children:"Рабочие дни"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(ge).map(([x,X])=>s.jsx(re,{variant:T.includes(x)?"default":"outline",size:"sm",onClick:()=>se(x),children:X},x))})]}),s.jsx(Ye,{}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ir,{className:"h-4 w-4 text-muted-foreground"}),s.jsx(H,{children:"Перерыв (опционально)"})]}),s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(H,{htmlFor:"break-start",children:"Начало перерыва"}),s.jsx(me,{id:"break-start",type:"time",value:R,onChange:x=>M(x.target.value),placeholder:"Например, 13:00"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(H,{htmlFor:"break-end",children:"Конец перерыва"}),s.jsx(me,{id:"break-end",type:"time",value:O,onChange:x=>I(x.target.value),placeholder:"Например, 14:00"})]})]})]}),s.jsx(Ye,{}),s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(H,{htmlFor:"slot-duration",children:"Длительность консультации (мин)"}),s.jsx(me,{id:"slot-duration",type:"number",min:15,max:180,step:15,value:$,onChange:x=>_(Number(x.target.value))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(H,{htmlFor:"buffer-time",children:"Перерыв между консультациями (мин)"}),s.jsx(me,{id:"buffer-time",type:"number",min:0,max:60,step:5,value:Y,onChange:x=>ae(Number(x.target.value))})]})]}),s.jsx(re,{onClick:P,disabled:le,children:le?s.jsxs(s.Fragment,{children:[s.jsx(De,{className:"mr-2 h-4 w-4 animate-spin"}),"Сохранение..."]}):s.jsxs(s.Fragment,{children:[s.jsx(on,{className:"mr-2 h-4 w-4"}),"Сохранить расписание"]})})]})})]})}),s.jsxs(it,{value:"security",className:"space-y-4",children:[s.jsxs(Ie,{children:[s.jsxs(ke,{children:[s.jsxs(Me,{className:"flex items-center gap-2",children:[s.jsx(sn,{className:"h-5 w-5"}),"Изменение пароля"]}),s.jsx(Oe,{children:"Измените пароль для входа в аккаунт"})]}),s.jsxs(Le,{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(H,{htmlFor:"new-password",children:"Новый пароль"}),s.jsx(me,{id:"new-password",type:"password",value:p,onChange:x=>m(x.target.value),placeholder:"Минимум 8 символов"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(H,{htmlFor:"confirm-password",children:"Подтвердите пароль"}),s.jsx(me,{id:"confirm-password",type:"password",value:N,onChange:x=>v(x.target.value),placeholder:"Повторите новый пароль"})]}),s.jsx(re,{onClick:G,disabled:y||!p||!N,children:y?s.jsxs(s.Fragment,{children:[s.jsx(De,{className:"mr-2 h-4 w-4 animate-spin"}),"Сохранение..."]}):"Изменить пароль"})]})]}),s.jsxs(Ie,{children:[s.jsxs(ke,{children:[s.jsx(Me,{children:"Активные сессии"}),s.jsx(Oe,{children:"Управление активными сессиями на других устройствах"})]}),s.jsx(Le,{children:s.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Ar,{className:"h-5 w-5 text-muted-foreground"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:"Текущее устройство"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Активна сейчас"})]})]}),s.jsx(re,{variant:"outline",size:"sm",disabled:!0,children:"Текущая"})]})})]})]}),s.jsx(it,{value:"templates",className:"space-y-4",children:s.jsx(wi,{})})]})]})}export{Xi as default};
