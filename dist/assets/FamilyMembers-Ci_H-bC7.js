import{r as t,j as e}from"./vendor-radix-CDHcN1cP.js";import{u as F}from"./vendor-query-DyYoeD25.js";import{S as H}from"./StepIndicator-CN1oIlQO.js";import{u as R,q as S,k as P,C as D,r as z,S as I,B as o,A as q,s as B,t as O,P as Q,g as J,v as u,f as j,w as K}from"./index-Dt6uKTGi.js";import{A as W,a as G,b as U,c as V,d as X,e as Y,f as Z,g as ee}from"./alert-dialog-DIIe8Egt.js";import{u as se,a as te}from"./vendor-react-D0zZO7ze.js";import{P as ae}from"./pencil-DcQUW8kj.js";import{T as re}from"./trash-2-DXIhtIVB.js";import{P as ne}from"./plus-C1Qd69GB.js";import"./vendor-charts-DMFz3Lzq.js";const le="/assets/family-ClrBRI6E.png";function ie(){const[a,r]=t.useState(null);return t.useEffect(()=>{try{const d=localStorage.getItem("waves_licenses"),c=d?JSON.parse(d):[];r(c.length>0)}catch{r(!1)}},[]),a}function je(){var k,C,A;const a=se(),r=te(),d=F(),{user:c}=R(),[i,b]=t.useState([]),[x,f]=t.useState(null),[E,y]=t.useState(!0),L=ie(),h=((k=r.state)==null?void 0:k.from)==="cabinet";t.useEffect(()=>{let s=!1;async function l(){try{s||y(!0);const n=await J();if(s)return;u.log("Loaded profiles:",n),u.log("Profiles with types:",n.map(_=>({name:_.first_name,type:_.type}))),b(n)}catch(n){s||(u.error("Error loading family members:",n),j.error("Ошибка при загрузке членов семьи"))}finally{s||y(!1)}}return l(),()=>{s=!0}},[r.pathname]);const M=t.useCallback(s=>({type:s.type==="partner"||s.type==="parent"?"parent":"child",gender:s.gender||"female"}),[]),T=async s=>{try{await K(s),await d.invalidateQueries({queryKey:["profiles",c==null?void 0:c.id]}),b(l=>l.filter(n=>n.id!==s)),f(null),j.success("Член семьи удален")}catch(l){u.error("Error deleting profile:",l),j.error("Ошибка при удалении члена семьи")}},m=t.useMemo(()=>i.find(s=>s.type==="parent"),[i]),v=(m==null?void 0:m.seeking_care)==="yes",N=t.useMemo(()=>i.filter(s=>s.type==="child"),[i]),w=t.useMemo(()=>N.filter(s=>(s.dob?S(s.dob):0)>=6),[N]),p=((C=r.state)==null?void 0:C.from)!=="cabinet",g=t.useMemo(()=>!p||v?!0:w.length>=1,[p,v,w.length]),$=()=>{g&&a("/cabinet")};return h&&L===!1?e.jsx("div",{className:"min-h-screen",style:{backgroundImage:`url(${P})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"},children:e.jsx("div",{className:"container mx-auto max-w-2xl px-4 py-12",children:e.jsx(D,{className:"rounded-[20px] border-2 bg-white p-8 shadow-[0_4px_20px_rgba(0,0,0,0.06)]",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-6 rounded-full bg-muted/50 flex items-center justify-center",children:e.jsx(z,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx(I,{size:"xl",className:"mb-4",children:"Управление участниками"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Раздел станет доступен после приобретения лицензии. Здесь вы сможете добавить членов семьи, которые будут использовать платформу."}),e.jsxs(o,{onClick:()=>a("/cabinet/licenses"),className:"bg-gradient-to-r from-coral to-coral-light hover:opacity-90",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Приобрести лицензию"]})]})})})}):e.jsxs("div",{className:"min-h-screen",style:{backgroundImage:`url(${P})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"},children:[e.jsx("div",{className:"container mx-auto max-w-2xl px-4 py-12",children:e.jsxs(D,{className:"rounded-[20px] border-2 bg-white p-8 shadow-[0_4px_20px_rgba(0,0,0,0.06)]",children:[!h&&e.jsx(H,{currentStep:3,totalSteps:3,label:"ПРОФИЛЬ СЕМЬИ"}),e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:le,alt:"Семья",className:"mx-auto mb-6 h-32 w-32 object-contain"}),e.jsx(I,{size:"2xl",className:"mb-4",children:"Члены семьи"}),e.jsx("p",{className:"text-muted-foreground",children:"Добавьте только тех членов семьи, которых вы планируете подключить к тренировкам на платформе."})]}),p&&!g&&e.jsxs(q,{variant:"warning",className:"shadow-[0_0_20px_rgba(255,178,153,0.5)]",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(O,{children:"Нужно выбрать хотя бы одного участника старше 6 лет, чтобы получить доступ к тренировкам."})]}),e.jsxs("div",{className:"space-y-4",children:[E?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Загрузка..."})}):i.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Пока нет членов семьи"})}):i.map(s=>{const l=s.dob?S(s.dob):null;return e.jsxs("div",{className:"flex items-center gap-4 rounded-lg border border-border bg-card p-4 transition-shadow hover:shadow-md",children:[e.jsx(Q,{...M(s),size:"md"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-foreground",children:[s.first_name," ",s.last_name||""]}),l!==null&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l," лет"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"icon",onClick:()=>{var n;console.log("Edit clicked for member:",{id:s.id,name:`${s.first_name} ${s.last_name}`,type:s.type,isParent:s.type==="parent"}),s.type==="parent"?a("/profile",{state:{from:((n=r.state)==null?void 0:n.from)==="cabinet"?"cabinet":"family-members"}}):a(`/edit-family-member/${s.id}`,{state:r.state?{from:r.state.from}:void 0})},className:"hover:border-coral hover:text-coral transition-colors",children:e.jsx(ae,{className:"h-4 w-4"})}),s.type!=="parent"&&e.jsx(o,{variant:"outline",size:"icon",onClick:()=>f(s.id),className:"hover:border-destructive hover:text-destructive transition-colors",children:e.jsx(re,{className:"h-4 w-4"})})]})]},s.id)}),e.jsxs(o,{variant:"outline",size:"lg",onClick:()=>{i.length===0||!m?a("/profile",{state:{from:"family-members"}}):a("/add-family-member",{state:{from:h?"cabinet":void 0}})},className:"h-14 w-full text-base font-medium hover:border-coral hover:text-coral transition-colors",children:[e.jsx(ne,{className:"mr-2 h-5 w-5"}),"Добавить члена семьи"]})]}),e.jsx("div",{className:"flex gap-4",children:((A=r.state)==null?void 0:A.from)==="cabinet"?e.jsx(o,{type:"button",size:"lg",onClick:()=>a("/cabinet"),className:"h-14 w-full text-base font-medium",children:"Вернуться в кабинет"}):e.jsxs(e.Fragment,{children:[e.jsx(o,{type:"button",variant:"outline",size:"lg",onClick:()=>a("/family-setup"),className:"h-14 flex-1 text-base font-medium",children:"Назад"}),e.jsx(o,{type:"button",size:"lg",onClick:$,disabled:!g,className:"h-14 flex-1 text-base font-medium",children:"Завершить"})]})})]})]})}),e.jsx(W,{open:x!==null,onOpenChange:()=>f(null),children:e.jsxs(G,{children:[e.jsxs(U,{children:[e.jsx(V,{children:"Удалить члена семьи?"}),e.jsx(X,{children:"Это действие нельзя отменить. Данные члена семьи будут удалены навсегда."})]}),e.jsxs(Y,{children:[e.jsx(Z,{children:"Отмена"}),e.jsx(ee,{onClick:()=>x&&T(x),children:"Удалить"})]})]})})]})}export{je as default};
