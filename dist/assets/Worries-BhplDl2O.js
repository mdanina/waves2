import{r as b,j as e}from"./vendor-radix-CDHcN1cP.js";import{z as U,k as $,S as K,D as g,E as k,G as C,B as M,g as E,f as N,v as f,o as I,y as Q}from"./index-Dt6uKTGi.js";import{u as V,a as X,e as Y}from"./vendor-react-D0zZO7ze.js";import"./vendor-charts-DMFz3Lzq.js";import"./vendor-query-DyYoeD25.js";const T=["Фокус и внимание","Грусть и плач","Тревоги и беспокойства","Питание","Сон и режим","Туалет","Сенсорная чувствительность","Гнев и агрессия","Импульсивность","Травма","Горе и потеря","Буллинг","Самооценка","Школа/детский сад","Удары, укусы или пинки","Гендерная или сексуальная идентичность","Сотрудничество"],y=["Выгорание","Тревожность","Пониженное настроение","Трудности с концентрацией внимания","Общий стресс"],j=["Разделение/развод","Семейный стресс","Отношения с партнером","Психическое здоровье партнера","Воспитание","Семейный конфликт"];function ie(){var R;const v=V(),L=X(),q=Y(),{currentProfileId:A,currentProfile:G,setCurrentProfile:_}=U(),x=q.profileId||A,h=((R=L.state)==null?void 0:R.from)==="cabinet"||!x,[u,H]=b.useState({child:!1,personal:!1,family:!1}),[i,z]=b.useState([]),[D,F]=b.useState(!1),w=b.useRef([]);b.useEffect(()=>{async function r(){try{const t=await E(),n=x?t.find(s=>s.id===x):null,a=t.find(s=>s.type==="parent"),o=t.find(s=>s.type==="partner"),m=n?null:t.find(s=>s.type==="child"),c=n||m,l=[];if(c!=null&&c.worry_tags&&l.push(...c.worry_tags),a!=null&&a.worry_tags){const s=a.worry_tags.filter(p=>y.includes(p)),B=a.worry_tags.filter(p=>j.includes(p));l.push(...s,...B)}o!=null&&o.worry_tags&&l.push(...o.worry_tags);const d=[...new Set(l)];z(d),w.current=d}catch(t){f.error("Error loading worry tags:",t)}}r()},[x]);const W=r=>{H(t=>({...t,[r]:!t[r]}))},P=r=>{z(t=>t.includes(r)?t.filter(n=>n!==r):[...t,r])};return e.jsxs("div",{className:"w-full min-h-screen relative",style:{backgroundImage:`url(${$})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed"},children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-br from-[#ffecd2] via-[#ffd7ba] to-[#fcb69f]",style:{opacity:.25}}),e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"container mx-auto max-w-4xl px-4 py-12",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"text-center",children:e.jsx(K,{size:"2xl",className:"mb-4",children:"Расскажите нам о своих беспокойствах"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-2xl border-2 border-muted bg-white/80 backdrop-blur-sm transition-all duration-200",children:[e.jsxs("button",{onClick:()=>W("child"),className:"flex w-full items-center justify-between p-6 text-left hover:bg-white/90 rounded-2xl focus:outline-none focus:ring-2 focus:ring-coral-light focus:ring-offset-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-lg font-medium text-foreground",children:"Для Ребенка"}),e.jsx(g,{variant:"secondary",className:"rounded-full",children:i.filter(r=>T.includes(r)).length})]}),u.child?e.jsx(k,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(C,{className:"h-5 w-5 text-muted-foreground"})]}),u.child&&e.jsx("div",{className:"border-t border-border p-6",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:T.map(r=>e.jsx(g,{variant:i.includes(r)?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm transition-colors font-light",onClick:()=>P(r),children:r},r))})})]}),e.jsxs("div",{className:"rounded-2xl border-2 border-muted bg-white/80 backdrop-blur-sm transition-all duration-200",children:[e.jsxs("button",{onClick:()=>W("personal"),className:"flex w-full items-center justify-between p-6 text-left hover:bg-white/90 rounded-2xl focus:outline-none focus:ring-2 focus:ring-coral-light focus:ring-offset-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-lg font-medium text-foreground",children:"Для Вас"}),e.jsx(g,{variant:"secondary",className:"rounded-full",children:i.filter(r=>y.includes(r)).length})]}),u.personal?e.jsx(k,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(C,{className:"h-5 w-5 text-muted-foreground"})]}),u.personal&&e.jsx("div",{className:"border-t border-border p-6",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:y.map(r=>e.jsx(g,{variant:i.includes(r)?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm transition-colors font-light",onClick:()=>P(r),children:r},r))})})]}),e.jsxs("div",{className:"rounded-2xl border-2 border-muted bg-white/80 backdrop-blur-sm transition-all duration-200",children:[e.jsxs("button",{onClick:()=>W("family"),className:"flex w-full items-center justify-between p-6 text-left hover:bg-white/90 rounded-2xl focus:outline-none focus:ring-2 focus:ring-coral-light focus:ring-offset-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-lg font-medium text-foreground",children:"Для Вашей Семьи"}),e.jsx(g,{variant:"secondary",className:"rounded-full",children:i.filter(r=>j.includes(r)).length})]}),u.family?e.jsx(k,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(C,{className:"h-5 w-5 text-muted-foreground"})]}),u.family&&e.jsx("div",{className:"border-t border-border p-6",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(r=>e.jsx(g,{variant:i.includes(r)?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm transition-colors font-light",onClick:()=>P(r),children:r},r))})})]})]}),e.jsx(M,{size:"lg",className:"h-14 w-full text-base font-medium",onClick:async()=>{let r=x;if(!r)try{const n=(await E()).find(a=>a.type==="child");if(n)r=n.id,setCurrentProfileId(n.id),_(n);else if(!h){N.error('Не выбран профиль ребенка. Пожалуйста, сначала добавьте ребенка на странице "Члены семьи"'),v("/family-members");return}}catch(t){if(f.error("Error loading profiles:",t),!h){N.error("Ошибка при загрузке профилей"),v("/family-members");return}}try{F(!0);const t=w.current,n=JSON.stringify([...t].sort())!==JSON.stringify([...i].sort()),a=i.filter(s=>T.includes(s)),o=i.filter(s=>y.includes(s)),m=i.filter(s=>j.includes(s));f.log("Saving worry tags:",{childProfileId:r,childWorryTags:a,personalWorryTags:o,familyWorryTags:m,isFromDashboard:h,hasChanges:n,initialCount:t.length,newCount:i.length,added:i.filter(s=>!t.includes(s)),removed:t.filter(s=>!i.includes(s))}),r&&await I(r,{worryTags:a});const c=await E(),l=c.find(s=>s.type==="parent"),d=c.find(s=>s.type==="partner");if(d&&await I(d.id,{worryTags:m}),l){const s=l.worry_tags||[],B=s.filter(S=>y.includes(S)),p=s.filter(S=>j.includes(S)),O=d?p:m,J=[...new Set([...o,...O])];f.log("Saving parent worry tags:",{personalWorryTags:o,familyWorryTags:m,hasPartner:!!d,finalFamilyWorries:O,combinedParentWorries:J}),await I(l.id,{worryTags:J})}if(G&&r)try{const s=await Q(r);s&&_(s)}catch(s){f.error("Error updating profile in context:",s)}w.current=i,n&&f.log("Worry tags updated",{source:h?"dashboard_menu":"onboarding",timestamp:new Date().toISOString(),changes:{added:i.filter(s=>!t.includes(s)),removed:t.filter(s=>!i.includes(s))}}),N.success("Беспокойства сохранены"),v("/cabinet")}catch(t){f.error("Error saving worry tags:",t),N.error("Ошибка при сохранении беспокойств")}finally{F(!1)}},disabled:D,children:D?"Сохранение...":h?"Сохранить":"Далее"})]})})})]})}export{ie as default};
